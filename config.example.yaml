# SesameFS Configuration
# Copy this file to config.yaml and customize for your environment

server:
  port: ":8080"
  read_timeout: 30s
  write_timeout: 300s      # Long timeout for large file uploads
  max_upload_mb: 10240     # 10 GB max upload size

database:
  hosts:
    - localhost:9042
  keyspace: sesamefs
  consistency: LOCAL_QUORUM
  local_dc: datacenter1
  # username: cassandra
  # password: cassandra

storage:
  default_class: hot-s3-usa

  # Storage classes: {tier}-{type}-{region}
  # Each class is a named storage backend with location info
  classes:
    # Hot storage (immediate access) - Multi-region
    hot-s3-usa:
      type: s3
      tier: hot
      endpoint: ""                    # Leave empty for AWS
      bucket: sesamefs-usa
      region: us-east-1
      failover_class: hot-s3-eu       # Failover if this backend is down

    hot-s3-eu:
      type: s3
      tier: hot
      endpoint: ""
      bucket: sesamefs-eu
      region: eu-west-1
      failover_class: hot-s3-usa

    hot-s3-china:
      type: s3
      tier: hot
      endpoint: ""
      bucket: sesamefs-china
      region: cn-north-1

    # Cold storage (delayed access)
    cold-glacier-usa:
      type: glacier
      tier: cold
      bucket: sesamefs-archive-usa
      region: us-east-1

    # Local development (MinIO)
    hot-minio-local:
      type: s3
      tier: hot
      endpoint: "http://localhost:9000"
      bucket: sesamefs-blocks
      region: us-east-1
      access_key: minioadmin
      secret_key: minioadmin
      use_path_style: true            # Required for MinIO

  # Map API hostnames to regions
  endpoint_regions:
    "us.sesamefs.com": "usa"
    "eu.sesamefs.com": "eu"
    "cn.sesamefs.com": "china"
    "*.sesamefs.com": "usa"           # Wildcard default
    "localhost": "local"
    "*": "usa"                        # Global default

  # Map regions to storage classes
  region_classes:
    usa:
      hot: hot-s3-usa
      cold: cold-glacier-usa
    eu:
      hot: hot-s3-eu
      cold: cold-glacier-usa          # Uses USA cold storage
    china:
      hot: hot-s3-china
      cold: ""                        # No cold storage in China yet
    local:
      hot: hot-minio-local
      cold: ""

  # Legacy backends (deprecated, use classes instead)
  # backends:
  #   hot:
  #     type: s3
  #     bucket: sesamefs-blocks-hot

auth:
  dev_mode: true                      # Set to false in production
  dev_tokens:
    - token: "dev-token-123"
      user_id: "00000000-0000-0000-0000-000000000001"
      org_id: "00000000-0000-0000-0000-000000000001"
  oidc:
    issuer: https://accounts.sesamedisk.com
    client_id: ""                     # Set via OIDC_CLIENT_ID env var
    client_secret: ""                 # Set via OIDC_CLIENT_SECRET env var
    scopes:
      - openid
      - profile
      - email

chunking:
  algorithm: fastcdc
  min_size: 524288                    # 512 KB
  avg_size: 2097152                   # 2 MB
  max_size: 8388608                   # 8 MB
  hash_algorithm: sha256

versioning:
  default_ttl_days: 90                # 0 = keep forever
  min_ttl_days: 7
  gc_interval: 24h

# lifecycle:
#   enabled: true
#   check_interval: 1h
#   rules:
#     - age_days: 30
#       from_class: hot
#       to_class: warm
#     - age_days: 90
#       from_class: warm
#       to_class: cold
#     - age_days: 365
#       from_class: cold
#       to_class: frozen
