{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { ReactEditor } from '@seafile/slate-react';\nimport { Editor, Transforms, Range } from '@seafile/slate';\nimport slugid from 'slugid';\nimport copy from 'copy-to-clipboard';\nimport context from '../../../../context';\nimport { FILE_LINK, INSERT_FILE_DISPLAY_TYPE, CODE_BLOCK, CODE_LINE, LINK, PARAGRAPH } from '../../constants';\nimport { getNodeType, getSelectedElems } from '../../core';\nexport var isMenuDisabled = function isMenuDisabled(editor, readonly) {\n  if (readonly) return true;\n  if (editor.selection == null) return true;\n  var selectedElems = getSelectedElems(editor);\n  var notMatch = selectedElems.some(function (elem) {\n    var type = elem.type;\n    if (editor.isVoid(elem)) return true;\n    if ([CODE_BLOCK, CODE_LINE, LINK].includes(type)) return true;\n    return false;\n  });\n  if (notMatch) return true; // disabled\n  return false; // enable\n};\n\nexport var generateFileNode = function generateFileNode(uuid, text) {\n  var fileNode = {\n    id: slugid.nice(),\n    type: FILE_LINK,\n    doc_uuid: uuid,\n    title: text,\n    display_type: INSERT_FILE_DISPLAY_TYPE[0],\n    children: [{\n      id: slugid.nice(),\n      text: text || ''\n    }]\n  };\n  return fileNode;\n};\nexport var getType = function getType(editor) {\n  var _Editor$nodes = Editor.nodes(editor, {\n      match: function match(n) {\n        return getNodeType(n) === FILE_LINK;\n      },\n      universal: true\n    }),\n    _Editor$nodes2 = _slicedToArray(_Editor$nodes, 1),\n    match = _Editor$nodes2[0];\n  if (!match) return PARAGRAPH;\n  var _match = _slicedToArray(match, 1),\n    n = _match[0];\n  return getNodeType(n);\n};\nexport var insertFileLink = function insertFileLink(editor, text, uuid) {\n  if (isMenuDisabled(editor)) return;\n  // Selection folded or not\n  var selection = editor.selection;\n  if (selection == null) return;\n  var isCollapsed = Range.isCollapsed(selection);\n  if (isCollapsed) {\n    var fileNode = generateFileNode(uuid, text);\n    Transforms.insertNodes(editor, fileNode);\n  } else {\n    var selectedText = Editor.string(editor, selection); // Selected text\n    if (selectedText !== text) {\n      // If the selected text is different from the typed text, delete the text and insert the link\n      editor.deleteFragment();\n      var _fileNode = generateFileNode(uuid, text);\n      Transforms.insertNodes(editor, _fileNode);\n    } else {\n      // If the selected text is the same as the entered text, only the link can be wrapped\n      var _fileNode2 = generateFileNode(uuid, text);\n      Transforms.wrapNodes(editor, _fileNode2, {\n        split: true\n      });\n      Transforms.collapse(editor, {\n        edge: 'end'\n      });\n    }\n  }\n};\nexport var unwrapLinkNode = function unwrapLinkNode(editor, element) {\n  if (editor.selection == null) return;\n  var path = ReactEditor.findPath(editor, element);\n  if (path) {\n    Transforms.unwrapNodes(editor, {\n      at: path\n    });\n  }\n};\nexport var getUrl = function getUrl(uuid) {\n  return context.getSdocLocalFileUrl(uuid);\n};\nexport var onCopyFileLinkNode = function onCopyFileLinkNode(editor, element) {\n  if (editor.selection == null || Range.isExpanded(editor.selection)) return;\n  var p = ReactEditor.findPath(editor, element);\n  Transforms.select(editor, p);\n  var newData = editor.setFragmentData(new DataTransfer());\n  copy('copy', {\n    onCopy: function onCopy(clipboardData) {\n      newData.types.forEach(function (type) {\n        var data = newData.getData(type);\n        clipboardData.setData(type, data);\n      });\n    }\n  });\n};","map":{"version":3,"names":["ReactEditor","Editor","Transforms","Range","slugid","copy","context","FILE_LINK","INSERT_FILE_DISPLAY_TYPE","CODE_BLOCK","CODE_LINE","LINK","PARAGRAPH","getNodeType","getSelectedElems","isMenuDisabled","editor","readonly","selection","selectedElems","notMatch","some","elem","type","isVoid","includes","generateFileNode","uuid","text","fileNode","id","nice","doc_uuid","title","display_type","children","getType","_Editor$nodes","nodes","match","n","universal","_Editor$nodes2","_slicedToArray","_match","insertFileLink","isCollapsed","insertNodes","selectedText","string","deleteFragment","wrapNodes","split","collapse","edge","unwrapLinkNode","element","path","findPath","unwrapNodes","at","getUrl","getSdocLocalFileUrl","onCopyFileLinkNode","isExpanded","p","select","newData","setFragmentData","DataTransfer","onCopy","clipboardData","types","forEach","data","getData","setData"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/file-link/helpers.js"],"sourcesContent":["import { ReactEditor } from '@seafile/slate-react';\nimport { Editor, Transforms, Range } from '@seafile/slate';\nimport slugid from 'slugid';\nimport copy from 'copy-to-clipboard';\nimport context from '../../../../context';\nimport { FILE_LINK, INSERT_FILE_DISPLAY_TYPE, CODE_BLOCK, CODE_LINE, LINK, PARAGRAPH } from '../../constants';\nimport { getNodeType, getSelectedElems } from '../../core';\nexport const isMenuDisabled = (editor, readonly) => {\n  if (readonly) return true;\n  if (editor.selection == null) return true;\n  const selectedElems = getSelectedElems(editor);\n  const notMatch = selectedElems.some(elem => {\n    const {\n      type\n    } = elem;\n    if (editor.isVoid(elem)) return true;\n    if ([CODE_BLOCK, CODE_LINE, LINK].includes(type)) return true;\n    return false;\n  });\n  if (notMatch) return true; // disabled\n  return false; // enable\n};\n\nexport const generateFileNode = (uuid, text) => {\n  const fileNode = {\n    id: slugid.nice(),\n    type: FILE_LINK,\n    doc_uuid: uuid,\n    title: text,\n    display_type: INSERT_FILE_DISPLAY_TYPE[0],\n    children: [{\n      id: slugid.nice(),\n      text: text || ''\n    }]\n  };\n  return fileNode;\n};\nexport const getType = editor => {\n  const [match] = Editor.nodes(editor, {\n    match: n => getNodeType(n) === FILE_LINK,\n    universal: true\n  });\n  if (!match) return PARAGRAPH;\n  const [n] = match;\n  return getNodeType(n);\n};\nexport const insertFileLink = (editor, text, uuid) => {\n  if (isMenuDisabled(editor)) return;\n  // Selection folded or not\n  const {\n    selection\n  } = editor;\n  if (selection == null) return;\n  const isCollapsed = Range.isCollapsed(selection);\n  if (isCollapsed) {\n    const fileNode = generateFileNode(uuid, text);\n    Transforms.insertNodes(editor, fileNode);\n  } else {\n    const selectedText = Editor.string(editor, selection); // Selected text\n    if (selectedText !== text) {\n      // If the selected text is different from the typed text, delete the text and insert the link\n      editor.deleteFragment();\n      const fileNode = generateFileNode(uuid, text);\n      Transforms.insertNodes(editor, fileNode);\n    } else {\n      // If the selected text is the same as the entered text, only the link can be wrapped\n      const fileNode = generateFileNode(uuid, text);\n      Transforms.wrapNodes(editor, fileNode, {\n        split: true\n      });\n      Transforms.collapse(editor, {\n        edge: 'end'\n      });\n    }\n  }\n};\nexport const unwrapLinkNode = (editor, element) => {\n  if (editor.selection == null) return;\n  const path = ReactEditor.findPath(editor, element);\n  if (path) {\n    Transforms.unwrapNodes(editor, {\n      at: path\n    });\n  }\n};\nexport const getUrl = uuid => {\n  return context.getSdocLocalFileUrl(uuid);\n};\nexport const onCopyFileLinkNode = (editor, element) => {\n  if (editor.selection == null || Range.isExpanded(editor.selection)) return;\n  const p = ReactEditor.findPath(editor, element);\n  Transforms.select(editor, p);\n  const newData = editor.setFragmentData(new DataTransfer());\n  copy('copy', {\n    onCopy: clipboardData => {\n      newData.types.forEach(type => {\n        const data = newData.getData(type);\n        clipboardData.setData(type, data);\n      });\n    }\n  });\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}