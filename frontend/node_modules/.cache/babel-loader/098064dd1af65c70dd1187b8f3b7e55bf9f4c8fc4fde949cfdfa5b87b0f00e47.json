{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useRef, useCallback, useMemo } from 'react';\nimport classnames from 'classnames';\nimport { useSlateStatic } from '@seafile/slate-react';\nimport ObjectUtils from '../../../../../../utils/object-utils';\nimport { useTableRootContext, useTableSelectedRangeContext } from '../../hooks';\nimport { ELEMENT_TYPE } from '../../../../../constants';\nimport { findPath, getSelectedNodeByType } from '../../../../../core';\nvar ColumnHeader = function ColumnHeader(_ref) {\n  var index = _ref.index,\n    column = _ref.column,\n    addIconPosition = _ref.addIconPosition,\n    setAddIconPosition = _ref.setAddIconPosition,\n    setInsertColumnIndex = _ref.setInsertColumnIndex,\n    selectRange = _ref.selectRange,\n    tableSize = _ref.tableSize,\n    handleDragStart = _ref.handleDragStart,\n    handleDragEnd = _ref.handleDragEnd;\n  var editor = useSlateStatic();\n  var tableSelectedRange = editor.tableSelectedRange;\n  var columnHeaderRef = useRef(null);\n  var tableRoot = useTableRootContext();\n  var selectedRange = useTableSelectedRangeContext();\n  var currentCell = getSelectedNodeByType(editor, ELEMENT_TYPE.TABLE_CELL);\n  var currentCellPath = currentCell ? findPath(editor, currentCell, [-1, -1]) : [-1, -1];\n  var pathLength = currentCellPath.length;\n  var canDrag = useMemo(function () {\n    var minRowIndex = tableSelectedRange.minRowIndex,\n      maxRowIndex = tableSelectedRange.maxRowIndex,\n      minColIndex = tableSelectedRange.minColIndex,\n      maxColIndex = tableSelectedRange.maxColIndex;\n    var _tableSize = _slicedToArray(tableSize, 1),\n      rowNum = _tableSize[0];\n    var isSelectColumn = minRowIndex === 0 && maxRowIndex === rowNum - 1;\n    var isSelectRangeColumn = minColIndex <= index && index <= maxColIndex;\n    var isSelectAllColumn = minColIndex === 0 && maxColIndex === tableSize[1] - 1;\n    if (tableSize[1] === 1 || isSelectAllColumn) return false;\n    if (isSelectColumn && isSelectRangeColumn) return true;\n    return false;\n  }, [index, tableSelectedRange, tableSize]);\n  var onMouseMove = useCallback(function (event) {\n    var _columnHeaderRef$curr = columnHeaderRef.current.getBoundingClientRect(),\n      left = _columnHeaderRef$curr.left,\n      width = _columnHeaderRef$curr.width,\n      top = _columnHeaderRef$curr.top;\n    var tableRootPosition = tableRoot.getBoundingClientRect();\n    var halfElementX = left + width / 2;\n    var nextAddIconPosition = {\n      left: event.clientX > halfElementX ? left + width - 6 : left - 6,\n      top: top\n    };\n    if (tableRootPosition.right < nextAddIconPosition.left) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (tableRootPosition.left - 6 > nextAddIconPosition.left) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (ObjectUtils.isSameObject(nextAddIconPosition, addIconPosition)) return;\n    setInsertColumnIndex(event.clientX > halfElementX ? index : index - 1);\n    setAddIconPosition(nextAddIconPosition);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, column, tableSize]);\n  var onMouseLeave = useCallback(function (event) {\n    setAddIconPosition(undefined);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, column, tableSize]);\n  var isSelectedAColumn = selectedRange.minRowIndex === 0 && selectedRange.maxRowIndex === tableSize[0] - 1;\n  var isSelectedRangeColumn = selectedRange.minColIndex <= index && index <= selectedRange.maxColIndex;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames('sdoc-table-column-header h-100', {\n      'range-selected': isSelectedAColumn && isSelectedRangeColumn,\n      'range-selected-tip': !isSelectedAColumn && isSelectedRangeColumn || currentCellPath[pathLength - 1] === index,\n      'drag': canDrag\n    }),\n    ref: columnHeaderRef,\n    onMouseMove: onMouseMove,\n    onMouseLeave: onMouseLeave,\n    onClick: function onClick() {\n      return selectRange(index);\n    },\n    onDragStart: handleDragStart,\n    onDragEnd: handleDragEnd,\n    style: {\n      width: column.width\n    },\n    draggable: canDrag\n  });\n};\nexport default ColumnHeader;","map":{"version":3,"names":["React","useRef","useCallback","useMemo","classnames","useSlateStatic","ObjectUtils","useTableRootContext","useTableSelectedRangeContext","ELEMENT_TYPE","findPath","getSelectedNodeByType","ColumnHeader","_ref","index","column","addIconPosition","setAddIconPosition","setInsertColumnIndex","selectRange","tableSize","handleDragStart","handleDragEnd","editor","tableSelectedRange","columnHeaderRef","tableRoot","selectedRange","currentCell","TABLE_CELL","currentCellPath","pathLength","length","canDrag","minRowIndex","maxRowIndex","minColIndex","maxColIndex","_tableSize","_slicedToArray","rowNum","isSelectColumn","isSelectRangeColumn","isSelectAllColumn","onMouseMove","event","_columnHeaderRef$curr","current","getBoundingClientRect","left","width","top","tableRootPosition","halfElementX","nextAddIconPosition","clientX","right","undefined","isSameObject","onMouseLeave","isSelectedAColumn","isSelectedRangeColumn","createElement","className","ref","onClick","onDragStart","onDragEnd","style","draggable"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/table/render/table-header/columns-header/column-header.js"],"sourcesContent":["import React, { useRef, useCallback, useMemo } from 'react';\nimport classnames from 'classnames';\nimport { useSlateStatic } from '@seafile/slate-react';\nimport ObjectUtils from '../../../../../../utils/object-utils';\nimport { useTableRootContext, useTableSelectedRangeContext } from '../../hooks';\nimport { ELEMENT_TYPE } from '../../../../../constants';\nimport { findPath, getSelectedNodeByType } from '../../../../../core';\nconst ColumnHeader = _ref => {\n  let {\n    index,\n    column,\n    addIconPosition,\n    setAddIconPosition,\n    setInsertColumnIndex,\n    selectRange,\n    tableSize,\n    handleDragStart,\n    handleDragEnd\n  } = _ref;\n  const editor = useSlateStatic();\n  const {\n    tableSelectedRange\n  } = editor;\n  const columnHeaderRef = useRef(null);\n  const tableRoot = useTableRootContext();\n  const selectedRange = useTableSelectedRangeContext();\n  const currentCell = getSelectedNodeByType(editor, ELEMENT_TYPE.TABLE_CELL);\n  const currentCellPath = currentCell ? findPath(editor, currentCell, [-1, -1]) : [-1, -1];\n  const pathLength = currentCellPath.length;\n  const canDrag = useMemo(() => {\n    const {\n      minRowIndex,\n      maxRowIndex,\n      minColIndex,\n      maxColIndex\n    } = tableSelectedRange;\n    const [rowNum] = tableSize;\n    const isSelectColumn = minRowIndex === 0 && maxRowIndex === rowNum - 1;\n    const isSelectRangeColumn = minColIndex <= index && index <= maxColIndex;\n    const isSelectAllColumn = minColIndex === 0 && maxColIndex === tableSize[1] - 1;\n    if (tableSize[1] === 1 || isSelectAllColumn) return false;\n    if (isSelectColumn && isSelectRangeColumn) return true;\n    return false;\n  }, [index, tableSelectedRange, tableSize]);\n  const onMouseMove = useCallback(event => {\n    const {\n      left,\n      width,\n      top\n    } = columnHeaderRef.current.getBoundingClientRect();\n    const tableRootPosition = tableRoot.getBoundingClientRect();\n    const halfElementX = left + width / 2;\n    const nextAddIconPosition = {\n      left: event.clientX > halfElementX ? left + width - 6 : left - 6,\n      top: top\n    };\n    if (tableRootPosition.right < nextAddIconPosition.left) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (tableRootPosition.left - 6 > nextAddIconPosition.left) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (ObjectUtils.isSameObject(nextAddIconPosition, addIconPosition)) return;\n    setInsertColumnIndex(event.clientX > halfElementX ? index : index - 1);\n    setAddIconPosition(nextAddIconPosition);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, column, tableSize]);\n  const onMouseLeave = useCallback(event => {\n    setAddIconPosition(undefined);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, column, tableSize]);\n  const isSelectedAColumn = selectedRange.minRowIndex === 0 && selectedRange.maxRowIndex === tableSize[0] - 1;\n  const isSelectedRangeColumn = selectedRange.minColIndex <= index && index <= selectedRange.maxColIndex;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames('sdoc-table-column-header h-100', {\n      'range-selected': isSelectedAColumn && isSelectedRangeColumn,\n      'range-selected-tip': !isSelectedAColumn && isSelectedRangeColumn || currentCellPath[pathLength - 1] === index,\n      'drag': canDrag\n    }),\n    ref: columnHeaderRef,\n    onMouseMove: onMouseMove,\n    onMouseLeave: onMouseLeave,\n    onClick: () => selectRange(index),\n    onDragStart: handleDragStart,\n    onDragEnd: handleDragEnd,\n    style: {\n      width: column.width\n    },\n    draggable: canDrag\n  });\n};\nexport default ColumnHeader;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}