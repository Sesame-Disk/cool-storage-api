{"ast":null,"code":"import { Editor, Node, Range, Transforms } from '@seafile/slate';\nimport isHotkey from 'is-hotkey';\nimport { CHECK_LIST_ITEM, PARAGRAPH } from '../../constants';\nimport { focusEditor, generateDefaultText, getSelectedNodeByType } from '../../core';\nvar withCheckList = function withCheckList(editor) {\n  var insertBreak = editor.insertBreak,\n    deleteBackward = editor.deleteBackward,\n    onHotKeyDown = editor.onHotKeyDown;\n  var newEditor = editor;\n  newEditor.insertBreak = function () {\n    var selection = newEditor.selection;\n    if (!selection) {\n      insertBreak();\n      return;\n    }\n    var node = getSelectedNodeByType(editor, CHECK_LIST_ITEM);\n    if (!node) {\n      insertBreak();\n      return;\n    }\n    if (Node.string(node).length === 0) {\n      Transforms.setNodes(editor, {\n        type: PARAGRAPH,\n        children: [generateDefaultText()]\n      }, {\n        at: node[1]\n      });\n      return;\n    }\n\n    // If it is check-list-item, handle your own business logic\n    if (Node.string(node).length > 0) {\n      Transforms.splitNodes(editor, {\n        always: true\n      });\n      Transforms.setNodes(editor, {\n        checked: false\n      }, {\n        at: node[1]\n      });\n      return;\n    }\n    insertBreak();\n    return;\n  };\n  newEditor.deleteBackward = function (unit) {\n    var selection = newEditor.selection;\n    if (selection && Range.isCollapsed(selection)) {\n      var selectedTodo = getSelectedNodeByType(editor, CHECK_LIST_ITEM);\n      if (selectedTodo) {\n        // If the current todo has no text, it will be converted to a paragraph\n        if (Node.string(selectedTodo).length === 0) {\n          Transforms.setNodes(editor, {\n            type: PARAGRAPH,\n            children: [generateDefaultText()]\n          }, {\n            at: selectedTodo[1]\n          });\n          return;\n        }\n      }\n    }\n    deleteBackward(unit);\n  };\n  newEditor.onHotKeyDown = function (event) {\n    var selectedTodo = getSelectedNodeByType(editor, CHECK_LIST_ITEM);\n    if (selectedTodo) {\n      if (isHotkey('shift+enter', event)) {\n        event.preventDefault();\n        var selection = newEditor.selection;\n        var insertPoint = Editor.start(editor, selection);\n        Transforms.insertText(editor, '\\n', {\n          at: insertPoint\n        });\n        focusEditor(editor, {\n          anchor: {\n            path: insertPoint.path,\n            offset: insertPoint.offset + 1\n          },\n          focus: {\n            path: insertPoint.path,\n            offset: insertPoint.offset + 1\n          }\n        });\n      }\n      return true;\n    }\n    return onHotKeyDown && onHotKeyDown(event);\n  };\n  return newEditor;\n};\nexport default withCheckList;","map":{"version":3,"names":["Editor","Node","Range","Transforms","isHotkey","CHECK_LIST_ITEM","PARAGRAPH","focusEditor","generateDefaultText","getSelectedNodeByType","withCheckList","editor","insertBreak","deleteBackward","onHotKeyDown","newEditor","selection","node","string","length","setNodes","type","children","at","splitNodes","always","checked","unit","isCollapsed","selectedTodo","event","preventDefault","insertPoint","start","insertText","anchor","path","offset","focus"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/check-list/plugin.js"],"sourcesContent":["import { Editor, Node, Range, Transforms } from '@seafile/slate';\nimport isHotkey from 'is-hotkey';\nimport { CHECK_LIST_ITEM, PARAGRAPH } from '../../constants';\nimport { focusEditor, generateDefaultText, getSelectedNodeByType } from '../../core';\nconst withCheckList = editor => {\n  const {\n    insertBreak,\n    deleteBackward,\n    onHotKeyDown\n  } = editor;\n  const newEditor = editor;\n  newEditor.insertBreak = () => {\n    const {\n      selection\n    } = newEditor;\n    if (!selection) {\n      insertBreak();\n      return;\n    }\n    const node = getSelectedNodeByType(editor, CHECK_LIST_ITEM);\n    if (!node) {\n      insertBreak();\n      return;\n    }\n    if (Node.string(node).length === 0) {\n      Transforms.setNodes(editor, {\n        type: PARAGRAPH,\n        children: [generateDefaultText()]\n      }, {\n        at: node[1]\n      });\n      return;\n    }\n\n    // If it is check-list-item, handle your own business logic\n    if (Node.string(node).length > 0) {\n      Transforms.splitNodes(editor, {\n        always: true\n      });\n      Transforms.setNodes(editor, {\n        checked: false\n      }, {\n        at: node[1]\n      });\n      return;\n    }\n    insertBreak();\n    return;\n  };\n  newEditor.deleteBackward = unit => {\n    const {\n      selection\n    } = newEditor;\n    if (selection && Range.isCollapsed(selection)) {\n      const selectedTodo = getSelectedNodeByType(editor, CHECK_LIST_ITEM);\n      if (selectedTodo) {\n        // If the current todo has no text, it will be converted to a paragraph\n        if (Node.string(selectedTodo).length === 0) {\n          Transforms.setNodes(editor, {\n            type: PARAGRAPH,\n            children: [generateDefaultText()]\n          }, {\n            at: selectedTodo[1]\n          });\n          return;\n        }\n      }\n    }\n    deleteBackward(unit);\n  };\n  newEditor.onHotKeyDown = event => {\n    const selectedTodo = getSelectedNodeByType(editor, CHECK_LIST_ITEM);\n    if (selectedTodo) {\n      if (isHotkey('shift+enter', event)) {\n        event.preventDefault();\n        const {\n          selection\n        } = newEditor;\n        const insertPoint = Editor.start(editor, selection);\n        Transforms.insertText(editor, '\\n', {\n          at: insertPoint\n        });\n        focusEditor(editor, {\n          anchor: {\n            path: insertPoint.path,\n            offset: insertPoint.offset + 1\n          },\n          focus: {\n            path: insertPoint.path,\n            offset: insertPoint.offset + 1\n          }\n        });\n      }\n      return true;\n    }\n    return onHotKeyDown && onHotKeyDown(event);\n  };\n  return newEditor;\n};\nexport default withCheckList;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}