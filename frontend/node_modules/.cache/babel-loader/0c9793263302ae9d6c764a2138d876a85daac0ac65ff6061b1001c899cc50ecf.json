{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Tooltip from '../../../tooltip';\nimport { getTopLevelChanges, getMergedChanges } from '../../../../basic-sdk/utils/diff';\nimport './index.css';\nvar ChangesCount = function ChangesCount(_ref) {\n  var allChanges = _ref.allChanges;\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var _useState = useState(0),\n    _useState2 = _slicedToArray(_useState, 2),\n    currentDiffIndex = _useState2[0],\n    setDiffIndex = _useState2[1];\n  var _useState3 = useState([]),\n    _useState4 = _slicedToArray(_useState3, 2),\n    changes = _useState4[0],\n    setChanges = _useState4[1];\n  var intervalRef = useRef();\n  useEffect(function () {\n    // Article rendering is delayed, so we need to wait for the Article to render before we can get the changes\n    new Promise(function (resolve) {\n      intervalRef.current = setInterval(function () {\n        var article = document.querySelector('.article');\n        if (article) {\n          clearInterval(intervalRef.current);\n          intervalRef.current = null;\n          resolve();\n        }\n      }, 100);\n    }).then(function () {\n      if (allChanges.changes.length !== 0) {\n        var topLevelChanges = getTopLevelChanges(allChanges.changes);\n        var _changes = getMergedChanges(topLevelChanges, allChanges.value);\n        setChanges(_changes);\n      }\n    });\n    return function () {\n      intervalRef.current && clearInterval(intervalRef.current);\n    };\n  }, [allChanges]);\n  var jumpToElement = useCallback(function (currentDiffIndex) {\n    setDiffIndex(currentDiffIndex);\n    var change = changes[currentDiffIndex];\n    var changeElement = document.querySelectorAll(\"[data-id=\\\"\".concat(change, \"\\\"]\"))[0];\n    if (changeElement) {\n      var scrollContainer = document.getElementById('sdoc-scroll-container');\n      if (scrollContainer) {\n        scrollContainer.scrollTop = changeElement.offsetTop - 10;\n      }\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [changes, currentDiffIndex]);\n  var lastChange = useCallback(function () {\n    if (currentDiffIndex === 0) {\n      jumpToElement(changes.length - 1);\n      return;\n    }\n    jumpToElement(currentDiffIndex - 1);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [changes, currentDiffIndex]);\n  var nextChange = useCallback(function () {\n    if (currentDiffIndex === changes.length - 1) {\n      jumpToElement(0);\n      return;\n    }\n    jumpToElement(currentDiffIndex + 1);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [changes, currentDiffIndex]);\n  if (!Array.isArray(changes) || changes.length === 0) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sdoc-revision-changes-container d-flex align-items-center pl-2 pr-2 ml-4\"\n    }, t('No_changes'));\n  }\n  var changesCount = changes.length;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-container d-flex align-items-center ml-4\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2\"\n  }, \"\".concat(t('Changes'), \" \").concat(currentDiffIndex + 1, \"/\").concat(changesCount)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-divider\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-last d-flex align-items-center justify-content-center\",\n    id: \"sdoc-revision-changes-last\",\n    onClick: lastChange\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-next-page\",\n    style: {\n      transform: 'rotate(-90deg)'\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-divider\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-next d-flex align-items-center justify-content-center\",\n    id: \"sdoc-revision-changes-next\",\n    onClick: nextChange\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-previous-page\",\n    style: {\n      transform: 'rotate(-90deg)'\n    }\n  })), /*#__PURE__*/React.createElement(Tooltip, {\n    placement: \"bottom\",\n    target: \"sdoc-revision-changes-last\"\n  }, t('Last_modification')), /*#__PURE__*/React.createElement(Tooltip, {\n    placement: \"bottom\",\n    target: \"sdoc-revision-changes-next\"\n  }, t('Next_modification')));\n};\nexport default ChangesCount;","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useState","useTranslation","Tooltip","getTopLevelChanges","getMergedChanges","ChangesCount","_ref","allChanges","_useTranslation","t","_useState","_useState2","_slicedToArray","currentDiffIndex","setDiffIndex","_useState3","_useState4","changes","setChanges","intervalRef","Promise","resolve","current","setInterval","article","document","querySelector","clearInterval","then","length","topLevelChanges","value","jumpToElement","change","changeElement","querySelectorAll","concat","scrollContainer","getElementById","scrollTop","offsetTop","lastChange","nextChange","Array","isArray","createElement","className","changesCount","id","onClick","style","transform","placement","target"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/components/doc-operations/revision-operations/changes-count/index.js"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Tooltip from '../../../tooltip';\nimport { getTopLevelChanges, getMergedChanges } from '../../../../basic-sdk/utils/diff';\nimport './index.css';\nconst ChangesCount = _ref => {\n  let {\n    allChanges\n  } = _ref;\n  const {\n    t\n  } = useTranslation();\n  const [currentDiffIndex, setDiffIndex] = useState(0);\n  const [changes, setChanges] = useState([]);\n  const intervalRef = useRef();\n  useEffect(() => {\n    // Article rendering is delayed, so we need to wait for the Article to render before we can get the changes\n    new Promise(resolve => {\n      intervalRef.current = setInterval(() => {\n        const article = document.querySelector('.article');\n        if (article) {\n          clearInterval(intervalRef.current);\n          intervalRef.current = null;\n          resolve();\n        }\n      }, 100);\n    }).then(() => {\n      if (allChanges.changes.length !== 0) {\n        const topLevelChanges = getTopLevelChanges(allChanges.changes);\n        const changes = getMergedChanges(topLevelChanges, allChanges.value);\n        setChanges(changes);\n      }\n    });\n    return () => {\n      intervalRef.current && clearInterval(intervalRef.current);\n    };\n  }, [allChanges]);\n  const jumpToElement = useCallback(currentDiffIndex => {\n    setDiffIndex(currentDiffIndex);\n    const change = changes[currentDiffIndex];\n    const changeElement = document.querySelectorAll(\"[data-id=\\\"\".concat(change, \"\\\"]\"))[0];\n    if (changeElement) {\n      const scrollContainer = document.getElementById('sdoc-scroll-container');\n      if (scrollContainer) {\n        scrollContainer.scrollTop = changeElement.offsetTop - 10;\n      }\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [changes, currentDiffIndex]);\n  const lastChange = useCallback(() => {\n    if (currentDiffIndex === 0) {\n      jumpToElement(changes.length - 1);\n      return;\n    }\n    jumpToElement(currentDiffIndex - 1);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [changes, currentDiffIndex]);\n  const nextChange = useCallback(() => {\n    if (currentDiffIndex === changes.length - 1) {\n      jumpToElement(0);\n      return;\n    }\n    jumpToElement(currentDiffIndex + 1);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [changes, currentDiffIndex]);\n  if (!Array.isArray(changes) || changes.length === 0) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sdoc-revision-changes-container d-flex align-items-center pl-2 pr-2 ml-4\"\n    }, t('No_changes'));\n  }\n  const changesCount = changes.length;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-container d-flex align-items-center ml-4\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2\"\n  }, \"\".concat(t('Changes'), \" \").concat(currentDiffIndex + 1, \"/\").concat(changesCount)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-divider\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-last d-flex align-items-center justify-content-center\",\n    id: \"sdoc-revision-changes-last\",\n    onClick: lastChange\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-next-page\",\n    style: {\n      transform: 'rotate(-90deg)'\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-divider\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-revision-changes-next d-flex align-items-center justify-content-center\",\n    id: \"sdoc-revision-changes-next\",\n    onClick: nextChange\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-previous-page\",\n    style: {\n      transform: 'rotate(-90deg)'\n    }\n  })), /*#__PURE__*/React.createElement(Tooltip, {\n    placement: \"bottom\",\n    target: \"sdoc-revision-changes-last\"\n  }, t('Last_modification')), /*#__PURE__*/React.createElement(Tooltip, {\n    placement: \"bottom\",\n    target: \"sdoc-revision-changes-next\"\n  }, t('Next_modification')));\n};\nexport default ChangesCount;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}