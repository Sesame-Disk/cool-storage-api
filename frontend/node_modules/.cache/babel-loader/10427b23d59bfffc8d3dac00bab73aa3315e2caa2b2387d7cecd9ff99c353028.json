{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import watermark from'watermark-dom';import{seafileAPI}from'../../utils/seafile-api';import{siteName}from'../../utils/constants';import{Utils}from'../../utils/utils';import toaster from'../toast';import FileInfo from'./file-info';import FileToolbar from'./file-toolbar';import FileDetails from'../dirent-detail/file-details';import InsertAd from'../../services/ad';import'../../css/file-view.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var _window$app$pageOptio=window.app.pageOptions,isStarred=_window$app$pageOptio.isStarred,isLocked=_window$app$pageOptio.isLocked,lockedByMe=_window$app$pageOptio.lockedByMe,repoID=_window$app$pageOptio.repoID,filePath=_window$app$pageOptio.filePath,enableWatermark=_window$app$pageOptio.enableWatermark,userNickName=_window$app$pageOptio.userNickName,repoName=_window$app$pageOptio.repoName,parentDir=_window$app$pageOptio.parentDir,fileName=_window$app$pageOptio.fileName;var FileView=/*#__PURE__*/function(_React$Component){_inherits(FileView,_React$Component);var _super=_createSuper(FileView);function FileView(props){var _this;_classCallCheck(this,FileView);_this=_super.call(this,props);_this.toggleDetailsPanel=function(){_this.setState({isDetailsPanelOpen:!_this.state.isDetailsPanelOpen});};_this.toggleStar=function(){if(_this.state.isStarred){seafileAPI.unstarItem(repoID,filePath).then(function(res){_this.setState({isStarred:false});}).catch(function(error){var errorMsg=Utils.getErrorMsg(error);toaster.danger(errorMsg);});}else{seafileAPI.starItem(repoID,filePath).then(function(res){_this.setState({isStarred:true});}).catch(function(error){var errorMsg=Utils.getErrorMsg(error);toaster.danger(errorMsg);});}};_this.toggleLockFile=function(){if(_this.state.isLocked){seafileAPI.unlockfile(repoID,filePath).then(function(res){_this.setState({isLocked:false,lockedByMe:false});}).catch(function(error){var errorMsg=Utils.getErrorMsg(error);toaster.danger(errorMsg);});}else{seafileAPI.lockfile(repoID,filePath).then(function(res){_this.setState({isLocked:true,lockedByMe:true});}).catch(function(error){var errorMsg=Utils.getErrorMsg(error);toaster.danger(errorMsg);});}};_this.state={isStarred:isStarred,isLocked:isLocked,lockedByMe:lockedByMe,isDetailsPanelOpen:false};return _this;}_createClass(FileView,[{key:\"componentDidMount\",value:function componentDidMount(){var fileIcon=Utils.getFileIconUrl(fileName,192);document.getElementById('favicon').href=fileIcon;}},{key:\"render\",value:function render(){var isDetailsPanelOpen=this.state.isDetailsPanelOpen;return/*#__PURE__*/_jsxs(\"div\",{className:\"h-100 d-flex flex-column\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-view-header d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(FileInfo,{isStarred:this.state.isStarred,isLocked:this.state.isLocked,toggleStar:this.toggleStar}),window.innerWidth>450&&/*#__PURE__*/_jsx(InsertAd,{zone:\"file-view\"}),/*#__PURE__*/_jsx(FileToolbar,{isLocked:this.state.isLocked,lockedByMe:this.state.lockedByMe,onSave:this.props.onSave,isSaving:this.props.isSaving,needSave:this.props.needSave,toggleLockFile:this.toggleLockFile,toggleDetailsPanel:this.toggleDetailsPanel})]}),window.innerWidth<=450&&/*#__PURE__*/_jsx(InsertAd,{zone:\"file-view\",center:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"file-view-body flex-auto d-flex o-hidden\",children:[this.props.content,isDetailsPanelOpen&&/*#__PURE__*/_jsx(FileDetails,{repoID:repoID,repoName:repoName,path:parentDir,dirent:{'name':fileName,type:'file'},togglePanel:this.toggleDetailsPanel})]})]});}}]);return FileView;}(React.Component);if(enableWatermark){watermark.init({watermark_txt:\"\".concat(siteName,\" \").concat(userNickName),watermark_alpha:0.075});}export default FileView;","map":{"version":3,"names":["React","watermark","seafileAPI","siteName","Utils","toaster","FileInfo","FileToolbar","FileDetails","InsertAd","jsx","_jsx","jsxs","_jsxs","_window$app$pageOptio","window","app","pageOptions","isStarred","isLocked","lockedByMe","repoID","filePath","enableWatermark","userNickName","repoName","parentDir","fileName","FileView","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","toggleDetailsPanel","setState","isDetailsPanelOpen","state","toggleStar","unstarItem","then","res","catch","error","errorMsg","getErrorMsg","danger","starItem","toggleLockFile","unlockfile","lockfile","_createClass","key","value","componentDidMount","fileIcon","getFileIconUrl","document","getElementById","href","render","className","children","innerWidth","zone","onSave","isSaving","needSave","center","content","path","dirent","type","togglePanel","Component","init","watermark_txt","concat","watermark_alpha"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/file-view/file-view.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport watermark from 'watermark-dom';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { siteName } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\nimport FileInfo from './file-info';\nimport FileToolbar from './file-toolbar';\nimport FileDetails from '../dirent-detail/file-details';\nimport InsertAd from '../../services/ad';\n\nimport '../../css/file-view.css';\n\nconst propTypes = {\n  onSave: PropTypes.func,\n  content: PropTypes.object.isRequired,\n  isSaving: PropTypes.bool,\n  needSave: PropTypes.bool,\n  participants: PropTypes.array,\n  onParticipantsChange: PropTypes.func,\n};\n\nconst { isStarred, isLocked, lockedByMe,\n  repoID, filePath, enableWatermark, userNickName,\n  repoName, parentDir, fileName\n} = window.app.pageOptions;\n\n\nclass FileView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isStarred: isStarred,\n      isLocked: isLocked,\n      lockedByMe: lockedByMe,\n      isDetailsPanelOpen: false\n    };\n  }\n\n  componentDidMount() {\n    const fileIcon = Utils.getFileIconUrl(fileName, 192);\n    document.getElementById('favicon').href = fileIcon;\n  }\n\n  toggleDetailsPanel = () => {\n    this.setState({ isDetailsPanelOpen: !this.state.isDetailsPanelOpen });\n  };\n\n  toggleStar = () => {\n    if (this.state.isStarred) {\n      seafileAPI.unstarItem(repoID, filePath).then((res) => {\n        this.setState({\n          isStarred: false\n        });\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    } else {\n      seafileAPI.starItem(repoID, filePath).then((res) => {\n        this.setState({\n          isStarred: true\n        });\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    }\n  };\n\n  toggleLockFile = () => {\n    if (this.state.isLocked) {\n      seafileAPI.unlockfile(repoID, filePath).then((res) => {\n        this.setState({\n          isLocked: false,\n          lockedByMe: false\n        });\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    } else {\n      seafileAPI.lockfile(repoID, filePath).then((res) => {\n        this.setState({\n          isLocked: true,\n          lockedByMe: true\n        });\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    }\n  };\n\n  render() {\n    const { isDetailsPanelOpen } = this.state;\n    return (\n      <div className=\"h-100 d-flex flex-column\">\n        <div className=\"file-view-header d-flex justify-content-between align-items-center\">\n          <FileInfo\n            isStarred={this.state.isStarred}\n            isLocked={this.state.isLocked}\n            toggleStar={this.toggleStar}\n          />\n          {window.innerWidth > 450 && <InsertAd zone='file-view' />}\n          <FileToolbar\n            isLocked={this.state.isLocked}\n            lockedByMe={this.state.lockedByMe}\n            onSave={this.props.onSave}\n            isSaving={this.props.isSaving}\n            needSave={this.props.needSave}\n            toggleLockFile={this.toggleLockFile}\n            toggleDetailsPanel={this.toggleDetailsPanel}\n          />\n        </div>\n        {window.innerWidth <= 450 && <InsertAd zone='file-view' center={true} />}\n        <div className=\"file-view-body flex-auto d-flex o-hidden\">\n          {this.props.content}\n          {isDetailsPanelOpen &&\n            <FileDetails\n              repoID={repoID}\n              repoName={repoName}\n              path={parentDir}\n              dirent={{ 'name': fileName, type: 'file' }}\n              togglePanel={this.toggleDetailsPanel}\n            />\n          }\n        </div>\n      </div>\n    );\n  }\n}\n\nif (enableWatermark) {\n  watermark.init({\n    watermark_txt: `${siteName} ${userNickName}`,\n    watermark_alpha: 0.075\n  });\n}\n\nFileView.propTypes = propTypes;\n\nexport default FileView;\n"],"mappings":"wkBAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CAEzB,MAAO,CAAAC,SAAS,KAAM,eAAe,CACrC,OAASC,UAAU,KAAQ,yBAAyB,CACpD,OAASC,QAAQ,KAAQ,uBAAuB,CAChD,OAASC,KAAK,KAAQ,mBAAmB,CACzC,MAAO,CAAAC,OAAO,KAAM,UAAU,CAC9B,MAAO,CAAAC,QAAQ,KAAM,aAAa,CAClC,MAAO,CAAAC,WAAW,KAAM,gBAAgB,CACxC,MAAO,CAAAC,WAAW,KAAM,+BAA+B,CACvD,MAAO,CAAAC,QAAQ,KAAM,mBAAmB,CAExC,MAAO,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAWjC,IAAAC,qBAAA,CAGIC,MAAM,CAACC,GAAG,CAACC,WAAW,CAHlBC,SAAS,CAAAJ,qBAAA,CAATI,SAAS,CAAEC,QAAQ,CAAAL,qBAAA,CAARK,QAAQ,CAAEC,UAAU,CAAAN,qBAAA,CAAVM,UAAU,CACrCC,MAAM,CAAAP,qBAAA,CAANO,MAAM,CAAEC,QAAQ,CAAAR,qBAAA,CAARQ,QAAQ,CAAEC,eAAe,CAAAT,qBAAA,CAAfS,eAAe,CAAEC,YAAY,CAAAV,qBAAA,CAAZU,YAAY,CAC/CC,QAAQ,CAAAX,qBAAA,CAARW,QAAQ,CAAEC,SAAS,CAAAZ,qBAAA,CAATY,SAAS,CAAEC,QAAQ,CAAAb,qBAAA,CAARa,QAAQ,CACJ,GAGrB,CAAAC,QAAQ,uBAAAC,gBAAA,EAAAC,SAAA,CAAAF,QAAA,CAAAC,gBAAA,MAAAE,MAAA,CAAAC,YAAA,CAAAJ,QAAA,EAEZ,SAAAA,SAAYK,KAAK,CAAE,KAAAC,KAAA,CAAAC,eAAA,MAAAP,QAAA,EACjBM,KAAA,CAAAH,MAAA,CAAAK,IAAA,MAAMH,KAAK,EAAEC,KAAA,CAcfG,kBAAkB,CAAG,UAAM,CACzBH,KAAA,CAAKI,QAAQ,CAAC,CAAEC,kBAAkB,CAAE,CAACL,KAAA,CAAKM,KAAK,CAACD,kBAAmB,CAAC,CAAC,CACvE,CAAC,CAAAL,KAAA,CAEDO,UAAU,CAAG,UAAM,CACjB,GAAIP,KAAA,CAAKM,KAAK,CAACtB,SAAS,CAAE,CACxBhB,UAAU,CAACwC,UAAU,CAACrB,MAAM,CAAEC,QAAQ,CAAC,CAACqB,IAAI,CAAC,SAACC,GAAG,CAAK,CACpDV,KAAA,CAAKI,QAAQ,CAAC,CACZpB,SAAS,CAAE,KACb,CAAC,CAAC,CACJ,CAAC,CAAC,CAAC2B,KAAK,CAAC,SAACC,KAAK,CAAK,CAClB,GAAM,CAAAC,QAAQ,CAAG3C,KAAK,CAAC4C,WAAW,CAACF,KAAK,CAAC,CACzCzC,OAAO,CAAC4C,MAAM,CAACF,QAAQ,CAAC,CAC1B,CAAC,CAAC,CACJ,CAAC,IAAM,CACL7C,UAAU,CAACgD,QAAQ,CAAC7B,MAAM,CAAEC,QAAQ,CAAC,CAACqB,IAAI,CAAC,SAACC,GAAG,CAAK,CAClDV,KAAA,CAAKI,QAAQ,CAAC,CACZpB,SAAS,CAAE,IACb,CAAC,CAAC,CACJ,CAAC,CAAC,CAAC2B,KAAK,CAAC,SAACC,KAAK,CAAK,CAClB,GAAM,CAAAC,QAAQ,CAAG3C,KAAK,CAAC4C,WAAW,CAACF,KAAK,CAAC,CACzCzC,OAAO,CAAC4C,MAAM,CAACF,QAAQ,CAAC,CAC1B,CAAC,CAAC,CACJ,CACF,CAAC,CAAAb,KAAA,CAEDiB,cAAc,CAAG,UAAM,CACrB,GAAIjB,KAAA,CAAKM,KAAK,CAACrB,QAAQ,CAAE,CACvBjB,UAAU,CAACkD,UAAU,CAAC/B,MAAM,CAAEC,QAAQ,CAAC,CAACqB,IAAI,CAAC,SAACC,GAAG,CAAK,CACpDV,KAAA,CAAKI,QAAQ,CAAC,CACZnB,QAAQ,CAAE,KAAK,CACfC,UAAU,CAAE,KACd,CAAC,CAAC,CACJ,CAAC,CAAC,CAACyB,KAAK,CAAC,SAACC,KAAK,CAAK,CAClB,GAAM,CAAAC,QAAQ,CAAG3C,KAAK,CAAC4C,WAAW,CAACF,KAAK,CAAC,CACzCzC,OAAO,CAAC4C,MAAM,CAACF,QAAQ,CAAC,CAC1B,CAAC,CAAC,CACJ,CAAC,IAAM,CACL7C,UAAU,CAACmD,QAAQ,CAAChC,MAAM,CAAEC,QAAQ,CAAC,CAACqB,IAAI,CAAC,SAACC,GAAG,CAAK,CAClDV,KAAA,CAAKI,QAAQ,CAAC,CACZnB,QAAQ,CAAE,IAAI,CACdC,UAAU,CAAE,IACd,CAAC,CAAC,CACJ,CAAC,CAAC,CAACyB,KAAK,CAAC,SAACC,KAAK,CAAK,CAClB,GAAM,CAAAC,QAAQ,CAAG3C,KAAK,CAAC4C,WAAW,CAACF,KAAK,CAAC,CACzCzC,OAAO,CAAC4C,MAAM,CAACF,QAAQ,CAAC,CAC1B,CAAC,CAAC,CACJ,CACF,CAAC,CA7DCb,KAAA,CAAKM,KAAK,CAAG,CACXtB,SAAS,CAAEA,SAAS,CACpBC,QAAQ,CAAEA,QAAQ,CAClBC,UAAU,CAAEA,UAAU,CACtBmB,kBAAkB,CAAE,KACtB,CAAC,CAAC,OAAAL,KAAA,CACJ,CAACoB,YAAA,CAAA1B,QAAA,GAAA2B,GAAA,qBAAAC,KAAA,CAED,SAAAC,kBAAA,CAAoB,CAClB,GAAM,CAAAC,QAAQ,CAAGtD,KAAK,CAACuD,cAAc,CAAChC,QAAQ,CAAE,GAAG,CAAC,CACpDiC,QAAQ,CAACC,cAAc,CAAC,SAAS,CAAC,CAACC,IAAI,CAAGJ,QAAQ,CACpD,CAAC,GAAAH,GAAA,UAAAC,KAAA,CAoDD,SAAAO,OAAA,CAAS,CACP,GAAQ,CAAAxB,kBAAkB,CAAK,IAAI,CAACC,KAAK,CAAjCD,kBAAkB,CAC1B,mBACE1B,KAAA,QAAKmD,SAAS,CAAC,0BAA0B,CAAAC,QAAA,eACvCpD,KAAA,QAAKmD,SAAS,CAAC,oEAAoE,CAAAC,QAAA,eACjFtD,IAAA,CAACL,QAAQ,EACPY,SAAS,CAAE,IAAI,CAACsB,KAAK,CAACtB,SAAU,CAChCC,QAAQ,CAAE,IAAI,CAACqB,KAAK,CAACrB,QAAS,CAC9BsB,UAAU,CAAE,IAAI,CAACA,UAAW,CAC7B,CAAC,CACD1B,MAAM,CAACmD,UAAU,CAAG,GAAG,eAAIvD,IAAA,CAACF,QAAQ,EAAC0D,IAAI,CAAC,WAAW,CAAE,CAAC,cACzDxD,IAAA,CAACJ,WAAW,EACVY,QAAQ,CAAE,IAAI,CAACqB,KAAK,CAACrB,QAAS,CAC9BC,UAAU,CAAE,IAAI,CAACoB,KAAK,CAACpB,UAAW,CAClCgD,MAAM,CAAE,IAAI,CAACnC,KAAK,CAACmC,MAAO,CAC1BC,QAAQ,CAAE,IAAI,CAACpC,KAAK,CAACoC,QAAS,CAC9BC,QAAQ,CAAE,IAAI,CAACrC,KAAK,CAACqC,QAAS,CAC9BnB,cAAc,CAAE,IAAI,CAACA,cAAe,CACpCd,kBAAkB,CAAE,IAAI,CAACA,kBAAmB,CAC7C,CAAC,EACC,CAAC,CACLtB,MAAM,CAACmD,UAAU,EAAI,GAAG,eAAIvD,IAAA,CAACF,QAAQ,EAAC0D,IAAI,CAAC,WAAW,CAACI,MAAM,CAAE,IAAK,CAAE,CAAC,cACxE1D,KAAA,QAAKmD,SAAS,CAAC,0CAA0C,CAAAC,QAAA,EACtD,IAAI,CAAChC,KAAK,CAACuC,OAAO,CAClBjC,kBAAkB,eACjB5B,IAAA,CAACH,WAAW,EACVa,MAAM,CAAEA,MAAO,CACfI,QAAQ,CAAEA,QAAS,CACnBgD,IAAI,CAAE/C,SAAU,CAChBgD,MAAM,CAAE,CAAE,MAAM,CAAE/C,QAAQ,CAAEgD,IAAI,CAAE,MAAO,CAAE,CAC3CC,WAAW,CAAE,IAAI,CAACvC,kBAAmB,CACtC,CAAC,EAED,CAAC,EACH,CAAC,CAEV,CAAC,WAAAT,QAAA,GAvGoB5B,KAAK,CAAC6E,SAAS,EA0GtC,GAAItD,eAAe,CAAE,CACnBtB,SAAS,CAAC6E,IAAI,CAAC,CACbC,aAAa,IAAAC,MAAA,CAAK7E,QAAQ,MAAA6E,MAAA,CAAIxD,YAAY,CAAE,CAC5CyD,eAAe,CAAE,KACnB,CAAC,CAAC,CACJ,CAIA,cAAe,CAAArD,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}