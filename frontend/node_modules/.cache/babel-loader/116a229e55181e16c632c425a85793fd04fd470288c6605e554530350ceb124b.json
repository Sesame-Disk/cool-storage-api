{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import ReactDom from'react-dom';import{MarkdownViewer}from'@seafile/seafile-editor';import{seafileAPI}from'./utils/seafile-api';import{Utils}from'./utils/utils';import{serviceURL,mediaUrl}from'./utils/constants';import SharedFileView from'./components/shared-file-view/shared-file-view';import SharedFileViewTip from'./components/shared-file-view/shared-file-view-tip';import Loading from'./components/loading';import toaster from'./components/toast';import{jsx as _jsx}from\"react/jsx-runtime\";var _window$shared$pageOp=window.shared.pageOptions,repoID=_window$shared$pageOp.repoID,sharedToken=_window$shared$pageOp.sharedToken,rawPath=_window$shared$pageOp.rawPath,err=_window$shared$pageOp.err;var SharedFileViewMarkdown=/*#__PURE__*/function(_React$Component){_inherits(SharedFileViewMarkdown,_React$Component);var _super=_createSuper(SharedFileViewMarkdown);function SharedFileViewMarkdown(){_classCallCheck(this,SharedFileViewMarkdown);return _super.apply(this,arguments);}_createClass(SharedFileViewMarkdown,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(SharedFileView,{content:/*#__PURE__*/_jsx(FileContent,{}),fileType:\"md\"});}}]);return SharedFileViewMarkdown;}(React.Component);var FileContent=/*#__PURE__*/function(_React$Component2){_inherits(FileContent,_React$Component2);var _super2=_createSuper(FileContent);function FileContent(props){var _this;_classCallCheck(this,FileContent);_this=_super2.call(this,props);_this.changeImageURL=function(innerNode){if(innerNode.type=='image'){var imageUrl=innerNode.data.src;var re=new RegExp(serviceURL+'/lib/'+repoID+'/file.*raw=1');// different repo\nif(!re.test(imageUrl)){return;}// get image path\nvar imagePath=imageUrl.substring(serviceURL.length);var index=imagePath.indexOf('/file');var index2=imagePath.indexOf('?');imagePath=imagePath.substring(index+5,index2);// change image url\n// the image path has been encoded when inserting the image\ninnerNode.data.src=serviceURL+'/view-image-via-share-link/?token='+sharedToken+'&path='+imagePath;}return innerNode;};_this.modifyValueBeforeRender=function(value){return Utils.changeMarkdownNodes(value,_this.changeImageURL);};_this.state={markdownContent:'',loading:!err};return _this;}_createClass(FileContent,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;seafileAPI.getFileContent(rawPath).then(function(res){_this2.setState({markdownContent:res.data,loading:false});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}},{key:\"render\",value:function render(){if(err){return/*#__PURE__*/_jsx(SharedFileViewTip,{});}if(this.state.loading){return/*#__PURE__*/_jsx(Loading,{});}return/*#__PURE__*/_jsx(\"div\",{className:\"shared-file-view-body md-view\",children:/*#__PURE__*/_jsx(MarkdownViewer,{value:this.state.markdownContent,isShowOutline:true,mathJaxSource:mediaUrl+'js/mathjax/tex-svg.js',beforeRenderCallback:this.modifyValueBeforeRender})});}}]);return FileContent;}(React.Component);ReactDom.render(/*#__PURE__*/_jsx(SharedFileViewMarkdown,{}),document.getElementById('wrapper'));","map":{"version":3,"names":["React","ReactDom","MarkdownViewer","seafileAPI","Utils","serviceURL","mediaUrl","SharedFileView","SharedFileViewTip","Loading","toaster","jsx","_jsx","_window$shared$pageOp","window","shared","pageOptions","repoID","sharedToken","rawPath","err","SharedFileViewMarkdown","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","render","content","FileContent","fileType","Component","_React$Component2","_super2","props","_this","call","changeImageURL","innerNode","type","imageUrl","data","src","re","RegExp","test","imagePath","substring","length","index","indexOf","index2","modifyValueBeforeRender","changeMarkdownNodes","state","markdownContent","loading","componentDidMount","_this2","getFileContent","then","res","setState","catch","error","errMessage","getErrorMsg","danger","className","children","isShowOutline","mathJaxSource","beforeRenderCallback","document","getElementById"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/shared-file-view-markdown.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport { MarkdownViewer } from '@seafile/seafile-editor';\nimport { seafileAPI } from './utils/seafile-api';\nimport { Utils } from './utils/utils';\nimport { serviceURL, mediaUrl } from './utils/constants';\nimport SharedFileView from './components/shared-file-view/shared-file-view';\nimport SharedFileViewTip from './components/shared-file-view/shared-file-view-tip';\nimport Loading from './components/loading';\nimport toaster from './components/toast';\n\nconst { repoID, sharedToken, rawPath, err } = window.shared.pageOptions;\n\nclass SharedFileViewMarkdown extends React.Component {\n  render() {\n    return <SharedFileView content={<FileContent />} fileType=\"md\" />;\n  }\n}\n\nclass FileContent extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      markdownContent: '',\n      loading: !err\n    };\n  }\n\n  componentDidMount() {\n    seafileAPI.getFileContent(rawPath).then((res) => {\n      this.setState({\n        markdownContent: res.data,\n        loading: false\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  }\n\n  changeImageURL = (innerNode) => {\n    if (innerNode.type == 'image') {\n      let imageUrl = innerNode.data.src;\n\n      const re = new RegExp(serviceURL + '/lib/' + repoID +'/file.*raw=1');\n\n      // different repo\n      if (!re.test(imageUrl)) {\n        return;\n      }\n      // get image path\n      let imagePath = imageUrl.substring(serviceURL.length);\n      let index = imagePath.indexOf('/file');\n      let index2 = imagePath.indexOf('?');\n      imagePath = imagePath.substring(index + 5, index2);\n      // change image url\n      // the image path has been encoded when inserting the image\n      innerNode.data.src = serviceURL + '/view-image-via-share-link/?token=' + sharedToken + '&path=' + imagePath;\n    }\n    return innerNode;\n  };\n\n  modifyValueBeforeRender = (value) => {\n    return Utils.changeMarkdownNodes(value, this.changeImageURL);\n  };\n\n  render() {\n    if (err) {\n      return <SharedFileViewTip />;\n    }\n\n    if (this.state.loading) {\n      return <Loading />;\n    }\n\n    return (\n      <div className=\"shared-file-view-body md-view\">\n        <MarkdownViewer\n          value={this.state.markdownContent}\n          isShowOutline={true}\n          mathJaxSource={mediaUrl + 'js/mathjax/tex-svg.js'}\n          beforeRenderCallback={this.modifyValueBeforeRender}\n        />\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SharedFileViewMarkdown />, document.getElementById('wrapper'));\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}