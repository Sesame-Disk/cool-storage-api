{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _elementTypes = require(\"../../../constants/element-types\");\nvar _menusConfig = require(\"../../../constants/menus-config\");\nvar _eventBus = _interopRequireDefault(require(\"../../../../utils/event-bus\"));\nvar _eventTypes = require(\"../../../../constants/event-types\");\nvar _helper = require(\"../helper\");\nvar _commons = require(\"../../../commons\");\nvar _imageMenuPopover = _interopRequireDefault(require(\"./image-menu-popover\"));\nvar menuConfig = _menusConfig.MENUS_CONFIG_MAP[_elementTypes.IMAGE];\nvar ImageMenu = function ImageMenu(_ref) {\n  var isRichEditor = _ref.isRichEditor,\n    className = _ref.className,\n    readonly = _ref.readonly,\n    editor = _ref.editor,\n    isSupportInsertSeafileImage = _ref.isSupportInsertSeafileImage;\n  var _ref2 = (0, _react.useState)(false),\n    _ref3 = _slicedToArray(_ref2, 2),\n    isShowImagePopover = _ref3[0],\n    setIsShowImagePopover = _ref3[1];\n  var imagePopoverRef = (0, _react.useRef)(null);\n  var handleChangePopoverDisplayed = (0, _react.useCallback)(function (e) {\n    if (e) {\n      var menu = imagePopoverRef.current;\n      var clickIsInMenu = menu && menu.contains(e.target) && menu !== e.target;\n      if (clickIsInMenu) return;\n    }\n    setIsShowImagePopover(false);\n    unregisterEventHandler();\n    setTimeout(function () {\n      var eventBus = _eventBus.default.getInstance();\n      eventBus.dispatch(_eventTypes.INTERNAL_EVENTS.ON_TOGGLE_IMAGE_POPOVER, false);\n    }, 150);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var registerEventHandler = (0, _react.useCallback)(function () {\n    document.addEventListener('mousedown', handleChangePopoverDisplayed);\n  }, [handleChangePopoverDisplayed]);\n  var unregisterEventHandler = (0, _react.useCallback)(function () {\n    document.removeEventListener('mousedown', handleChangePopoverDisplayed);\n  }, [handleChangePopoverDisplayed]);\n  var onImageMenuToggle = (0, _react.useCallback)(function (e) {\n    e.stopPropagation();\n    e.nativeEvent.stopImmediatePropagation();\n    var state = !isShowImagePopover;\n    var eventBus = _eventBus.default.getInstance();\n    if (state) {\n      setIsShowImagePopover(state);\n      registerEventHandler();\n    } else {\n      setIsShowImagePopover(state);\n      unregisterEventHandler();\n    }\n    eventBus.dispatch(_eventTypes.INTERNAL_EVENTS.ON_TOGGLE_IMAGE_POPOVER, state);\n  }, [isShowImagePopover, registerEventHandler, unregisterEventHandler]);\n  return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_commons.MenuItem, Object.assign({\n    type: Image,\n    isRichEditor: isRichEditor,\n    className: className,\n    disabled: (0, _helper.isMenuDisabled)(editor, readonly),\n    isActive: isShowImagePopover,\n    onMouseDown: onImageMenuToggle\n  }, menuConfig)), isShowImagePopover && /*#__PURE__*/_react.default.createElement(_imageMenuPopover.default, {\n    ref: imagePopoverRef,\n    editor: editor,\n    setIsShowImagePopover: setIsShowImagePopover,\n    unregisterEventHandler: unregisterEventHandler,\n    handelClosePopover: handleChangePopoverDisplayed,\n    isSupportInsertSeafileImage: isSupportInsertSeafileImage\n  }));\n};\nvar _default = exports.default = ImageMenu;","map":{"version":3,"names":["_slicedToArray","require","default","_interopRequireDefault","_interopRequireWildcard","Object","defineProperty","exports","value","_react","_elementTypes","_menusConfig","_eventBus","_eventTypes","_helper","_commons","_imageMenuPopover","menuConfig","MENUS_CONFIG_MAP","IMAGE","ImageMenu","_ref","isRichEditor","className","readonly","editor","isSupportInsertSeafileImage","_ref2","useState","_ref3","isShowImagePopover","setIsShowImagePopover","imagePopoverRef","useRef","handleChangePopoverDisplayed","useCallback","e","menu","current","clickIsInMenu","contains","target","unregisterEventHandler","setTimeout","eventBus","getInstance","dispatch","INTERNAL_EVENTS","ON_TOGGLE_IMAGE_POPOVER","registerEventHandler","document","addEventListener","removeEventListener","onImageMenuToggle","stopPropagation","nativeEvent","stopImmediatePropagation","state","createElement","Fragment","MenuItem","assign","type","Image","disabled","isMenuDisabled","isActive","onMouseDown","ref","handelClosePopover","_default"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/seafile-editor/dist/extension/plugins/image/menu/index.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _elementTypes = require(\"../../../constants/element-types\");\nvar _menusConfig = require(\"../../../constants/menus-config\");\nvar _eventBus = _interopRequireDefault(require(\"../../../../utils/event-bus\"));\nvar _eventTypes = require(\"../../../../constants/event-types\");\nvar _helper = require(\"../helper\");\nvar _commons = require(\"../../../commons\");\nvar _imageMenuPopover = _interopRequireDefault(require(\"./image-menu-popover\"));\nconst menuConfig = _menusConfig.MENUS_CONFIG_MAP[_elementTypes.IMAGE];\nconst ImageMenu = _ref => {\n  let {\n    isRichEditor,\n    className,\n    readonly,\n    editor,\n    isSupportInsertSeafileImage\n  } = _ref;\n  const [isShowImagePopover, setIsShowImagePopover] = (0, _react.useState)(false);\n  const imagePopoverRef = (0, _react.useRef)(null);\n  const handleChangePopoverDisplayed = (0, _react.useCallback)(e => {\n    if (e) {\n      const menu = imagePopoverRef.current;\n      const clickIsInMenu = menu && menu.contains(e.target) && menu !== e.target;\n      if (clickIsInMenu) return;\n    }\n    setIsShowImagePopover(false);\n    unregisterEventHandler();\n    setTimeout(() => {\n      const eventBus = _eventBus.default.getInstance();\n      eventBus.dispatch(_eventTypes.INTERNAL_EVENTS.ON_TOGGLE_IMAGE_POPOVER, false);\n    }, 150);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const registerEventHandler = (0, _react.useCallback)(() => {\n    document.addEventListener('mousedown', handleChangePopoverDisplayed);\n  }, [handleChangePopoverDisplayed]);\n  const unregisterEventHandler = (0, _react.useCallback)(() => {\n    document.removeEventListener('mousedown', handleChangePopoverDisplayed);\n  }, [handleChangePopoverDisplayed]);\n  const onImageMenuToggle = (0, _react.useCallback)(e => {\n    e.stopPropagation();\n    e.nativeEvent.stopImmediatePropagation();\n    const state = !isShowImagePopover;\n    const eventBus = _eventBus.default.getInstance();\n    if (state) {\n      setIsShowImagePopover(state);\n      registerEventHandler();\n    } else {\n      setIsShowImagePopover(state);\n      unregisterEventHandler();\n    }\n    eventBus.dispatch(_eventTypes.INTERNAL_EVENTS.ON_TOGGLE_IMAGE_POPOVER, state);\n  }, [isShowImagePopover, registerEventHandler, unregisterEventHandler]);\n  return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_commons.MenuItem, Object.assign({\n    type: Image,\n    isRichEditor: isRichEditor,\n    className: className,\n    disabled: (0, _helper.isMenuDisabled)(editor, readonly),\n    isActive: isShowImagePopover,\n    onMouseDown: onImageMenuToggle\n  }, menuConfig)), isShowImagePopover && /*#__PURE__*/_react.default.createElement(_imageMenuPopover.default, {\n    ref: imagePopoverRef,\n    editor: editor,\n    setIsShowImagePopover: setIsShowImagePopover,\n    unregisterEventHandler: unregisterEventHandler,\n    handelClosePopover: handleChangePopoverDisplayed,\n    isSupportInsertSeafileImage: isSupportInsertSeafileImage\n  }));\n};\nvar _default = exports.default = ImageMenu;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}