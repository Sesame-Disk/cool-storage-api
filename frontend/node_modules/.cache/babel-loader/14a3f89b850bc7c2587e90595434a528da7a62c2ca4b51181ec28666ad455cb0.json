{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import{gettext,siteRoot}from'../../utils/constants';import{seafileAPI}from'../../utils/seafile-api';import toaster from'../toast';import{Utils}from'../../utils/utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var _window$app$pageOptio=window.app.pageOptions,avatarURL=_window$app$pageOptio.avatarURL,csrfToken=_window$app$pageOptio.csrfToken;var UserAvatarForm=/*#__PURE__*/function(_React$Component){_inherits(UserAvatarForm,_React$Component);var _super=_createSuper(UserAvatarForm);function UserAvatarForm(props){var _this;_classCallCheck(this,UserAvatarForm);_this=_super.call(this,props);_this.fileInputChange=function(){// no file selected\nif(!_this.fileInput.current.files.length){return;}var file=_this.fileInput.current.files[0];var fileName=file.name;// no file extension\nif(fileName.lastIndexOf('.')==-1){toaster.danger(gettext('Please choose an image file.'),{duration:5});return false;}var fileExt=fileName.substr(fileName.lastIndexOf('.')+1).toLowerCase();var allowedExt=['jpg','jpeg','png','gif'];if(allowedExt.indexOf(fileExt)==-1){var errorMsg=gettext('File extensions can only be {placeholder}.').replace('{placeholder}',allowedExt.join(', '));toaster.danger(errorMsg,{duration:5});return false;}// file size should be less than 1MB\nif(file.size>1024*1024){var _errorMsg=gettext('The file is too large. Allowed maximum size is 1MB.');toaster.danger(_errorMsg,{duration:5});return false;}//this.form.current.submit();\nseafileAPI.updateUserAvatar(file,160).then(function(res){_this.setState({avatarSrc:res.data.avatar_url});toaster.success(gettext('Success'));}).catch(function(error){var errorMsg=Utils.getErrorMsg(error);toaster.danger(errorMsg);});};_this.openFileInput=function(){_this.fileInput.current.click();};_this.handleMouseOver=function(){_this.setState({isEditShown:true});};_this.handleMouseOut=function(){_this.setState({isEditShown:false});};_this.onEditIconKeyDown=function(e){if(e.key=='Enter'||e.key=='Space'){e.target.click();}};_this.state={avatarSrc:avatarURL,isEditShown:false};_this.fileInput=/*#__PURE__*/React.createRef();_this.form=/*#__PURE__*/React.createRef();return _this;}_createClass(UserAvatarForm,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"form\",{ref:this.form,className:\"form-group row\",encType:\"multipart/form-data\",method:\"post\",action:\"\".concat(siteRoot,\"avatar/add/\"),children:[/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",name:\"csrfmiddlewaretoken\",value:csrfToken}),/*#__PURE__*/_jsx(\"label\",{className:\"col-sm-1 col-form-label\",children:gettext('Avatar:')}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-auto position-relative\",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,tabIndex:\"0\",children:[/*#__PURE__*/_jsx(\"img\",{src:this.state.avatarSrc,width:\"80\",height:\"80\",alt:\"\",className:\"user-avatar\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"avatar\",className:\"d-none\",onChange:this.fileInputChange,ref:this.fileInput}),/*#__PURE__*/_jsx(\"span\",{className:\"avatar-edit fas fa-edit \".concat(!this.state.isEditShown&&'d-none'),onClick:this.openFileInput,role:\"button\",\"aria-label\":gettext('Edit'),tabIndex:\"0\",onKeyDown:this.onEditIconKeyDown})]})]});}}]);return UserAvatarForm;}(React.Component);export default UserAvatarForm;","map":{"version":3,"names":["React","gettext","siteRoot","seafileAPI","toaster","Utils","jsx","_jsx","jsxs","_jsxs","_window$app$pageOptio","window","app","pageOptions","avatarURL","csrfToken","UserAvatarForm","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","fileInputChange","fileInput","current","files","length","file","fileName","name","lastIndexOf","danger","duration","fileExt","substr","toLowerCase","allowedExt","indexOf","errorMsg","replace","join","size","updateUserAvatar","then","res","setState","avatarSrc","data","avatar_url","success","catch","error","getErrorMsg","openFileInput","click","handleMouseOver","isEditShown","handleMouseOut","onEditIconKeyDown","e","key","target","state","createRef","form","_createClass","value","render","ref","className","encType","method","action","concat","children","type","onMouseOver","onMouseOut","onFocus","tabIndex","src","width","height","alt","onChange","onClick","role","onKeyDown","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/user-settings/user-avatar-form.js"],"sourcesContent":["import React from 'react';\nimport { gettext, siteRoot } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport toaster from '../toast';\nimport { Utils } from '../../utils/utils';\n\nconst { avatarURL, csrfToken } = window.app.pageOptions;\n\nclass UserAvatarForm extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      avatarSrc: avatarURL,\n      isEditShown: false\n    };\n    this.fileInput = React.createRef();\n    this.form = React.createRef();\n  }\n\n  fileInputChange = () => {\n\n    // no file selected\n    if (!this.fileInput.current.files.length) {\n      return;\n    }\n\n    const file = this.fileInput.current.files[0];\n    const fileName = file.name;\n\n    // no file extension\n    if (fileName.lastIndexOf('.') == -1) {\n      toaster.danger(gettext('Please choose an image file.'), {\n        duration: 5\n      });\n      return false;\n    }\n\n    const fileExt = fileName.substr((fileName.lastIndexOf('.') + 1)).toLowerCase();\n    const allowedExt = ['jpg','jpeg', 'png', 'gif'];\n    if (allowedExt.indexOf(fileExt) == -1) {\n      const errorMsg = gettext('File extensions can only be {placeholder}.')\n        .replace('{placeholder}', allowedExt.join(', '));\n      toaster.danger(errorMsg, {duration: 5});\n      return false;\n    }\n\n    // file size should be less than 1MB\n    if (file.size > 1024*1024) {\n      const errorMsg = gettext('The file is too large. Allowed maximum size is 1MB.');\n      toaster.danger(errorMsg, {duration: 5});\n      return false;\n    }\n\n    //this.form.current.submit();\n    seafileAPI.updateUserAvatar(file, 160).then((res) => {\n      this.setState({\n        avatarSrc: res.data.avatar_url\n      });\n      toaster.success(gettext('Success'));\n    }).catch((error) => {\n      let errorMsg = Utils.getErrorMsg(error);\n      toaster.danger(errorMsg);\n    });\n  };\n\n  openFileInput = () => {\n    this.fileInput.current.click();\n  };\n\n  handleMouseOver = () => {\n    this.setState({\n      isEditShown: true\n    });\n  };\n\n  handleMouseOut = () => {\n    this.setState({\n      isEditShown: false\n    });\n  };\n\n  onEditIconKeyDown = (e) => {\n    if (e.key == 'Enter' || e.key == 'Space') {\n      e.target.click();\n    }\n  };\n\n  render() {\n    return (\n      <form ref={this.form} className=\"form-group row\" encType=\"multipart/form-data\" method=\"post\" action={`${siteRoot}avatar/add/`}>\n        <input type=\"hidden\" name=\"csrfmiddlewaretoken\" value={csrfToken} />\n        <label className=\"col-sm-1 col-form-label\">{gettext('Avatar:')}</label>\n        <div className=\"col-auto position-relative\" onMouseOver={this.handleMouseOver} onMouseOut={this.handleMouseOut} onFocus={this.handleMouseOver} tabIndex=\"0\">\n          <img src={this.state.avatarSrc} width=\"80\" height=\"80\" alt=\"\" className=\"user-avatar\" />\n          <input type=\"file\" name=\"avatar\" className=\"d-none\" onChange={this.fileInputChange} ref={this.fileInput} />\n          <span className={`avatar-edit fas fa-edit ${!this.state.isEditShown && 'd-none'}`} onClick={this.openFileInput} role=\"button\" aria-label={gettext('Edit')} tabIndex=\"0\" onKeyDown={this.onEditIconKeyDown}></span>\n        </div>\n      </form>\n    );\n  }\n}\n\nexport default UserAvatarForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}