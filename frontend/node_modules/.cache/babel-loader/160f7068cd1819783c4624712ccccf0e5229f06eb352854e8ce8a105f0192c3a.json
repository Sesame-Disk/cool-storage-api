{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport React, { useCallback, useMemo } from 'react';\nimport { Editable, ReactEditor, Slate } from '@seafile/slate-react';\nimport { Editor, Node, Range } from '@seafile/slate';\nimport isHotkey from 'is-hotkey';\nimport scrollIntoView from 'scroll-into-view-if-needed';\nimport { renderLeaf } from '../extension';\nimport { useCursors } from '../cursor/use-cursors';\nimport { INTERNAL_EVENT } from '../constants';\nimport { usePipDecorate } from '../decorates';\nimport EventBus from '../utils/event-bus';\nimport { IMAGE, IMAGE_BLOCK } from '../extension/constants';\nimport RenderCommentEditorCustomRenderElement from '../extension/render/render-comment-editor-element';\nimport EventProxy from '../utils/event-handler';\nvar CommentArticle = function CommentArticle(_ref) {\n  var editor = _ref.editor,\n    slateValue = _ref.slateValue,\n    updateSlateValue = _ref.updateSlateValue,\n    type = _ref.type;\n  var _useCursors = useCursors(editor),\n    cursors = _useCursors.cursors;\n  var decorate = usePipDecorate(editor);\n  // init eventHandler\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  var eventProxy = useMemo(function () {\n    return new EventProxy(editor);\n  }, []);\n  var onMouseDown = useCallback(function (event) {\n    if (event.button === 0) {\n      // Compatible with the editor which unload table plugin\n      editor.reSetTableSelectedRange && editor.reSetTableSelectedRange();\n      var eventBus = EventBus.getInstance();\n      eventBus.dispatch(INTERNAL_EVENT.CANCEL_TABLE_SELECT_RANGE);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var handleScrollIntoView = useCallback(function (editor, domRange) {\n    try {\n      var selection = editor.selection;\n      // Do not scroll into view, when focus on image\n      var _Editor$nodes = Editor.nodes(editor, {\n          match: function match(n) {\n            return [IMAGE, IMAGE_BLOCK].includes(n.type);\n          },\n          at: selection\n        }),\n        _Editor$nodes2 = _slicedToArray(_Editor$nodes, 1),\n        imageNodeEntry = _Editor$nodes2[0];\n      if (imageNodeEntry) return;\n      var focusedNode = Node.get(editor, selection.focus.path);\n      var domNode = ReactEditor.toDOMNode(editor, focusedNode);\n      if (!domNode) return;\n      scrollIntoView(domNode, {\n        'scrollMode': 'if-needed'\n      });\n    } catch (error) {\n      //\n    }\n  }, []);\n  var onKeyDown = useCallback(function (event) {\n    if (isHotkey('shift+enter', event)) {\n      event.preventDefault();\n      var eventBus = EventBus.getInstance();\n      eventBus.dispatch(INTERNAL_EVENT.COMMENT_EDITOR_POST_COMMENT, event);\n      return;\n    }\n    eventProxy.onKeyDown(event);\n  }, [eventProxy]);\n  return /*#__PURE__*/React.createElement(Slate, {\n    editor: editor,\n    value: slateValue,\n    onChange: updateSlateValue\n  }, /*#__PURE__*/React.createElement(Editable, {\n    id: \"sdoc-editor\",\n    scrollSelectionIntoView: handleScrollIntoView,\n    cursors: cursors,\n    renderElement: function renderElement(props) {\n      return RenderCommentEditorCustomRenderElement(_objectSpread(_objectSpread({}, props), {}, {\n        commentType: type\n      }));\n    },\n    renderLeaf: renderLeaf,\n    onMouseDown: onMouseDown,\n    decorate: decorate,\n    onCut: eventProxy.onCut,\n    onCopy: eventProxy.onCopy,\n    onCompositionStart: eventProxy.onCompositionStart,\n    onCompositionUpdate: eventProxy.onCompositionUpdate,\n    onCompositionEnd: eventProxy.onCompositionEnd,\n    onKeyDown: onKeyDown,\n    onBeforeInput: eventProxy.onBeforeInput\n  }));\n};\nexport default CommentArticle;","map":{"version":3,"names":["_objectSpread","React","useCallback","useMemo","Editable","ReactEditor","Slate","Editor","Node","Range","isHotkey","scrollIntoView","renderLeaf","useCursors","INTERNAL_EVENT","usePipDecorate","EventBus","IMAGE","IMAGE_BLOCK","RenderCommentEditorCustomRenderElement","EventProxy","CommentArticle","_ref","editor","slateValue","updateSlateValue","type","_useCursors","cursors","decorate","eventProxy","onMouseDown","event","button","reSetTableSelectedRange","eventBus","getInstance","dispatch","CANCEL_TABLE_SELECT_RANGE","handleScrollIntoView","domRange","selection","_Editor$nodes","nodes","match","n","includes","at","_Editor$nodes2","_slicedToArray","imageNodeEntry","focusedNode","get","focus","path","domNode","toDOMNode","error","onKeyDown","preventDefault","COMMENT_EDITOR_POST_COMMENT","createElement","value","onChange","id","scrollSelectionIntoView","renderElement","props","commentType","onCut","onCopy","onCompositionStart","onCompositionUpdate","onCompositionEnd","onBeforeInput"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/editor/comment-article.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport React, { useCallback, useMemo } from 'react';\nimport { Editable, ReactEditor, Slate } from '@seafile/slate-react';\nimport { Editor, Node, Range } from '@seafile/slate';\nimport isHotkey from 'is-hotkey';\nimport scrollIntoView from 'scroll-into-view-if-needed';\nimport { renderLeaf } from '../extension';\nimport { useCursors } from '../cursor/use-cursors';\nimport { INTERNAL_EVENT } from '../constants';\nimport { usePipDecorate } from '../decorates';\nimport EventBus from '../utils/event-bus';\nimport { IMAGE, IMAGE_BLOCK } from '../extension/constants';\nimport RenderCommentEditorCustomRenderElement from '../extension/render/render-comment-editor-element';\nimport EventProxy from '../utils/event-handler';\nconst CommentArticle = _ref => {\n  let {\n    editor,\n    slateValue,\n    updateSlateValue,\n    type\n  } = _ref;\n  const {\n    cursors\n  } = useCursors(editor);\n  const decorate = usePipDecorate(editor);\n  // init eventHandler\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const eventProxy = useMemo(() => new EventProxy(editor), []);\n  const onMouseDown = useCallback(event => {\n    if (event.button === 0) {\n      // Compatible with the editor which unload table plugin\n      editor.reSetTableSelectedRange && editor.reSetTableSelectedRange();\n      const eventBus = EventBus.getInstance();\n      eventBus.dispatch(INTERNAL_EVENT.CANCEL_TABLE_SELECT_RANGE);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const handleScrollIntoView = useCallback((editor, domRange) => {\n    try {\n      const {\n        selection\n      } = editor;\n      // Do not scroll into view, when focus on image\n      const [imageNodeEntry] = Editor.nodes(editor, {\n        match: n => [IMAGE, IMAGE_BLOCK].includes(n.type),\n        at: selection\n      });\n      if (imageNodeEntry) return;\n      const focusedNode = Node.get(editor, selection.focus.path);\n      const domNode = ReactEditor.toDOMNode(editor, focusedNode);\n      if (!domNode) return;\n      scrollIntoView(domNode, {\n        'scrollMode': 'if-needed'\n      });\n    } catch (error) {\n      //\n    }\n  }, []);\n  const onKeyDown = useCallback(event => {\n    if (isHotkey('shift+enter', event)) {\n      event.preventDefault();\n      const eventBus = EventBus.getInstance();\n      eventBus.dispatch(INTERNAL_EVENT.COMMENT_EDITOR_POST_COMMENT, event);\n      return;\n    }\n    eventProxy.onKeyDown(event);\n  }, [eventProxy]);\n  return /*#__PURE__*/React.createElement(Slate, {\n    editor: editor,\n    value: slateValue,\n    onChange: updateSlateValue\n  }, /*#__PURE__*/React.createElement(Editable, {\n    id: \"sdoc-editor\",\n    scrollSelectionIntoView: handleScrollIntoView,\n    cursors: cursors,\n    renderElement: props => RenderCommentEditorCustomRenderElement(_objectSpread(_objectSpread({}, props), {}, {\n      commentType: type\n    })),\n    renderLeaf: renderLeaf,\n    onMouseDown: onMouseDown,\n    decorate: decorate,\n    onCut: eventProxy.onCut,\n    onCopy: eventProxy.onCopy,\n    onCompositionStart: eventProxy.onCompositionStart,\n    onCompositionUpdate: eventProxy.onCompositionUpdate,\n    onCompositionEnd: eventProxy.onCompositionEnd,\n    onKeyDown: onKeyDown,\n    onBeforeInput: eventProxy.onBeforeInput\n  }));\n};\nexport default CommentArticle;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}