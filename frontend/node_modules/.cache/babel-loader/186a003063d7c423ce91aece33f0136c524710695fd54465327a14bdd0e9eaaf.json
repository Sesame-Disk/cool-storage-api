{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{SeafileAPI}from'seafile-js';import{siteRoot,serviceURL}from'./constants';var TOKEN_KEY='sesamefs_auth_token';var seafileAPI=new SeafileAPI();// Initialize with token from localStorage if available\nfunction initAPI(){var token=localStorage.getItem(TOKEN_KEY);var server=serviceURL||window.location.origin;if(token){// Token-based authentication for SesameFS\nseafileAPI.init({server:server,token:token});}else{// Initialize without auth - will need to login\nseafileAPI.init({server:server});}}// Check if user is authenticated\nfunction isAuthenticated(){return!!localStorage.getItem(TOKEN_KEY);}// Login and store token\nfunction login(_x,_x2){return _login.apply(this,arguments);}// Logout - clear token\nfunction _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(username,password){var server,response,_error$non_field_erro,error,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:server=serviceURL||window.location.origin;// Call the auth-token endpoint\n_context.next=3;return fetch(\"\".concat(server,\"/api2/auth-token/\"),{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:new URLSearchParams({username:username,password:password})});case 3:response=_context.sent;if(response.ok){_context.next=9;break;}_context.next=7;return response.json().catch(function(){return{};});case 7:error=_context.sent;throw new Error(((_error$non_field_erro=error.non_field_errors)===null||_error$non_field_erro===void 0?void 0:_error$non_field_erro[0])||error.detail||'Login failed');case 9:_context.next=11;return response.json();case 11:data=_context.sent;if(!data.token){_context.next=16;break;}localStorage.setItem(TOKEN_KEY,data.token);// Reinitialize API with the new token\nseafileAPI.init({server:server,token:data.token});return _context.abrupt(\"return\",data);case 16:throw new Error('No token received');case 17:case\"end\":return _context.stop();}},_callee);}));return _login.apply(this,arguments);}function logout(){localStorage.removeItem(TOKEN_KEY);// Redirect to login\nwindow.location.href='/login/';}// Get stored token\nfunction getToken(){return localStorage.getItem(TOKEN_KEY);}// Initialize on load\ninitAPI();export{seafileAPI,isAuthenticated,login,logout,getToken,initAPI};","map":{"version":3,"names":["SeafileAPI","siteRoot","serviceURL","TOKEN_KEY","seafileAPI","initAPI","token","localStorage","getItem","server","window","location","origin","init","isAuthenticated","login","_x","_x2","_login","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","username","password","response","_error$non_field_erro","error","data","wrap","_callee$","_context","prev","next","fetch","concat","method","headers","body","URLSearchParams","sent","ok","json","catch","Error","non_field_errors","detail","setItem","abrupt","stop","logout","removeItem","href","getToken"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/utils/seafile-api.js"],"sourcesContent":["import { SeafileAPI } from 'seafile-js';\nimport { siteRoot, serviceURL } from './constants';\n\nconst TOKEN_KEY = 'sesamefs_auth_token';\n\nlet seafileAPI = new SeafileAPI();\n\n// Initialize with token from localStorage if available\nfunction initAPI() {\n  const token = localStorage.getItem(TOKEN_KEY);\n  const server = serviceURL || window.location.origin;\n\n  if (token) {\n    // Token-based authentication for SesameFS\n    seafileAPI.init({ server, token });\n  } else {\n    // Initialize without auth - will need to login\n    seafileAPI.init({ server });\n  }\n}\n\n// Check if user is authenticated\nfunction isAuthenticated() {\n  return !!localStorage.getItem(TOKEN_KEY);\n}\n\n// Login and store token\nasync function login(username, password) {\n  const server = serviceURL || window.location.origin;\n\n  // Call the auth-token endpoint\n  const response = await fetch(`${server}/api2/auth-token/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: new URLSearchParams({\n      username: username,\n      password: password,\n    }),\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({}));\n    throw new Error(error.non_field_errors?.[0] || error.detail || 'Login failed');\n  }\n\n  const data = await response.json();\n\n  if (data.token) {\n    localStorage.setItem(TOKEN_KEY, data.token);\n    // Reinitialize API with the new token\n    seafileAPI.init({ server, token: data.token });\n    return data;\n  }\n\n  throw new Error('No token received');\n}\n\n// Logout - clear token\nfunction logout() {\n  localStorage.removeItem(TOKEN_KEY);\n  // Redirect to login\n  window.location.href = '/login/';\n}\n\n// Get stored token\nfunction getToken() {\n  return localStorage.getItem(TOKEN_KEY);\n}\n\n// Initialize on load\ninitAPI();\n\nexport { seafileAPI, isAuthenticated, login, logout, getToken, initAPI };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}