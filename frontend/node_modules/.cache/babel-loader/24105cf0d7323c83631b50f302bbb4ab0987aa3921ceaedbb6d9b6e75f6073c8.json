{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _slicedToArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _toConsumableArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.normalizeListItem = void 0;\nvar _slate = require(\"slate\");\nvar _core = require(\"../../../core\");\nvar _moveListItemUp = require(\"./move-list-item-up\");\nvar _constant = require(\"../constant\");\nvar _elementTypes = require(\"../../../constants/element-types\");\nvar normalizeListItem = function normalizeListItem(editor, _ref) {\n  var listItem = _ref.listItem;\n  var changed = false;\n\n  // patch old version\n  var validLiChildrenTypes = [].concat(_toConsumableArray(_constant.LIST_TYPES), [_elementTypes.PARAGRAPH, _elementTypes.CODE_BLOCK, _elementTypes.BLOCKQUOTE]);\n  var _listItem = _slicedToArray(listItem, 2),\n    liPath = _listItem[1];\n  var liChildren = (0, _core.getChildren)(listItem);\n  var invalidLiChildrenPathRefs = liChildren.filter(function (_ref2) {\n    var _ref5 = _slicedToArray(_ref2, 1),\n      child = _ref5[0];\n    return !validLiChildrenTypes.includes(child.type);\n  }).map(function (_ref3) {\n    var _ref6 = _slicedToArray(_ref3, 2),\n      childPath = _ref6[1];\n    return _slate.Editor.pathRef(editor, childPath);\n  });\n  var firstLiChild = liChildren[0];\n  var _ref7 = firstLiChild !== null && firstLiChild !== void 0 ? firstLiChild : [],\n    _ref8 = _slicedToArray(_ref7, 2),\n    firstLiChildNode = _ref8[0],\n    firstLiChildPath = _ref8[1];\n  if (!firstLiChild || !_slate.Editor.isBlock(editor, firstLiChildNode)) {\n    var emptyLic = (0, _core.generateElement)(_elementTypes.PARAGRAPH);\n    _slate.Transforms.insertNodes(editor, emptyLic, {\n      at: liPath.concat([0])\n    });\n    return true;\n  }\n  if (_slate.Editor.isBlock(editor, firstLiChildNode) && !(0, _core.match)(firstLiChildNode, [], {\n    type: [_elementTypes.PARAGRAPH]\n  })) {\n    if ((0, _core.match)(firstLiChildNode, [], {\n      type: _constant.LIST_TYPES\n    })) {\n      var parent = _slate.Editor.parent(editor, listItem[1]);\n      var subList = firstLiChild;\n      var children = (0, _core.getChildren)(firstLiChild).reverse();\n      children.forEach(function (c) {\n        (0, _moveListItemUp.movedListItemUp)(editor, {\n          list: subList,\n          listItem: c\n        });\n      });\n      _slate.Transforms.removeNodes(editor, {\n        at: [].concat(_toConsumableArray(parent[1]), [0])\n      });\n      return true;\n    }\n    if (validLiChildrenTypes.includes(firstLiChildNode.type)) {\n      return true;\n    }\n    _slate.Transforms.setNodes(editor, {\n      type: _elementTypes.PARAGRAPH\n    }, {\n      at: firstLiChildPath\n    });\n    changed = true;\n  }\n  var licChildren = (0, _core.getChildren)(firstLiChild);\n  if (licChildren.length) {\n    var _licChildren;\n    var blockPathRefs = [];\n    var inlineChildren = [];\n    var _iterator = _createForOfIteratorHelper(licChildren),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var licChild = _step.value;\n        if (!(_slate.Element.isElement(licChild[0]) && _slate.Editor.isBlock(editor, licChild[0]))) {\n          break;\n        }\n        blockPathRefs.push(_slate.Editor.pathRef(editor, licChild[1]));\n        inlineChildren.push.apply(inlineChildren, _toConsumableArray((0, _core.getDeepInlineChildren)(editor, {\n          children: (0, _core.getChildren)(licChild)\n        })));\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n    var to = _slate.Path.next((_licChildren = licChildren[licChildren.length - 1]) === null || _licChildren === void 0 ? void 0 : _licChildren[1]);\n    inlineChildren.reverse().forEach(function (_ref4) {\n      var _ref9 = _slicedToArray(_ref4, 2),\n        path = _ref9[1];\n      _slate.Transforms.moveNodes(editor, {\n        at: path,\n        to: to\n      });\n    });\n    blockPathRefs.forEach(function (pathRef) {\n      var path = pathRef.unref();\n      path && _slate.Transforms.removeNodes(editor, {\n        at: path\n      });\n    });\n    if (blockPathRefs.length) {\n      changed = true;\n    }\n  }\n  if (changed) return true;\n  invalidLiChildrenPathRefs.reverse().forEach(function (ref) {\n    var path = ref.unref();\n    path && _slate.Transforms.moveNodes(editor, {\n      at: path,\n      to: firstLiChildPath.concat([0])\n    });\n  });\n  return !!invalidLiChildrenPathRefs.length;\n};\nexports.normalizeListItem = normalizeListItem;","map":{"version":3,"names":["_createForOfIteratorHelper","require","default","_slicedToArray","_toConsumableArray","Object","defineProperty","exports","value","normalizeListItem","_slate","_core","_moveListItemUp","_constant","_elementTypes","editor","_ref","listItem","changed","validLiChildrenTypes","concat","LIST_TYPES","PARAGRAPH","CODE_BLOCK","BLOCKQUOTE","_listItem","liPath","liChildren","getChildren","invalidLiChildrenPathRefs","filter","_ref2","_ref5","child","includes","type","map","_ref3","_ref6","childPath","Editor","pathRef","firstLiChild","_ref7","_ref8","firstLiChildNode","firstLiChildPath","isBlock","emptyLic","generateElement","Transforms","insertNodes","at","match","parent","subList","children","reverse","forEach","c","movedListItemUp","list","removeNodes","setNodes","licChildren","length","_licChildren","blockPathRefs","inlineChildren","_iterator","_step","s","n","done","licChild","Element","isElement","push","apply","getDeepInlineChildren","err","e","f","to","Path","next","_ref4","_ref9","path","moveNodes","unref","ref"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/seafile-editor/dist/extension/plugins/list/transforms/normalize-list-item.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.normalizeListItem = void 0;\nvar _slate = require(\"slate\");\nvar _core = require(\"../../../core\");\nvar _moveListItemUp = require(\"./move-list-item-up\");\nvar _constant = require(\"../constant\");\nvar _elementTypes = require(\"../../../constants/element-types\");\nconst normalizeListItem = (editor, _ref) => {\n  let {\n    listItem\n  } = _ref;\n  let changed = false;\n\n  // patch old version\n  const validLiChildrenTypes = [..._constant.LIST_TYPES, _elementTypes.PARAGRAPH, _elementTypes.CODE_BLOCK, _elementTypes.BLOCKQUOTE];\n  const [, liPath] = listItem;\n  const liChildren = (0, _core.getChildren)(listItem);\n  const invalidLiChildrenPathRefs = liChildren.filter(_ref2 => {\n    let [child] = _ref2;\n    return !validLiChildrenTypes.includes(child.type);\n  }).map(_ref3 => {\n    let [, childPath] = _ref3;\n    return _slate.Editor.pathRef(editor, childPath);\n  });\n  const firstLiChild = liChildren[0];\n  const [firstLiChildNode, firstLiChildPath] = firstLiChild !== null && firstLiChild !== void 0 ? firstLiChild : [];\n  if (!firstLiChild || !_slate.Editor.isBlock(editor, firstLiChildNode)) {\n    const emptyLic = (0, _core.generateElement)(_elementTypes.PARAGRAPH);\n    _slate.Transforms.insertNodes(editor, emptyLic, {\n      at: liPath.concat([0])\n    });\n    return true;\n  }\n  if (_slate.Editor.isBlock(editor, firstLiChildNode) && !(0, _core.match)(firstLiChildNode, [], {\n    type: [_elementTypes.PARAGRAPH]\n  })) {\n    if ((0, _core.match)(firstLiChildNode, [], {\n      type: _constant.LIST_TYPES\n    })) {\n      const parent = _slate.Editor.parent(editor, listItem[1]);\n      const subList = firstLiChild;\n      const children = (0, _core.getChildren)(firstLiChild).reverse();\n      children.forEach(c => {\n        (0, _moveListItemUp.movedListItemUp)(editor, {\n          list: subList,\n          listItem: c\n        });\n      });\n      _slate.Transforms.removeNodes(editor, {\n        at: [...parent[1], 0]\n      });\n      return true;\n    }\n    if (validLiChildrenTypes.includes(firstLiChildNode.type)) {\n      return true;\n    }\n    _slate.Transforms.setNodes(editor, {\n      type: _elementTypes.PARAGRAPH\n    }, {\n      at: firstLiChildPath\n    });\n    changed = true;\n  }\n  const licChildren = (0, _core.getChildren)(firstLiChild);\n  if (licChildren.length) {\n    var _licChildren;\n    const blockPathRefs = [];\n    const inlineChildren = [];\n    for (const licChild of licChildren) {\n      if (!(_slate.Element.isElement(licChild[0]) && _slate.Editor.isBlock(editor, licChild[0]))) {\n        break;\n      }\n      blockPathRefs.push(_slate.Editor.pathRef(editor, licChild[1]));\n      inlineChildren.push(...(0, _core.getDeepInlineChildren)(editor, {\n        children: (0, _core.getChildren)(licChild)\n      }));\n    }\n    const to = _slate.Path.next((_licChildren = licChildren[licChildren.length - 1]) === null || _licChildren === void 0 ? void 0 : _licChildren[1]);\n    inlineChildren.reverse().forEach(_ref4 => {\n      let [, path] = _ref4;\n      _slate.Transforms.moveNodes(editor, {\n        at: path,\n        to\n      });\n    });\n    blockPathRefs.forEach(pathRef => {\n      const path = pathRef.unref();\n      path && _slate.Transforms.removeNodes(editor, {\n        at: path\n      });\n    });\n    if (blockPathRefs.length) {\n      changed = true;\n    }\n  }\n  if (changed) return true;\n  invalidLiChildrenPathRefs.reverse().forEach(ref => {\n    const path = ref.unref();\n    path && _slate.Transforms.moveNodes(editor, {\n      at: path,\n      to: firstLiChildPath.concat([0])\n    });\n  });\n  return !!invalidLiChildrenPathRefs.length;\n};\nexports.normalizeListItem = normalizeListItem;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}