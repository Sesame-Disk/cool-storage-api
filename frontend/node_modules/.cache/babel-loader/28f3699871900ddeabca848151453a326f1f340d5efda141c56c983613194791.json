{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import{mdStringToSlate}from'@seafile/seafile-editor';import{isPublicWiki,repoID,serviceURL,slug}from'../../../utils/constants';import{Utils}from'../../../utils/utils';import{generateNavItems}from'../utils/generate-navs';import NavItem from'./nav-item';import'./style.css';import{jsx as _jsx}from\"react/jsx-runtime\";var IndexMdViewer=/*#__PURE__*/function(_React$Component){_inherits(IndexMdViewer,_React$Component);var _super=_createSuper(IndexMdViewer);function IndexMdViewer(props){var _this;_classCallCheck(this,IndexMdViewer);_this=_super.call(this,props);_this.onLinkClick=function(node){var currentPath=_this.state.currentPath;if(node.path===currentPath)return;if(node.path){_this.setState({currentPath:node.path});}var url=new URL(node.href);if(node.href)_this.props.onLinkClick(url.href);};_this.changeInlineNode=function(item){if(item.type=='link'||item.type==='image'){var url;// change image url\nif(item.type=='image'&&isPublicWiki){url=item.data.src;var re=new RegExp(serviceURL+'/lib/'+repoID+'/file.*raw=1');// different repo\nif(!re.test(url)){return;}// get image path\nvar index=url.indexOf('/file');var index2=url.indexOf('?');var imagePath=url.substring(index+5,index2);// replace url\nitem.data.src=serviceURL+'/view-image-via-public-wiki/?slug='+slug+'&path='+imagePath;}else if(item.type=='link'){url=item.url;/* eslint-disable */var expression=/((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[\\-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9\\.\\-]+|(?:www\\.|[\\-;:&=\\+\\$,\\w]+@)[A-Za-z0-9\\.\\-]+)((?:\\/[\\+~%\\/\\.\\w\\-_]*)?\\??(?:[\\-\\+=&;%@\\.\\w_]*)#?(?:[\\.\\!\\/\\\\\\w]*))?)/;/* eslint-enable */var _re=new RegExp(expression);// Solving relative paths\nif(!_re.test(url)){if(url.startsWith('./')){url=url.slice(2);}item.url=serviceURL+'/published/'+slug+'/'+url;}// change file url\nelse if(Utils.isInternalMarkdownLink(url,repoID)){var path=Utils.getPathFromInternalMarkdownLink(url,repoID);// replace url\nitem.url=serviceURL+'/published/'+slug+path;}// change dir url\nelse if(Utils.isInternalDirLink(url,repoID)){var _path=Utils.getPathFromInternalDirLink(url,repoID);// replace url\nitem.url=serviceURL+'/published/'+slug+_path;}}}return item;};_this.links=[];_this.state={currentPath:'',treeRoot:{name:'',href:'',children:[],isRoot:true}};return _this;}_createClass(IndexMdViewer,[{key:\"componentDidMount\",value:function componentDidMount(){var indexContent=this.props.indexContent;var slateNodes=mdStringToSlate(indexContent);var newSlateNodes=Utils.changeMarkdownNodes(slateNodes,this.changeInlineNode);var treeRoot=generateNavItems(newSlateNodes);this.setState({treeRoot:treeRoot});}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,treeRoot=_this$state.treeRoot,currentPath=_this$state.currentPath;return/*#__PURE__*/_jsx(\"div\",{className:\"mx-4 o-hidden\",children:treeRoot.children.map(function(node){return/*#__PURE__*/_jsx(NavItem,{node:node,currentPath:currentPath,onLinkClick:_this2.onLinkClick},node.path);})});}}]);return IndexMdViewer;}(React.Component);export default IndexMdViewer;","map":{"version":3,"names":["React","mdStringToSlate","isPublicWiki","repoID","serviceURL","slug","Utils","generateNavItems","NavItem","jsx","_jsx","IndexMdViewer","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","onLinkClick","node","currentPath","state","path","setState","url","URL","href","changeInlineNode","item","type","data","src","re","RegExp","test","index","indexOf","index2","imagePath","substring","expression","startsWith","slice","isInternalMarkdownLink","getPathFromInternalMarkdownLink","isInternalDirLink","getPathFromInternalDirLink","links","treeRoot","name","children","isRoot","_createClass","key","value","componentDidMount","indexContent","slateNodes","newSlateNodes","changeMarkdownNodes","render","_this2","_this$state","className","map","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/wiki/index-md-viewer/index.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { mdStringToSlate } from '@seafile/seafile-editor';\nimport { isPublicWiki, repoID, serviceURL, slug } from '../../../utils/constants';\nimport { Utils } from '../../../utils/utils';\nimport { generateNavItems } from '../utils/generate-navs';\nimport NavItem from './nav-item';\n\nimport'./style.css';\n\nconst viewerPropTypes = {\n  indexContent: PropTypes.string.isRequired,\n  onLinkClick: PropTypes.func.isRequired,\n};\n\nclass IndexMdViewer extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.links = [];\n    this.state = {\n      currentPath: '',\n      treeRoot: { name: '', href: '', children: [], isRoot: true },\n    };\n  }\n\n  componentDidMount() {\n    const { indexContent } = this.props;\n    const slateNodes = mdStringToSlate(indexContent);\n    const newSlateNodes = Utils.changeMarkdownNodes(slateNodes, this.changeInlineNode);\n    const treeRoot = generateNavItems(newSlateNodes);\n    this.setState({\n      treeRoot: treeRoot,\n    });\n  }\n\n  onLinkClick = (node) => {\n    const { currentPath } = this.state;\n    if (node.path === currentPath) return;\n    if (node.path) {\n      this.setState({ currentPath: node.path });\n    }\n    const url = new URL(node.href);\n    if (node.href) this.props.onLinkClick(url.href);\n  };\n\n  changeInlineNode = (item) => {\n    if (item.type == 'link' || item.type === 'image') {\n      let url;\n\n      // change image url\n      if (item.type == 'image' && isPublicWiki) {\n        url = item.data.src;\n        const re = new RegExp(serviceURL + '/lib/' + repoID +'/file.*raw=1');\n        // different repo\n        if (!re.test(url)) {\n          return;\n        }\n        // get image path\n        let index = url.indexOf('/file');\n        let index2 = url.indexOf('?');\n        const imagePath = url.substring(index + 5, index2);\n        // replace url\n        item.data.src = serviceURL + '/view-image-via-public-wiki/?slug=' + slug + '&path=' + imagePath;\n      }\n\n      else if (item.type == 'link') {\n        url = item.url;\n        /* eslint-disable */\n        let expression = /((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[\\-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9\\.\\-]+|(?:www\\.|[\\-;:&=\\+\\$,\\w]+@)[A-Za-z0-9\\.\\-]+)((?:\\/[\\+~%\\/\\.\\w\\-_]*)?\\??(?:[\\-\\+=&;%@\\.\\w_]*)#?(?:[\\.\\!\\/\\\\\\w]*))?)/\n        /* eslint-enable */\n        let re = new RegExp(expression);\n\n        // Solving relative paths\n        if (!re.test(url)) {\n          if (url.startsWith('./')) {\n            url = url.slice(2);\n          }\n          item.url = serviceURL + '/published/' + slug + '/' + url;\n        }\n        // change file url\n        else if (Utils.isInternalMarkdownLink(url, repoID)) {\n          let path = Utils.getPathFromInternalMarkdownLink(url, repoID);\n          // replace url\n          item.url = serviceURL + '/published/' + slug + path;\n        }\n        // change dir url\n        else if (Utils.isInternalDirLink(url, repoID)) {\n          let path = Utils.getPathFromInternalDirLink(url, repoID);\n          // replace url\n          item.url = serviceURL + '/published/' + slug + path;\n        }\n      }\n    }\n\n    return item;\n  };\n\n  render() {\n    const { treeRoot, currentPath } = this.state;\n    return (\n      <div className=\"mx-4 o-hidden\">\n        {treeRoot.children.map(node => {\n          return (\n            <NavItem key={node.path} node={node} currentPath={currentPath} onLinkClick={this.onLinkClick} />\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nIndexMdViewer.propTypes = viewerPropTypes;\n\nexport default IndexMdViewer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}