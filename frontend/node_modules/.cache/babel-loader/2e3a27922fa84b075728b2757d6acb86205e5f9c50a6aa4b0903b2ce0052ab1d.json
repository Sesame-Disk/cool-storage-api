{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { Node } from '@seafile/slate';\nimport deepCopy from 'deep-copy';\nimport slugid from 'slugid';\nimport * as OPERATION from './constants';\nimport ObjectUtils from '../utils/object-utils';\nexport var decorateOperation = function decorateOperation(editor, operation) {\n  var newOperation = deepCopy(operation);\n  var type = newOperation.type;\n  switch (type) {\n    case OPERATION.INSERT_TEXT:\n    case OPERATION.REMOVE_TEXT:\n      {\n        var path = newOperation.path;\n        var node = Node.get(editor, path);\n        newOperation['node_id'] = node.id;\n        break;\n      }\n    case OPERATION.INSERT_NODE:\n      {\n        var _path = newOperation.path,\n          _node = newOperation.node;\n        if (!_node.id) _node.id = slugid.nice(); // generate an id for insert node\n\n        var parent = Node.parent(editor, _path);\n        newOperation['parent_node_id'] = parent.id;\n        break;\n      }\n    case OPERATION.REMOVE_NODE:\n      {\n        var _path2 = newOperation.path;\n        var _node2 = Node.get(editor, _path2);\n        newOperation['node_id'] = _node2.id; // remove node's id\n        break;\n      }\n    case OPERATION.MERGE_NODE:\n      {\n        // merge next node into prev node\n        var _path3 = newOperation.path;\n        var _node3 = Node.get(editor, _path3);\n        newOperation['node_id'] = _node3.id;\n        break;\n      }\n    case OPERATION.SPLIT_NODE:\n      {\n        // child: split [7, 0] -> [[7, 0],[7, 1]]\n        // parent: split [[7, 0], [7, 1]] -> [[7], [8]]\n        var _path4 = newOperation.path,\n          _newOperation$propert = newOperation.properties,\n          properties = _newOperation$propert === void 0 ? {} : _newOperation$propert;\n        // need generate a new id for new node\n        properties.id = slugid.nice();\n        var _node4 = Node.get(editor, _path4);\n        newOperation['node_id'] = _node4.id; // split node's id\n        break;\n      }\n    case OPERATION.SET_NODE:\n      {\n        var _path5 = newOperation.path;\n        var _node5 = Node.get(editor, _path5);\n        newOperation['node_id'] = _node5.id; // the node which will be set to another type\n        break;\n      }\n    case OPERATION.MOVE_NODE:\n      {\n        var _path6 = newOperation.path;\n        var _node6 = Node.get(editor, _path6);\n        // move operation not change the node's id\n        newOperation['node_id'] = _node6.id; // moved node's id\n        break;\n      }\n    default:\n      {\n        // set_selection\n        break;\n      }\n  }\n  return newOperation;\n};\nexport var replaceNodeId = function replaceNodeId(node) {\n  if (!ObjectUtils.isObject(node)) return node;\n  if (ObjectUtils.hasProperty(node, 'children')) {\n    return _objectSpread(_objectSpread({}, node), {}, {\n      id: slugid.nice(),\n      children: replacePastedDataId(node.children)\n    });\n  }\n  return _objectSpread(_objectSpread({}, node), {}, {\n    id: slugid.nice()\n  });\n};\nexport var replacePastedDataId = function replacePastedDataId(pastedData) {\n  // If children is malformed, return a list of correct child nodes\n\n  if (ObjectUtils.isObject(pastedData)) {\n    return replaceNodeId(pastedData);\n  }\n  if (!Array.isArray(pastedData)) return [{\n    id: slugid.nice(),\n    text: ''\n  }];\n  return pastedData.map(function (item) {\n    item.id = slugid.nice();\n    if (item.children) {\n      item.children = replacePastedDataId(item.children);\n    }\n    return item;\n  });\n};","map":{"version":3,"names":["_objectSpread","Node","deepCopy","slugid","OPERATION","ObjectUtils","decorateOperation","editor","operation","newOperation","type","INSERT_TEXT","REMOVE_TEXT","path","node","get","id","INSERT_NODE","nice","parent","REMOVE_NODE","MERGE_NODE","SPLIT_NODE","_newOperation$propert","properties","SET_NODE","MOVE_NODE","replaceNodeId","isObject","hasProperty","children","replacePastedDataId","pastedData","Array","isArray","text","map","item"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/node-id/helpers.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { Node } from '@seafile/slate';\nimport deepCopy from 'deep-copy';\nimport slugid from 'slugid';\nimport * as OPERATION from './constants';\nimport ObjectUtils from '../utils/object-utils';\nexport const decorateOperation = (editor, operation) => {\n  let newOperation = deepCopy(operation);\n  const {\n    type\n  } = newOperation;\n  switch (type) {\n    case OPERATION.INSERT_TEXT:\n    case OPERATION.REMOVE_TEXT:\n      {\n        const {\n          path\n        } = newOperation;\n        const node = Node.get(editor, path);\n        newOperation['node_id'] = node.id;\n        break;\n      }\n    case OPERATION.INSERT_NODE:\n      {\n        let {\n          path,\n          node\n        } = newOperation;\n        if (!node.id) node.id = slugid.nice(); // generate an id for insert node\n\n        const parent = Node.parent(editor, path);\n        newOperation['parent_node_id'] = parent.id;\n        break;\n      }\n    case OPERATION.REMOVE_NODE:\n      {\n        let {\n          path\n        } = newOperation;\n        const node = Node.get(editor, path);\n        newOperation['node_id'] = node.id; // remove node's id\n        break;\n      }\n    case OPERATION.MERGE_NODE:\n      {\n        // merge next node into prev node\n        const {\n          path\n        } = newOperation;\n        const node = Node.get(editor, path);\n        newOperation['node_id'] = node.id;\n        break;\n      }\n    case OPERATION.SPLIT_NODE:\n      {\n        // child: split [7, 0] -> [[7, 0],[7, 1]]\n        // parent: split [[7, 0], [7, 1]] -> [[7], [8]]\n        const {\n          path,\n          properties = {}\n        } = newOperation;\n        // need generate a new id for new node\n        properties.id = slugid.nice();\n        const node = Node.get(editor, path);\n        newOperation['node_id'] = node.id; // split node's id\n        break;\n      }\n    case OPERATION.SET_NODE:\n      {\n        const {\n          path\n        } = newOperation;\n        const node = Node.get(editor, path);\n        newOperation['node_id'] = node.id; // the node which will be set to another type\n        break;\n      }\n    case OPERATION.MOVE_NODE:\n      {\n        const {\n          path\n        } = newOperation;\n        const node = Node.get(editor, path);\n        // move operation not change the node's id\n        newOperation['node_id'] = node.id; // moved node's id\n        break;\n      }\n    default:\n      {\n        // set_selection\n        break;\n      }\n  }\n  return newOperation;\n};\nexport const replaceNodeId = node => {\n  if (!ObjectUtils.isObject(node)) return node;\n  if (ObjectUtils.hasProperty(node, 'children')) {\n    return _objectSpread(_objectSpread({}, node), {}, {\n      id: slugid.nice(),\n      children: replacePastedDataId(node.children)\n    });\n  }\n  return _objectSpread(_objectSpread({}, node), {}, {\n    id: slugid.nice()\n  });\n};\nexport const replacePastedDataId = pastedData => {\n  // If children is malformed, return a list of correct child nodes\n\n  if (ObjectUtils.isObject(pastedData)) {\n    return replaceNodeId(pastedData);\n  }\n  if (!Array.isArray(pastedData)) return [{\n    id: slugid.nice(),\n    text: ''\n  }];\n  return pastedData.map(item => {\n    item.id = slugid.nice();\n    if (item.children) {\n      item.children = replacePastedDataId(item.children);\n    }\n    return item;\n  });\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}