{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { EventBus } from '../../../basic-sdk';\nimport { getRebase, hasConflict } from '../../../basic-sdk/utils/rebase';\nimport context from '../../../context';\nimport { EXTERNAL_EVENT, TIP_CONTENT, TIP_TYPE } from '../../../constants';\nimport { useDocument } from '../../../hooks';\nimport toaster from '../../toast';\nimport TipDialog from '../../tip-dialog';\nimport { useTranslation } from 'react-i18next';\nimport PublishRevision from './publish-revision';\nimport ViewChanges from './view-changes';\nimport MoreRevisionOperations from './more-revision-operations';\nimport Revisions from './revisions';\nimport ChangesCount from './changes-count';\nvar RevisionOperations = function RevisionOperations(_ref) {\n  var isShowChanges = _ref.isShowChanges,\n    _ref$isPublished = _ref.isPublished,\n    isPublished = _ref$isPublished === void 0 ? false : _ref$isPublished,\n    changes = _ref.changes,\n    handleViewChangesToggle = _ref.handleViewChangesToggle,\n    handleRevisionMerged = _ref.handleRevisionMerged,\n    handleRevisionPublished = _ref.handleRevisionPublished;\n  var isSdocRevision = context.getSetting('isSdocRevision');\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isShowTip = _useState2[0],\n    setShowTip = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    tipType = _useState4[0],\n    setTipType = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    mergeValue = _useState6[0],\n    setMergeValue = _useState6[1];\n  var _useState7 = useState(false),\n    _useState8 = _slicedToArray(_useState7, 2),\n    isLoading = _useState8[0],\n    setLoading = _useState8[1];\n  var _useDocument = useDocument(),\n    loadDocument = _useDocument.loadDocument;\n  useEffect(function () {\n    if (!isSdocRevision) return;\n    if (isShowChanges) return;\n    if (isPublished) return;\n    var revisionPromise = loadDocument();\n    var baseVersionPromise = context.getRevisionBaseVersionContent();\n    var originVersionPromise = context.getSeadocOriginFileContent();\n    Promise.all([revisionPromise, baseVersionPromise, originVersionPromise]).then(function (results) {\n      var _results = _slicedToArray(results, 3),\n        revisionContent = _results[0],\n        baseRes = _results[1],\n        masterRes = _results[2];\n      var baseContent = JSON.parse(baseRes.data.content);\n      var masterContent = JSON.parse(masterRes.data.content);\n\n      // no changes\n      if (masterContent.version === baseContent.version) return;\n      setShowTip(true);\n      var _getRebase = getRebase(masterContent, baseContent, revisionContent),\n        value = _getRebase.value;\n      setMergeValue(value);\n      setTipType(TIP_TYPE.SOURCE_DOCUMENT_CHANGED);\n    }).catch(function (error) {\n      if (typeof error === 'string') {\n        toaster.danger(t(error));\n        return;\n      }\n      toaster.danger(t('Error'));\n      setShowTip(false);\n      setTipType('');\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var onDocumentReplaced = useCallback(function () {\n    if (isShowTip) return;\n    setTipType(TIP_TYPE.HAS_BEEN_REPLACED);\n    setShowTip(true);\n  }, [isShowTip]);\n  var hasPublishRevision = useCallback(function () {\n    handleRevisionPublished();\n    toaster.success(t(TIP_CONTENT[TIP_TYPE.HAS_BEEN_PUBLISHED]));\n  }, [handleRevisionPublished, t]);\n  var onDocumentRemoved = useCallback(function () {\n    if (isShowTip) return;\n    setTipType(TIP_TYPE.HAS_BEEN_REMOVED);\n    setShowTip(true);\n  }, [isShowTip]);\n  var onError = useCallback(function () {\n    toaster.danger(t('Error'));\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(function () {\n    var eventBus = EventBus.getInstance();\n    var unsubscribeMergeDocument = eventBus.subscribe(EXTERNAL_EVENT.DOCUMENT_REPLACED, onDocumentReplaced);\n    var unsubscribeMergeDocumentError = eventBus.subscribe(EXTERNAL_EVENT.DOCUMENT_REPLACED_ERROR, onError);\n    var unsubscribePublishDocument = eventBus.subscribe(EXTERNAL_EVENT.PUBLISH_DOCUMENT, hasPublishRevision);\n    var unsubscribePublishDocumentError = eventBus.subscribe(EXTERNAL_EVENT.PUBLISH_DOCUMENT_ERROR, onError);\n    var unsubscribeRemoveDocument = eventBus.subscribe(EXTERNAL_EVENT.REMOVE_DOCUMENT, onDocumentRemoved);\n    var unsubscribeRemoveDocumentError = eventBus.subscribe(EXTERNAL_EVENT.REMOVE_DOCUMENT_ERROR, onError);\n    return function () {\n      unsubscribeMergeDocument();\n      unsubscribeMergeDocumentError();\n      unsubscribePublishDocument();\n      unsubscribePublishDocumentError();\n      unsubscribeRemoveDocument();\n      unsubscribeRemoveDocumentError();\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // solve show change view in revision editor\n  var onViewChangesToggle = useCallback(function (isShowChanges) {\n    if (isLoading) return;\n    setLoading(true);\n    if (!isPublished && isShowChanges) {\n      // The trick here is to send one more api request in order to use the same information box.\n      loadDocument().then(function (revisionContent) {\n        // Prevent users from switching if document contains conflicting content\n        if (hasConflict(revisionContent.children)) {\n          setTipType(TIP_TYPE.HAS_CONFLICT_BEFORE_VIEW_CHANGES);\n          setShowTip(true);\n        } else {\n          handleViewChangesToggle(isShowChanges);\n        }\n        setLoading(false);\n      }).catch(function (errorMessage) {\n        toaster.danger(t(errorMessage));\n        setLoading(false);\n      });\n      return;\n    }\n    handleViewChangesToggle(isShowChanges);\n    setLoading(false);\n  }, [handleViewChangesToggle, loadDocument, t, isPublished, isLoading]);\n\n  // publish revision\n  var publishRevision = useCallback(function () {\n    setShowTip(true);\n    setTipType(TIP_TYPE.CHECKING);\n    var revisionPromise = loadDocument();\n    var baseVersionPromise = context.getRevisionBaseVersionContent();\n    var originVersionPromise = context.getSeadocOriginFileContent();\n    Promise.all([revisionPromise, baseVersionPromise, originVersionPromise]).then(function (results) {\n      var _results2 = _slicedToArray(results, 3),\n        revisionContent = _results2[0],\n        baseRes = _results2[1],\n        masterRes = _results2[2];\n      var baseContent = JSON.parse(baseRes.data.content);\n      var masterContent = JSON.parse(masterRes.data.content);\n      if (hasConflict(revisionContent.children)) {\n        setTipType(TIP_TYPE.HAS_CONFLICT_BEFORE_PUBLISH);\n        return;\n      }\n      var _getRebase2 = getRebase(masterContent, baseContent, revisionContent),\n        canMerge = _getRebase2.canMerge,\n        isNeedReplaceMaster = _getRebase2.isNeedReplaceMaster,\n        value = _getRebase2.value;\n      // change to HAS_BEEN_PUBLISHED\n      if (canMerge && isNeedReplaceMaster) {\n        setTipType(TIP_TYPE.PUBLISHING);\n        context.publishRevision().then(function (res) {\n          setShowTip(false);\n          setTipType('');\n        }).catch(function (error) {\n          toaster.danger(t('Error'));\n        });\n        return;\n      }\n\n      // change to DELETE_NO_CHANGES_REVISION\n      if (canMerge && !isNeedReplaceMaster) {\n        setTipType(TIP_TYPE.DELETE_NO_CHANGES_REVISION);\n        return;\n      }\n\n      // change to MERGE\n      setMergeValue(value);\n      setTipType(TIP_TYPE.MERGE);\n    }).catch(function (error) {\n      if (typeof error === 'string') {\n        toaster.danger(t(error));\n        return;\n      }\n      toaster.danger(t('Error'));\n    });\n  }, [loadDocument, t]);\n\n  // confirm publish\n  var onSubmit = useCallback(function () {\n    if (tipType === TIP_TYPE.HAS_BEEN_PUBLISHED) {\n      // nothing todo\n      return;\n    }\n    if (tipType === TIP_TYPE.DELETE_NO_CHANGES_REVISION) {\n      context.deleteSdocRevision().then(function (res) {\n        // update current location\n        var originFileURL = context.getSetting('originFileURL');\n        window.location.href = originFileURL;\n      }).catch(function (error) {\n        toaster.danger(t('Error'));\n      });\n      return;\n    }\n    if (tipType === TIP_TYPE.MERGE || tipType === TIP_TYPE.SOURCE_DOCUMENT_CHANGED) {\n      var _context$getUserInfo = context.getUserInfo(),\n        username = _context$getUserInfo.username;\n      var doc = {\n        children: mergeValue.children,\n        version: mergeValue.version,\n        format_version: mergeValue.format_version,\n        last_modify_user: username\n      };\n      context.updateSdocRevision(doc).then(function (res) {\n        var origin_file_version = res.data.origin_file_version;\n        context.updateSettings({\n          'originFileVersion': origin_file_version\n        });\n        handleRevisionMerged && handleRevisionMerged(mergeValue);\n        setShowTip(false);\n      }).catch(function (error) {\n        toaster.danger(t('Error'));\n      });\n      return;\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tipType, mergeValue, document]);\n  var onClose = useCallback(function () {\n    setShowTip(false);\n  }, []);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, !isSdocRevision && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(MoreRevisionOperations, null), /*#__PURE__*/React.createElement(Revisions, null)), isSdocRevision && isShowChanges && /*#__PURE__*/React.createElement(ChangesCount, {\n    allChanges: changes\n  }), isSdocRevision && /*#__PURE__*/React.createElement(ViewChanges, {\n    isShowChanges: isShowChanges,\n    onViewChangesToggle: onViewChangesToggle\n  }), isSdocRevision && !isPublished && /*#__PURE__*/React.createElement(PublishRevision, {\n    publishRevision: publishRevision\n  }), isShowTip && /*#__PURE__*/React.createElement(TipDialog, {\n    tipType: tipType,\n    onSubmit: onSubmit,\n    onClose: onClose,\n    zIndex: 1072\n  }));\n};\nexport default RevisionOperations;","map":{"version":3,"names":["React","useCallback","useEffect","useState","EventBus","getRebase","hasConflict","context","EXTERNAL_EVENT","TIP_CONTENT","TIP_TYPE","useDocument","toaster","TipDialog","useTranslation","PublishRevision","ViewChanges","MoreRevisionOperations","Revisions","ChangesCount","RevisionOperations","_ref","isShowChanges","_ref$isPublished","isPublished","changes","handleViewChangesToggle","handleRevisionMerged","handleRevisionPublished","isSdocRevision","getSetting","_useTranslation","t","_useState","_useState2","_slicedToArray","isShowTip","setShowTip","_useState3","_useState4","tipType","setTipType","_useState5","_useState6","mergeValue","setMergeValue","_useState7","_useState8","isLoading","setLoading","_useDocument","loadDocument","revisionPromise","baseVersionPromise","getRevisionBaseVersionContent","originVersionPromise","getSeadocOriginFileContent","Promise","all","then","results","_results","revisionContent","baseRes","masterRes","baseContent","JSON","parse","data","content","masterContent","version","_getRebase","value","SOURCE_DOCUMENT_CHANGED","catch","error","danger","onDocumentReplaced","HAS_BEEN_REPLACED","hasPublishRevision","success","HAS_BEEN_PUBLISHED","onDocumentRemoved","HAS_BEEN_REMOVED","onError","eventBus","getInstance","unsubscribeMergeDocument","subscribe","DOCUMENT_REPLACED","unsubscribeMergeDocumentError","DOCUMENT_REPLACED_ERROR","unsubscribePublishDocument","PUBLISH_DOCUMENT","unsubscribePublishDocumentError","PUBLISH_DOCUMENT_ERROR","unsubscribeRemoveDocument","REMOVE_DOCUMENT","unsubscribeRemoveDocumentError","REMOVE_DOCUMENT_ERROR","onViewChangesToggle","children","HAS_CONFLICT_BEFORE_VIEW_CHANGES","errorMessage","publishRevision","CHECKING","_results2","HAS_CONFLICT_BEFORE_PUBLISH","_getRebase2","canMerge","isNeedReplaceMaster","PUBLISHING","res","DELETE_NO_CHANGES_REVISION","MERGE","onSubmit","deleteSdocRevision","originFileURL","window","location","href","_context$getUserInfo","getUserInfo","username","doc","format_version","last_modify_user","updateSdocRevision","origin_file_version","updateSettings","document","onClose","createElement","Fragment","allChanges","zIndex"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/components/doc-operations/revision-operations/index.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { EventBus } from '../../../basic-sdk';\nimport { getRebase, hasConflict } from '../../../basic-sdk/utils/rebase';\nimport context from '../../../context';\nimport { EXTERNAL_EVENT, TIP_CONTENT, TIP_TYPE } from '../../../constants';\nimport { useDocument } from '../../../hooks';\nimport toaster from '../../toast';\nimport TipDialog from '../../tip-dialog';\nimport { useTranslation } from 'react-i18next';\nimport PublishRevision from './publish-revision';\nimport ViewChanges from './view-changes';\nimport MoreRevisionOperations from './more-revision-operations';\nimport Revisions from './revisions';\nimport ChangesCount from './changes-count';\nconst RevisionOperations = _ref => {\n  let {\n    isShowChanges,\n    isPublished = false,\n    changes,\n    handleViewChangesToggle,\n    handleRevisionMerged,\n    handleRevisionPublished\n  } = _ref;\n  const isSdocRevision = context.getSetting('isSdocRevision');\n  const {\n    t\n  } = useTranslation();\n  const [isShowTip, setShowTip] = useState(false);\n  const [tipType, setTipType] = useState('');\n  const [mergeValue, setMergeValue] = useState(null);\n  const [isLoading, setLoading] = useState(false);\n  const {\n    loadDocument\n  } = useDocument();\n  useEffect(() => {\n    if (!isSdocRevision) return;\n    if (isShowChanges) return;\n    if (isPublished) return;\n    const revisionPromise = loadDocument();\n    const baseVersionPromise = context.getRevisionBaseVersionContent();\n    const originVersionPromise = context.getSeadocOriginFileContent();\n    Promise.all([revisionPromise, baseVersionPromise, originVersionPromise]).then(results => {\n      const [revisionContent, baseRes, masterRes] = results;\n      const baseContent = JSON.parse(baseRes.data.content);\n      const masterContent = JSON.parse(masterRes.data.content);\n\n      // no changes\n      if (masterContent.version === baseContent.version) return;\n      setShowTip(true);\n      const {\n        value\n      } = getRebase(masterContent, baseContent, revisionContent);\n      setMergeValue(value);\n      setTipType(TIP_TYPE.SOURCE_DOCUMENT_CHANGED);\n    }).catch(error => {\n      if (typeof error === 'string') {\n        toaster.danger(t(error));\n        return;\n      }\n      toaster.danger(t('Error'));\n      setShowTip(false);\n      setTipType('');\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const onDocumentReplaced = useCallback(() => {\n    if (isShowTip) return;\n    setTipType(TIP_TYPE.HAS_BEEN_REPLACED);\n    setShowTip(true);\n  }, [isShowTip]);\n  const hasPublishRevision = useCallback(() => {\n    handleRevisionPublished();\n    toaster.success(t(TIP_CONTENT[TIP_TYPE.HAS_BEEN_PUBLISHED]));\n  }, [handleRevisionPublished, t]);\n  const onDocumentRemoved = useCallback(() => {\n    if (isShowTip) return;\n    setTipType(TIP_TYPE.HAS_BEEN_REMOVED);\n    setShowTip(true);\n  }, [isShowTip]);\n  const onError = useCallback(() => {\n    toaster.danger(t('Error'));\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    const eventBus = EventBus.getInstance();\n    const unsubscribeMergeDocument = eventBus.subscribe(EXTERNAL_EVENT.DOCUMENT_REPLACED, onDocumentReplaced);\n    const unsubscribeMergeDocumentError = eventBus.subscribe(EXTERNAL_EVENT.DOCUMENT_REPLACED_ERROR, onError);\n    const unsubscribePublishDocument = eventBus.subscribe(EXTERNAL_EVENT.PUBLISH_DOCUMENT, hasPublishRevision);\n    const unsubscribePublishDocumentError = eventBus.subscribe(EXTERNAL_EVENT.PUBLISH_DOCUMENT_ERROR, onError);\n    const unsubscribeRemoveDocument = eventBus.subscribe(EXTERNAL_EVENT.REMOVE_DOCUMENT, onDocumentRemoved);\n    const unsubscribeRemoveDocumentError = eventBus.subscribe(EXTERNAL_EVENT.REMOVE_DOCUMENT_ERROR, onError);\n    return () => {\n      unsubscribeMergeDocument();\n      unsubscribeMergeDocumentError();\n      unsubscribePublishDocument();\n      unsubscribePublishDocumentError();\n      unsubscribeRemoveDocument();\n      unsubscribeRemoveDocumentError();\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // solve show change view in revision editor\n  const onViewChangesToggle = useCallback(isShowChanges => {\n    if (isLoading) return;\n    setLoading(true);\n    if (!isPublished && isShowChanges) {\n      // The trick here is to send one more api request in order to use the same information box.\n      loadDocument().then(revisionContent => {\n        // Prevent users from switching if document contains conflicting content\n        if (hasConflict(revisionContent.children)) {\n          setTipType(TIP_TYPE.HAS_CONFLICT_BEFORE_VIEW_CHANGES);\n          setShowTip(true);\n        } else {\n          handleViewChangesToggle(isShowChanges);\n        }\n        setLoading(false);\n      }).catch(errorMessage => {\n        toaster.danger(t(errorMessage));\n        setLoading(false);\n      });\n      return;\n    }\n    handleViewChangesToggle(isShowChanges);\n    setLoading(false);\n  }, [handleViewChangesToggle, loadDocument, t, isPublished, isLoading]);\n\n  // publish revision\n  const publishRevision = useCallback(() => {\n    setShowTip(true);\n    setTipType(TIP_TYPE.CHECKING);\n    const revisionPromise = loadDocument();\n    const baseVersionPromise = context.getRevisionBaseVersionContent();\n    const originVersionPromise = context.getSeadocOriginFileContent();\n    Promise.all([revisionPromise, baseVersionPromise, originVersionPromise]).then(results => {\n      const [revisionContent, baseRes, masterRes] = results;\n      const baseContent = JSON.parse(baseRes.data.content);\n      const masterContent = JSON.parse(masterRes.data.content);\n      if (hasConflict(revisionContent.children)) {\n        setTipType(TIP_TYPE.HAS_CONFLICT_BEFORE_PUBLISH);\n        return;\n      }\n      const {\n        canMerge,\n        isNeedReplaceMaster,\n        value\n      } = getRebase(masterContent, baseContent, revisionContent);\n      // change to HAS_BEEN_PUBLISHED\n      if (canMerge && isNeedReplaceMaster) {\n        setTipType(TIP_TYPE.PUBLISHING);\n        context.publishRevision().then(res => {\n          setShowTip(false);\n          setTipType('');\n        }).catch(error => {\n          toaster.danger(t('Error'));\n        });\n        return;\n      }\n\n      // change to DELETE_NO_CHANGES_REVISION\n      if (canMerge && !isNeedReplaceMaster) {\n        setTipType(TIP_TYPE.DELETE_NO_CHANGES_REVISION);\n        return;\n      }\n\n      // change to MERGE\n      setMergeValue(value);\n      setTipType(TIP_TYPE.MERGE);\n    }).catch(error => {\n      if (typeof error === 'string') {\n        toaster.danger(t(error));\n        return;\n      }\n      toaster.danger(t('Error'));\n    });\n  }, [loadDocument, t]);\n\n  // confirm publish\n  const onSubmit = useCallback(() => {\n    if (tipType === TIP_TYPE.HAS_BEEN_PUBLISHED) {\n      // nothing todo\n      return;\n    }\n    if (tipType === TIP_TYPE.DELETE_NO_CHANGES_REVISION) {\n      context.deleteSdocRevision().then(res => {\n        // update current location\n        const originFileURL = context.getSetting('originFileURL');\n        window.location.href = originFileURL;\n      }).catch(error => {\n        toaster.danger(t('Error'));\n      });\n      return;\n    }\n    if (tipType === TIP_TYPE.MERGE || tipType === TIP_TYPE.SOURCE_DOCUMENT_CHANGED) {\n      const {\n        username\n      } = context.getUserInfo();\n      const doc = {\n        children: mergeValue.children,\n        version: mergeValue.version,\n        format_version: mergeValue.format_version,\n        last_modify_user: username\n      };\n      context.updateSdocRevision(doc).then(res => {\n        const {\n          origin_file_version\n        } = res.data;\n        context.updateSettings({\n          'originFileVersion': origin_file_version\n        });\n        handleRevisionMerged && handleRevisionMerged(mergeValue);\n        setShowTip(false);\n      }).catch(error => {\n        toaster.danger(t('Error'));\n      });\n      return;\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tipType, mergeValue, document]);\n  const onClose = useCallback(() => {\n    setShowTip(false);\n  }, []);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, !isSdocRevision && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(MoreRevisionOperations, null), /*#__PURE__*/React.createElement(Revisions, null)), isSdocRevision && isShowChanges && /*#__PURE__*/React.createElement(ChangesCount, {\n    allChanges: changes\n  }), isSdocRevision && /*#__PURE__*/React.createElement(ViewChanges, {\n    isShowChanges: isShowChanges,\n    onViewChangesToggle: onViewChangesToggle\n  }), isSdocRevision && !isPublished && /*#__PURE__*/React.createElement(PublishRevision, {\n    publishRevision: publishRevision\n  }), isShowTip && /*#__PURE__*/React.createElement(TipDialog, {\n    tipType: tipType,\n    onSubmit: onSubmit,\n    onClose: onClose,\n    zIndex: 1072\n  }));\n};\nexport default RevisionOperations;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}