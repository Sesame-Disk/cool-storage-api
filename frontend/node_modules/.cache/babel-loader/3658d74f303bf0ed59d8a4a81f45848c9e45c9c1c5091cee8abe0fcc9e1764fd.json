{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useEffect, useState, useRef, useLayoutEffect } from 'react';\nimport { useSlateStatic, ReactEditor } from '@seafile/slate-react';\nimport { TABLE_ROW_MIN_HEIGHT } from '../../constants';\nimport { focusClosestCellWhenJustifyCellSize, getRowHeight, updateTableRowHeight } from '../../helpers';\nimport { eventStopPropagation, getMouseDownInfo, getMouseMoveInfo, registerResizeEvents, unregisterResizeEvents } from '../../../../../utils/mouse-event';\nimport { useScrollContext } from '../../../../../hooks/use-scroll-context';\nvar RowResizeHandler = function RowResizeHandler(_ref) {\n  var rowIndex = _ref.rowIndex,\n    _ref$initRowBottom = _ref.initRowBottom,\n    initRowBottom = _ref$initRowBottom === void 0 ? 0 : _ref$initRowBottom,\n    table = _ref.table,\n    hideResizeHandlers = _ref.hideResizeHandlers,\n    mouseDownEvent = _ref.mouseDownEvent,\n    adjustingCell = _ref.adjustingCell,\n    isDraggingResizeHandler = _ref.isDraggingResizeHandler;\n  var editor = useSlateStatic();\n  var _useState = useState(initRowBottom),\n    _useState2 = _slicedToArray(_useState, 2),\n    rowBottom = _useState2[0],\n    setRowBottom = _useState2[1];\n  var _useState3 = useState({}),\n    _useState4 = _slicedToArray(_useState3, 2),\n    mouseDownInfo = _useState4[0],\n    setMouseDownInfo = _useState4[1];\n  var _useState5 = useState({}),\n    _useState6 = _slicedToArray(_useState5, 2),\n    style = _useState6[0],\n    setStyle = _useState6[1];\n  var row = table.children[rowIndex];\n  var rowHeight = getRowHeight(row, rowIndex);\n  var tableRow = useRef(rowHeight);\n  var _useState7 = useState(rowHeight),\n    _useState8 = _slicedToArray(_useState7, 2),\n    height = _useState8[0],\n    setHeight = _useState8[1];\n  var scrollContent = useScrollContext();\n  useLayoutEffect(function () {\n    var mouseDownInfo = getMouseDownInfo(mouseDownEvent, scrollContent.current);\n    setMouseDownInfo(mouseDownInfo);\n    var lastRowOffset = rowIndex === table.children.length - 1 ? -2 : 0;\n    setStyle({\n      top: rowBottom + lastRowOffset\n    });\n  }, [mouseDownEvent, rowBottom, rowIndex, scrollContent, table.children.length]);\n  useEffect(function () {\n    if (!isDraggingResizeHandler) return;\n    var onMouseMove = function onMouseMove(event) {\n      eventStopPropagation(event);\n      var mouseMoveInfo = getMouseMoveInfo(event, mouseDownInfo, scrollContent.current);\n      var newHeight = tableRow.current + mouseMoveInfo.displacementY;\n      var validHeight = Math.max(TABLE_ROW_MIN_HEIGHT, newHeight);\n      setHeight(validHeight);\n      setStyle({\n        top: rowBottom - tableRow.current + validHeight\n      });\n    };\n    var onMouseUp = function onMouseUp(event) {\n      eventStopPropagation(event);\n      tableRow.current = height;\n      updateTableRowHeight(editor, row, height);\n      focusClosestCellWhenJustifyCellSize(editor, adjustingCell);\n      hideResizeHandlers();\n    };\n    registerResizeEvents({\n      'mousemove': onMouseMove,\n      'mouseup': onMouseUp\n    });\n    return function () {\n      unregisterResizeEvents({\n        'mousemove': onMouseMove,\n        'mouseup': onMouseUp\n      });\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDraggingResizeHandler, mouseDownInfo, rowBottom, table, height]);\n  useEffect(function () {\n    var cell = row.children.filter(function (cell) {\n      return !cell.is_combined && (!cell.rowspan || cell.rowspan === 1);\n    })[0];\n    if (!cell) return;\n    var rowDom = ReactEditor.toDOMNode(editor, cell);\n    if (!rowDom) return;\n    tableRow.current = rowDom.clientHeight;\n    setRowBottom(initRowBottom);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [row, initRowBottom]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"table-row-height-just position-absolute resizing\",\n    contentEditable: false,\n    style: style\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"table-row-height-just-color-tip\"\n  }));\n};\nexport default RowResizeHandler;","map":{"version":3,"names":["React","useEffect","useState","useRef","useLayoutEffect","useSlateStatic","ReactEditor","TABLE_ROW_MIN_HEIGHT","focusClosestCellWhenJustifyCellSize","getRowHeight","updateTableRowHeight","eventStopPropagation","getMouseDownInfo","getMouseMoveInfo","registerResizeEvents","unregisterResizeEvents","useScrollContext","RowResizeHandler","_ref","rowIndex","_ref$initRowBottom","initRowBottom","table","hideResizeHandlers","mouseDownEvent","adjustingCell","isDraggingResizeHandler","editor","_useState","_useState2","_slicedToArray","rowBottom","setRowBottom","_useState3","_useState4","mouseDownInfo","setMouseDownInfo","_useState5","_useState6","style","setStyle","row","children","rowHeight","tableRow","_useState7","_useState8","height","setHeight","scrollContent","current","lastRowOffset","length","top","onMouseMove","event","mouseMoveInfo","newHeight","displacementY","validHeight","Math","max","onMouseUp","cell","filter","is_combined","rowspan","rowDom","toDOMNode","clientHeight","createElement","className","contentEditable"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/table/render/resize-handlers/row-resize-handler.js"],"sourcesContent":["import React, { useEffect, useState, useRef, useLayoutEffect } from 'react';\nimport { useSlateStatic, ReactEditor } from '@seafile/slate-react';\nimport { TABLE_ROW_MIN_HEIGHT } from '../../constants';\nimport { focusClosestCellWhenJustifyCellSize, getRowHeight, updateTableRowHeight } from '../../helpers';\nimport { eventStopPropagation, getMouseDownInfo, getMouseMoveInfo, registerResizeEvents, unregisterResizeEvents } from '../../../../../utils/mouse-event';\nimport { useScrollContext } from '../../../../../hooks/use-scroll-context';\nconst RowResizeHandler = _ref => {\n  let {\n    rowIndex,\n    initRowBottom = 0,\n    table,\n    hideResizeHandlers,\n    mouseDownEvent,\n    adjustingCell,\n    isDraggingResizeHandler\n  } = _ref;\n  const editor = useSlateStatic();\n  const [rowBottom, setRowBottom] = useState(initRowBottom);\n  const [mouseDownInfo, setMouseDownInfo] = useState({});\n  const [style, setStyle] = useState({});\n  const row = table.children[rowIndex];\n  const rowHeight = getRowHeight(row, rowIndex);\n  const tableRow = useRef(rowHeight);\n  const [height, setHeight] = useState(rowHeight);\n  const scrollContent = useScrollContext();\n  useLayoutEffect(() => {\n    const mouseDownInfo = getMouseDownInfo(mouseDownEvent, scrollContent.current);\n    setMouseDownInfo(mouseDownInfo);\n    const lastRowOffset = rowIndex === table.children.length - 1 ? -2 : 0;\n    setStyle({\n      top: rowBottom + lastRowOffset\n    });\n  }, [mouseDownEvent, rowBottom, rowIndex, scrollContent, table.children.length]);\n  useEffect(() => {\n    if (!isDraggingResizeHandler) return;\n    const onMouseMove = event => {\n      eventStopPropagation(event);\n      const mouseMoveInfo = getMouseMoveInfo(event, mouseDownInfo, scrollContent.current);\n      const newHeight = tableRow.current + mouseMoveInfo.displacementY;\n      const validHeight = Math.max(TABLE_ROW_MIN_HEIGHT, newHeight);\n      setHeight(validHeight);\n      setStyle({\n        top: rowBottom - tableRow.current + validHeight\n      });\n    };\n    const onMouseUp = event => {\n      eventStopPropagation(event);\n      tableRow.current = height;\n      updateTableRowHeight(editor, row, height);\n      focusClosestCellWhenJustifyCellSize(editor, adjustingCell);\n      hideResizeHandlers();\n    };\n    registerResizeEvents({\n      'mousemove': onMouseMove,\n      'mouseup': onMouseUp\n    });\n    return () => {\n      unregisterResizeEvents({\n        'mousemove': onMouseMove,\n        'mouseup': onMouseUp\n      });\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDraggingResizeHandler, mouseDownInfo, rowBottom, table, height]);\n  useEffect(() => {\n    const cell = row.children.filter(cell => !cell.is_combined && (!cell.rowspan || cell.rowspan === 1))[0];\n    if (!cell) return;\n    const rowDom = ReactEditor.toDOMNode(editor, cell);\n    if (!rowDom) return;\n    tableRow.current = rowDom.clientHeight;\n    setRowBottom(initRowBottom);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [row, initRowBottom]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"table-row-height-just position-absolute resizing\",\n    contentEditable: false,\n    style: style\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"table-row-height-just-color-tip\"\n  }));\n};\nexport default RowResizeHandler;"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,eAAe,QAAQ,OAAO;AAC3E,SAASC,cAAc,EAAEC,WAAW,QAAQ,sBAAsB;AAClE,SAASC,oBAAoB,QAAQ,iBAAiB;AACtD,SAASC,mCAAmC,EAAEC,YAAY,EAAEC,oBAAoB,QAAQ,eAAe;AACvG,SAASC,oBAAoB,EAAEC,gBAAgB,EAAEC,gBAAgB,EAAEC,oBAAoB,EAAEC,sBAAsB,QAAQ,kCAAkC;AACzJ,SAASC,gBAAgB,QAAQ,yCAAyC;AAC1E,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAGC,IAAI,EAAI;EAC/B,IACEC,QAAQ,GAOND,IAAI,CAPNC,QAAQ;IAAAC,kBAAA,GAONF,IAAI,CANNG,aAAa;IAAbA,aAAa,GAAAD,kBAAA,cAAG,CAAC,GAAAA,kBAAA;IACjBE,KAAK,GAKHJ,IAAI,CALNI,KAAK;IACLC,kBAAkB,GAIhBL,IAAI,CAJNK,kBAAkB;IAClBC,cAAc,GAGZN,IAAI,CAHNM,cAAc;IACdC,aAAa,GAEXP,IAAI,CAFNO,aAAa;IACbC,uBAAuB,GACrBR,IAAI,CADNQ,uBAAuB;EAEzB,IAAMC,MAAM,GAAGtB,cAAc,CAAC,CAAC;EAC/B,IAAAuB,SAAA,GAAkC1B,QAAQ,CAACmB,aAAa,CAAC;IAAAQ,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAAlDG,SAAS,GAAAF,UAAA;IAAEG,YAAY,GAAAH,UAAA;EAC9B,IAAAI,UAAA,GAA0C/B,QAAQ,CAAC,CAAC,CAAC,CAAC;IAAAgC,UAAA,GAAAJ,cAAA,CAAAG,UAAA;IAA/CE,aAAa,GAAAD,UAAA;IAAEE,gBAAgB,GAAAF,UAAA;EACtC,IAAAG,UAAA,GAA0BnC,QAAQ,CAAC,CAAC,CAAC,CAAC;IAAAoC,UAAA,GAAAR,cAAA,CAAAO,UAAA;IAA/BE,KAAK,GAAAD,UAAA;IAAEE,QAAQ,GAAAF,UAAA;EACtB,IAAMG,GAAG,GAAGnB,KAAK,CAACoB,QAAQ,CAACvB,QAAQ,CAAC;EACpC,IAAMwB,SAAS,GAAGlC,YAAY,CAACgC,GAAG,EAAEtB,QAAQ,CAAC;EAC7C,IAAMyB,QAAQ,GAAGzC,MAAM,CAACwC,SAAS,CAAC;EAClC,IAAAE,UAAA,GAA4B3C,QAAQ,CAACyC,SAAS,CAAC;IAAAG,UAAA,GAAAhB,cAAA,CAAAe,UAAA;IAAxCE,MAAM,GAAAD,UAAA;IAAEE,SAAS,GAAAF,UAAA;EACxB,IAAMG,aAAa,GAAGjC,gBAAgB,CAAC,CAAC;EACxCZ,eAAe,CAAC,YAAM;IACpB,IAAM+B,aAAa,GAAGvB,gBAAgB,CAACY,cAAc,EAAEyB,aAAa,CAACC,OAAO,CAAC;IAC7Ed,gBAAgB,CAACD,aAAa,CAAC;IAC/B,IAAMgB,aAAa,GAAGhC,QAAQ,KAAKG,KAAK,CAACoB,QAAQ,CAACU,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC;IACrEZ,QAAQ,CAAC;MACPa,GAAG,EAAEtB,SAAS,GAAGoB;IACnB,CAAC,CAAC;EACJ,CAAC,EAAE,CAAC3B,cAAc,EAAEO,SAAS,EAAEZ,QAAQ,EAAE8B,aAAa,EAAE3B,KAAK,CAACoB,QAAQ,CAACU,MAAM,CAAC,CAAC;EAC/EnD,SAAS,CAAC,YAAM;IACd,IAAI,CAACyB,uBAAuB,EAAE;IAC9B,IAAM4B,WAAW,GAAG,SAAdA,WAAWA,CAAGC,KAAK,EAAI;MAC3B5C,oBAAoB,CAAC4C,KAAK,CAAC;MAC3B,IAAMC,aAAa,GAAG3C,gBAAgB,CAAC0C,KAAK,EAAEpB,aAAa,EAAEc,aAAa,CAACC,OAAO,CAAC;MACnF,IAAMO,SAAS,GAAGb,QAAQ,CAACM,OAAO,GAAGM,aAAa,CAACE,aAAa;MAChE,IAAMC,WAAW,GAAGC,IAAI,CAACC,GAAG,CAACtD,oBAAoB,EAAEkD,SAAS,CAAC;MAC7DT,SAAS,CAACW,WAAW,CAAC;MACtBnB,QAAQ,CAAC;QACPa,GAAG,EAAEtB,SAAS,GAAGa,QAAQ,CAACM,OAAO,GAAGS;MACtC,CAAC,CAAC;IACJ,CAAC;IACD,IAAMG,SAAS,GAAG,SAAZA,SAASA,CAAGP,KAAK,EAAI;MACzB5C,oBAAoB,CAAC4C,KAAK,CAAC;MAC3BX,QAAQ,CAACM,OAAO,GAAGH,MAAM;MACzBrC,oBAAoB,CAACiB,MAAM,EAAEc,GAAG,EAAEM,MAAM,CAAC;MACzCvC,mCAAmC,CAACmB,MAAM,EAAEF,aAAa,CAAC;MAC1DF,kBAAkB,CAAC,CAAC;IACtB,CAAC;IACDT,oBAAoB,CAAC;MACnB,WAAW,EAAEwC,WAAW;MACxB,SAAS,EAAEQ;IACb,CAAC,CAAC;IACF,OAAO,YAAM;MACX/C,sBAAsB,CAAC;QACrB,WAAW,EAAEuC,WAAW;QACxB,SAAS,EAAEQ;MACb,CAAC,CAAC;IACJ,CAAC;;IAED;EACF,CAAC,EAAE,CAACpC,uBAAuB,EAAES,aAAa,EAAEJ,SAAS,EAAET,KAAK,EAAEyB,MAAM,CAAC,CAAC;EACtE9C,SAAS,CAAC,YAAM;IACd,IAAM8D,IAAI,GAAGtB,GAAG,CAACC,QAAQ,CAACsB,MAAM,CAAC,UAAAD,IAAI;MAAA,OAAI,CAACA,IAAI,CAACE,WAAW,KAAK,CAACF,IAAI,CAACG,OAAO,IAAIH,IAAI,CAACG,OAAO,KAAK,CAAC,CAAC;IAAA,EAAC,CAAC,CAAC,CAAC;IACvG,IAAI,CAACH,IAAI,EAAE;IACX,IAAMI,MAAM,GAAG7D,WAAW,CAAC8D,SAAS,CAACzC,MAAM,EAAEoC,IAAI,CAAC;IAClD,IAAI,CAACI,MAAM,EAAE;IACbvB,QAAQ,CAACM,OAAO,GAAGiB,MAAM,CAACE,YAAY;IACtCrC,YAAY,CAACX,aAAa,CAAC;IAC3B;EACF,CAAC,EAAE,CAACoB,GAAG,EAAEpB,aAAa,CAAC,CAAC;EACxB,OAAO,aAAarB,KAAK,CAACsE,aAAa,CAAC,KAAK,EAAE;IAC7CC,SAAS,EAAE,kDAAkD;IAC7DC,eAAe,EAAE,KAAK;IACtBjC,KAAK,EAAEA;EACT,CAAC,EAAE,aAAavC,KAAK,CAACsE,aAAa,CAAC,KAAK,EAAE;IACzCC,SAAS,EAAE;EACb,CAAC,CAAC,CAAC;AACL,CAAC;AACD,eAAetD,gBAAgB"},"metadata":{},"sourceType":"module","externalDependencies":[]}