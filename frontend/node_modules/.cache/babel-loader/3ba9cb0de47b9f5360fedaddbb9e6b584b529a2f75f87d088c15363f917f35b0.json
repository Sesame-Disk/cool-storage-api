{"ast":null,"code":"import React, { useRef, useEffect, useCallback } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useFocused, useSlateStatic, useReadOnly } from '@seafile/slate-react';\nimport { Editor, Range } from '@seafile/slate';\nimport { MenuGroup } from '../../commons';\nimport TextStyleMenuList from '../../plugins/text-style/menu';\nimport { useScrollContext } from '../../../hooks/use-scroll-context';\nimport { getSelectedNodeByType } from '../../core';\nimport { CODE_BLOCK } from '../../constants';\nimport './index.css';\nvar ContextToolbar = function ContextToolbar() {\n  var ref = useRef(null);\n  var editor = useSlateStatic();\n  var scrollRef = useScrollContext();\n  var inFocus = useFocused();\n  var readOnly = useReadOnly();\n  var setContextToolbarPosition = useCallback(function () {\n    var el = ref.current;\n    var domSelection = window.getSelection();\n    var domRange = domSelection.getRangeAt(0);\n    var rect = domRange.getBoundingClientRect();\n    el.style.top = \"\".concat(rect.top - 42 - 12, \"px\"); // top = Current top - Element height - Shaded part\n    el.style.left = \"\".concat(rect.left, \"px\");\n    el.style.display = 'block';\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var onScroll = useCallback(function (e) {\n    setContextToolbarPosition();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(function () {\n    var el = ref.current;\n    var selection = editor.selection;\n    if (!el) {\n      return;\n    }\n    if (readOnly || !selection || !inFocus || Range.isCollapsed(selection) || Editor.string(editor, selection) === '' || getSelectedNodeByType(editor, CODE_BLOCK)) {\n      scrollRef.current && scrollRef.current.removeEventListener('scroll', onScroll);\n      el.removeAttribute('style');\n      return;\n    }\n    scrollRef.current && scrollRef.current.addEventListener('scroll', onScroll);\n    setContextToolbarPosition();\n  });\n  var onMouseDown = useCallback(function (event) {\n    event.preventDefault(); // prevent toolbar from taking focus away from editor\n  }, []);\n  var onMouseMove = useCallback(function (e) {\n    var isMouseLeftDown = e.buttons === 1;\n    if (isMouseLeftDown) {\n      var el = ref.current;\n      el.removeAttribute('style');\n    }\n  }, []);\n  return createPortal( /*#__PURE__*/React.createElement(\"div\", {\n    ref: ref,\n    className: \"sdoc-context-toolbar\",\n    onMouseDown: onMouseDown,\n    onMouseOver: onMouseMove\n  }, /*#__PURE__*/React.createElement(MenuGroup, null, /*#__PURE__*/React.createElement(TextStyleMenuList, {\n    editor: editor,\n    idPrefix: 'sdoc_context_toolbar'\n  }))), document.body);\n};\nexport default ContextToolbar;","map":{"version":3,"names":["React","useRef","useEffect","useCallback","createPortal","useFocused","useSlateStatic","useReadOnly","Editor","Range","MenuGroup","TextStyleMenuList","useScrollContext","getSelectedNodeByType","CODE_BLOCK","ContextToolbar","ref","editor","scrollRef","inFocus","readOnly","setContextToolbarPosition","el","current","domSelection","window","getSelection","domRange","getRangeAt","rect","getBoundingClientRect","style","top","concat","left","display","onScroll","e","selection","isCollapsed","string","removeEventListener","removeAttribute","addEventListener","onMouseDown","event","preventDefault","onMouseMove","isMouseLeftDown","buttons","createElement","className","onMouseOver","idPrefix","document","body"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/toolbar/context-toolbar/index.js"],"sourcesContent":["import React, { useRef, useEffect, useCallback } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useFocused, useSlateStatic, useReadOnly } from '@seafile/slate-react';\nimport { Editor, Range } from '@seafile/slate';\nimport { MenuGroup } from '../../commons';\nimport TextStyleMenuList from '../../plugins/text-style/menu';\nimport { useScrollContext } from '../../../hooks/use-scroll-context';\nimport { getSelectedNodeByType } from '../../core';\nimport { CODE_BLOCK } from '../../constants';\nimport './index.css';\nconst ContextToolbar = () => {\n  const ref = useRef(null);\n  const editor = useSlateStatic();\n  const scrollRef = useScrollContext();\n  const inFocus = useFocused();\n  const readOnly = useReadOnly();\n  const setContextToolbarPosition = useCallback(() => {\n    const el = ref.current;\n    const domSelection = window.getSelection();\n    const domRange = domSelection.getRangeAt(0);\n    const rect = domRange.getBoundingClientRect();\n    el.style.top = \"\".concat(rect.top - 42 - 12, \"px\"); // top = Current top - Element height - Shaded part\n    el.style.left = \"\".concat(rect.left, \"px\");\n    el.style.display = 'block';\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const onScroll = useCallback(e => {\n    setContextToolbarPosition();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    const el = ref.current;\n    const {\n      selection\n    } = editor;\n    if (!el) {\n      return;\n    }\n    if (readOnly || !selection || !inFocus || Range.isCollapsed(selection) || Editor.string(editor, selection) === '' || getSelectedNodeByType(editor, CODE_BLOCK)) {\n      scrollRef.current && scrollRef.current.removeEventListener('scroll', onScroll);\n      el.removeAttribute('style');\n      return;\n    }\n    scrollRef.current && scrollRef.current.addEventListener('scroll', onScroll);\n    setContextToolbarPosition();\n  });\n  const onMouseDown = useCallback(event => {\n    event.preventDefault(); // prevent toolbar from taking focus away from editor\n  }, []);\n  const onMouseMove = useCallback(e => {\n    const isMouseLeftDown = e.buttons === 1;\n    if (isMouseLeftDown) {\n      const el = ref.current;\n      el.removeAttribute('style');\n    }\n  }, []);\n  return createPortal( /*#__PURE__*/React.createElement(\"div\", {\n    ref: ref,\n    className: \"sdoc-context-toolbar\",\n    onMouseDown: onMouseDown,\n    onMouseOver: onMouseMove\n  }, /*#__PURE__*/React.createElement(MenuGroup, null, /*#__PURE__*/React.createElement(TextStyleMenuList, {\n    editor: editor,\n    idPrefix: 'sdoc_context_toolbar'\n  }))), document.body);\n};\nexport default ContextToolbar;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}