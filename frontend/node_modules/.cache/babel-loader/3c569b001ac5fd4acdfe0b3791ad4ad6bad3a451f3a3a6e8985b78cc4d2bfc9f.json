{"ast":null,"code":"import _regeneratorRuntime from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _toConsumableArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport urlJoin from 'url-join';\nimport { Editor, Range, Transforms, Path, Node } from '@seafile/slate';\nimport { ReactEditor } from '@seafile/slate-react';\nimport slugId from 'slugid';\nimport context from '../../../../context';\nimport EventBus from '../../../utils/event-bus';\nimport { generateEmptyElement, getNodeType, isTextNode, getParentNode, focusEditor } from '../../core';\nimport { isList } from '../../toolbar/side-toolbar/helpers';\nimport { COMMENT_EDITOR, INTERNAL_EVENT } from '../../../constants';\nimport { CODE_BLOCK, ELEMENT_TYPE, IMAGE, IMAGE_BLOCK, INSERT_POSITION } from '../../constants';\nimport base64ToUnit8Array from '../../../../utils/base64-to-unit8array';\nexport var isInsertImageMenuDisabled = function isInsertImageMenuDisabled(editor, readonly) {\n  if (readonly) return true;\n  var selection = editor.selection;\n  if (selection === null) return true;\n  if (!Range.isCollapsed(selection)) return true;\n  var _Editor$nodes = Editor.nodes(editor, {\n      match: function match(n) {\n        var type = getNodeType(n);\n        if (!type && isTextNode(n) && n.id) {\n          var parentNode = getParentNode(editor.children, n.id);\n          type = getNodeType(parentNode);\n        }\n        if (type === CODE_BLOCK) return true;\n        if (type.startsWith('header')) return true;\n        if (Editor.isVoid(editor, n)) return true;\n        return false;\n      },\n      universal: true\n    }),\n    _Editor$nodes2 = _slicedToArray(_Editor$nodes, 1),\n    match = _Editor$nodes2[0];\n  if (match) return true;\n  return false;\n};\nexport var generateImageNode = function generateImageNode(src) {\n  var element = generateEmptyElement(IMAGE);\n  return _objectSpread(_objectSpread({}, element), {}, {\n    data: {\n      src: src\n    }\n  });\n};\nexport var insertImage = function insertImage(editor, srcList, selection) {\n  var position = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : INSERT_POSITION.CURRENT;\n  if (!srcList) return;\n  if (position !== INSERT_POSITION.AFTER) {\n    if (isInsertImageMenuDisabled(editor)) return;\n  }\n  var imageNodes = srcList.map(function (src) {\n    var isCommentEditor = editor.editorType === COMMENT_EDITOR;\n    var imgSrc = isCommentEditor ? getImageURL(src) : src;\n    return generateImageNode(imgSrc);\n  });\n  var validSelection = selection || editor.selection;\n  var path = Editor.path(editor, validSelection);\n  if (position === INSERT_POSITION.AFTER) {\n    if (isList(editor, path)) {\n      var targetPath = path.slice(0, -2);\n      targetPath[targetPath.length - 1] = targetPath[targetPath.length - 1] + 1;\n      Transforms.insertNodes(editor, imageNodes, {\n        at: targetPath\n      });\n      var _imageEndSelection = Path.next(Path.next([].concat(_toConsumableArray(targetPath), [0, 0])));\n      focusEditor(editor, _imageEndSelection);\n      return;\n    }\n    var p = generateEmptyElement(ELEMENT_TYPE.PARAGRAPH);\n    imageNodes.forEach(function (item, index) {\n      p.children[index] = item;\n    });\n    Transforms.insertNodes(editor, p, {\n      at: [path[0] + 1]\n    });\n    focusEditor(editor, [path[0] + 1, 2]);\n    return;\n  }\n  Transforms.insertNodes(editor, imageNodes, {\n    at: validSelection\n  });\n  var imageEndSelection = Path.next(Path.next(path));\n  focusEditor(editor, imageEndSelection);\n};\nexport var updateImage = function updateImage(editor, data) {\n  Transforms.setNodes(editor, {\n    data: data\n  }, {\n    match: function match(n) {\n      return getNodeType(n) === IMAGE;\n    },\n    at: editor.selection,\n    voids: true\n  });\n};\nexport var getImageURL = function getImageURL(url) {\n  if (url && url.startsWith('http')) return url;\n  var serviceUrl = context.getSetting('serviceUrl');\n  var assetsUrl = context.getSetting('assetsUrl');\n  return urlJoin(serviceUrl, assetsUrl, url);\n};\nexport var hasSdocImages = function hasSdocImages(originSdocUuid, fragmentData) {\n  var sdocUuid = context.getSetting('docUuid');\n  var hasImg = fragmentData.some(function (item) {\n    return item.children.some(function (child) {\n      return (child === null || child === void 0 ? void 0 : child.type) === IMAGE;\n    });\n  });\n  return originSdocUuid !== sdocUuid && hasImg;\n};\nexport var getImageData = function getImageData(fragmentData) {\n  var imageData = new Set();\n  fragmentData.forEach(function (item) {\n    return item.children.forEach(function (child) {\n      if ((child === null || child === void 0 ? void 0 : child.type) === IMAGE && !child.data.src.startsWith('http')) {\n        imageData.add(child.data.src.slice(1));\n      }\n    });\n  });\n  return Array.from(imageData);\n};\nexport var queryCopyMoveProgressView = function queryCopyMoveProgressView(taskId) {\n  var interval = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 300;\n  var timer;\n  var stop = function stop() {\n    clearTimeout(timer);\n  };\n  var start = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var res, done, eventBus;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return context.getCopyMoveProgressView(taskId);\n          case 2:\n            res = _context.sent;\n            done = res.data.done;\n            if (done) {\n              stop();\n              // Reload image\n              eventBus = EventBus.getInstance();\n              eventBus.dispatch(INTERNAL_EVENT.RELOAD_IMAGE);\n            } else {\n              timer = setTimeout(start, interval);\n            }\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n    return function start() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  start();\n};\nexport var resetCursor = function resetCursor(editor) {\n  var selection = editor.selection;\n  var currentPath = selection.focus.path;\n  var targetPath = Path.next(Path.next(currentPath));\n\n  // Set cursor after image insertion\n  queueMicrotask(function () {\n    Transforms.select(editor, targetPath);\n  });\n};\nexport var isSingleImage = function isSingleImage(data) {\n  if (data.length !== 1) return false;\n  if (Node.string(data[0]).length !== 0) return false;\n  if (data[0].children.filter(function (item) {\n    return (item === null || item === void 0 ? void 0 : item.type) === IMAGE;\n  }).length !== 1) return false;\n  return true;\n};\nexport var insertImageFiles = function insertImageFiles(files, editor, targetPath) {\n  context.uploadLocalImage(files).then(function (fileUrl) {\n    insertImage(editor, fileUrl, targetPath, INSERT_POSITION.AFTER);\n  });\n};\nexport var selectImageWhenSelectPartial = function selectImageWhenSelectPartial(event, editor, imageNode, isImageSelected) {\n  if (isImageSelected) return;\n  var isMouseLeftDown = event.buttons === 1;\n  if (!isMouseLeftDown) return;\n  var selection = editor.selection;\n  if (Range.isCollapsed(selection)) return;\n  var imagePath = ReactEditor.findPath(editor, imageNode);\n  if (imageNode.type === IMAGE_BLOCK) {\n    var imageIndex = imageNode.children.findIndex(function (item) {\n      return item.type === IMAGE;\n    });\n    imagePath = imagePath.concat([imageIndex]);\n  }\n  var isIncludedSelection = Range.includes(selection, imagePath);\n  if (isIncludedSelection) return;\n  var focusRange = _objectSpread(_objectSpread({}, selection), {}, {\n    focus: {\n      offset: 0,\n      path: imagePath\n    }\n  });\n  focusEditor(editor, focusRange);\n};\n\n// Upload image when the image is pasted from the clipboard in base64\nexport var handleBase64Image = function handleBase64Image(editor, path, imgData) {\n  var unit8Array = base64ToUnit8Array(imgData.src);\n  var blob = new Blob([unit8Array.u8arr], {\n    type: unit8Array.mime\n  });\n  var file = new File([blob], \"\".concat(slugId.nice(), \".jpg\"), {\n    type: unit8Array.mime\n  });\n  context.uploadLocalImage([file]).then(function (res) {\n    var _data = _objectSpread(_objectSpread({}, imgData), {}, {\n      src: res[0]\n    });\n    Transforms.setNodes(editor, {\n      data: _data\n    }, {\n      at: path\n    });\n  });\n};","map":{"version":3,"names":["_objectSpread","urlJoin","Editor","Range","Transforms","Path","Node","ReactEditor","slugId","context","EventBus","generateEmptyElement","getNodeType","isTextNode","getParentNode","focusEditor","isList","COMMENT_EDITOR","INTERNAL_EVENT","CODE_BLOCK","ELEMENT_TYPE","IMAGE","IMAGE_BLOCK","INSERT_POSITION","base64ToUnit8Array","isInsertImageMenuDisabled","editor","readonly","selection","isCollapsed","_Editor$nodes","nodes","match","n","type","id","parentNode","children","startsWith","isVoid","universal","_Editor$nodes2","_slicedToArray","generateImageNode","src","element","data","insertImage","srcList","position","arguments","length","undefined","CURRENT","AFTER","imageNodes","map","isCommentEditor","editorType","imgSrc","getImageURL","validSelection","path","targetPath","slice","insertNodes","at","imageEndSelection","next","concat","_toConsumableArray","p","PARAGRAPH","forEach","item","index","updateImage","setNodes","voids","url","serviceUrl","getSetting","assetsUrl","hasSdocImages","originSdocUuid","fragmentData","sdocUuid","hasImg","some","child","getImageData","imageData","Set","add","Array","from","queryCopyMoveProgressView","taskId","interval","timer","stop","clearTimeout","start","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","done","eventBus","wrap","_callee$","_context","prev","getCopyMoveProgressView","sent","getInstance","dispatch","RELOAD_IMAGE","setTimeout","apply","resetCursor","currentPath","focus","queueMicrotask","select","isSingleImage","string","filter","insertImageFiles","files","uploadLocalImage","then","fileUrl","selectImageWhenSelectPartial","event","imageNode","isImageSelected","isMouseLeftDown","buttons","imagePath","findPath","imageIndex","findIndex","isIncludedSelection","includes","focusRange","offset","handleBase64Image","imgData","unit8Array","blob","Blob","u8arr","mime","file","File","nice","_data"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/image/helpers.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport urlJoin from 'url-join';\nimport { Editor, Range, Transforms, Path, Node } from '@seafile/slate';\nimport { ReactEditor } from '@seafile/slate-react';\nimport slugId from 'slugid';\nimport context from '../../../../context';\nimport EventBus from '../../../utils/event-bus';\nimport { generateEmptyElement, getNodeType, isTextNode, getParentNode, focusEditor } from '../../core';\nimport { isList } from '../../toolbar/side-toolbar/helpers';\nimport { COMMENT_EDITOR, INTERNAL_EVENT } from '../../../constants';\nimport { CODE_BLOCK, ELEMENT_TYPE, IMAGE, IMAGE_BLOCK, INSERT_POSITION } from '../../constants';\nimport base64ToUnit8Array from '../../../../utils/base64-to-unit8array';\nexport const isInsertImageMenuDisabled = (editor, readonly) => {\n  if (readonly) return true;\n  const {\n    selection\n  } = editor;\n  if (selection === null) return true;\n  if (!Range.isCollapsed(selection)) return true;\n  const [match] = Editor.nodes(editor, {\n    match: n => {\n      let type = getNodeType(n);\n      if (!type && isTextNode(n) && n.id) {\n        const parentNode = getParentNode(editor.children, n.id);\n        type = getNodeType(parentNode);\n      }\n      if (type === CODE_BLOCK) return true;\n      if (type.startsWith('header')) return true;\n      if (Editor.isVoid(editor, n)) return true;\n      return false;\n    },\n    universal: true\n  });\n  if (match) return true;\n  return false;\n};\nexport const generateImageNode = src => {\n  const element = generateEmptyElement(IMAGE);\n  return _objectSpread(_objectSpread({}, element), {}, {\n    data: {\n      src\n    }\n  });\n};\nexport const insertImage = function (editor, srcList, selection) {\n  let position = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : INSERT_POSITION.CURRENT;\n  if (!srcList) return;\n  if (position !== INSERT_POSITION.AFTER) {\n    if (isInsertImageMenuDisabled(editor)) return;\n  }\n  const imageNodes = srcList.map(src => {\n    const isCommentEditor = editor.editorType === COMMENT_EDITOR;\n    const imgSrc = isCommentEditor ? getImageURL(src) : src;\n    return generateImageNode(imgSrc);\n  });\n  const validSelection = selection || editor.selection;\n  let path = Editor.path(editor, validSelection);\n  if (position === INSERT_POSITION.AFTER) {\n    if (isList(editor, path)) {\n      const targetPath = path.slice(0, -2);\n      targetPath[targetPath.length - 1] = targetPath[targetPath.length - 1] + 1;\n      Transforms.insertNodes(editor, imageNodes, {\n        at: targetPath\n      });\n      const imageEndSelection = Path.next(Path.next([...targetPath, 0, 0]));\n      focusEditor(editor, imageEndSelection);\n      return;\n    }\n    const p = generateEmptyElement(ELEMENT_TYPE.PARAGRAPH);\n    imageNodes.forEach((item, index) => {\n      p.children[index] = item;\n    });\n    Transforms.insertNodes(editor, p, {\n      at: [path[0] + 1]\n    });\n    focusEditor(editor, [path[0] + 1, 2]);\n    return;\n  }\n  Transforms.insertNodes(editor, imageNodes, {\n    at: validSelection\n  });\n  const imageEndSelection = Path.next(Path.next(path));\n  focusEditor(editor, imageEndSelection);\n};\nexport const updateImage = (editor, data) => {\n  Transforms.setNodes(editor, {\n    data\n  }, {\n    match: n => getNodeType(n) === IMAGE,\n    at: editor.selection,\n    voids: true\n  });\n};\nexport const getImageURL = url => {\n  if (url && url.startsWith('http')) return url;\n  const serviceUrl = context.getSetting('serviceUrl');\n  const assetsUrl = context.getSetting('assetsUrl');\n  return urlJoin(serviceUrl, assetsUrl, url);\n};\nexport const hasSdocImages = (originSdocUuid, fragmentData) => {\n  const sdocUuid = context.getSetting('docUuid');\n  const hasImg = fragmentData.some(item => item.children.some(child => (child === null || child === void 0 ? void 0 : child.type) === IMAGE));\n  return originSdocUuid !== sdocUuid && hasImg;\n};\nexport const getImageData = fragmentData => {\n  let imageData = new Set();\n  fragmentData.forEach(item => item.children.forEach(child => {\n    if ((child === null || child === void 0 ? void 0 : child.type) === IMAGE && !child.data.src.startsWith('http')) {\n      imageData.add(child.data.src.slice(1));\n    }\n  }));\n  return Array.from(imageData);\n};\nexport const queryCopyMoveProgressView = function (taskId) {\n  let interval = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 300;\n  let timer;\n  const stop = () => {\n    clearTimeout(timer);\n  };\n  const start = async () => {\n    const res = await context.getCopyMoveProgressView(taskId);\n    const {\n      data: {\n        done\n      }\n    } = res;\n    if (done) {\n      stop();\n      // Reload image\n      const eventBus = EventBus.getInstance();\n      eventBus.dispatch(INTERNAL_EVENT.RELOAD_IMAGE);\n    } else {\n      timer = setTimeout(start, interval);\n    }\n  };\n  start();\n};\nexport const resetCursor = editor => {\n  const {\n    selection\n  } = editor;\n  const currentPath = selection.focus.path;\n  const targetPath = Path.next(Path.next(currentPath));\n\n  // Set cursor after image insertion\n  queueMicrotask(() => {\n    Transforms.select(editor, targetPath);\n  });\n};\nexport const isSingleImage = data => {\n  if (data.length !== 1) return false;\n  if (Node.string(data[0]).length !== 0) return false;\n  if (data[0].children.filter(item => (item === null || item === void 0 ? void 0 : item.type) === IMAGE).length !== 1) return false;\n  return true;\n};\nexport const insertImageFiles = (files, editor, targetPath) => {\n  context.uploadLocalImage(files).then(fileUrl => {\n    insertImage(editor, fileUrl, targetPath, INSERT_POSITION.AFTER);\n  });\n};\nexport const selectImageWhenSelectPartial = (event, editor, imageNode, isImageSelected) => {\n  if (isImageSelected) return;\n  const isMouseLeftDown = event.buttons === 1;\n  if (!isMouseLeftDown) return;\n  const {\n    selection\n  } = editor;\n  if (Range.isCollapsed(selection)) return;\n  let imagePath = ReactEditor.findPath(editor, imageNode);\n  if (imageNode.type === IMAGE_BLOCK) {\n    const imageIndex = imageNode.children.findIndex(item => item.type === IMAGE);\n    imagePath = imagePath.concat([imageIndex]);\n  }\n  const isIncludedSelection = Range.includes(selection, imagePath);\n  if (isIncludedSelection) return;\n  const focusRange = _objectSpread(_objectSpread({}, selection), {}, {\n    focus: {\n      offset: 0,\n      path: imagePath\n    }\n  });\n  focusEditor(editor, focusRange);\n};\n\n// Upload image when the image is pasted from the clipboard in base64\nexport const handleBase64Image = (editor, path, imgData) => {\n  const unit8Array = base64ToUnit8Array(imgData.src);\n  const blob = new Blob([unit8Array.u8arr], {\n    type: unit8Array.mime\n  });\n  const file = new File([blob], \"\".concat(slugId.nice(), \".jpg\"), {\n    type: unit8Array.mime\n  });\n  context.uploadLocalImage([file]).then(res => {\n    const _data = _objectSpread(_objectSpread({}, imgData), {}, {\n      src: res[0]\n    });\n    Transforms.setNodes(editor, {\n      data: _data\n    }, {\n      at: path\n    });\n  });\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}