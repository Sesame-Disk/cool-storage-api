{"ast":null,"code":"import _toConsumableArray from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Fragment}from'react';import{v4 as uuidv4}from'uuid';import{gettext}from'../../utils/constants';import{seafileAPI}from'../../utils/seafile-api';import{Utils}from'../../utils/utils';import toaster from'../toast';import RepoTag from'../../models/repo-tag';import TagListItem from'./tag-list-item';import VirtualTagListItem from'./virtual-tag-list-item';import TagListFooter from'./tag-list-footer';import{TAG_COLORS}from'../../constants/';import'../../css/repo-tag.css';import'./list-tag-popover.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ListTagPopover=/*#__PURE__*/function(_React$Component){_inherits(ListTagPopover,_React$Component);var _super=_createSuper(ListTagPopover);function ListTagPopover(props){var _this;_classCallCheck(this,ListTagPopover);_this=_super.call(this,props);_this.loadTags=function(){seafileAPI.listRepoTags(_this.props.repoID).then(function(res){var repotagList=[];res.data.repo_tags.forEach(function(item){var repo_tag=new RepoTag(item);repotagList.push(repo_tag);});_this.setState({repotagList:repotagList});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.updateTags=function(newRepotagList){_this.setState({repotagList:[].concat(_toConsumableArray(_this.state.repotagList),_toConsumableArray(newRepotagList))});};_this.onDeleteTag=function(tag){var repoID=_this.props.repoID;var targetTagID=tag.id;seafileAPI.deleteRepoTag(repoID,targetTagID).then(function(res){_this.setState({repotagList:_this.state.repotagList.filter(function(tag){return tag.id!=targetTagID;})});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.createVirtualTag=function(e){e.preventDefault();var repotagList=_this.state.repotagList;var virtual_repo_tag={name:'',color:TAG_COLORS[Math.floor(Math.random()*TAG_COLORS.length)],// generate random tag color for virtual tag\nid:\"virtual-tag-\".concat(uuidv4()),is_virtual:true};repotagList.push(virtual_repo_tag);_this.setState({repotagList:repotagList});};_this.deleteVirtualTag=function(virtualTag){var repotagList=_this.state.repotagList;var index=repotagList.findIndex(function(item){return item.id===virtualTag.id;});repotagList.splice(index,1);_this.setState({repotagList:repotagList});};_this.updateVirtualTag=function(virtualTag,data){var repoID=_this.props.repoID;var repotagList=_this.state.repotagList;var index=repotagList.findIndex(function(item){return item.id===virtualTag.id;});if(index<0)return null;// If virtual tag color is updated and virtual tag name is empty, it will be saved to local state, don't save it to the server\nif(data.color){virtualTag.color=data.color;repotagList[index]=virtualTag;_this.setState({repotagList:repotagList});return;}// If virtual tag name is updated and name is not empty, virtual tag color use default, save it to the server\nif(data.name&&data.name.length>0){var color=virtualTag.color;var name=data.name;seafileAPI.createRepoTag(repoID,name,color).then(function(res){// After saving sag to the server, replace the virtual tag with newly created tag\nrepotagList[index]=new RepoTag(res.data.repo_tag);_this.setState({repotagList:repotagList});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}};_this.state={repotagList:[]};return _this;}_createClass(ListTagPopover,[{key:\"componentDidMount\",value:function componentDidMount(){this.loadTags();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"ul\",{className:\"tag-list tag-list-container my-2\",children:this.state.repotagList.map(function(repoTag,index){if(repoTag.is_virtual){return/*#__PURE__*/_jsx(VirtualTagListItem,{item:repoTag,repoID:_this2.props.repoID,deleteVirtualTag:_this2.deleteVirtualTag,updateVirtualTag:_this2.updateVirtualTag},index);}else{return/*#__PURE__*/_jsx(TagListItem,{item:repoTag,repoID:_this2.props.repoID,onDeleteTag:_this2.onDeleteTag},index);}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"add-tag-link px-4 py-2 d-flex align-items-center\",onClick:this.createVirtualTag,children:[/*#__PURE__*/_jsx(\"span\",{className:\"sf2-icon-plus mr-2\"}),gettext('Create a new tag')]}),/*#__PURE__*/_jsx(TagListFooter,{toggle:this.props.onListTagCancel,repotagList:this.state.repotagList,updateTags:this.updateTags,repoID:this.props.repoID})]});}}]);return ListTagPopover;}(React.Component);export{ListTagPopover as default};","map":{"version":3,"names":["React","Fragment","v4","uuidv4","gettext","seafileAPI","Utils","toaster","RepoTag","TagListItem","VirtualTagListItem","TagListFooter","TAG_COLORS","jsx","_jsx","jsxs","_jsxs","ListTagPopover","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","loadTags","listRepoTags","repoID","then","res","repotagList","data","repo_tags","forEach","item","repo_tag","push","setState","catch","error","errMessage","getErrorMsg","danger","updateTags","newRepotagList","concat","_toConsumableArray","state","onDeleteTag","tag","targetTagID","id","deleteRepoTag","filter","createVirtualTag","e","preventDefault","virtual_repo_tag","name","color","Math","floor","random","length","is_virtual","deleteVirtualTag","virtualTag","index","findIndex","splice","updateVirtualTag","createRepoTag","_createClass","key","value","componentDidMount","render","_this2","children","className","map","repoTag","onClick","toggle","onListTagCancel","Component","default"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/popover/list-tag-popover.js"],"sourcesContent":["import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { v4 as uuidv4 } from 'uuid';\nimport { gettext } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../toast';\nimport RepoTag from '../../models/repo-tag';\nimport TagListItem from './tag-list-item';\nimport VirtualTagListItem from './virtual-tag-list-item';\nimport TagListFooter from './tag-list-footer';\nimport { TAG_COLORS } from '../../constants/';\n\nimport '../../css/repo-tag.css';\nimport './list-tag-popover.css';\n\nexport default class ListTagPopover extends React.Component {\n\n  static propTypes = {\n    repoID: PropTypes.string.isRequired,\n    onListTagCancel: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      repotagList: []\n    };\n  }\n\n  componentDidMount() {\n    this.loadTags();\n  }\n\n  loadTags = () => {\n    seafileAPI.listRepoTags(this.props.repoID).then(res => {\n      let repotagList = [];\n      res.data.repo_tags.forEach(item => {\n        let repo_tag = new RepoTag(item);\n        repotagList.push(repo_tag);\n      });\n      this.setState({ repotagList });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  updateTags = (newRepotagList) => {\n    this.setState({\n      repotagList: [...this.state.repotagList, ...newRepotagList],\n    });\n  };\n\n  onDeleteTag = (tag) => {\n    const { repoID } = this.props;\n    const { id: targetTagID } = tag;\n    seafileAPI.deleteRepoTag(repoID, targetTagID).then((res) => {\n      this.setState({\n        repotagList: this.state.repotagList.filter(tag => tag.id != targetTagID)\n      });\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  createVirtualTag = (e) => {\n    e.preventDefault();\n    let { repotagList } = this.state;\n    let virtual_repo_tag = {\n      name: '',\n      color: TAG_COLORS[Math.floor(Math.random() * TAG_COLORS.length)], // generate random tag color for virtual tag\n      id: `virtual-tag-${uuidv4()}`,\n      is_virtual: true,\n    };\n    repotagList.push(virtual_repo_tag);\n    this.setState({ repotagList });\n  };\n\n  deleteVirtualTag = (virtualTag) => {\n    let { repotagList } = this.state;\n    let index = repotagList.findIndex(item => item.id === virtualTag.id);\n    repotagList.splice(index, 1);\n    this.setState({ repotagList });\n  };\n\n  updateVirtualTag = (virtualTag, data) => {\n    const repoID = this.props.repoID;\n    const { repotagList } = this.state;\n    const index = repotagList.findIndex(item => item.id === virtualTag.id);\n    if (index < 0) return null;\n\n    // If virtual tag color is updated and virtual tag name is empty, it will be saved to local state, don't save it to the server\n    if (data.color) {\n      virtualTag.color = data.color;\n      repotagList[index] = virtualTag;\n      this.setState({ repotagList });\n      return;\n    }\n\n    // If virtual tag name is updated and name is not empty, virtual tag color use default, save it to the server\n    if (data.name && data.name.length > 0) {\n      let color = virtualTag.color;\n      let name = data.name;\n      seafileAPI.createRepoTag(repoID, name, color).then((res) => {\n        // After saving sag to the server, replace the virtual tag with newly created tag\n        repotagList[index] = new RepoTag(res.data.repo_tag);\n        this.setState({ repotagList });\n      }).catch((error) => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    }\n  };\n\n  render() {\n    return (\n      <Fragment>\n        <ul className=\"tag-list tag-list-container my-2\">\n          {this.state.repotagList.map((repoTag, index) => {\n            if (repoTag.is_virtual) {\n              return (\n                <VirtualTagListItem\n                  key={index}\n                  item={repoTag}\n                  repoID={this.props.repoID}\n                  deleteVirtualTag={this.deleteVirtualTag}\n                  updateVirtualTag={this.updateVirtualTag}\n                />\n              );\n            } else {\n              return (\n                <TagListItem\n                  key={index}\n                  item={repoTag}\n                  repoID={this.props.repoID}\n                  onDeleteTag={this.onDeleteTag}\n                />\n              );\n            }\n          })}\n        </ul>\n        <div className=\"add-tag-link px-4 py-2 d-flex align-items-center\" onClick={this.createVirtualTag}>\n          <span className=\"sf2-icon-plus mr-2\"></span>{gettext('Create a new tag')}\n        </div>\n        <TagListFooter\n          toggle={this.props.onListTagCancel}\n          repotagList={this.state.repotagList}\n          updateTags={this.updateTags}\n          repoID={this.props.repoID}\n        />\n      </Fragment>\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}