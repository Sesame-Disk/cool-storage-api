{"ast":null,"code":"import _objectSpread from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component,Fragment}from'react';import{Utils}from'../../../utils/utils';import{seafileAPI}from'../../../utils/seafile-api';import{gettext}from'../../../utils/constants';import toaster from'../../../components/toast';import Loading from'../../../components/loading';import SysAdminSetInstitutionQuotaDialog from'../../../components/dialog/sysadmin-dialog/set-quota';import MainPanelTopbar from'../main-panel-topbar';import InstitutionNav from'./institution-nav';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Content=/*#__PURE__*/function(_Component){_inherits(Content,_Component);var _super=_createSuper(Content);function Content(props){var _this;_classCallCheck(this,Content);_this=_super.call(this,props);_this.toggleSetQuotaDialog=function(){_this.setState({isSetQuotaDialogOpen:!_this.state.isSetQuotaDialogOpen});};_this.showEditIcon=function(action){return/*#__PURE__*/_jsx(\"span\",{title:gettext('Edit'),className:\"fa fa-pencil-alt attr-action-icon\",onClick:action});};_this.state={isSetQuotaDialogOpen:false};return _this;}_createClass(Content,[{key:\"render\",value:function render(){var _this$props=this.props,loading=_this$props.loading,errorMsg=_this$props.errorMsg,institutionInfo=_this$props.institutionInfo;if(loading){return/*#__PURE__*/_jsx(Loading,{});}else if(errorMsg){return/*#__PURE__*/_jsx(\"p\",{className:\"error text-center\",children:errorMsg});}else{var name=institutionInfo.name,user_count=institutionInfo.user_count,quota_total=institutionInfo.quota_total,quota_used=institutionInfo.quota_used;var isSetQuotaDialogOpen=this.state.isSetQuotaDialogOpen;return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsxs(\"dl\",{className:\"m-0\",children:[/*#__PURE__*/_jsx(\"dt\",{className:\"info-item-heading\",children:gettext('Name')}),/*#__PURE__*/_jsx(\"dd\",{className:\"info-item-content\",children:name}),/*#__PURE__*/_jsx(\"dt\",{className:\"info-item-heading\",children:gettext('Number of members')}),/*#__PURE__*/_jsx(\"dd\",{className:\"info-item-content\",children:user_count}),/*#__PURE__*/_jsx(\"dt\",{className:\"info-item-heading\",children:gettext('Space Used')}),/*#__PURE__*/_jsxs(\"dd\",{className:\"info-item-content\",children:[\"\".concat(Utils.bytesToSize(quota_used),\" / \").concat(quota_total>0?Utils.bytesToSize(quota_total):'--'),this.showEditIcon(this.toggleSetQuotaDialog)]})]}),isSetQuotaDialogOpen&&/*#__PURE__*/_jsx(SysAdminSetInstitutionQuotaDialog,{updateQuota:this.props.updateQuota,toggle:this.toggleSetQuotaDialog})]});}}}]);return Content;}(Component);var InstitutionInfo=/*#__PURE__*/function(_Component2){_inherits(InstitutionInfo,_Component2);var _super2=_createSuper(InstitutionInfo);function InstitutionInfo(props){var _this2;_classCallCheck(this,InstitutionInfo);_this2=_super2.call(this,props);_this2.updateQuota=function(quota){seafileAPI.sysAdminUpdateInstitution(_this2.props.institutionID,quota).then(function(res){var newInstitutionInfo=Object.assign(_this2.state.institutionInfo,{quota_total:res.data.quota_total});_this2.setState({institutionInfo:newInstitutionInfo});toaster.success(gettext('Successfully set quota.'));}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.state={loading:true,errorMsg:'',institutionInfo:{}};return _this2;}_createClass(InstitutionInfo,[{key:\"componentDidMount\",value:function componentDidMount(){var _this3=this;seafileAPI.sysAdminGetInstitution(this.props.institutionID).then(function(res){_this3.setState({loading:false,institutionInfo:res.data});}).catch(function(error){_this3.setState({loading:false,errorMsg:Utils.getErrorMsg(error,true)// true: show login tip if 403\n});});}},{key:\"render\",value:function render(){var institutionInfo=this.state.institutionInfo;return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MainPanelTopbar,_objectSpread({},this.props)),/*#__PURE__*/_jsx(\"div\",{className:\"main-panel-center flex-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"cur-view-container\",children:[/*#__PURE__*/_jsx(InstitutionNav,{currentItem:\"info\",institutionID:this.props.institutionID,institutionName:institutionInfo.name}),/*#__PURE__*/_jsx(\"div\",{className:\"cur-view-content\",children:/*#__PURE__*/_jsx(Content,{loading:this.state.loading,errorMsg:this.state.errorMsg,institutionInfo:this.state.institutionInfo,updateQuota:this.updateQuota})})]})})]});}}]);return InstitutionInfo;}(Component);export default InstitutionInfo;","map":{"version":3,"names":["React","Component","Fragment","Utils","seafileAPI","gettext","toaster","Loading","SysAdminSetInstitutionQuotaDialog","MainPanelTopbar","InstitutionNav","jsx","_jsx","jsxs","_jsxs","Content","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","toggleSetQuotaDialog","setState","isSetQuotaDialogOpen","state","showEditIcon","action","title","className","onClick","_createClass","key","value","render","_this$props","loading","errorMsg","institutionInfo","children","name","user_count","quota_total","quota_used","concat","bytesToSize","updateQuota","toggle","InstitutionInfo","_Component2","_super2","_this2","quota","sysAdminUpdateInstitution","institutionID","then","res","newInstitutionInfo","Object","assign","data","success","catch","error","errMessage","getErrorMsg","danger","componentDidMount","_this3","sysAdminGetInstitution","_objectSpread","currentItem","institutionName"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/sys-admin/institutions/institution-info.js"],"sourcesContent":["import React, { Component, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { Utils } from '../../../utils/utils';\nimport { seafileAPI } from '../../../utils/seafile-api';\nimport { gettext } from '../../../utils/constants';\nimport toaster from '../../../components/toast';\nimport Loading from '../../../components/loading';\nimport SysAdminSetInstitutionQuotaDialog from '../../../components/dialog/sysadmin-dialog/set-quota';\nimport MainPanelTopbar from '../main-panel-topbar';\nimport InstitutionNav from './institution-nav';\n\nclass Content extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isSetQuotaDialogOpen: false,\n    };\n  }\n\n  toggleSetQuotaDialog = () => {\n    this.setState({isSetQuotaDialogOpen: !this.state.isSetQuotaDialogOpen});\n  };\n\n  showEditIcon = (action) => {\n    return (\n      <span\n        title={gettext('Edit')}\n        className=\"fa fa-pencil-alt attr-action-icon\"\n        onClick={action}>\n      </span>\n    );\n  };\n\n  render() {\n    const { loading, errorMsg, institutionInfo } = this.props;\n    if (loading) {\n      return <Loading />;\n    } else if (errorMsg) {\n      return <p className=\"error text-center\">{errorMsg}</p>;\n    } else {\n      const { name, user_count, quota_total, quota_used } = institutionInfo;\n      const { isSetQuotaDialogOpen } = this.state;\n      return (\n        <Fragment>\n          <dl className=\"m-0\">\n            <dt className=\"info-item-heading\">{gettext('Name')}</dt>\n            <dd className=\"info-item-content\">\n              {name}\n            </dd>\n\n            <dt className=\"info-item-heading\">{gettext('Number of members')}</dt>\n            <dd className=\"info-item-content\">{user_count}</dd>\n\n            <dt className=\"info-item-heading\">{gettext('Space Used')}</dt>\n            <dd className=\"info-item-content\">\n              {`${Utils.bytesToSize(quota_used)} / ${quota_total > 0 ? Utils.bytesToSize(quota_total) : '--'}`}\n              {this.showEditIcon(this.toggleSetQuotaDialog)}\n            </dd>\n          </dl>\n          {isSetQuotaDialogOpen &&\n          <SysAdminSetInstitutionQuotaDialog\n            updateQuota={this.props.updateQuota}\n            toggle={this.toggleSetQuotaDialog}\n          />\n          }\n        </Fragment>\n      );\n    }\n  }\n}\n\nContent.propTypes = {\n  loading: PropTypes.bool.isRequired,\n  errorMsg: PropTypes.string.isRequired,\n  items: PropTypes.array.isRequired,\n  getLogsByPage: PropTypes.func,\n  resetPerPage: PropTypes.func,\n  currentPage: PropTypes.number,\n  perPage: PropTypes.number,\n  pageInfo: PropTypes.object,\n  hasNextPage: PropTypes.bool,\n  institutionInfo: PropTypes.object.isRequired,\n  updateQuota: PropTypes.func.isRequired,\n};\n\n\nclass InstitutionInfo extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n      errorMsg: '',\n      institutionInfo: {}\n    };\n  }\n\n  componentDidMount () {\n    seafileAPI.sysAdminGetInstitution(this.props.institutionID).then((res) => {\n      this.setState({\n        loading: false,\n        institutionInfo: res.data\n      });\n    }).catch((error) => {\n      this.setState({\n        loading: false,\n        errorMsg: Utils.getErrorMsg(error, true) // true: show login tip if 403\n      });\n    });\n  }\n\n  updateQuota = (quota) => {\n    seafileAPI.sysAdminUpdateInstitution(this.props.institutionID, quota).then(res => {\n      const newInstitutionInfo = Object.assign(this.state.institutionInfo, {\n        quota_total: res.data.quota_total,\n      });\n      this.setState({institutionInfo: newInstitutionInfo});\n      toaster.success(gettext('Successfully set quota.'));\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n\n  render() {\n    const { institutionInfo } = this.state;\n    return (\n      <Fragment>\n        <MainPanelTopbar {...this.props} />\n        <div className=\"main-panel-center flex-row\">\n          <div className=\"cur-view-container\">\n            <InstitutionNav currentItem=\"info\" institutionID={this.props.institutionID} institutionName={institutionInfo.name} />\n            <div className=\"cur-view-content\">\n              <Content\n                loading={this.state.loading}\n                errorMsg={this.state.errorMsg}\n                institutionInfo={this.state.institutionInfo}\n                updateQuota={this.updateQuota}\n              />\n            </div>\n          </div>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nInstitutionInfo.propTypes = {\n  institutionID: PropTypes.string,\n};\n\nexport default InstitutionInfo;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}