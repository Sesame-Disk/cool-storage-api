{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Fragment}from'react';import cookie from'react-cookies';import moment from'moment';import{navigate}from'@gatsbyjs/reach-router';import{gettext,siteRoot,username,enableVideoThumbnail}from'../../utils/constants';import{seafileAPI}from'../../utils/seafile-api';import{Utils}from'../../utils/utils';import collabServer from'../../utils/collab-server';import Dirent from'../../models/dirent';import FileTag from'../../models/file-tag';import RepoTag from'../../models/repo-tag';import RepoInfo from'../../models/repo-info';import TreeNode from'../../components/tree-view/tree-node';import treeHelper from'../../components/tree-view/tree-helper';import toaster from'../../components/toast';import ModalPortal from'../../components/modal-portal';import LibDecryptDialog from'../../components/dialog/lib-decrypt-dialog';import LibContentToolbar from'./lib-content-toolbar';import LibContentContainer from'./lib-content-container';import FileUploader from'../../components/file-uploader/file-uploader';import CopyMoveDirentProgressDialog from'../../components/dialog/copy-move-dirent-progress-dialog';import DeleteFolderDialog from'../../components/dialog/delete-folder-dialog';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LibContentView=/*#__PURE__*/function(_React$Component){_inherits(LibContentView,_React$Component);var _super=_createSuper(LibContentView);function LibContentView(props){var _this2;_classCallCheck(this,LibContentView);_this2=_super.call(this,props);_this2.showDirentDetail=function(direntDetailPanelTab){if(direntDetailPanelTab){_this2.setState({direntDetailPanelTab:direntDetailPanelTab},function(){_this2.setState({isDirentDetailShow:true});});}else{_this2.setState({direntDetailPanelTab:'',isDirentDetailShow:true});}};_this2.toggleDirentDetail=function(){_this2.setState({direntDetailPanelTab:'',isDirentDetailShow:!_this2.state.isDirentDetailShow});};_this2.closeDirentDetail=function(){_this2.setState({isDirentDetailShow:false,direntDetailPanelTab:''});};_this2.onpopstate=function(event){if(event.state&&event.state.key){// root path\nif(_this2.state.path==='/'){return;}else{var path='/';_this2.loadDirentList(path);_this2.setState({path:path,isViewFile:false});}}else if(event.state&&event.state.path){// file path\nvar _path=event.state.path;if(_this2.state.currentMode==='column'){if(Utils.isMarkdownFile(_path)){// Judging not strict\n_this2.showFile(_path);return;}}_this2.loadDirentList(_path);_this2.setState({path:_path,isViewFile:false});}};_this2.onRepoUpdateEvent=function(){var currentTime=new Date();if(parseFloat(currentTime-_this2.lastModifyTime)/1000<=5){return;}var repoID=_this2.props.repoID;var _this2$state=_this2.state,path=_this2$state.path,dirID=_this2$state.dirID;if(_this2.state.currentMode==='column'){if(_this2.state.isViewFile){_this2.updateColumnMarkdownData(path);}else{seafileAPI.dirMetaData(repoID,path).then(function(res){if(res.data.id!==dirID){_this2.loadDirentList(path);}}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}}else{seafileAPI.dirMetaData(repoID,path).then(function(res){if(res.data.id!==dirID){_this2.loadDirentList(path);}}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}};_this2.updateUsedRepoTags=function(){var repoID=_this2.props.repoID;seafileAPI.listRepoTags(repoID).then(function(res){var repoTags=[];var usedRepoTags=[];res.data.repo_tags.forEach(function(item){var repoTag=new RepoTag(item);repoTags.push(repoTag);if(repoTag.fileCount>0){usedRepoTags.push(repoTag);}});_this2.setState({repoTags:repoTags,usedRepoTags:usedRepoTags});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.updateColumnMarkdownData=function(filePath){var repoID=_this2.props.repoID;// update state\n_this2.setState({path:filePath,isViewFile:true});// update data\nseafileAPI.getFileInfo(repoID,filePath).then(function(res){var _res$data=res.data,mtime=_res$data.mtime,permission=_res$data.permission,last_modifier_name=_res$data.last_modifier_name;seafileAPI.getFileDownloadLink(repoID,filePath).then(function(res){seafileAPI.getFileContent(res.data).then(function(res){if(_this2.state.content!==res.data){_this2.setState({isFileLoading:true});}_this2.setState({content:res.data,filePermission:permission,latestContributor:last_modifier_name,lastModified:moment.unix(mtime).fromNow(),isFileLoading:false,isFileLoadedErr:false});});});}).catch(function(){_this2.setState({isFileLoading:false,isFileLoadedErr:true});});};// load data\n_this2.loadDirData=function(path){var repoID=_this2.props.repoID;// listen current repo\ncollabServer.watchRepo(repoID,_this2.onRepoUpdateEvent);// list used FileTags\n_this2.updateUsedRepoTags();if(Utils.isMarkdownFile(path)){seafileAPI.getFileInfo(_this2.props.repoID,path).then(function(){if(_this2.state.currentMode!=='column'){cookie.save('seafile_view_mode','column');_this2.setState({currentMode:'column'});}_this2.loadSidePanel(path);_this2.showFile(path);}).catch(function(){if(_this2.state.currentMode==='column'){// After an error occurs, follow dir\n_this2.loadSidePanel(path);_this2.showDir(path);}else{_this2.showDir(path);}});}else{if(_this2.state.currentMode==='column'){_this2.loadSidePanel(path);_this2.showDir(path);}else{_this2.showDir(path);}}};_this2.loadSidePanel=function(path){var repoID=_this2.props.repoID;if(path==='/'){seafileAPI.listDir(repoID,'/').then(function(res){var _res$data2=res.data,dirent_list=_res$data2.dirent_list,user_perm=_res$data2.user_perm;var tree=_this2.state.treeData;_this2.addResponseListToNode(dirent_list,tree.root);_this2.setState({isTreeDataLoading:false,treeData:tree,userPerm:user_perm});}).catch(function(){_this2.setState({isTreeDataLoading:false});});}else{_this2.loadNodeAndParentsByPath(path);}};_this2.showDir=function(path){var repoID=_this2.props.repoID;if(!_this2.state.isSessionExpired){// update stste\n_this2.setState({isDirentListLoading:true,isViewFile:false,selectedDirentList:[]});}// update data\n_this2.loadDirentList(path);_this2.resetShowLength();if(!_this2.isNeedUpdateHistoryState){_this2.isNeedUpdateHistoryState=true;return;}// update location\nvar repoInfo=_this2.state.currentRepoInfo;var url=siteRoot+'library/'+repoID+'/'+encodeURIComponent(repoInfo.repo_name)+Utils.encodePath(path);window.history.pushState({url:url,path:path},path,url);};_this2.showFile=function(filePath){var repoID=_this2.props.repoID;if(_this2.state.currentMode==='column'){seafileAPI.listFileTags(repoID,filePath).then(function(res){var fileTags=res.data.file_tags.map(function(item){return new FileTag(item);});_this2.setState({fileTags:fileTags});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}// update state\n_this2.setState({isFileLoading:true,path:filePath,isViewFile:true});// update data\nseafileAPI.getFileInfo(repoID,filePath).then(function(res){var _res$data3=res.data,mtime=_res$data3.mtime,permission=_res$data3.permission,last_modifier_name=_res$data3.last_modifier_name;seafileAPI.getFileDownloadLink(repoID,filePath).then(function(res){seafileAPI.getFileContent(res.data).then(function(res){_this2.setState({content:res.data,filePermission:permission,latestContributor:last_modifier_name,lastModified:moment.unix(mtime).fromNow(),isFileLoading:false,isFileLoadedErr:false});});});}).catch(function(err){var errMsg=Utils.getErrorMsg(err,true);if(!err.response||err.response.status!==403){toaster.danger(errMsg);}_this2.setState({isFileLoading:false,isFileLoadedErr:true});});// update location\nvar repoInfo=_this2.state.currentRepoInfo;var url=siteRoot+'library/'+repoID+'/'+encodeURIComponent(repoInfo.repo_name)+Utils.encodePath(filePath);window.history.pushState({url:url,path:filePath},filePath,url);};_this2.loadDirentList=function(path){var repoID=_this2.props.repoID;seafileAPI.listDir(repoID,path,{'with_thumbnail':true}).then(function(res){var direntList=[];res.data.dirent_list.forEach(function(item){var dirent=new Dirent(item);direntList.push(dirent);});_this2.setState({pathExist:true,userPerm:res.data.user_perm,isDirentListLoading:false,direntList:Utils.sortDirents(direntList,_this2.state.sortBy,_this2.state.sortOrder),dirID:res.data.dir_id,path:path,isSessionExpired:false});if(!_this2.state.repoEncrypted&&direntList.length){_this2.getThumbnails(repoID,path,_this2.state.direntList);}if(_this2.state.currentRepoInfo.is_admin){if(_this2.foldersSharedOut){_this2.identifyFoldersSharedOut();}else{_this2.foldersSharedOut=[];seafileAPI.getAllRepoFolderShareInfo(repoID).then(function(res){res.data.share_info_list.forEach(function(item){if(_this2.foldersSharedOut.indexOf(item.path)===-1){_this2.foldersSharedOut.push(item.path);}});_this2.identifyFoldersSharedOut();});}}}).catch(function(err){Utils.getErrorMsg(err,true);if(err.response&&err.response.status===403){_this2.setState({isDirentListLoading:false});return;}_this2.setState({isDirentListLoading:false,pathExist:false});});};_this2.identifyFoldersSharedOut=function(){var _this2$state2=_this2.state,path=_this2$state2.path,direntList=_this2$state2.direntList;if(_this2.foldersSharedOut.length==0){return;}direntList.forEach(function(dirent){if(dirent.type=='dir'&&_this2.foldersSharedOut.indexOf(Utils.joinPath(path,dirent.name)+'/')!==-1){dirent.has_been_shared_out=true;}});_this2.setState({direntList:direntList});};_this2.onListContainerScroll=function(){var itemsShowLength=_this2.state.itemsShowLength+100;_this2.setState({itemsShowLength:itemsShowLength});};_this2.resetShowLength=function(){_this2.setState({itemsShowLength:100});};_this2.getThumbnails=function(repoID,path,direntList){var items=direntList.filter(function(item){return(Utils.imageCheck(item.name)||enableVideoThumbnail&&Utils.videoCheck(item.name))&&!item.encoded_thumbnail_src;});if(items.length==0){return;}var _this=_assertThisInitialized(_this2);var len=items.length;var thumbnailSize=48;var getThumbnail=function getThumbnail(i){var curItem=items[i];var curItemPath=[path,curItem.name].join('/');seafileAPI.createThumbnail(repoID,curItemPath,thumbnailSize).then(function(res){curItem.encoded_thumbnail_src=res.data.encoded_thumbnail_src;}).catch(function(error){// do nothing\n}).then(function(){if(i<len-1){getThumbnail(++i);}else{_this.setState({direntList:direntList});}});};getThumbnail(0);};_this2.updateMoveCopyTreeNode=function(path){var repoID=_this2.props.repoID;var tree=_this2.state.treeData.clone();var node=tree.getNodeByPath(path);// for node not loaded, such as a deep folder '/vv/aa'\nif(!node){// node: null\nreturn false;}var nodeChildren=node.children.map(function(item){return item.object;});var nodeChildrenNames=nodeChildren.map(function(item){return item.name;});seafileAPI.listDir(repoID,path).then(function(res){var newDirentList=res.data.dirent_list;var newAddedDirents=newDirentList.filter(function(item){return!nodeChildrenNames.includes(item.name);});newAddedDirents.forEach(function(item){_this2.addNodeToTree(item.name,path,item.type);});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.cancelCopyMoveDirent=function(){var taskId=_this2.state.asyncCopyMoveTaskId;seafileAPI.cancelCopyMoveOperation(taskId);_this2.currentMoveItemName='';_this2.currentMoveItemPath='';var direntList=_this2.state.direntList;_this2.setState({direntList:direntList.slice(0)});};_this2.onMoveProgressDialogToggle=function(){var asyncOperationProgress=_this2.state.asyncOperationProgress;if(asyncOperationProgress!==100){_this2.cancelCopyMoveDirent();}_this2.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:false});};// toolbar operations\n_this2.onMoveItems=function(destRepo,destDirentPath){var repoID=_this2.props.repoID;var selectedDirentList=_this2.state.selectedDirentList;var dirNames=_this2.getSelectedDirentNames();var direntPaths=_this2.getSelectedDirentPaths();seafileAPI.moveDir(repoID,destRepo.repo_id,destDirentPath,_this2.state.path,dirNames).then(function(res){if(repoID!==destRepo.repo_id){_this2.setState({asyncCopyMoveTaskId:res.data.task_id,asyncOperatedFilesLength:selectedDirentList.length,asyncOperationProgress:0,asyncOperationType:'move',isCopyMoveProgressDialogShow:true},function(){// After moving successfully, delete related files\n_this2.getAsyncCopyMoveProgress();});}if(repoID===destRepo.repo_id){if(_this2.state.currentMode==='column'){_this2.deleteTreeNodes(direntPaths);}_this2.moveDirents(dirNames);// 2. tow columns mode need update left tree\nif(_this2.state.currentMode==='column'){_this2.updateMoveCopyTreeNode(destDirentPath);}// show tip message if move to current repo\nvar message=Utils.getMoveSuccessMessage(dirNames);toaster.success(message);}}).catch(function(error){if(!error.response.data.lib_need_decrypt){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){errMessage=Utils.getCopyFailedMessage(dirNames);}toaster.danger(errMessage);}else{_this2.setState({libNeedDecryptWhenMove:true,destRepoWhenCopyMove:destRepo,destDirentPathWhenCopyMove:destDirentPath});}});};_this2.onCopyItems=function(destRepo,destDirentPath){var repoID=_this2.props.repoID;var selectedDirentList=_this2.state.selectedDirentList;var dirNames=_this2.getSelectedDirentNames();seafileAPI.copyDir(repoID,destRepo.repo_id,destDirentPath,_this2.state.path,dirNames).then(function(res){if(repoID!==destRepo.repo_id){_this2.setState({asyncCopyMoveTaskId:res.data.task_id,asyncOperatedFilesLength:selectedDirentList.length,asyncOperationProgress:0,asyncOperationType:'copy',isCopyMoveProgressDialogShow:true},function(){_this2.getAsyncCopyMoveProgress();});}if(repoID===destRepo.repo_id){if(_this2.state.currentMode==='column'){_this2.updateMoveCopyTreeNode(destDirentPath);}if(destDirentPath===_this2.state.path){_this2.loadDirentList(_this2.state.path);}// show tip message if copy to current repo\nvar message=Utils.getCopySuccessfulMessage(dirNames);toaster.success(message);}}).catch(function(error){if(!error.response.data.lib_need_decrypt){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){errMessage=Utils.getCopyFailedMessage(dirNames);}toaster.danger(errMessage);}else{_this2.setState({libNeedDecryptWhenCopy:true,destRepoWhenCopyMove:destRepo,destDirentPathWhenCopyMove:destDirentPath});}});};_this2.restoreDeletedDirents=function(commitID,paths,e){var repoID=_this2.props.repoID;e.preventDefault();toaster.closeAll();seafileAPI.restoreDirents(repoID,commitID,paths).then(function(res){var _res$data4=res.data,success=_res$data4.success,failed=_res$data4.failed;success.forEach(function(dirent){var name=Utils.getFileName(dirent.path);var parentPath=Utils.getDirName(dirent.path);if(!dirent.is_dir){if(_this2.state.currentMode==='column'){_this2.addNodeToTree(name,parentPath,'file');}if(parentPath===_this2.state.path&&!_this2.state.isViewFile){_this2.addDirent(name,'file');}}else{if(_this2.state.currentMode==='column'){_this2.addNodeToTree(name,parentPath,'dir');}if(parentPath===_this2.state.path&&!_this2.state.isViewFile){_this2.addDirent(name,'dir');}}});if(success.length){var msg=success.length>1?gettext('Restored {name} and {n} other items'):gettext('Restored {name}');msg=msg.replace('{name}',success[0].path.split('/').pop()).replace('{n}',success.length-1);toaster.success(msg);}if(failed.length){var _msg=failed.length>1?gettext('Failed to restore {name} and {n} other items'):gettext('Failed to restore {name}');_msg=_msg.replace('{name}',failed[0].path.split('/').pop()).replace('{n}',failed.length-1);toaster.danger(_msg);}}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.onDeleteItems=function(){var repoID=_this2.props.repoID;var direntPaths=_this2.getSelectedDirentPaths();var dirNames=_this2.getSelectedDirentNames();_this2.setState({updateDetail:!_this2.state.updateDetail});seafileAPI.deleteMutipleDirents(repoID,_this2.state.path,dirNames).then(function(res){if(_this2.state.currentMode==='column'){_this2.deleteTreeNodes(direntPaths);}_this2.deleteDirents(dirNames);var msg='';if(direntPaths.length>1){msg=gettext('Successfully deleted {name} and {n} other items.');msg=msg.replace('{name}',dirNames[0]);msg=msg.replace('{n}',dirNames.length-1);}else{msg=gettext('Successfully deleted {name}.');msg=msg.replace('{name}',dirNames[0]);}var successTipWithUndo=/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:msg}),/*#__PURE__*/_jsx(\"a\",{className:\"action-link p-0 ml-1\",href:\"#\",onClick:_this2.restoreDeletedDirents.bind(_assertThisInitialized(_this2),res.data.commit_id,direntPaths),children:gettext('Undo')})]});toaster.success(successTipWithUndo,{duration:5});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){errMessage=gettext('Failed to delete {name} and {n} other items.');errMessage=errMessage.replace('{name}',dirNames[0]);errMessage=errMessage.replace('{n}',dirNames.length-1);}toaster.danger(errMessage);});};_this2.onAddFolder=function(dirPath){var repoID=_this2.props.repoID;seafileAPI.createDir(repoID,dirPath).then(function(){var name=Utils.getFileName(dirPath);var parentPath=Utils.getDirName(dirPath);if(_this2.state.currentMode==='column'){_this2.addNodeToTree(name,parentPath,'dir');}if(parentPath===_this2.state.path&&!_this2.state.isViewFile){_this2.addDirent(name,'dir');}}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.onAddFile=function(filePath){var repoID=_this2.props.repoID;seafileAPI.createFile(repoID,filePath).then(function(res){var name=Utils.getFileName(filePath);var parentPath=Utils.getDirName(filePath);if(_this2.state.currentMode==='column'){_this2.addNodeToTree(name,parentPath,'file');}if(parentPath===_this2.state.path&&!_this2.state.isViewFile){_this2.addDirent(name,'file',res.data.size);}}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.switchViewMode=function(mode){if(mode===_this2.state.currentMode){return;}if(mode==='detail'){_this2.toggleDirentDetail();return;}cookie.save('seafile_view_mode',mode);var path=_this2.state.path;if(_this2.state.currentMode==='column'&&_this2.state.isViewFile){path=Utils.getDirName(path);_this2.setState({path:path,isViewFile:false});var repoInfo=_this2.state.currentRepoInfo;var url=siteRoot+'library/'+repoInfo.repo_id+'/'+encodeURIComponent(repoInfo.repo_name)+Utils.encodePath(path);window.history.pushState({url:url,path:path},path,url);}if(mode==='column'){_this2.loadSidePanel(_this2.state.path);}_this2.isNeedUpdateHistoryState=false;_this2.setState({currentMode:mode});_this2.showDir(path);};_this2.onSearchedClick=function(item){var path=item.is_dir?item.path.slice(0,item.path.length-1):item.path;if(_this2.state.currentPath===path){return;}if(_this2.state.currentMode==='column'){// load sidePanel\nvar index=-1;var paths=Utils.getPaths(path);for(var i=0;i<paths.length;i++){// eslint-disable-next-line\nvar node=_this2.state.treeData.getNodeByPath(node);if(!node){index=i;break;}}if(index===-1){// all the data has been loaded already.\nvar _node=_this2.state.treeData.getNodeByPath(path);_this2.setState({currentNode:_node});}else{_this2.loadNodeAndParentsByPath(path);}// load mainPanel\nif(item.is_dir){_this2.showDir(path);}else{if(Utils.isMarkdownFile(path)){_this2.showFile(path);}else{var url=siteRoot+'lib/'+item.repo_id+'/file'+Utils.encodePath(path);var isWeChat=Utils.isWeChat();if(!isWeChat){var newWindow=window.open('about:blank');newWindow.location.href=url;}else{location.href=url;}}}}else{if(item.is_dir){_this2.showDir(path);}else{var _url=siteRoot+'lib/'+item.repo_id+'/file'+Utils.encodePath(path);var _isWeChat=Utils.isWeChat();if(!_isWeChat){var _newWindow=window.open('about:blank');_newWindow.location.href=_url;}else{location.href=_url;}}}};_this2.onMainNavBarClick=function(nodePath){//just for dir\n_this2.resetSelected();if(_this2.state.currentMode==='column'){var tree=_this2.state.treeData.clone();var node=tree.getNodeByPath(nodePath);tree.expandNode(node);_this2.setState({treeData:tree,currentNode:node});}_this2.showDir(nodePath);};_this2.onLinkClick=function(link){var url=link;var repoID=_this2.props.repoID;if(Utils.isInternalMarkdownLink(url,repoID)){var path=Utils.getPathFromInternalMarkdownLink(url,repoID);_this2.showFile(path);}else if(Utils.isInternalDirLink(url,repoID)){var _path2=Utils.getPathFromInternalDirLink(url,repoID);_this2.showDir(_path2);}else{window.open(url);}};// list&tree operations\n_this2.onMainPanelItemRename=function(dirent,newName){var path=Utils.joinPath(_this2.state.path,dirent.name);_this2.renameItem(path,dirent.isDir(),newName);};_this2.onMainPanelItemDelete=function(dirent){var path=Utils.joinPath(_this2.state.path,dirent.name);_this2.deleteItem(path,dirent.isDir());};_this2.onRenameTreeNode=function(node,newName){_this2.renameItem(node.path,node.object.isDir(),newName);};_this2.onDeleteTreeNode=function(node){_this2.deleteItem(node.path,node.object.isDir());};_this2.renameItem=function(path,isDir,newName){var repoID=_this2.props.repoID;if(isDir){seafileAPI.renameDir(repoID,path,newName).then(function(){_this2.renameItemAjaxCallback(path,newName);}).catch(function(error){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){var _name=Utils.getFileName(path);errMessage=gettext('Renaming {name} failed').replace('{name}',_name);}toaster.danger(errMessage);});}else{seafileAPI.renameFile(repoID,path,newName).then(function(){_this2.renameItemAjaxCallback(path,newName);}).catch(function(error){var errMessage='';if(error.response.status==403&&error.response.data&&error.response.data['error_msg']){errMessage=error.response.data['error_msg'];}else{errMessage=Utils.getErrorMsg(error);}if(errMessage===gettext('Error')){var _name2=Utils.getFileName(path);errMessage=gettext('Renaming {name} failed').replace('{name}',_name2);}toaster.danger(errMessage);});}};_this2.toggleDeleteFolderDialog=function(){_this2.setState({isDeleteFolderDialogOpen:!_this2.state.isDeleteFolderDialogOpen});};_this2.deleteFolder=function(){var repoID=_this2.props.repoID;var path=_this2.state.folderToDelete;seafileAPI.deleteDir(repoID,path).then(function(res){_this2.deleteItemAjaxCallback(path,true);var name=Utils.getFileName(path);var msg=gettext('Successfully deleted {name}').replace('{name}',name);var successTipWithUndo=/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:msg}),/*#__PURE__*/_jsx(\"a\",{className:\"action-link p-0 ml-1\",href:\"#\",onClick:_this2.restoreDeletedDirents.bind(_assertThisInitialized(_this2),res.data.commit_id,[path]),children:gettext('Undo')})]});toaster.success(successTipWithUndo,{duration:5});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){var _name3=Utils.getFileName(path);errMessage=gettext('Failed to delete {name}').replace('{name}',_name3);}toaster.danger(errMessage);});};// list operations\n_this2.onMoveItem=function(destRepo,dirent,moveToDirentPath,nodeParentPath){var repoID=_this2.props.repoID;//just for view list state\nvar dirName=dirent.name;if(!nodeParentPath){nodeParentPath=_this2.state.path;}var direntPath=Utils.joinPath(nodeParentPath,dirName);seafileAPI.moveDir(repoID,destRepo.repo_id,moveToDirentPath,nodeParentPath,dirName).then(function(res){if(repoID!==destRepo.repo_id){_this2.setState({asyncCopyMoveTaskId:res.data.task_id,asyncOperatedFilesLength:1,asyncOperationProgress:0,asyncOperationType:'move',isCopyMoveProgressDialogShow:true},function(){_this2.currentMoveItemName=dirName;_this2.currentMoveItemPath=direntPath;_this2.getAsyncCopyMoveProgress(dirName,direntPath);});}if(_this2.state.currentMode==='column'){_this2.deleteTreeNode(direntPath);}// 1. move to current repo\n// 2. tow columns mode need update left tree\nif(repoID===destRepo.repo_id&&_this2.state.currentMode==='column'){_this2.updateMoveCopyTreeNode(moveToDirentPath);}_this2.moveDirent(direntPath,moveToDirentPath);// show tip message if move to current repo\nif(repoID===destRepo.repo_id){var message=gettext('Successfully moved {name}.');message=message.replace('{name}',dirName);toaster.success(message);}}).catch(function(error){if(!error.response.data.lib_need_decrypt){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){errMessage=gettext('Failed to move {name}.');errMessage=errMessage.replace('{name}',dirName);}toaster.danger(errMessage);}else{_this2.setState({libNeedDecryptWhenMove:true,destRepoWhenCopyMove:destRepo,destDirentPathWhenCopyMove:moveToDirentPath,copyMoveSingleItem:true,srcDirentWhenCopyMove:dirent,srcNodeParentPathWhenCopyMove:nodeParentPath});}});};_this2.onCopyItem=function(destRepo,dirent,copyToDirentPath,nodeParentPath){var repoID=_this2.props.repoID;//just for view list state\nvar dirName=dirent.name;if(!nodeParentPath){nodeParentPath=_this2.state.path;}seafileAPI.copyDir(repoID,destRepo.repo_id,copyToDirentPath,nodeParentPath,dirName).then(function(res){if(repoID!==destRepo.repo_id){_this2.setState({asyncCopyMoveTaskId:res.data.task_id,asyncOperatedFilesLength:1,asyncOperationProgress:0,asyncOperationType:'copy',isCopyMoveProgressDialogShow:true},function(){_this2.getAsyncCopyMoveProgress();});}if(repoID===destRepo.repo_id){if(_this2.state.currentMode==='column'){_this2.updateMoveCopyTreeNode(copyToDirentPath);}if(copyToDirentPath===nodeParentPath){_this2.loadDirentList(_this2.state.path);}var message=gettext('Successfully copied %(name)s.');message=message.replace('%(name)s',dirName);toaster.success(message);}}).catch(function(error){if(!error.response.data.lib_need_decrypt){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){errMessage=gettext('Failed to copy %(name)s');errMessage=errMessage.replace('%(name)s',dirName);}toaster.danger(errMessage);}else{_this2.setState({libNeedDecryptWhenCopy:true,destRepoWhenCopyMove:destRepo,destDirentPathWhenCopyMove:copyToDirentPath,copyMoveSingleItem:true,srcDirentWhenCopyMove:dirent,srcNodeParentPathWhenCopyMove:nodeParentPath});}});};_this2.onConvertItem=function(dirent,dstType){var path=Utils.joinPath(_this2.state.path,dirent.name);var repoID=_this2.props.repoID;toaster.notifyInProgress(gettext('Converting, please wait...'),{'id':'conversion'});seafileAPI.convertFile(repoID,path,dstType).then(function(res){var newFileName=res.data.obj_name;var parentDir=res.data.parent_dir;var new_path=parentDir+'/'+newFileName;var parentPath=Utils.getDirName(new_path);if(_this2.state.currentMode==='column'){_this2.addNodeToTree(newFileName,parentPath,'file');}_this2.addDirent(newFileName,'file',res.data.size);var message=gettext('Successfully converted the file.');toaster.success(message,{'id':'conversion'});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){var _name4=Utils.getFileName(path);errMessage=gettext('Failed to convert {name}.').replace('{name}',_name4);}toaster.danger(errMessage,{'id':'conversion'});});};_this2.onDirentClick=function(dirent){var direntList=_this2.state.direntList.map(function(dirent){dirent.isSelected=false;return dirent;});if(dirent){// dirent.isSelected = true;\n_this2.setState({direntList:direntList,isDirentSelected:true,selectedDirentList:[dirent]});}else{_this2.setState({direntList:direntList,isDirentSelected:false,selectedDirentList:[]});}};_this2.onItemClick=function(dirent){_this2.resetSelected();var repoID=_this2.props.repoID;var direntPath=Utils.joinPath(_this2.state.path,dirent.name);if(dirent.isDir()){// is dir\nif(_this2.state.currentMode==='column'){_this2.loadTreeNodeByPath(direntPath);}_this2.showDir(direntPath);}else{// is file\nif(_this2.state.currentMode==='column'&&Utils.isMarkdownFile(direntPath)){_this2.showColumnMarkdownFile(direntPath);}else{var url=siteRoot+'lib/'+repoID+'/file'+Utils.encodePath(direntPath);if(dirent.is_sdoc_revision&&dirent.revision_id){url=siteRoot+'lib/'+repoID+'/revisions/'+dirent.revision_id+'/';}var isWeChat=Utils.isWeChat();if(!isWeChat){window.open(url);}else{location.href=url;}}}};_this2.onDirentSelected=function(dirent){var direntList=_this2.state.direntList.map(function(item){if(item.name===dirent.name){item.isSelected=!item.isSelected;}return item;});var selectedDirentList=direntList.filter(function(item){return item.isSelected;});if(selectedDirentList.length){_this2.setState({isDirentSelected:true});if(selectedDirentList.length===direntList.length){_this2.setState({isAllDirentSelected:true,direntList:direntList,selectedDirentList:selectedDirentList});}else{_this2.setState({isAllDirentSelected:false,direntList:direntList,selectedDirentList:selectedDirentList});}}else{_this2.setState({isDirentSelected:false,isAllDirentSelected:false,direntList:direntList,selectedDirentList:[]});}};_this2.onAllDirentSelected=function(){if(_this2.state.isAllDirentSelected){var direntList=_this2.state.direntList.map(function(item){item.isSelected=false;return item;});_this2.setState({isDirentSelected:false,isAllDirentSelected:false,direntList:direntList,selectedDirentList:[]});}else{var _direntList=_this2.state.direntList.map(function(item){item.isSelected=true;return item;});_this2.setState({isDirentSelected:true,isAllDirentSelected:true,direntList:_direntList,selectedDirentList:_direntList});}};_this2.onFileTagChanged=function(dirent,direntPath){var repoID=_this2.props.repoID;seafileAPI.listFileTags(repoID,direntPath).then(function(res){var fileTags=res.data.file_tags.map(function(item){return new FileTag(item);});if(_this2.state.isViewFile){_this2.setState({fileTags:fileTags});}else{_this2.updateDirent(dirent,'file_tags',fileTags);}}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});_this2.updateUsedRepoTags();};_this2.onFileUploadSuccess=function(direntObject){var isExist=_this2.state.direntList.some(function(item){return item.name===direntObject.name&&item.type===direntObject.type;});if(isExist){var direntList=_this2.state.direntList;for(var i=0;i<direntList.length;i++){var dirent=direntList[i];if(dirent.name===direntObject.name&&dirent.type===direntObject.type){var mtime=moment.unix(direntObject.mtime).fromNow();_this2.updateDirent(dirent,'mtime',mtime);// todo file size is need update too, api is not return;\nbreak;}}}else{// use current dirent parent's permission as it's permission\ndirentObject.permission=_this2.state.userPerm;var _dirent=new Dirent(direntObject);if(_this2.state.currentMode==='column'){_this2.addNodeToTree(_dirent.name,_this2.state.path,_dirent.type);}if(direntObject.type==='dir'){_this2.setState({direntList:[_dirent].concat(_toConsumableArray(_this2.state.direntList))});}else{_this2.setState({direntList:[].concat(_toConsumableArray(_this2.state.direntList),[_dirent])});}}};_this2.addDirent=function(name,type,size){var item=_this2.createDirent(name,type,size);var direntList=_this2.state.direntList;if(type==='dir'){direntList.unshift(item);}else{// there will be there conditions;\n// first: direntList.length === 0;\n// second: all the direntList's items are dir;\n// third: direntList has dir and file;\nvar length=direntList.length;if(length===0||direntList[length-1].type==='dir'){direntList.push(item);}else{var index=0;for(var i=0;i<=length;i++){if(direntList[i].type==='file'){index=i;break;}}direntList.splice(index,0,item);}}_this2.setState({direntList:direntList});};_this2.renameDirent=function(direntPath,newName){var repoID=_this2.props.repoID;var parentPath=Utils.getDirName(direntPath);var newDirentPath=Utils.joinPath(parentPath,newName);if(direntPath===_this2.state.path){// the renamed item is current viewed item\n// example: direntPath = /A/B/C, state.path = /A/B/C\n_this2.setState({path:newDirentPath});var repoInfo=_this2.state.currentRepoInfo;var url=siteRoot+'library/'+repoID+'/'+encodeURIComponent(repoInfo.repo_name)+newDirentPath;window.history.replaceState({url:url,path:newDirentPath},newDirentPath,url);}else if(Utils.isChildPath(direntPath,_this2.state.path)){// example: direntPath = /A/B/C/D, state.path = /A/B/C\nvar oldName=Utils.getFileName(direntPath);var direntList=_this2.state.direntList.map(function(item){if(item.name===oldName){item.name=newName;}return item;});_this2.setState({direntList:direntList});}else if(Utils.isAncestorPath(direntPath,_this2.state.path)){// example: direntPath = /A/B, state.path = /A/B/C\nvar newPath=Utils.renameAncestorPath(_this2.state.path,direntPath,newDirentPath);_this2.setState({path:newPath});var _repoInfo=_this2.state.currentRepoInfo;var _url2=siteRoot+'library/'+repoID+'/'+encodeURIComponent(_repoInfo.repo_name)+newPath;window.history.replaceState({url:_url2,path:newPath},newPath,_url2);}};// only one scence: The deleted items are inside current path\n_this2.deleteDirents=function(direntNames){var direntList=_this2.state.direntList.filter(function(item){return direntNames.indexOf(item.name)===-1;});// Recalculate the state of the selection\n_this2.recaculateSelectedStateAfterDirentDeleted(name,direntList);_this2.setState({direntList:direntList});};_this2.moveDirent=function(direntPath){var moveToDirentPath=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var name=Utils.getFileName(direntPath);if(moveToDirentPath===_this2.state.path){_this2.loadDirentList(_this2.state.path);return;}var direntList=_this2.state.direntList.filter(function(item){return item.name!==name;});// Recalculate the state of the selection\n_this2.recaculateSelectedStateAfterDirentDeleted(name,direntList);_this2.setState({direntList:direntList});};// only one scence: The moved items are inside current path\n_this2.moveDirents=function(direntNames){var direntList=_this2.state.direntList.filter(function(item){return direntNames.indexOf(item.name)===-1;});// Recalculate the state of the selection\n//this.recaculateSelectedStateAfterDirentDeleted(name, direntList);\n_this2.setState({direntList:direntList,selectedDirentList:[],isDirentSelected:false,isAllDirentSelected:false});};_this2.updateDirent=function(dirent,paramKey,paramValue){var newDirentList=_this2.state.direntList.map(function(item){if(item.name===dirent.name){item[paramKey]=paramValue;}return item;});_this2.setState({direntList:newDirentList});};// tree operations\n_this2.loadTreeNodeByPath=function(path){var repoID=_this2.props.repoID;var tree=_this2.state.treeData.clone();var node=tree.getNodeByPath(path);if(!node.isLoaded){seafileAPI.listDir(repoID,node.path).then(function(res){_this2.addResponseListToNode(res.data.dirent_list,node);var parentNode=tree.getNodeByPath(node.parentNode.path);parentNode.isExpanded=true;_this2.setState({treeData:tree,currentNode:node});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}else{var parentNode=tree.getNodeByPath(node.parentNode.path);parentNode.isExpanded=true;_this2.setState({treeData:tree,currentNode:node});//tree\n}};_this2.loadNodeAndParentsByPath=function(path){var repoID=_this2.props.repoID;var tree=_this2.state.treeData.clone();if(Utils.isMarkdownFile(path)){path=Utils.getDirName(path);}seafileAPI.listDir(repoID,path,{with_parents:true}).then(function(res){var _res$data5=res.data,direntList=_res$data5.dirent_list,user_perm=_res$data5.user_perm;var results={};for(var i=0;i<direntList.length;i++){var object=direntList[i];var parentDir=object.parent_dir;var key=parentDir==='/'?'/':parentDir.slice(0,parentDir.length-1);if(!results[key]){results[key]=[];}results[key].push(object);}for(var _key in results){var node=tree.getNodeByPath(_key);if(!node.isLoaded){_this2.addResponseListToNode(results[_key],node);}}_this2.setState({isTreeDataLoading:false,treeData:tree,userPerm:user_perm});}).catch(function(){_this2.setState({isLoadFailed:true});});};_this2.onTreeNodeClick=function(node){_this2.resetSelected();var repoID=_this2.props.repoID;if(!_this2.state.pathExist){_this2.setState({pathExist:true});}if(node.object.isDir()){var isLoaded=node.isLoaded;if(!node.isLoaded){var tree=_this2.state.treeData.clone();node=tree.getNodeByPath(node.path);seafileAPI.listDir(repoID,node.path).then(function(res){_this2.addResponseListToNode(res.data.dirent_list,node);tree.collapseNode(node);_this2.setState({treeData:tree});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}if(isLoaded&&node.path===_this2.state.path){if(node.isExpanded){var _tree=treeHelper.collapseNode(_this2.state.treeData,node);_this2.setState({treeData:_tree});}else{var _tree2=_this2.state.treeData.clone();node=_tree2.getNodeByPath(node.path);_tree2.expandNode(node);_this2.setState({treeData:_tree2});}}}if(node.path===_this2.state.path){return;}if(node.object.isDir()){// isDir\n_this2.showDir(node.path);}else{if(Utils.isMarkdownFile(node.path)){if(node.path!==_this2.state.path){_this2.showColumnMarkdownFile(node.path);}}else{var url=siteRoot+'lib/'+repoID+'/file'+Utils.encodePath(node.path);var dirent=node.object;if(dirent.is_sdoc_revision&&dirent.revision_id){url=siteRoot+'lib/'+repoID+'/revisions/'+dirent.revision_id+'/';}window.open(url);}}};_this2.showColumnMarkdownFile=function(filePath){var repoID=_this2.props.repoID;seafileAPI.getFileInfo(repoID,filePath).then(function(res){if(res.data.size===0){// loading of asynchronously obtained data may be blocked\nvar w=window.open('about:blank');var url=siteRoot+'lib/'+repoID+'/file'+Utils.encodePath(filePath);w.location.href=url;}else{_this2.showFile(filePath);}}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.onTreeNodeCollapse=function(node){var tree=treeHelper.collapseNode(_this2.state.treeData,node);_this2.setState({treeData:tree});};_this2.onTreeNodeExpanded=function(node){var repoID=_this2.props.repoID;var tree=_this2.state.treeData.clone();node=tree.getNodeByPath(node.path);if(!node.isLoaded){seafileAPI.listDir(repoID,node.path).then(function(res){_this2.addResponseListToNode(res.data.dirent_list,node);_this2.setState({treeData:tree});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}else{tree.expandNode(node);_this2.setState({treeData:tree});}};_this2.addNodeToTree=function(name,parentPath,type){var node=_this2.createTreeNode(name,type);var tree=treeHelper.addNodeToParentByPath(_this2.state.treeData,node,parentPath);_this2.setState({treeData:tree});};_this2.renameTreeNode=function(path,newName){var tree=treeHelper.renameNodeByPath(_this2.state.treeData,path,newName);_this2.setState({treeData:tree});};_this2.deleteTreeNode=function(path){var tree=treeHelper.deleteNodeByPath(_this2.state.treeData,path);_this2.setState({treeData:tree});};_this2.deleteTreeNodes=function(paths){var tree=treeHelper.deleteNodeListByPaths(_this2.state.treeData,paths);_this2.setState({treeData:tree});};_this2.moveTreeNode=function(nodePath,moveToPath,moveToRepo,nodeName){var repoID=_this2.props.repoID;if(repoID!==moveToRepo.repo_id){var _tree3=treeHelper.deleteNodeByPath(_this2.state.treeData,nodePath);_this2.setState({treeData:_tree3});return;}var tree=treeHelper.moveNodeByPath(_this2.state.treeData,nodePath,moveToPath,nodeName);_this2.setState({treeData:tree});};_this2.copyTreeNode=function(nodePath,copyToPath,destRepo,nodeName){var repoID=_this2.props.repoID;if(repoID!==destRepo.repo_id){return;}var tree=treeHelper.copyNodeByPath(_this2.state.treeData,nodePath,copyToPath,nodeName);_this2.setState({treeData:tree});};_this2.addResponseListToNode=function(list,node){node.isLoaded=true;node.isExpanded=true;var direntList=list.map(function(item){return new Dirent(item);});direntList=Utils.sortDirents(direntList,'name','asc');var nodeList=direntList.map(function(object){return new TreeNode({object:object});});node.addChildren(nodeList);};_this2.getSelectedDirentPaths=function(){var paths=[];_this2.state.selectedDirentList.forEach(function(selectedDirent){paths.push(Utils.joinPath(_this2.state.path,selectedDirent.name));});return paths;};_this2.getSelectedDirentNames=function(){var names=[];_this2.state.selectedDirentList.forEach(function(selectedDirent){names.push(selectedDirent.name);});return names;};_this2.resetSelected=function(){_this2.setState({isDirentSelected:false,isAllDirentSelected:false});};_this2.recaculateSelectedStateAfterDirentDeleted=function(name,newDirentList){var selectedDirentList=_this2.state.selectedDirentList.slice(0);if(selectedDirentList.length>0){selectedDirentList=selectedDirentList.filter(function(item){return item.name!==name;});}_this2.setState({selectedDirentList:selectedDirentList,isDirentSelected:selectedDirentList.length>0,isAllDirentSelected:selectedDirentList.length===newDirentList.length});};_this2.onLibDecryptDialog=function(){_this2.setState({libNeedDecrypt:false});_this2.loadDirData(_this2.state.path);};_this2.onLibDecryptWhenCopyMove=function(){if(_this2.state.libNeedDecryptWhenCopy){if(_this2.state.copyMoveSingleItem){_this2.onCopyItem(_this2.state.destRepoWhenCopyMove,_this2.state.srcDirentWhenCopyMove,_this2.state.destDirentPathWhenCopyMove,_this2.state.srcNodeParentPathWhenCopyMove);}else{_this2.onCopyItems(_this2.state.destRepoWhenCopyMove,_this2.state.destDirentPathWhenCopyMove);}_this2.setState({libNeedDecryptWhenCopy:false,copyMoveSingleItem:false});}if(_this2.state.libNeedDecryptWhenMove){if(_this2.state.copyMoveSingleItem){_this2.onMoveItem(_this2.state.destRepoWhenCopyMove,_this2.state.srcDirentWhenCopyMove,_this2.state.destDirentPathWhenCopyMove,_this2.state.srcNodeParentPathWhenCopyMove);}else{_this2.onMoveItems(_this2.state.destRepoWhenCopyMove,_this2.state.destDirentPathWhenCopyMove);}_this2.setState({libNeedDecryptWhenMove:false,copyMoveSingleItem:false});}};_this2.sortItems=function(sortBy,sortOrder){cookie.save('seafile-repo-dir-sort-by',sortBy);cookie.save('seafile-repo-dir-sort-order',sortOrder);_this2.setState({sortBy:sortBy,sortOrder:sortOrder,items:Utils.sortDirents(_this2.state.direntList,sortBy,sortOrder)});};_this2.onUploadFile=function(e){e.nativeEvent.stopImmediatePropagation();_this2.uploader.onFileUpload();};_this2.onUploadFolder=function(e){e.nativeEvent.stopImmediatePropagation();_this2.uploader.onFolderUpload();};_this2.onToolbarFileTagChanged=function(){var repoID=_this2.props.repoID;var filePath=_this2.state.path;seafileAPI.listFileTags(repoID,filePath).then(function(res){var fileTags=res.data.file_tags.map(function(item){return new FileTag(item);});_this2.setState({fileTags:fileTags});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this2.unSelectDirent=function(){_this2.setState({isDirentSelected:false,selectedDirentList:[]});var dirent={};_this2.onDirentSelected(dirent);};_this2.onDeleteRepoTag=function(deletedTagID){var direntList=_this2.state.direntList.map(function(dirent){if(dirent.file_tags){var fileTags=dirent.file_tags.filter(function(item){return item.repo_tag_id!==deletedTagID;});dirent.file_tags=fileTags;}return dirent;});_this2.setState({direntList:direntList});_this2.updateUsedRepoTags();};_this2.handleSubmit=function(e){var options={'share_type':'personal','from':_this2.state.currentRepoInfo.owner_email};seafileAPI.leaveShareRepo(_this2.props.repoID,options).then(function(res){navigate(siteRoot+'shared-libs/');}).catch(function(error){var errorMsg=Utils.getErrorMsg(error,true);toaster.danger(errorMsg);});e.preventDefault();};_this2.state={currentMode:cookie.load('seafile_view_mode')||'list',path:'',pathExist:true,isViewFile:false,hash:'',currentRepoInfo:null,repoName:'',repoEncrypted:false,libNeedDecrypt:false,isGroupOwnedRepo:false,userPerm:'',selectedDirentList:[],fileTags:[],repoTags:[],usedRepoTags:[],isTreeDataLoading:true,treeData:treeHelper.buildTree(),currentNode:null,isFileLoading:true,isFileLoadedErr:false,filePermission:'',content:'',lastModified:'',latestContributor:'',isDirentListLoading:true,direntList:[],isDirentSelected:false,sortBy:cookie.load('seafile-repo-dir-sort-by')||'name',// 'name' or 'time' or 'size'\nsortOrder:cookie.load('seafile-repo-dir-sort-order')||'asc',// 'asc' or 'desc'\nisAllDirentSelected:false,dirID:'',// for update dir list\nerrorMsg:'',isDirentDetailShow:false,direntDetailPanelTab:'',updateDetail:false,itemsShowLength:100,isSessionExpired:false,isCopyMoveProgressDialogShow:false,isDeleteFolderDialogOpen:false,asyncCopyMoveTaskId:'',asyncOperationType:'move',asyncOperationProgress:0,asyncOperatedFilesLength:0};_this2.oldonpopstate=window.onpopstate;window.onpopstate=_this2.onpopstate;_this2.lastModifyTime=new Date();_this2.isNeedUpdateHistoryState=true;// Load, refresh page, switch mode for the first time, no need to set historyState\n_this2.currentMoveItemName='';_this2.currentMoveItemPath='';return _this2;}_createClass(LibContentView,[{key:\"UNSAFE_componentWillMount\",value:function UNSAFE_componentWillMount(){var hash=window.location.hash;if(hash.slice(0,1)==='#'){this.setState({hash:hash});}}},{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var repoID,location,path,repoRes,repoInfo,isGroupOwnedRepo,permissionID,permissionRes,errorMsg;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:// eg: http://127.0.0.1:8000/library/repo_id/repo_name/**/**/\\\nrepoID=this.props.repoID;location=window.location.href.split('?')[0];// '?': to remove the effect of '?notifications=all', which is added to the URL when the 'view all notifications' dialog is open.\nlocation=decodeURIComponent(location);path=location.slice(location.indexOf(repoID)+repoID.length+1);// get the string after repoID\npath=path.slice(path.indexOf('/'));// get current path\n// If the path isn't a root path and ends with '/', delete the ending '/'\nif(path.length>1&&path[path.length-1]==='/'){path=path.slice(0,path.length-1);}_context.prev=6;_context.next=9;return seafileAPI.getRepoInfo(repoID);case 9:repoRes=_context.sent;repoInfo=new RepoInfo(repoRes.data);isGroupOwnedRepo=repoInfo.owner_email.indexOf('@seafile_group')>-1;this.setState({currentRepoInfo:repoInfo});if(!repoInfo.permission.startsWith('custom-')){_context.next=19;break;}permissionID=repoInfo.permission.split('-')[1];_context.next=17;return seafileAPI.getCustomPermission(repoID,permissionID);case 17:permissionRes=_context.sent;window.custom_permission=permissionRes.data.permission;case 19:this.isNeedUpdateHistoryState=false;this.setState({repoName:repoInfo.repo_name,libNeedDecrypt:repoInfo.lib_need_decrypt,repoEncrypted:repoInfo.encrypted,isGroupOwnedRepo:isGroupOwnedRepo,path:path});if(!repoInfo.lib_need_decrypt){this.loadDirData(path);}_context.next=27;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](6);if(_context.t0.response){if(_context.t0.response.status==403){this.setState({isDirentListLoading:false,errorMsg:gettext('Permission denied')});errorMsg=gettext('Permission denied');toaster.danger(errorMsg);}else if(_context.t0.response.status==404){this.setState({isDirentListLoading:false,errorMsg:gettext('Library share permission not found.')});}else{this.setState({isDirentListLoading:false,errorMsg:gettext('Error')});}}else{this.setState({isDirentListLoading:false,errorMsg:gettext('Please check the network.')});}case 27:case\"end\":return _context.stop();}},_callee,this,[[6,24]]);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window.onpopstate=this.oldonpopstate;collabServer.unwatchRepo(this.props.repoID,this.onRepoUpdateEvent);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.lastModifyTime=new Date();}},{key:\"getAsyncCopyMoveProgress\",value:function(){var _getAsyncCopyMoveProgress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _this$state,asyncOperationType,asyncCopyMoveTaskId,res,data,message,direntPaths,direntNames,_message,asyncOperationProgress;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_this$state=this.state,asyncOperationType=_this$state.asyncOperationType,asyncCopyMoveTaskId=_this$state.asyncCopyMoveTaskId;_context2.prev=1;_context2.next=4;return seafileAPI.queryAsyncOperationProgress(asyncCopyMoveTaskId);case 4:res=_context2.sent;data=res.data;if(!data.failed){_context2.next=12;break;}message=gettext('Failed to move files to another library.');if(asyncOperationType==='copy'){message=gettext('Failed to copy files to another library.');}toaster.danger(message);this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:false});return _context2.abrupt(\"return\");case 12:if(!data.successful){_context2.next=19;break;}if(asyncOperationType==='move'){if(this.currentMoveItemName&&this.currentMoveItemPath){if(this.state.currentMode==='column'){this.deleteTreeNode(this.currentMoveItemPath);}this.moveDirent(this.currentMoveItemName);this.currentMoveItemName='';this.currentMoveItemPath='';}else{if(this.state.currentMode==='column'){direntPaths=this.getSelectedDirentPaths();this.deleteTreeNodes(direntPaths);}direntNames=this.getSelectedDirentNames();this.moveDirents(direntNames);}}this.setState({isCopyMoveProgressDialogShow:false});_message=gettext('Successfully moved files to another library.');if(asyncOperationType==='copy'){_message=gettext('Successfully copied files to another library.');}toaster.success(_message);return _context2.abrupt(\"return\");case 19:// init state: total is 0\nasyncOperationProgress=!data.total?0:parseInt((data.done/data.total*100).toFixed(2));this.getAsyncCopyMoveProgress();this.setState({asyncOperationProgress:asyncOperationProgress});_context2.next=27;break;case 24:_context2.prev=24;_context2.t0=_context2[\"catch\"](1);this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:false});case 27:case\"end\":return _context2.stop();}},_callee2,this,[[1,24]]);}));function getAsyncCopyMoveProgress(){return _getAsyncCopyMoveProgress.apply(this,arguments);}return getAsyncCopyMoveProgress;}()},{key:\"renameItemAjaxCallback\",value:function renameItemAjaxCallback(path,newName){if(this.state.currentMode==='column'){this.renameTreeNode(path,newName);}this.renameDirent(path,newName);}},{key:\"deleteItem\",value:function deleteItem(path,isDir){var _this3=this;var repoID=this.props.repoID;if(isDir){this.setState({folderToDelete:path},function(){_this3.toggleDeleteFolderDialog();});}else{seafileAPI.deleteFile(repoID,path).then(function(res){_this3.deleteItemAjaxCallback(path,isDir);var name=Utils.getFileName(path);var msg=gettext('Successfully deleted {name}').replace('{name}',name);var successTipWithUndo=/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:msg}),/*#__PURE__*/_jsx(\"a\",{className:\"action-link p-0 ml-1\",href:\"#\",onClick:_this3.restoreDeletedDirents.bind(_this3,res.data.commit_id,[path]),children:gettext('Undo')})]});toaster.success(successTipWithUndo,{duration:5});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);if(errMessage===gettext('Error')){var _name5=Utils.getFileName(path);errMessage=gettext('Failed to delete {name}').replace('{name}',_name5);}toaster.danger(errMessage);});}}},{key:\"deleteItemAjaxCallback\",value:function deleteItemAjaxCallback(path){if(this.state.currentMode==='column'){this.deleteTreeNode(path);}this.deleteDirent(path);}},{key:\"deleteDirent\",value:function deleteDirent(direntPath){if(direntPath===this.state.path){// The deleted item is current item\nvar parentPath=Utils.getDirName(direntPath);this.showDir(parentPath);}else if(Utils.isChildPath(direntPath,this.state.path)){// The deleted item is inside current path\nvar _name6=Utils.getFileName(direntPath);var direntList=this.state.direntList.filter(function(item){return item.name!==_name6;});// Recalculate the state of the selection\nthis.recaculateSelectedStateAfterDirentDeleted(_name6,direntList);this.setState({direntList:direntList});}else if(Utils.isAncestorPath(direntPath,this.state.path)){// the deleted item is ancester of the current item\nvar _parentPath=Utils.getDirName(direntPath);this.showDir(_parentPath);}// else do nothing\n}},{key:\"createTreeNode\",value:function createTreeNode(name,type){var object=this.createDirent(name,type);return new TreeNode({object:object});}},{key:\"createDirent\",value:function createDirent(name,type,size){// use current dirent parent's permission as it's permission\nvar permission=this.state.userPerm;var mtime=new Date().getTime()/1000;var obj={name:name,type:type,mtime:mtime,size:size,permission:permission};var dirent=new Dirent(obj);return dirent;}},{key:\"render\",value:function render(){var _this4=this;if(this.state.libNeedDecrypt){return/*#__PURE__*/_jsx(ModalPortal,{children:/*#__PURE__*/_jsx(LibDecryptDialog,{repoID:this.props.repoID,onLibDecryptDialog:this.onLibDecryptDialog})});}if(this.state.libNeedDecryptWhenCopy||this.state.libNeedDecryptWhenMove){return/*#__PURE__*/_jsx(ModalPortal,{children:/*#__PURE__*/_jsx(LibDecryptDialog,{repoID:this.state.destRepoWhenCopyMove.repo_id,onLibDecryptDialog:this.onLibDecryptWhenCopyMove})});}if(this.state.errorMsg){return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"error mt-6 text-center\",children:this.state.errorMsg}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary submit\",onClick:this.handleSubmit,children:gettext('Leave Share')})]});}if(!this.state.currentRepoInfo){return'';}var enableDirPrivateShare=false;var _this$state2=this.state,currentRepoInfo=_this$state2.currentRepoInfo,userPerm=_this$state2.userPerm,isCopyMoveProgressDialogShow=_this$state2.isCopyMoveProgressDialogShow,isDeleteFolderDialogOpen=_this$state2.isDeleteFolderDialogOpen;var showShareBtn=Utils.isHasPermissionToShare(currentRepoInfo,userPerm);var isRepoOwner=currentRepoInfo.owner_email===username;var isVirtual=currentRepoInfo.is_virtual;var isAdmin=currentRepoInfo.is_admin;if(!isVirtual&&(isRepoOwner||isAdmin)){enableDirPrivateShare=true;}var direntItemsList=this.state.direntList.filter(function(item,index){return index<_this4.state.itemsShowLength;});var canUpload=true;var _Utils$getUserPermiss=Utils.getUserPermission(userPerm),isCustomPermission=_Utils$getUserPermiss.isCustomPermission,customPermission=_Utils$getUserPermiss.customPermission;if(isCustomPermission){var upload=customPermission.permission.upload;canUpload=upload;}return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"main-panel-north border-left-show\",children:/*#__PURE__*/_jsx(LibContentToolbar,{isViewFile:this.state.isViewFile,filePermission:this.state.filePermission,fileTags:this.state.fileTags,onFileTagChanged:this.onToolbarFileTagChanged,onSideNavMenuClick:this.props.onMenuClick,repoID:this.props.repoID,path:this.state.path,isDirentSelected:this.state.isDirentSelected,selectedDirentList:this.state.selectedDirentList,onItemsMove:this.onMoveItems,onItemsCopy:this.onCopyItems,onItemsDelete:this.onDeleteItems,onItemRename:this.onMainPanelItemRename,direntList:this.state.direntList,repoName:this.state.repoName,repoEncrypted:this.state.repoEncrypted,isGroupOwnedRepo:this.state.isGroupOwnedRepo,userPerm:this.state.userPerm,showShareBtn:showShareBtn,enableDirPrivateShare:enableDirPrivateShare,onAddFile:this.onAddFile,onAddFolder:this.onAddFolder,onUploadFile:this.onUploadFile,onUploadFolder:this.onUploadFolder,currentMode:this.state.currentMode,switchViewMode:this.switchViewMode,onSearchedClick:this.onSearchedClick,isRepoOwner:isRepoOwner,currentRepoInfo:this.state.currentRepoInfo,updateDirent:this.updateDirent,onDirentSelected:this.onDirentSelected,showDirentDetail:this.showDirentDetail,unSelectDirent:this.unSelectDirent,onFilesTagChanged:this.onFileTagChanged,repoTags:this.state.repoTags})}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-panel-center flex-row\",children:[/*#__PURE__*/_jsx(LibContentContainer,{pathPrefix:this.props.pathPrefix,currentMode:this.state.currentMode,path:this.state.path,pathExist:this.state.pathExist,currentRepoInfo:this.state.currentRepoInfo,repoID:this.props.repoID,enableDirPrivateShare:enableDirPrivateShare,userPerm:userPerm,isGroupOwnedRepo:this.state.isGroupOwnedRepo,onTabNavClick:this.props.onTabNavClick,onMainNavBarClick:this.onMainNavBarClick,isViewFile:this.state.isViewFile,hash:this.state.hash,fileTags:this.state.fileTags,isFileLoading:this.state.isFileLoading,isFileLoadedErr:this.state.isFileLoadedErr,filePermission:this.state.filePermission,content:this.state.content,lastModified:this.state.lastModified,latestContributor:this.state.latestContributor,onLinkClick:this.onLinkClick,isTreeDataLoading:this.state.isTreeDataLoading,treeData:this.state.treeData,currentNode:this.state.currentNode,onNodeClick:this.onTreeNodeClick,onNodeCollapse:this.onTreeNodeCollapse,onNodeExpanded:this.onTreeNodeExpanded,onAddFolderNode:this.onAddFolder,onAddFileNode:this.onAddFile,onRenameNode:this.onRenameTreeNode,onDeleteNode:this.onDeleteTreeNode,repoTags:this.state.repoTags,usedRepoTags:this.state.usedRepoTags,updateUsedRepoTags:this.updateUsedRepoTags,isDirentListLoading:this.state.isDirentListLoading,direntList:direntItemsList,fullDirentList:this.state.direntList,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortItems:this.sortItems,updateDirent:this.updateDirent,onDirentClick:this.onDirentClick,onItemClick:this.onItemClick,onItemSelected:this.onDirentSelected,onItemDelete:this.onMainPanelItemDelete,onItemRename:this.onMainPanelItemRename,onItemMove:this.onMoveItem,onItemCopy:this.onCopyItem,onItemConvert:this.onConvertItem,onAddFolder:this.onAddFolder,onAddFile:this.onAddFile,onFileTagChanged:this.onFileTagChanged,isDirentSelected:this.state.isDirentSelected,isAllDirentSelected:this.state.isAllDirentSelected,onAllDirentSelected:this.onAllDirentSelected,isDirentDetailShow:this.state.isDirentDetailShow,selectedDirent:this.state.selectedDirentList&&this.state.selectedDirentList[0],selectedDirentList:this.state.selectedDirentList,onItemsMove:this.onMoveItems,onItemsCopy:this.onCopyItems,onItemsDelete:this.onDeleteItems,closeDirentDetail:this.closeDirentDetail,showDirentDetail:this.showDirentDetail,direntDetailPanelTab:this.state.direntDetailPanelTab,onDeleteRepoTag:this.onDeleteRepoTag,onToolbarFileTagChanged:this.onToolbarFileTagChanged,updateDetail:this.state.updateDetail,onListContainerScroll:this.onListContainerScroll,loadDirentList:this.loadDirentList}),canUpload&&this.state.pathExist&&!this.state.isViewFile&&/*#__PURE__*/_jsx(FileUploader,{ref:function ref(uploader){return _this4.uploader=uploader;},dragAndDrop:true,path:this.state.path,repoID:this.props.repoID,direntList:this.state.direntList,onFileUploadSuccess:this.onFileUploadSuccess,isCustomPermission:isCustomPermission})]}),isCopyMoveProgressDialogShow&&/*#__PURE__*/_jsx(CopyMoveDirentProgressDialog,{type:this.state.asyncOperationType,asyncOperatedFilesLength:this.state.asyncOperatedFilesLength,asyncOperationProgress:this.state.asyncOperationProgress,toggleDialog:this.onMoveProgressDialogToggle}),isDeleteFolderDialogOpen&&/*#__PURE__*/_jsx(DeleteFolderDialog,{repoID:this.props.repoID,path:this.state.folderToDelete,deleteFolder:this.deleteFolder,toggleDialog:this.toggleDeleteFolderDialog})]});}}]);return LibContentView;}(React.Component);export default LibContentView;","map":{"version":3,"names":["React","Fragment","cookie","moment","navigate","gettext","siteRoot","username","enableVideoThumbnail","seafileAPI","Utils","collabServer","Dirent","FileTag","RepoTag","RepoInfo","TreeNode","treeHelper","toaster","ModalPortal","LibDecryptDialog","LibContentToolbar","LibContentContainer","FileUploader","CopyMoveDirentProgressDialog","DeleteFolderDialog","jsx","_jsx","_Fragment","jsxs","_jsxs","LibContentView","_React$Component","_inherits","_super","_createSuper","props","_this2","_classCallCheck","call","showDirentDetail","direntDetailPanelTab","setState","isDirentDetailShow","toggleDirentDetail","state","closeDirentDetail","onpopstate","event","key","path","loadDirentList","isViewFile","currentMode","isMarkdownFile","showFile","onRepoUpdateEvent","currentTime","Date","parseFloat","lastModifyTime","repoID","_this2$state","dirID","updateColumnMarkdownData","dirMetaData","then","res","data","id","catch","error","errMessage","getErrorMsg","danger","updateUsedRepoTags","listRepoTags","repoTags","usedRepoTags","repo_tags","forEach","item","repoTag","push","fileCount","filePath","getFileInfo","_res$data","mtime","permission","last_modifier_name","getFileDownloadLink","getFileContent","content","isFileLoading","filePermission","latestContributor","lastModified","unix","fromNow","isFileLoadedErr","loadDirData","watchRepo","save","loadSidePanel","showDir","listDir","_res$data2","dirent_list","user_perm","tree","treeData","addResponseListToNode","root","isTreeDataLoading","userPerm","loadNodeAndParentsByPath","isSessionExpired","isDirentListLoading","selectedDirentList","resetShowLength","isNeedUpdateHistoryState","repoInfo","currentRepoInfo","url","encodeURIComponent","repo_name","encodePath","window","history","pushState","listFileTags","fileTags","file_tags","map","_res$data3","err","errMsg","response","status","direntList","dirent","pathExist","sortDirents","sortBy","sortOrder","dir_id","repoEncrypted","length","getThumbnails","is_admin","foldersSharedOut","identifyFoldersSharedOut","getAllRepoFolderShareInfo","share_info_list","indexOf","_this2$state2","type","joinPath","name","has_been_shared_out","onListContainerScroll","itemsShowLength","items","filter","imageCheck","videoCheck","encoded_thumbnail_src","_this","_assertThisInitialized","len","thumbnailSize","getThumbnail","i","curItem","curItemPath","join","createThumbnail","updateMoveCopyTreeNode","clone","node","getNodeByPath","nodeChildren","children","object","nodeChildrenNames","newDirentList","newAddedDirents","includes","addNodeToTree","cancelCopyMoveDirent","taskId","asyncCopyMoveTaskId","cancelCopyMoveOperation","currentMoveItemName","currentMoveItemPath","slice","onMoveProgressDialogToggle","asyncOperationProgress","isCopyMoveProgressDialogShow","onMoveItems","destRepo","destDirentPath","dirNames","getSelectedDirentNames","direntPaths","getSelectedDirentPaths","moveDir","repo_id","task_id","asyncOperatedFilesLength","asyncOperationType","getAsyncCopyMoveProgress","deleteTreeNodes","moveDirents","message","getMoveSuccessMessage","success","lib_need_decrypt","getCopyFailedMessage","libNeedDecryptWhenMove","destRepoWhenCopyMove","destDirentPathWhenCopyMove","onCopyItems","copyDir","getCopySuccessfulMessage","libNeedDecryptWhenCopy","restoreDeletedDirents","commitID","paths","e","preventDefault","closeAll","restoreDirents","_res$data4","failed","getFileName","parentPath","getDirName","is_dir","addDirent","msg","replace","split","pop","onDeleteItems","updateDetail","deleteMutipleDirents","deleteDirents","successTipWithUndo","className","href","onClick","bind","commit_id","duration","onAddFolder","dirPath","createDir","onAddFile","createFile","size","switchViewMode","mode","onSearchedClick","currentPath","index","getPaths","currentNode","isWeChat","newWindow","open","location","onMainNavBarClick","nodePath","resetSelected","expandNode","onLinkClick","link","isInternalMarkdownLink","getPathFromInternalMarkdownLink","isInternalDirLink","getPathFromInternalDirLink","onMainPanelItemRename","newName","renameItem","isDir","onMainPanelItemDelete","deleteItem","onRenameTreeNode","onDeleteTreeNode","renameDir","renameItemAjaxCallback","renameFile","toggleDeleteFolderDialog","isDeleteFolderDialogOpen","deleteFolder","folderToDelete","deleteDir","deleteItemAjaxCallback","onMoveItem","moveToDirentPath","nodeParentPath","dirName","direntPath","deleteTreeNode","moveDirent","copyMoveSingleItem","srcDirentWhenCopyMove","srcNodeParentPathWhenCopyMove","onCopyItem","copyToDirentPath","onConvertItem","dstType","notifyInProgress","convertFile","newFileName","obj_name","parentDir","parent_dir","new_path","onDirentClick","isSelected","isDirentSelected","onItemClick","loadTreeNodeByPath","showColumnMarkdownFile","is_sdoc_revision","revision_id","onDirentSelected","isAllDirentSelected","onAllDirentSelected","onFileTagChanged","updateDirent","onFileUploadSuccess","direntObject","isExist","some","concat","_toConsumableArray","createDirent","unshift","splice","renameDirent","newDirentPath","replaceState","isChildPath","oldName","isAncestorPath","newPath","renameAncestorPath","direntNames","recaculateSelectedStateAfterDirentDeleted","arguments","undefined","paramKey","paramValue","isLoaded","parentNode","isExpanded","with_parents","_res$data5","results","isLoadFailed","onTreeNodeClick","collapseNode","w","onTreeNodeCollapse","onTreeNodeExpanded","createTreeNode","addNodeToParentByPath","renameTreeNode","renameNodeByPath","deleteNodeByPath","deleteNodeListByPaths","moveTreeNode","moveToPath","moveToRepo","nodeName","moveNodeByPath","copyTreeNode","copyToPath","copyNodeByPath","list","nodeList","addChildren","selectedDirent","names","onLibDecryptDialog","libNeedDecrypt","onLibDecryptWhenCopyMove","sortItems","onUploadFile","nativeEvent","stopImmediatePropagation","uploader","onFileUpload","onUploadFolder","onFolderUpload","onToolbarFileTagChanged","unSelectDirent","onDeleteRepoTag","deletedTagID","repo_tag_id","handleSubmit","options","owner_email","leaveShareRepo","errorMsg","load","hash","repoName","isGroupOwnedRepo","buildTree","oldonpopstate","_createClass","value","UNSAFE_componentWillMount","_componentDidMount","_asyncToGenerator","_regeneratorRuntime","mark","_callee","repoRes","permissionID","permissionRes","wrap","_callee$","_context","prev","next","decodeURIComponent","getRepoInfo","sent","startsWith","getCustomPermission","custom_permission","encrypted","t0","stop","componentDidMount","apply","componentWillUnmount","unwatchRepo","componentDidUpdate","_getAsyncCopyMoveProgress","_callee2","_this$state","_message","_callee2$","_context2","queryAsyncOperationProgress","abrupt","successful","total","parseInt","done","toFixed","_this3","deleteFile","deleteDirent","getTime","obj","render","_this4","enableDirPrivateShare","_this$state2","showShareBtn","isHasPermissionToShare","isRepoOwner","isVirtual","is_virtual","isAdmin","direntItemsList","canUpload","_Utils$getUserPermiss","getUserPermission","isCustomPermission","customPermission","upload","onSideNavMenuClick","onMenuClick","onItemsMove","onItemsCopy","onItemsDelete","onItemRename","onFilesTagChanged","pathPrefix","onTabNavClick","onNodeClick","onNodeCollapse","onNodeExpanded","onAddFolderNode","onAddFileNode","onRenameNode","onDeleteNode","fullDirentList","onItemSelected","onItemDelete","onItemMove","onItemCopy","onItemConvert","ref","dragAndDrop","toggleDialog","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/lib-content-view/lib-content-view.js"],"sourcesContent":["import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport cookie from 'react-cookies';\nimport moment from 'moment';\nimport { navigate } from '@gatsbyjs/reach-router';\nimport { gettext, siteRoot, username, enableVideoThumbnail } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport collabServer from '../../utils/collab-server';\nimport Dirent from '../../models/dirent';\nimport FileTag from '../../models/file-tag';\nimport RepoTag from '../../models/repo-tag';\nimport RepoInfo from '../../models/repo-info';\nimport TreeNode from '../../components/tree-view/tree-node';\nimport treeHelper from '../../components/tree-view/tree-helper';\nimport toaster from '../../components/toast';\nimport ModalPortal from '../../components/modal-portal';\nimport LibDecryptDialog from '../../components/dialog/lib-decrypt-dialog';\nimport LibContentToolbar from './lib-content-toolbar';\nimport LibContentContainer from './lib-content-container';\nimport FileUploader from '../../components/file-uploader/file-uploader';\nimport CopyMoveDirentProgressDialog from '../../components/dialog/copy-move-dirent-progress-dialog';\nimport DeleteFolderDialog from '../../components/dialog/delete-folder-dialog';\n\nconst propTypes = {\n  pathPrefix: PropTypes.array.isRequired,\n  onTabNavClick: PropTypes.func.isRequired,\n  onMenuClick: PropTypes.func.isRequired,\n  repoID: PropTypes.string,\n};\n\nclass LibContentView extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentMode: cookie.load('seafile_view_mode') || 'list',\n      path: '',\n      pathExist: true,\n      isViewFile: false,\n      hash: '',\n      currentRepoInfo: null,\n      repoName: '',\n      repoEncrypted: false,\n      libNeedDecrypt: false,\n      isGroupOwnedRepo: false,\n      userPerm: '',\n      selectedDirentList: [],\n      fileTags: [],\n      repoTags: [],\n      usedRepoTags: [],\n      isTreeDataLoading: true,\n      treeData: treeHelper.buildTree(),\n      currentNode: null,\n      isFileLoading: true,\n      isFileLoadedErr: false,\n      filePermission: '',\n      content: '',\n      lastModified: '',\n      latestContributor: '',\n      isDirentListLoading: true,\n      direntList: [],\n      isDirentSelected: false,\n      sortBy: cookie.load('seafile-repo-dir-sort-by') || 'name', // 'name' or 'time' or 'size'\n      sortOrder: cookie.load('seafile-repo-dir-sort-order') || 'asc', // 'asc' or 'desc'\n      isAllDirentSelected: false,\n      dirID: '',  // for update dir list\n      errorMsg: '',\n      isDirentDetailShow: false,\n      direntDetailPanelTab: '',\n      updateDetail: false,\n      itemsShowLength: 100,\n      isSessionExpired: false,\n      isCopyMoveProgressDialogShow: false,\n      isDeleteFolderDialogOpen: false,\n      asyncCopyMoveTaskId: '',\n      asyncOperationType: 'move',\n      asyncOperationProgress: 0,\n      asyncOperatedFilesLength: 0,\n    };\n\n    this.oldonpopstate = window.onpopstate;\n    window.onpopstate = this.onpopstate;\n    this.lastModifyTime = new Date();\n    this.isNeedUpdateHistoryState = true; // Load, refresh page, switch mode for the first time, no need to set historyState\n    this.currentMoveItemName = '';\n    this.currentMoveItemPath = '';\n  }\n\n  showDirentDetail = (direntDetailPanelTab) => {\n    if (direntDetailPanelTab) {\n      this.setState({ direntDetailPanelTab: direntDetailPanelTab }, () => {\n        this.setState({ isDirentDetailShow: true });\n      });\n    } else {\n      this.setState({\n        direntDetailPanelTab: '',\n        isDirentDetailShow: true\n      });\n    }\n  };\n\n  toggleDirentDetail = () => {\n    this.setState({\n      direntDetailPanelTab: '',\n      isDirentDetailShow: !this.state.isDirentDetailShow\n    });\n  };\n\n  closeDirentDetail = () => {\n    this.setState({\n      isDirentDetailShow: false,\n      direntDetailPanelTab: '',\n    });\n  };\n\n  UNSAFE_componentWillMount() {\n    const hash = window.location.hash;\n    if (hash.slice(0, 1) === '#') {\n      this.setState({hash: hash});\n    }\n  }\n\n  async componentDidMount() {\n    // eg: http://127.0.0.1:8000/library/repo_id/repo_name/**/**/\\\n    let repoID = this.props.repoID;\n    let location = window.location.href.split('?')[0]; // '?': to remove the effect of '?notifications=all', which is added to the URL when the 'view all notifications' dialog is open.\n    location = decodeURIComponent(location);\n    let path = location.slice(location.indexOf(repoID) + repoID.length + 1); // get the string after repoID\n    path = path.slice(path.indexOf('/')); // get current path\n    // If the path isn't a root path and ends with '/', delete the ending '/'\n    if (path.length > 1 && path[path.length - 1] === '/') {\n      path = path.slice(0, path.length - 1);\n    }\n\n    try {\n      const repoRes = await seafileAPI.getRepoInfo(repoID);\n      const repoInfo = new RepoInfo(repoRes.data);\n      const isGroupOwnedRepo = repoInfo.owner_email.indexOf('@seafile_group') > -1;\n\n      this.setState({\n        currentRepoInfo: repoInfo,\n      });\n\n      if (repoInfo.permission.startsWith('custom-')) {\n        const permissionID = repoInfo.permission.split('-')[1];\n        const permissionRes = await seafileAPI.getCustomPermission(repoID, permissionID);\n        window.custom_permission = permissionRes.data.permission;\n      }\n\n      this.isNeedUpdateHistoryState = false;\n      this.setState({\n        repoName: repoInfo.repo_name,\n        libNeedDecrypt: repoInfo.lib_need_decrypt,\n        repoEncrypted: repoInfo.encrypted,\n        isGroupOwnedRepo: isGroupOwnedRepo,\n        path: path\n      });\n\n      if (!repoInfo.lib_need_decrypt) {\n        this.loadDirData(path);\n      }\n    } catch (error) {\n      if (error.response) {\n        if (error.response.status == 403) {\n          this.setState({\n            isDirentListLoading: false,\n            errorMsg: gettext('Permission denied')\n          });\n\n          let errorMsg = gettext('Permission denied');\n          toaster.danger(errorMsg);\n        } else if (error.response.status == 404) {\n          this.setState({\n            isDirentListLoading: false,\n            errorMsg: gettext('Library share permission not found.')\n          });\n        } else {\n          this.setState({\n            isDirentListLoading: false,\n            errorMsg: gettext('Error')\n          });\n        }\n      } else {\n        this.setState({\n          isDirentListLoading: false,\n          errorMsg: gettext('Please check the network.')\n        });\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    window.onpopstate = this.oldonpopstate;\n    collabServer.unwatchRepo(this.props.repoID, this.onRepoUpdateEvent);\n  }\n\n  componentDidUpdate() {\n    this.lastModifyTime = new Date();\n  }\n\n  onpopstate = (event) => {\n    if (event.state && event.state.key) { // root path\n      if (this.state.path === '/') {\n        return;\n      } else {\n        let path = '/';\n        this.loadDirentList(path);\n        this.setState({\n          path: path,\n          isViewFile: false\n        });\n      }\n    } else if (event.state && event.state.path) { // file path\n      let path = event.state.path;\n      if (this.state.currentMode === 'column') {\n        if (Utils.isMarkdownFile(path)) { // Judging not strict\n          this.showFile(path);\n          return;\n        }\n      }\n      this.loadDirentList(path);\n      this.setState({\n        path: path,\n        isViewFile: false\n      });\n    }\n  };\n\n  onRepoUpdateEvent = () => {\n    let currentTime = new Date();\n    if ((parseFloat(currentTime - this.lastModifyTime)/1000) <= 5) {\n      return;\n    }\n    let repoID = this.props.repoID;\n    let { path, dirID } = this.state;\n\n    if (this.state.currentMode === 'column') {\n      if (this.state.isViewFile) {\n        this.updateColumnMarkdownData(path);\n      } else {\n        seafileAPI.dirMetaData(repoID, path).then((res) => {\n          if (res.data.id !== dirID) {\n            this.loadDirentList(path);\n          }\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    } else {\n      seafileAPI.dirMetaData(repoID, path).then((res) => {\n        if (res.data.id !== dirID) {\n          this.loadDirentList(path);\n        }\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    }\n  };\n\n  updateUsedRepoTags = () => {\n    let repoID = this.props.repoID;\n    seafileAPI.listRepoTags(repoID).then(res => {\n      let repoTags = [];\n      let usedRepoTags = [];\n      res.data.repo_tags.forEach(item => {\n        const repoTag = new RepoTag(item);\n        repoTags.push(repoTag);\n        if (repoTag.fileCount > 0) {\n          usedRepoTags.push(repoTag);\n        }\n      });\n      this.setState({\n        repoTags: repoTags,\n        usedRepoTags: usedRepoTags\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  updateColumnMarkdownData = (filePath) => {\n    let repoID = this.props.repoID;\n    // update state\n    this.setState({\n      path: filePath,\n      isViewFile: true\n    });\n\n    // update data\n    seafileAPI.getFileInfo(repoID, filePath).then((res) => {\n      let { mtime, permission, last_modifier_name } = res.data;\n      seafileAPI.getFileDownloadLink(repoID, filePath).then((res) => {\n        seafileAPI.getFileContent(res.data).then((res) => {\n          if (this.state.content !== res.data) {\n            this.setState({isFileLoading: true});\n          }\n          this.setState({\n            content: res.data,\n            filePermission: permission,\n            latestContributor: last_modifier_name,\n            lastModified: moment.unix(mtime).fromNow(),\n            isFileLoading: false,\n            isFileLoadedErr: false,\n          });\n        });\n      });\n    }).catch(() => {\n      this.setState({\n        isFileLoading: false,\n        isFileLoadedErr: true,\n      });\n    });\n  };\n\n  // load data\n  loadDirData = (path) => {\n    let repoID = this.props.repoID;\n\n    // listen current repo\n    collabServer.watchRepo(repoID, this.onRepoUpdateEvent);\n\n    // list used FileTags\n    this.updateUsedRepoTags();\n\n    if (Utils.isMarkdownFile(path)) {\n      seafileAPI.getFileInfo(this.props.repoID, path).then(() => {\n        if (this.state.currentMode !== 'column') {\n          cookie.save('seafile_view_mode', 'column');\n          this.setState({currentMode: 'column'});\n        }\n        this.loadSidePanel(path);\n        this.showFile(path);\n      }).catch(() => {\n        if (this.state.currentMode === 'column') { // After an error occurs, follow dir\n          this.loadSidePanel(path);\n          this.showDir(path);\n        } else {\n          this.showDir(path);\n        }\n      });\n    } else {\n      if (this.state.currentMode === 'column') {\n        this.loadSidePanel(path);\n        this.showDir(path);\n      } else {\n        this.showDir(path);\n      }\n    }\n  };\n\n  loadSidePanel = (path) => {\n    let repoID = this.props.repoID;\n    if (path === '/') {\n      seafileAPI.listDir(repoID, '/').then(res => {\n        const { dirent_list, user_perm } = res.data;\n        let tree = this.state.treeData;\n        this.addResponseListToNode(dirent_list, tree.root);\n        this.setState({\n          isTreeDataLoading: false,\n          treeData: tree,\n          userPerm: user_perm,\n        });\n      }).catch(() => {\n        this.setState({isTreeDataLoading: false});\n      });\n    } else {\n      this.loadNodeAndParentsByPath(path);\n    }\n  };\n\n  showDir = (path) => {\n    let repoID = this.props.repoID;\n\n    if (!this.state.isSessionExpired) {\n      // update stste\n      this.setState({\n        isDirentListLoading: true,\n        isViewFile: false,\n        selectedDirentList: [],\n      });\n    }\n\n    // update data\n    this.loadDirentList(path);\n    this.resetShowLength();\n\n    if (!this.isNeedUpdateHistoryState) {\n      this.isNeedUpdateHistoryState = true;\n      return;\n    }\n    // update location\n    let repoInfo = this.state.currentRepoInfo;\n    let url = siteRoot + 'library/' + repoID + '/' + encodeURIComponent(repoInfo.repo_name) + Utils.encodePath(path);\n    window.history.pushState({url: url, path: path}, path, url);\n  };\n\n  showFile = (filePath) => {\n    let repoID = this.props.repoID;\n\n    if (this.state.currentMode === 'column') {\n      seafileAPI.listFileTags(repoID, filePath).then(res => {\n        let fileTags = res.data.file_tags.map(item => {\n          return new FileTag(item);\n        });\n        this.setState({fileTags: fileTags});\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    }\n\n    // update state\n    this.setState({\n      isFileLoading: true,\n      path: filePath,\n      isViewFile: true\n    });\n\n    // update data\n    seafileAPI.getFileInfo(repoID, filePath).then((res) => {\n      let { mtime, permission, last_modifier_name } = res.data;\n      seafileAPI.getFileDownloadLink(repoID, filePath).then((res) => {\n        seafileAPI.getFileContent(res.data).then((res) => {\n          this.setState({\n            content: res.data,\n            filePermission: permission,\n            latestContributor: last_modifier_name,\n            lastModified: moment.unix(mtime).fromNow(),\n            isFileLoading: false,\n            isFileLoadedErr: false,\n          });\n        });\n      });\n    }).catch((err) => {\n      let errMsg = Utils.getErrorMsg(err, true);\n      if (!err.response || err.response.status !== 403) {\n        toaster.danger(errMsg);\n      }\n      this.setState({\n        isFileLoading: false,\n        isFileLoadedErr: true,\n      });\n    });\n\n    // update location\n    let repoInfo = this.state.currentRepoInfo;\n    let url = siteRoot + 'library/' + repoID + '/' + encodeURIComponent(repoInfo.repo_name) + Utils.encodePath(filePath);\n    window.history.pushState({url: url, path: filePath}, filePath, url);\n  };\n\n  loadDirentList = (path) => {\n    let repoID = this.props.repoID;\n    seafileAPI.listDir(repoID, path, {'with_thumbnail': true}).then(res => {\n      let direntList = [];\n      res.data.dirent_list.forEach(item => {\n        let dirent = new Dirent(item);\n        direntList.push(dirent);\n      });\n\n      this.setState({\n        pathExist: true,\n        userPerm: res.data.user_perm,\n        isDirentListLoading: false,\n        direntList: Utils.sortDirents(direntList, this.state.sortBy, this.state.sortOrder),\n        dirID: res.data.dir_id,\n        path: path,\n        isSessionExpired: false,\n      });\n\n      if (!this.state.repoEncrypted && direntList.length) {\n        this.getThumbnails(repoID, path, this.state.direntList);\n      }\n\n      if (this.state.currentRepoInfo.is_admin) {\n        if (this.foldersSharedOut) {\n          this.identifyFoldersSharedOut();\n        } else {\n          this.foldersSharedOut = [];\n          seafileAPI.getAllRepoFolderShareInfo(repoID).then(res => {\n            res.data.share_info_list.forEach(item => {\n              if (this.foldersSharedOut.indexOf(item.path) === -1) {\n                this.foldersSharedOut.push(item.path);\n              }\n            });\n            this.identifyFoldersSharedOut();\n          });\n        }\n      }\n    }).catch((err) => {\n      Utils.getErrorMsg(err, true);\n      if (err.response && err.response.status === 403) {\n        this.setState({isDirentListLoading: false});\n        return;\n      }\n      this.setState({\n        isDirentListLoading: false,\n        pathExist: false,\n      });\n    });\n  };\n\n  identifyFoldersSharedOut = () => {\n    const { path, direntList } = this.state;\n    if (this.foldersSharedOut.length == 0) {\n      return;\n    }\n    direntList.forEach(dirent => {\n      if (dirent.type == 'dir' && this.foldersSharedOut.indexOf(Utils.joinPath(path, dirent.name) + '/') !== -1) {\n        dirent.has_been_shared_out = true;\n      }\n    });\n    this.setState({\n      direntList: direntList\n    });\n  };\n\n  onListContainerScroll = () => {\n    let itemsShowLength = this.state.itemsShowLength + 100;\n    this.setState({itemsShowLength: itemsShowLength});\n  };\n\n  resetShowLength = () => {\n    this.setState({itemsShowLength: 100});\n  };\n\n  getThumbnails = (repoID, path, direntList) => {\n    let items = direntList.filter((item) => {\n      return (Utils.imageCheck(item.name) || (enableVideoThumbnail && Utils.videoCheck(item.name))) && !item.encoded_thumbnail_src;\n    });\n    if (items.length == 0) {\n      return ;\n    }\n\n    const _this = this;\n    const len = items.length;\n    const thumbnailSize = 48;\n    let getThumbnail = (i) => {\n      const curItem = items[i];\n      const curItemPath = [path, curItem.name].join('/');\n      seafileAPI.createThumbnail(repoID, curItemPath, thumbnailSize).then((res) => {\n        curItem.encoded_thumbnail_src = res.data.encoded_thumbnail_src;\n      }).catch((error) => {\n        // do nothing\n      }).then(() => {\n        if (i < len - 1) {\n          getThumbnail(++i);\n        } else {\n          _this.setState({\n            direntList: direntList\n          });\n        }\n      });\n    };\n    getThumbnail(0);\n  };\n\n  updateMoveCopyTreeNode = (path) => {\n    let repoID = this.props.repoID;\n\n    let tree = this.state.treeData.clone();\n    let node = tree.getNodeByPath(path);\n\n    // for node not loaded, such as a deep folder '/vv/aa'\n    if (!node) { // node: null\n      return false;\n    }\n\n    let nodeChildren = node.children.map(item => item.object);\n    let nodeChildrenNames = nodeChildren.map(item => item.name);\n\n    seafileAPI.listDir(repoID, path).then(res => {\n      let newDirentList = res.data.dirent_list;\n      let newAddedDirents = newDirentList.filter(item => {\n        return !nodeChildrenNames.includes(item.name);\n      });\n      newAddedDirents.forEach(item => {\n        this.addNodeToTree(item.name, path, item.type);\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  async getAsyncCopyMoveProgress() {\n    let { asyncOperationType, asyncCopyMoveTaskId } = this.state;\n    try {\n      let res = await seafileAPI.queryAsyncOperationProgress(asyncCopyMoveTaskId);\n      let data = res.data;\n      if (data.failed) {\n        let message = gettext('Failed to move files to another library.');\n        if (asyncOperationType === 'copy') {\n          message = gettext('Failed to copy files to another library.');\n        }\n        toaster.danger(message);\n        this.setState({\n          asyncOperationProgress: 0,\n          isCopyMoveProgressDialogShow: false,\n        });\n        return;\n      }\n\n      if (data.successful) {\n        if (asyncOperationType === 'move') {\n          if (this.currentMoveItemName && this.currentMoveItemPath) {\n            if (this.state.currentMode === 'column') {\n              this.deleteTreeNode(this.currentMoveItemPath);\n            }\n            this.moveDirent(this.currentMoveItemName);\n            this.currentMoveItemName = '';\n            this.currentMoveItemPath = '';\n          } else {\n            if (this.state.currentMode === 'column') {\n              let direntPaths = this.getSelectedDirentPaths();\n              this.deleteTreeNodes(direntPaths);\n            }\n            let direntNames = this.getSelectedDirentNames();\n            this.moveDirents(direntNames);\n          }\n        }\n\n        this.setState({isCopyMoveProgressDialogShow: false});\n        let message = gettext('Successfully moved files to another library.');\n        if (asyncOperationType === 'copy') {\n          message = gettext('Successfully copied files to another library.');\n        }\n        toaster.success(message);\n        return;\n      }\n      // init state: total is 0\n      let asyncOperationProgress = !data.total ? 0 : parseInt((data.done/data.total * 100).toFixed(2));\n\n      this.getAsyncCopyMoveProgress();\n      this.setState({asyncOperationProgress: asyncOperationProgress});\n    } catch (error) {\n      this.setState({\n        asyncOperationProgress: 0,\n        isCopyMoveProgressDialogShow: false,\n      });\n    }\n  }\n\n  cancelCopyMoveDirent = () => {\n    let taskId = this.state.asyncCopyMoveTaskId;\n    seafileAPI.cancelCopyMoveOperation(taskId);\n\n    this.currentMoveItemName = '';\n    this.currentMoveItemPath = '';\n    let direntList = this.state.direntList;\n    this.setState({direntList: direntList.slice(0)});\n  };\n\n  onMoveProgressDialogToggle = () => {\n    let { asyncOperationProgress } = this.state;\n    if (asyncOperationProgress !== 100) {\n      this.cancelCopyMoveDirent();\n    }\n\n    this.setState({\n      asyncOperationProgress: 0,\n      isCopyMoveProgressDialogShow: false,\n    });\n  };\n\n  // toolbar operations\n  onMoveItems = (destRepo, destDirentPath) => {\n    let repoID = this.props.repoID;\n    let selectedDirentList = this.state.selectedDirentList;\n\n    let dirNames = this.getSelectedDirentNames();\n    let direntPaths = this.getSelectedDirentPaths();\n    seafileAPI.moveDir(repoID, destRepo.repo_id, destDirentPath, this.state.path, dirNames).then(res => {\n      if (repoID !== destRepo.repo_id) {\n        this.setState({\n          asyncCopyMoveTaskId: res.data.task_id,\n          asyncOperatedFilesLength: selectedDirentList.length,\n          asyncOperationProgress: 0,\n          asyncOperationType: 'move',\n          isCopyMoveProgressDialogShow: true\n        }, () => {\n          // After moving successfully, delete related files\n          this.getAsyncCopyMoveProgress();\n        });\n      }\n\n      if (repoID === destRepo.repo_id) {\n        if (this.state.currentMode === 'column') {\n          this.deleteTreeNodes(direntPaths);\n        }\n\n        this.moveDirents(dirNames);\n\n        // 2. tow columns mode need update left tree\n        if (this.state.currentMode === 'column') {\n          this.updateMoveCopyTreeNode(destDirentPath);\n        }\n\n        // show tip message if move to current repo\n        let message =  Utils.getMoveSuccessMessage(dirNames);\n        toaster.success(message);\n      }\n\n    }).catch((error) => {\n      if (!error.response.data.lib_need_decrypt) {\n        let errMessage = Utils.getErrorMsg(error);\n        if (errMessage === gettext('Error')) {\n          errMessage = Utils.getCopyFailedMessage(dirNames);\n        }\n        toaster.danger(errMessage);\n      } else {\n        this.setState({\n          libNeedDecryptWhenMove: true,\n          destRepoWhenCopyMove: destRepo,\n          destDirentPathWhenCopyMove: destDirentPath,\n        });\n      }\n    });\n  };\n\n  onCopyItems = (destRepo, destDirentPath) => {\n    let repoID = this.props.repoID;\n    let selectedDirentList = this.state.selectedDirentList;\n\n    let dirNames = this.getSelectedDirentNames();\n    seafileAPI.copyDir(repoID, destRepo.repo_id, destDirentPath, this.state.path, dirNames).then(res => {\n      if (repoID !== destRepo.repo_id) {\n        this.setState({\n          asyncCopyMoveTaskId: res.data.task_id,\n          asyncOperatedFilesLength: selectedDirentList.length,\n          asyncOperationProgress: 0,\n          asyncOperationType: 'copy',\n          isCopyMoveProgressDialogShow: true\n        }, () => {\n          this.getAsyncCopyMoveProgress();\n        });\n      }\n\n      if (repoID === destRepo.repo_id) {\n        if (this.state.currentMode === 'column') {\n          this.updateMoveCopyTreeNode(destDirentPath);\n        }\n\n        if (destDirentPath === this.state.path) {\n          this.loadDirentList(this.state.path);\n        }\n\n        // show tip message if copy to current repo\n        let message =  Utils.getCopySuccessfulMessage(dirNames);\n        toaster.success(message);\n      }\n    }).catch((error) => {\n      if (!error.response.data.lib_need_decrypt) {\n        let errMessage = Utils.getErrorMsg(error);\n        if (errMessage === gettext('Error')) {\n          errMessage = Utils.getCopyFailedMessage(dirNames);\n        }\n        toaster.danger(errMessage);\n      } else {\n        this.setState({\n          libNeedDecryptWhenCopy: true,\n          destRepoWhenCopyMove: destRepo,\n          destDirentPathWhenCopyMove: destDirentPath,\n        });\n      }\n    });\n  };\n\n  restoreDeletedDirents = (commitID, paths, e) => {\n    const { repoID } = this.props;\n    e.preventDefault();\n    toaster.closeAll();\n    seafileAPI.restoreDirents(repoID, commitID, paths).then(res => {\n      const { success, failed } = res.data;\n      success.forEach(dirent => {\n        let name = Utils.getFileName(dirent.path);\n        let parentPath = Utils.getDirName(dirent.path);\n        if (!dirent.is_dir) {\n          if (this.state.currentMode === 'column') {\n            this.addNodeToTree(name, parentPath, 'file');\n          }\n          if (parentPath === this.state.path && !this.state.isViewFile) {\n            this.addDirent(name, 'file');\n          }\n        } else {\n          if (this.state.currentMode === 'column') {\n            this.addNodeToTree(name, parentPath, 'dir');\n          }\n          if (parentPath === this.state.path && !this.state.isViewFile) {\n            this.addDirent(name, 'dir');\n          }\n        }\n      });\n\n      if (success.length) {\n        let msg = success.length > 1 ? gettext('Restored {name} and {n} other items') :\n          gettext('Restored {name}');\n        msg = msg.replace('{name}', success[0].path.split('/').pop())\n          .replace('{n}', success.length - 1);\n        toaster.success(msg);\n      }\n\n      if (failed.length) {\n        let msg = failed.length > 1 ? gettext('Failed to restore {name} and {n} other items') :\n          gettext('Failed to restore {name}');\n        msg = msg.replace('{name}', failed[0].path.split('/').pop())\n          .replace('{n}', failed.length - 1);\n        toaster.danger(msg);\n      }\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  onDeleteItems = () => {\n    let repoID = this.props.repoID;\n    let direntPaths = this.getSelectedDirentPaths();\n    let dirNames = this.getSelectedDirentNames();\n\n    this.setState({updateDetail: !this.state.updateDetail});\n    seafileAPI.deleteMutipleDirents(repoID, this.state.path, dirNames).then(res => {\n      if (this.state.currentMode === 'column') {\n        this.deleteTreeNodes(direntPaths);\n      }\n\n      this.deleteDirents(dirNames);\n\n      let msg = '';\n      if (direntPaths.length > 1) {\n        msg = gettext('Successfully deleted {name} and {n} other items.');\n        msg = msg.replace('{name}', dirNames[0]);\n        msg = msg.replace('{n}', dirNames.length - 1);\n      } else {\n        msg = gettext('Successfully deleted {name}.');\n        msg = msg.replace('{name}', dirNames[0]);\n      }\n      const successTipWithUndo = (\n        <>\n          <span>{msg}</span>\n          <a className=\"action-link p-0 ml-1\" href=\"#\" onClick={this.restoreDeletedDirents.bind(this, res.data.commit_id, direntPaths)}>{gettext('Undo')}</a>\n        </>\n      );\n      toaster.success(successTipWithUndo, {duration: 5});\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      if (errMessage === gettext('Error')) {\n        errMessage = gettext('Failed to delete {name} and {n} other items.');\n        errMessage = errMessage.replace('{name}', dirNames[0]);\n        errMessage = errMessage.replace('{n}', dirNames.length - 1);\n      }\n      toaster.danger(errMessage);\n    });\n  };\n\n  onAddFolder = (dirPath) => {\n    let repoID = this.props.repoID;\n    seafileAPI.createDir(repoID, dirPath).then(() => {\n      let name = Utils.getFileName(dirPath);\n      let parentPath = Utils.getDirName(dirPath);\n\n      if (this.state.currentMode === 'column') {\n        this.addNodeToTree(name, parentPath, 'dir');\n      }\n\n      if (parentPath === this.state.path && !this.state.isViewFile) {\n        this.addDirent(name, 'dir');\n      }\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  onAddFile = (filePath) => {\n    let repoID = this.props.repoID;\n    seafileAPI.createFile(repoID, filePath).then(res => {\n      let name = Utils.getFileName(filePath);\n      let parentPath = Utils.getDirName(filePath);\n      if (this.state.currentMode === 'column') {\n        this.addNodeToTree(name, parentPath, 'file');\n      }\n      if (parentPath === this.state.path && !this.state.isViewFile) {\n        this.addDirent(name, 'file', res.data.size);\n      }\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  switchViewMode = (mode) => {\n    if (mode === this.state.currentMode) {\n      return;\n    }\n    if (mode === 'detail') {\n      this.toggleDirentDetail();\n      return;\n    }\n    cookie.save('seafile_view_mode', mode);\n    let path = this.state.path;\n    if (this.state.currentMode === 'column' && this.state.isViewFile) {\n      path = Utils.getDirName(path);\n      this.setState({\n        path: path,\n        isViewFile: false,\n      });\n      let repoInfo = this.state.currentRepoInfo;\n\n      let url = siteRoot + 'library/' + repoInfo.repo_id + '/' + encodeURIComponent(repoInfo.repo_name) + Utils.encodePath(path);\n      window.history.pushState({url: url, path: path}, path, url);\n    }\n\n    if (mode === 'column') {\n      this.loadSidePanel(this.state.path);\n    }\n    this.isNeedUpdateHistoryState = false;\n    this.setState({currentMode: mode});\n    this.showDir(path);\n  };\n\n  onSearchedClick = (item) => {\n    let path = item.is_dir ? item.path.slice(0, item.path.length - 1) : item.path;\n    if (this.state.currentPath === path) {\n      return;\n    }\n    if (this.state.currentMode === 'column') {\n      // load sidePanel\n      let index = -1;\n      let paths = Utils.getPaths(path);\n      for (let i = 0; i < paths.length; i++) {\n        // eslint-disable-next-line\n        let node = this.state.treeData.getNodeByPath(node);\n        if (!node) {\n          index = i;\n          break;\n        }\n      }\n      if (index === -1) { // all the data has been loaded already.\n        let node = this.state.treeData.getNodeByPath(path);\n        this.setState({currentNode: node});\n      } else {\n        this.loadNodeAndParentsByPath(path);\n      }\n\n      // load mainPanel\n      if (item.is_dir) {\n        this.showDir(path);\n      } else {\n        if (Utils.isMarkdownFile(path)) {\n          this.showFile(path);\n        } else {\n          let url = siteRoot + 'lib/' + item.repo_id + '/file' + Utils.encodePath(path);\n          let isWeChat = Utils.isWeChat();\n          if (!isWeChat) {\n            let newWindow = window.open('about:blank');\n            newWindow.location.href = url;\n          } else {\n            location.href = url;\n          }\n        }\n      }\n    } else {\n      if (item.is_dir) {\n        this.showDir(path);\n      } else {\n        let url = siteRoot + 'lib/' + item.repo_id + '/file' + Utils.encodePath(path);\n        let isWeChat = Utils.isWeChat();\n        if (!isWeChat) {\n          let newWindow = window.open('about:blank');\n          newWindow.location.href = url;\n        } else {\n          location.href = url;\n        }\n      }\n    }\n  };\n\n  onMainNavBarClick = (nodePath) => {\n    //just for dir\n    this.resetSelected();\n    if (this.state.currentMode === 'column') {\n      let tree = this.state.treeData.clone();\n      let node = tree.getNodeByPath(nodePath);\n      tree.expandNode(node);\n      this.setState({treeData: tree, currentNode: node});\n    }\n\n    this.showDir(nodePath);\n  };\n\n  onLinkClick = (link) => {\n    const url = link;\n    let repoID = this.props.repoID;\n    if (Utils.isInternalMarkdownLink(url, repoID)) {\n      let path = Utils.getPathFromInternalMarkdownLink(url, repoID);\n      this.showFile(path);\n    } else if (Utils.isInternalDirLink(url, repoID)) {\n      let path = Utils.getPathFromInternalDirLink(url, repoID);\n      this.showDir(path);\n    } else {\n      window.open(url);\n    }\n  };\n\n  // list&tree operations\n  onMainPanelItemRename = (dirent, newName) => {\n    let path = Utils.joinPath(this.state.path, dirent.name);\n    this.renameItem(path, dirent.isDir(), newName);\n  };\n\n  onMainPanelItemDelete = (dirent) => {\n    let path = Utils.joinPath(this.state.path, dirent.name);\n    this.deleteItem(path, dirent.isDir());\n  };\n\n  onRenameTreeNode = (node, newName) => {\n    this.renameItem(node.path, node.object.isDir(), newName);\n  };\n\n  onDeleteTreeNode = (node) => {\n    this.deleteItem(node.path, node.object.isDir());\n  };\n\n  renameItem = (path, isDir, newName) => {\n    let repoID = this.props.repoID;\n    if (isDir) {\n      seafileAPI.renameDir(repoID, path, newName).then(() => {\n        this.renameItemAjaxCallback(path, newName);\n      }).catch((error) => {\n        let errMessage = Utils.getErrorMsg(error);\n        if (errMessage === gettext('Error')) {\n          let name = Utils.getFileName(path);\n          errMessage = gettext('Renaming {name} failed').replace('{name}', name);\n        }\n        toaster.danger(errMessage);\n      });\n    } else {\n      seafileAPI.renameFile(repoID, path, newName).then(() => {\n        this.renameItemAjaxCallback(path, newName);\n      }).catch((error) => {\n        let errMessage = '';\n        if (error.response.status == 403 && error.response.data && error.response.data['error_msg']) {\n          errMessage = error.response.data['error_msg'];\n        } else {\n          errMessage = Utils.getErrorMsg(error);\n        }\n        if (errMessage === gettext('Error')) {\n          let name = Utils.getFileName(path);\n          errMessage = gettext('Renaming {name} failed').replace('{name}', name);\n        }\n        toaster.danger(errMessage);\n      });\n    }\n  };\n\n  renameItemAjaxCallback(path, newName) {\n    if (this.state.currentMode === 'column') {\n      this.renameTreeNode(path, newName);\n    }\n    this.renameDirent(path, newName);\n  }\n\n  toggleDeleteFolderDialog = () => {\n    this.setState({isDeleteFolderDialogOpen: !this.state.isDeleteFolderDialogOpen});\n  };\n\n  deleteFolder = () => {\n    const { repoID } = this.props;\n    const { folderToDelete: path } = this.state;\n    seafileAPI.deleteDir(repoID, path).then((res) => {\n      this.deleteItemAjaxCallback(path, true);\n      let name = Utils.getFileName(path);\n      var msg = gettext('Successfully deleted {name}').replace('{name}', name);\n      const successTipWithUndo = (\n        <>\n          <span>{msg}</span>\n          <a className=\"action-link p-0 ml-1\" href=\"#\" onClick={this.restoreDeletedDirents.bind(this, res.data.commit_id, [path])}>{gettext('Undo')}</a>\n        </>\n      );\n      toaster.success(successTipWithUndo, {duration: 5});\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      if (errMessage === gettext('Error')) {\n        let name = Utils.getFileName(path);\n        errMessage = gettext('Failed to delete {name}').replace('{name}', name);\n      }\n      toaster.danger(errMessage);\n    });\n  };\n\n  deleteItem(path, isDir) {\n    let repoID = this.props.repoID;\n    if (isDir) {\n      this.setState({ folderToDelete: path }, () => {\n        this.toggleDeleteFolderDialog();\n      });\n    } else {\n      seafileAPI.deleteFile(repoID, path).then((res) => {\n        this.deleteItemAjaxCallback(path, isDir);\n        let name = Utils.getFileName(path);\n        var msg = gettext('Successfully deleted {name}').replace('{name}', name);\n        const successTipWithUndo = (\n          <>\n            <span>{msg}</span>\n            <a className=\"action-link p-0 ml-1\" href=\"#\" onClick={this.restoreDeletedDirents.bind(this, res.data.commit_id, [path])}>{gettext('Undo')}</a>\n          </>\n        );\n        toaster.success(successTipWithUndo, {duration: 5});\n      }).catch((error) => {\n        let errMessage = Utils.getErrorMsg(error);\n        if (errMessage === gettext('Error')) {\n          let name = Utils.getFileName(path);\n          errMessage = gettext('Failed to delete {name}').replace('{name}', name);\n        }\n        toaster.danger(errMessage);\n      });\n    }\n  }\n\n  deleteItemAjaxCallback(path) {\n    if (this.state.currentMode === 'column') {\n      this.deleteTreeNode(path);\n    }\n    this.deleteDirent(path);\n  }\n\n  // list operations\n  onMoveItem = (destRepo, dirent, moveToDirentPath, nodeParentPath) => {\n    let repoID = this.props.repoID;\n    //just for view list state\n    let dirName = dirent.name;\n    if (!nodeParentPath) {\n      nodeParentPath = this.state.path;\n    }\n    let direntPath = Utils.joinPath(nodeParentPath, dirName);\n\n    seafileAPI.moveDir(repoID, destRepo.repo_id, moveToDirentPath, nodeParentPath, dirName).then(res => {\n      if (repoID !== destRepo.repo_id) {\n        this.setState({\n          asyncCopyMoveTaskId: res.data.task_id,\n          asyncOperatedFilesLength: 1,\n          asyncOperationProgress: 0,\n          asyncOperationType: 'move',\n          isCopyMoveProgressDialogShow: true,\n        }, () => {\n          this.currentMoveItemName = dirName;\n          this.currentMoveItemPath = direntPath;\n          this.getAsyncCopyMoveProgress(dirName, direntPath);\n        });\n      }\n\n      if (this.state.currentMode === 'column') {\n        this.deleteTreeNode(direntPath);\n      }\n\n      // 1. move to current repo\n      // 2. tow columns mode need update left tree\n      if (repoID === destRepo.repo_id && this.state.currentMode === 'column') {\n        this.updateMoveCopyTreeNode(moveToDirentPath);\n      }\n\n      this.moveDirent(direntPath, moveToDirentPath);\n\n      // show tip message if move to current repo\n      if (repoID === destRepo.repo_id) {\n        let message = gettext('Successfully moved {name}.');\n        message = message.replace('{name}', dirName);\n        toaster.success(message);\n      }\n    }).catch((error) => {\n      if (!error.response.data.lib_need_decrypt) {\n        let errMessage = Utils.getErrorMsg(error);\n        if (errMessage === gettext('Error')) {\n          errMessage = gettext('Failed to move {name}.');\n          errMessage = errMessage.replace('{name}', dirName);\n        }\n        toaster.danger(errMessage);\n      } else {\n        this.setState({\n          libNeedDecryptWhenMove: true,\n          destRepoWhenCopyMove: destRepo,\n          destDirentPathWhenCopyMove: moveToDirentPath,\n          copyMoveSingleItem: true,\n          srcDirentWhenCopyMove: dirent,\n          srcNodeParentPathWhenCopyMove: nodeParentPath,\n        });\n      }\n    });\n  };\n\n  onCopyItem = (destRepo, dirent, copyToDirentPath, nodeParentPath) => {\n    let repoID = this.props.repoID;\n    //just for view list state\n    let dirName = dirent.name;\n    if (!nodeParentPath) {\n      nodeParentPath = this.state.path;\n    }\n\n    seafileAPI.copyDir(repoID, destRepo.repo_id, copyToDirentPath, nodeParentPath, dirName).then(res => {\n\n      if (repoID !== destRepo.repo_id) {\n        this.setState({\n          asyncCopyMoveTaskId: res.data.task_id,\n          asyncOperatedFilesLength: 1,\n          asyncOperationProgress: 0,\n          asyncOperationType: 'copy',\n          isCopyMoveProgressDialogShow: true\n        }, () => {\n          this.getAsyncCopyMoveProgress();\n        });\n      }\n\n      if (repoID === destRepo.repo_id) {\n        if (this.state.currentMode === 'column') {\n          this.updateMoveCopyTreeNode(copyToDirentPath);\n        }\n\n        if (copyToDirentPath === nodeParentPath) {\n          this.loadDirentList(this.state.path);\n        }\n\n        let message = gettext('Successfully copied %(name)s.');\n        message = message.replace('%(name)s', dirName);\n        toaster.success(message);\n      }\n    }).catch((error) => {\n      if (!error.response.data.lib_need_decrypt) {\n        let errMessage = Utils.getErrorMsg(error);\n        if (errMessage === gettext('Error')) {\n          errMessage = gettext('Failed to copy %(name)s');\n          errMessage = errMessage.replace('%(name)s', dirName);\n        }\n        toaster.danger(errMessage);\n      } else {\n        this.setState({\n          libNeedDecryptWhenCopy: true,\n          destRepoWhenCopyMove: destRepo,\n          destDirentPathWhenCopyMove: copyToDirentPath,\n          copyMoveSingleItem: true,\n          srcDirentWhenCopyMove: dirent,\n          srcNodeParentPathWhenCopyMove: nodeParentPath,\n        });\n      }\n    });\n  };\n\n  onConvertItem = (dirent, dstType) => {\n    let path = Utils.joinPath(this.state.path, dirent.name);\n    let repoID = this.props.repoID;\n    toaster.notifyInProgress(gettext('Converting, please wait...'), {'id': 'conversion'});\n    seafileAPI.convertFile(repoID, path, dstType).then((res) => {\n      let newFileName = res.data.obj_name;\n      let parentDir = res.data.parent_dir;\n      let new_path = parentDir + '/' + newFileName;\n      let parentPath = Utils.getDirName(new_path);\n\n      if (this.state.currentMode === 'column') {\n        this.addNodeToTree(newFileName, parentPath, 'file');\n      }\n\n      this.addDirent(newFileName, 'file', res.data.size);\n      let message = gettext('Successfully converted the file.');\n      toaster.success(message, {'id': 'conversion'});\n\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      if (errMessage === gettext('Error')) {\n        let name = Utils.getFileName(path);\n        errMessage = gettext('Failed to convert {name}.').replace('{name}', name);\n      }\n      toaster.danger(errMessage, {'id': 'conversion'});\n    });\n\n  };\n\n  onDirentClick = (dirent) => {\n    let direntList = this.state.direntList.map(dirent => {\n      dirent.isSelected = false;\n      return dirent;\n    });\n    if (dirent) {\n      // dirent.isSelected = true;\n      this.setState({\n        direntList: direntList,\n        isDirentSelected: true,\n        selectedDirentList: [dirent],\n      });\n    } else {\n      this.setState({\n        direntList: direntList,\n        isDirentSelected: false,\n        selectedDirentList: [],\n      });\n    }\n  };\n\n  onItemClick = (dirent) => {\n    this.resetSelected();\n    let repoID = this.props.repoID;\n    let direntPath = Utils.joinPath(this.state.path, dirent.name);\n    if (dirent.isDir()) {  // is dir\n      if (this.state.currentMode === 'column') {\n        this.loadTreeNodeByPath(direntPath);\n      }\n      this.showDir(direntPath);\n    } else {  // is file\n      if (this.state.currentMode === 'column' && Utils.isMarkdownFile(direntPath)) {\n        this.showColumnMarkdownFile(direntPath);\n      } else {\n        let url = siteRoot + 'lib/' + repoID + '/file' + Utils.encodePath(direntPath);\n        if (dirent.is_sdoc_revision && dirent.revision_id) {\n          url = siteRoot + 'lib/' + repoID + '/revisions/' + dirent.revision_id + '/';\n        }\n\n        let isWeChat = Utils.isWeChat();\n        if (!isWeChat) {\n          window.open(url);\n        } else {\n          location.href = url;\n        }\n      }\n    }\n  };\n\n  onDirentSelected = (dirent) => {\n    let direntList = this.state.direntList.map(item => {\n      if (item.name === dirent.name) {\n        item.isSelected = !item.isSelected;\n      }\n      return item;\n    });\n    let selectedDirentList = direntList.filter(item => {\n      return item.isSelected;\n    });\n\n    if (selectedDirentList.length) {\n      this.setState({isDirentSelected: true});\n      if (selectedDirentList.length === direntList.length) {\n        this.setState({\n          isAllDirentSelected: true,\n          direntList: direntList,\n          selectedDirentList: selectedDirentList,\n        });\n      } else {\n        this.setState({\n          isAllDirentSelected: false,\n          direntList: direntList,\n          selectedDirentList: selectedDirentList\n        });\n      }\n    } else {\n      this.setState({\n        isDirentSelected: false,\n        isAllDirentSelected: false,\n        direntList: direntList,\n        selectedDirentList: []\n      });\n    }\n  };\n\n  onAllDirentSelected = () => {\n    if (this.state.isAllDirentSelected) {\n      let direntList = this.state.direntList.map(item => {\n        item.isSelected = false;\n        return item;\n      });\n      this.setState({\n        isDirentSelected: false,\n        isAllDirentSelected: false,\n        direntList: direntList,\n        selectedDirentList: [],\n      });\n    } else {\n      let direntList = this.state.direntList.map(item => {\n        item.isSelected = true;\n        return item;\n      });\n      this.setState({\n        isDirentSelected: true,\n        isAllDirentSelected: true,\n        direntList: direntList,\n        selectedDirentList: direntList,\n      });\n    }\n  };\n\n  onFileTagChanged = (dirent, direntPath) => {\n    let repoID = this.props.repoID;\n    seafileAPI.listFileTags(repoID, direntPath).then(res => {\n      let fileTags = res.data.file_tags.map(item => {\n        return new FileTag(item);\n      });\n\n      if (this.state.isViewFile) {\n        this.setState({fileTags: fileTags});\n      } else {\n        this.updateDirent(dirent, 'file_tags', fileTags);\n      }\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n\n    this.updateUsedRepoTags();\n  };\n\n  onFileUploadSuccess = (direntObject) => {\n    let isExist = this.state.direntList.some(item => {\n      return item.name === direntObject.name && item.type === direntObject.type;\n    });\n    if (isExist) {\n      let direntList = this.state.direntList;\n      for (let i = 0; i < direntList.length; i++) {\n        let dirent = direntList[i];\n        if (dirent.name === direntObject.name && dirent.type === direntObject.type) {\n          let mtime = moment.unix(direntObject.mtime).fromNow();\n          this.updateDirent(dirent, 'mtime', mtime);  // todo file size is need update too, api is not return;\n          break;\n        }\n      }\n    } else {\n      // use current dirent parent's permission as it's permission\n      direntObject.permission = this.state.userPerm;\n      let dirent = new Dirent(direntObject);\n      if (this.state.currentMode === 'column') {\n        this.addNodeToTree(dirent.name, this.state.path, dirent.type);\n      }\n      if (direntObject.type === 'dir') {\n        this.setState({direntList: [dirent, ...this.state.direntList]});\n      } else {\n        this.setState({direntList: [...this.state.direntList, dirent]});\n      }\n    }\n  };\n\n  addDirent = (name, type, size) => {\n    let item = this.createDirent(name, type, size);\n    let direntList = this.state.direntList;\n    if (type === 'dir') {\n      direntList.unshift(item);\n    } else {\n      // there will be there conditions;\n      // first: direntList.length === 0;\n      // second: all the direntList's items are dir;\n      // third: direntList has dir and file;\n      let length = direntList.length;\n      if (length === 0 || direntList[length - 1].type === 'dir') {\n        direntList.push(item);\n      } else {\n        let index = 0;\n        for (let i = 0; i <= length; i++) {\n          if (direntList[i].type === 'file') {\n            index = i;\n            break;\n          }\n        }\n        direntList.splice(index, 0, item);\n      }\n    }\n    this.setState({direntList: direntList});\n  };\n\n  renameDirent = (direntPath, newName) => {\n    let repoID = this.props.repoID;\n    let parentPath = Utils.getDirName(direntPath);\n    let newDirentPath = Utils.joinPath(parentPath, newName);\n    if (direntPath === this.state.path) {\n      // the renamed item is current viewed item\n      // example: direntPath = /A/B/C, state.path = /A/B/C\n\n      this.setState({ path: newDirentPath });\n      let repoInfo = this.state.currentRepoInfo;\n      let url = siteRoot + 'library/' + repoID + '/' + encodeURIComponent(repoInfo.repo_name) + newDirentPath;\n      window.history.replaceState({ url: url, path: newDirentPath}, newDirentPath, url);\n    } else if (Utils.isChildPath(direntPath, this.state.path)) {\n      // example: direntPath = /A/B/C/D, state.path = /A/B/C\n      let oldName = Utils.getFileName(direntPath);\n      let direntList = this.state.direntList.map(item => {\n        if (item.name === oldName) {\n          item.name = newName;\n        }\n        return item;\n      });\n      this.setState({ direntList: direntList });\n    } else if (Utils.isAncestorPath(direntPath, this.state.path)) {\n      // example: direntPath = /A/B, state.path = /A/B/C\n      let newPath = Utils.renameAncestorPath(this.state.path, direntPath, newDirentPath);\n      this.setState({ path: newPath });\n\n      let repoInfo = this.state.currentRepoInfo;\n      let url = siteRoot + 'library/' + repoID + '/' + encodeURIComponent(repoInfo.repo_name) + newPath;\n      window.history.replaceState({ url: url, path: newPath}, newPath, url);\n    }\n  };\n\n  deleteDirent(direntPath) {\n    if (direntPath === this.state.path) {\n      // The deleted item is current item\n      let parentPath = Utils.getDirName(direntPath);\n      this.showDir(parentPath);\n    } else if (Utils.isChildPath(direntPath, this.state.path)) {\n      // The deleted item is inside current path\n      let name = Utils.getFileName(direntPath);\n      let direntList = this.state.direntList.filter(item => {\n        return item.name !== name;\n      });\n\n      // Recalculate the state of the selection\n      this.recaculateSelectedStateAfterDirentDeleted(name, direntList);\n\n      this.setState({direntList: direntList});\n    } else if (Utils.isAncestorPath(direntPath, this.state.path)) {\n      // the deleted item is ancester of the current item\n      let parentPath = Utils.getDirName(direntPath);\n      this.showDir(parentPath);\n    }\n    // else do nothing\n  }\n\n  // only one scence: The deleted items are inside current path\n  deleteDirents = (direntNames) => {\n    let direntList = this.state.direntList.filter(item => {\n      return direntNames.indexOf(item.name) === -1;\n    });\n\n    // Recalculate the state of the selection\n    this.recaculateSelectedStateAfterDirentDeleted(name, direntList);\n\n    this.setState({direntList: direntList});\n  };\n\n  moveDirent = (direntPath, moveToDirentPath = null) => {\n    let name = Utils.getFileName(direntPath);\n    if (moveToDirentPath === this.state.path) {\n      this.loadDirentList(this.state.path);\n      return;\n    }\n    let direntList = this.state.direntList.filter(item => {\n      return item.name !== name;\n    });\n\n    // Recalculate the state of the selection\n    this.recaculateSelectedStateAfterDirentDeleted(name, direntList);\n\n    this.setState({direntList: direntList});\n  };\n\n  // only one scence: The moved items are inside current path\n  moveDirents = (direntNames) => {\n    let direntList = this.state.direntList.filter(item => {\n      return direntNames.indexOf(item.name) === -1;\n    });\n\n    // Recalculate the state of the selection\n    //this.recaculateSelectedStateAfterDirentDeleted(name, direntList);\n\n    this.setState({\n      direntList: direntList,\n      selectedDirentList: [],\n      isDirentSelected: false,\n      isAllDirentSelected: false,\n    });\n  };\n\n  updateDirent = (dirent, paramKey, paramValue) => {\n    let newDirentList = this.state.direntList.map(item => {\n      if (item.name === dirent.name) {\n        item[paramKey] = paramValue;\n      }\n      return item;\n    });\n    this.setState({direntList: newDirentList});\n  };\n\n  // tree operations\n  loadTreeNodeByPath = (path) => {\n    let repoID = this.props.repoID;\n    let tree = this.state.treeData.clone();\n    let node = tree.getNodeByPath(path);\n    if (!node.isLoaded) {\n      seafileAPI.listDir(repoID, node.path).then(res => {\n        this.addResponseListToNode(res.data.dirent_list, node);\n        let parentNode = tree.getNodeByPath(node.parentNode.path);\n        parentNode.isExpanded = true;\n        this.setState({\n          treeData: tree,\n          currentNode: node\n        });\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    } else {\n      let parentNode = tree.getNodeByPath(node.parentNode.path);\n      parentNode.isExpanded = true;\n      this.setState({treeData: tree, currentNode: node}); //tree\n    }\n  };\n\n  loadNodeAndParentsByPath = (path) => {\n    let repoID = this.props.repoID;\n    let tree = this.state.treeData.clone();\n    if (Utils.isMarkdownFile(path)) {\n      path = Utils.getDirName(path);\n    }\n    seafileAPI.listDir(repoID, path, {with_parents: true}).then(res => {\n      const { dirent_list: direntList, user_perm } = res.data;\n      let results = {};\n      for (let i = 0; i < direntList.length; i++) {\n        let object = direntList[i];\n        let parentDir = object.parent_dir;\n        let key = parentDir === '/' ?  '/' : parentDir.slice(0, parentDir.length - 1);\n        if (!results[key]) {\n          results[key] = [];\n        }\n        results[key].push(object);\n      }\n      for (let key in results) {\n        let node = tree.getNodeByPath(key);\n        if (!node.isLoaded) {\n          this.addResponseListToNode(results[key], node);\n        }\n      }\n      this.setState({\n        isTreeDataLoading: false,\n        treeData: tree,\n        userPerm: user_perm,\n      });\n    }).catch(() => {\n      this.setState({isLoadFailed: true});\n    });\n  };\n\n  onTreeNodeClick = (node) => {\n    this.resetSelected();\n    let repoID = this.props.repoID;\n    if (!this.state.pathExist) {\n      this.setState({pathExist: true});\n    }\n\n    if (node.object.isDir()) {\n      let isLoaded = node.isLoaded;\n      if (!node.isLoaded) {\n        let tree = this.state.treeData.clone();\n        node = tree.getNodeByPath(node.path);\n        seafileAPI.listDir(repoID, node.path).then(res => {\n          this.addResponseListToNode(res.data.dirent_list, node);\n          tree.collapseNode(node);\n          this.setState({treeData: tree});\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n      if (isLoaded && node.path === this.state.path) {\n        if (node.isExpanded) {\n          let tree = treeHelper.collapseNode(this.state.treeData, node);\n          this.setState({treeData: tree});\n        } else {\n          let tree = this.state.treeData.clone();\n          node = tree.getNodeByPath(node.path);\n          tree.expandNode(node);\n          this.setState({treeData: tree});\n        }\n      }\n    }\n\n    if (node.path === this.state.path ) {\n      return;\n    }\n\n    if (node.object.isDir()) {  // isDir\n      this.showDir(node.path);\n    } else {\n      if (Utils.isMarkdownFile(node.path)) {\n        if (node.path !== this.state.path) {\n          this.showColumnMarkdownFile(node.path);\n        }\n      } else {\n        let url = siteRoot + 'lib/' + repoID + '/file' + Utils.encodePath(node.path);\n        let dirent = node.object;\n        if (dirent.is_sdoc_revision && dirent.revision_id) {\n          url = siteRoot + 'lib/' + repoID + '/revisions/' + dirent.revision_id + '/';\n        }\n        window.open(url);\n      }\n    }\n  };\n\n  showColumnMarkdownFile = (filePath) => {\n    let repoID = this.props.repoID;\n    seafileAPI.getFileInfo(repoID, filePath).then((res) => {\n      if (res.data.size === 0) {\n        // loading of asynchronously obtained data may be blocked\n        const w = window.open('about:blank');\n        const url = siteRoot + 'lib/' + repoID + '/file' + Utils.encodePath(filePath);\n        w.location.href = url;\n      } else {\n        this.showFile(filePath);\n      }\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  onTreeNodeCollapse = (node) => {\n    let tree = treeHelper.collapseNode(this.state.treeData, node);\n    this.setState({treeData: tree});\n  };\n\n  onTreeNodeExpanded = (node) => {\n    let repoID = this.props.repoID;\n    let tree = this.state.treeData.clone();\n    node = tree.getNodeByPath(node.path);\n    if (!node.isLoaded) {\n      seafileAPI.listDir(repoID, node.path).then(res => {\n        this.addResponseListToNode(res.data.dirent_list, node);\n        this.setState({treeData: tree});\n      }).catch(error => {\n        let errMessage = Utils.getErrorMsg(error);\n        toaster.danger(errMessage);\n      });\n    } else {\n      tree.expandNode(node);\n      this.setState({treeData: tree});\n    }\n  };\n\n  addNodeToTree = (name, parentPath, type) => {\n    let node = this.createTreeNode(name, type);\n    let tree = treeHelper.addNodeToParentByPath(this.state.treeData, node, parentPath);\n    this.setState({treeData: tree});\n  };\n\n  renameTreeNode = (path, newName) => {\n    let tree = treeHelper.renameNodeByPath(this.state.treeData, path, newName);\n    this.setState({treeData: tree});\n  };\n\n  deleteTreeNode = (path) => {\n    let tree = treeHelper.deleteNodeByPath(this.state.treeData, path);\n    this.setState({treeData: tree});\n  };\n\n  deleteTreeNodes = (paths) => {\n    let tree = treeHelper.deleteNodeListByPaths(this.state.treeData, paths);\n    this.setState({treeData: tree});\n  };\n\n  moveTreeNode = (nodePath, moveToPath, moveToRepo, nodeName) => {\n    let repoID = this.props.repoID;\n    if (repoID !== moveToRepo.repo_id) {\n      let tree = treeHelper.deleteNodeByPath(this.state.treeData, nodePath);\n      this.setState({treeData: tree});\n      return;\n    }\n    let tree = treeHelper.moveNodeByPath(this.state.treeData, nodePath, moveToPath, nodeName);\n    this.setState({treeData: tree});\n  };\n\n  copyTreeNode = (nodePath, copyToPath, destRepo, nodeName) => {\n    let repoID = this.props.repoID;\n    if (repoID !== destRepo.repo_id) {\n      return;\n    }\n    let tree = treeHelper.copyNodeByPath(this.state.treeData, nodePath, copyToPath, nodeName);\n    this.setState({treeData: tree});\n  };\n\n  createTreeNode(name, type) {\n    let object = this.createDirent(name, type);\n    return new TreeNode({object});\n  }\n\n  createDirent(name, type, size) {\n    // use current dirent parent's permission as it's permission\n    const { userPerm: permission } = this.state;\n    const mtime = new Date().getTime()/1000;\n    const obj = { name, type, mtime, size, permission };\n    const dirent = new Dirent(obj);\n    return dirent;\n  }\n\n  addResponseListToNode = (list, node) => {\n    node.isLoaded = true;\n    node.isExpanded = true;\n    let direntList = list.map(item => {\n      return new Dirent(item);\n    });\n    direntList = Utils.sortDirents(direntList, 'name', 'asc');\n\n    let nodeList = direntList.map(object => {\n      return new TreeNode({object});\n    });\n    node.addChildren(nodeList);\n  };\n\n  getSelectedDirentPaths = () => {\n    let paths = [];\n    this.state.selectedDirentList.forEach(selectedDirent => {\n      paths.push(Utils.joinPath(this.state.path, selectedDirent.name));\n    });\n    return paths;\n  };\n\n  getSelectedDirentNames = () => {\n    let names = [];\n    this.state.selectedDirentList.forEach(selectedDirent => {\n      names.push(selectedDirent.name);\n    });\n    return names;\n  };\n\n  resetSelected = () => {\n    this.setState({\n      isDirentSelected: false,\n      isAllDirentSelected: false,\n    });\n  };\n\n  recaculateSelectedStateAfterDirentDeleted = (name, newDirentList) => {\n    let selectedDirentList = this.state.selectedDirentList.slice(0);\n    if (selectedDirentList.length > 0) {\n      selectedDirentList = selectedDirentList.filter(item => {\n        return item.name !== name;\n      });\n    }\n    this.setState({\n      selectedDirentList: selectedDirentList,\n      isDirentSelected: selectedDirentList.length > 0,\n      isAllDirentSelected: selectedDirentList.length === newDirentList.length,\n    });\n  };\n\n  onLibDecryptDialog = () => {\n    this.setState({libNeedDecrypt: false});\n    this.loadDirData(this.state.path);\n  };\n\n  onLibDecryptWhenCopyMove = () => {\n    if (this.state.libNeedDecryptWhenCopy) {\n      if (this.state.copyMoveSingleItem) {\n        this.onCopyItem(this.state.destRepoWhenCopyMove, this.state.srcDirentWhenCopyMove, this.state.destDirentPathWhenCopyMove,this.state.srcNodeParentPathWhenCopyMove);\n      } else {\n        this.onCopyItems(this.state.destRepoWhenCopyMove, this.state.destDirentPathWhenCopyMove);\n      }\n      this.setState({\n        libNeedDecryptWhenCopy: false,\n        copyMoveSingleItem: false,\n      });\n    }\n    if (this.state.libNeedDecryptWhenMove) {\n      if (this.state.copyMoveSingleItem) {\n        this.onMoveItem(this.state.destRepoWhenCopyMove, this.state.srcDirentWhenCopyMove, this.state.destDirentPathWhenCopyMove, this.state.srcNodeParentPathWhenCopyMove);\n      } else {\n        this.onMoveItems(this.state.destRepoWhenCopyMove, this.state.destDirentPathWhenCopyMove);\n      }\n      this.setState({\n        libNeedDecryptWhenMove: false,\n        copyMoveSingleItem: false,\n      });\n    }\n  };\n\n  sortItems = (sortBy, sortOrder) => {\n    cookie.save('seafile-repo-dir-sort-by', sortBy);\n    cookie.save('seafile-repo-dir-sort-order', sortOrder);\n    this.setState({\n      sortBy: sortBy,\n      sortOrder: sortOrder,\n      items: Utils.sortDirents(this.state.direntList, sortBy, sortOrder)\n    });\n  };\n\n  onUploadFile = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    this.uploader.onFileUpload();\n  };\n\n  onUploadFolder = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    this.uploader.onFolderUpload();\n  };\n\n  onToolbarFileTagChanged = () => {\n    let repoID = this.props.repoID;\n    let filePath = this.state.path;\n    seafileAPI.listFileTags(repoID, filePath).then(res => {\n      let fileTags = res.data.file_tags.map(item => {\n        return new FileTag(item);\n      });\n\n      this.setState({fileTags: fileTags});\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  unSelectDirent = () => {\n    this.setState({\n      isDirentSelected: false,\n      selectedDirentList: []\n    });\n    const dirent = {};\n    this.onDirentSelected(dirent);\n  };\n\n  onDeleteRepoTag = (deletedTagID) => {\n    let direntList = this.state.direntList.map(dirent => {\n      if (dirent.file_tags) {\n        let fileTags = dirent.file_tags.filter(item => {\n          return item.repo_tag_id !== deletedTagID;\n        });\n        dirent.file_tags = fileTags;\n      }\n      return dirent;\n    });\n    this.setState({direntList: direntList});\n    this.updateUsedRepoTags();\n  };\n\n\n  handleSubmit = (e) => {\n    let options = {\n      'share_type': 'personal',\n      'from': this.state.currentRepoInfo.owner_email\n    };\n    seafileAPI.leaveShareRepo(this.props.repoID, options).then(res => {\n      navigate(siteRoot + 'shared-libs/');\n    }).catch((error) => {\n      let errorMsg = Utils.getErrorMsg(error, true);\n      toaster.danger(errorMsg);\n    });\n\n    e.preventDefault();\n  };\n\n  render() {\n    if (this.state.libNeedDecrypt) {\n      return (\n        <ModalPortal>\n          <LibDecryptDialog\n            repoID={this.props.repoID}\n            onLibDecryptDialog={this.onLibDecryptDialog}\n          />\n        </ModalPortal>\n      );\n    }\n\n    if (this.state.libNeedDecryptWhenCopy || this.state.libNeedDecryptWhenMove) {\n      return (\n        <ModalPortal>\n          <LibDecryptDialog\n            repoID={this.state.destRepoWhenCopyMove.repo_id}\n            onLibDecryptDialog={this.onLibDecryptWhenCopyMove}\n          />\n        </ModalPortal>\n      );\n    }\n\n    if (this.state.errorMsg) {\n      return (\n        <Fragment>\n          <p className=\"error mt-6 text-center\">{this.state.errorMsg}</p>\n          <button type=\"submit\" className=\"btn btn-primary submit\" onClick={this.handleSubmit}>{gettext('Leave Share')}</button>\n        </Fragment>\n      );\n    }\n\n    if (!this.state.currentRepoInfo) {\n      return '';\n    }\n\n    let enableDirPrivateShare = false;\n    let { currentRepoInfo, userPerm, isCopyMoveProgressDialogShow, isDeleteFolderDialogOpen } = this.state;\n    let showShareBtn = Utils.isHasPermissionToShare(currentRepoInfo, userPerm);\n    let isRepoOwner = currentRepoInfo.owner_email === username;\n    let isVirtual = currentRepoInfo.is_virtual;\n    let isAdmin = currentRepoInfo.is_admin;\n    if (!isVirtual && (isRepoOwner || isAdmin)) {\n      enableDirPrivateShare = true;\n    }\n    let direntItemsList = this.state.direntList.filter((item, index) => {\n      return index < this.state.itemsShowLength;\n    });\n\n    let canUpload = true;\n    const { isCustomPermission, customPermission } = Utils.getUserPermission(userPerm);\n    if (isCustomPermission) {\n      const { upload } = customPermission.permission;\n      canUpload = upload;\n    }\n\n    return (\n      <Fragment>\n        <div className=\"main-panel-north border-left-show\">\n          <LibContentToolbar\n            isViewFile={this.state.isViewFile}\n            filePermission={this.state.filePermission}\n            fileTags={this.state.fileTags}\n            onFileTagChanged={this.onToolbarFileTagChanged}\n            onSideNavMenuClick={this.props.onMenuClick}\n            repoID={this.props.repoID}\n            path={this.state.path}\n            isDirentSelected={this.state.isDirentSelected}\n            selectedDirentList={this.state.selectedDirentList}\n            onItemsMove={this.onMoveItems}\n            onItemsCopy={this.onCopyItems}\n            onItemsDelete={this.onDeleteItems}\n            onItemRename={this.onMainPanelItemRename}\n            direntList={this.state.direntList}\n            repoName={this.state.repoName}\n            repoEncrypted={this.state.repoEncrypted}\n            isGroupOwnedRepo={this.state.isGroupOwnedRepo}\n            userPerm={this.state.userPerm}\n            showShareBtn={showShareBtn}\n            enableDirPrivateShare={enableDirPrivateShare}\n            onAddFile={this.onAddFile}\n            onAddFolder={this.onAddFolder}\n            onUploadFile={this.onUploadFile}\n            onUploadFolder={this.onUploadFolder}\n            currentMode={this.state.currentMode}\n            switchViewMode={this.switchViewMode}\n            onSearchedClick={this.onSearchedClick}\n            isRepoOwner={isRepoOwner}\n            currentRepoInfo={this.state.currentRepoInfo}\n            updateDirent={this.updateDirent}\n            onDirentSelected={this.onDirentSelected}\n            showDirentDetail={this.showDirentDetail}\n            unSelectDirent={this.unSelectDirent}\n            onFilesTagChanged={this.onFileTagChanged}\n            repoTags={this.state.repoTags}\n          />\n        </div>\n        <div className=\"main-panel-center flex-row\">\n          <LibContentContainer\n            pathPrefix={this.props.pathPrefix}\n            currentMode={this.state.currentMode}\n            path={this.state.path}\n            pathExist={this.state.pathExist}\n            currentRepoInfo={this.state.currentRepoInfo}\n            repoID={this.props.repoID}\n            enableDirPrivateShare={enableDirPrivateShare}\n            userPerm={userPerm}\n            isGroupOwnedRepo={this.state.isGroupOwnedRepo}\n            onTabNavClick={this.props.onTabNavClick}\n            onMainNavBarClick={this.onMainNavBarClick}\n            isViewFile={this.state.isViewFile}\n            hash={this.state.hash}\n            fileTags={this.state.fileTags}\n            isFileLoading={this.state.isFileLoading}\n            isFileLoadedErr={this.state.isFileLoadedErr}\n            filePermission={this.state.filePermission}\n            content={this.state.content}\n            lastModified={this.state.lastModified}\n            latestContributor={this.state.latestContributor}\n            onLinkClick={this.onLinkClick}\n            isTreeDataLoading={this.state.isTreeDataLoading}\n            treeData={this.state.treeData}\n            currentNode={this.state.currentNode}\n            onNodeClick={this.onTreeNodeClick}\n            onNodeCollapse={this.onTreeNodeCollapse}\n            onNodeExpanded={this.onTreeNodeExpanded}\n            onAddFolderNode={this.onAddFolder}\n            onAddFileNode={this.onAddFile}\n            onRenameNode={this.onRenameTreeNode}\n            onDeleteNode={this.onDeleteTreeNode}\n            repoTags={this.state.repoTags}\n            usedRepoTags={this.state.usedRepoTags}\n            updateUsedRepoTags={this.updateUsedRepoTags}\n            isDirentListLoading={this.state.isDirentListLoading}\n            direntList={direntItemsList}\n            fullDirentList={this.state.direntList}\n            sortBy={this.state.sortBy}\n            sortOrder={this.state.sortOrder}\n            sortItems={this.sortItems}\n            updateDirent={this.updateDirent}\n            onDirentClick={this.onDirentClick}\n            onItemClick={this.onItemClick}\n            onItemSelected={this.onDirentSelected}\n            onItemDelete={this.onMainPanelItemDelete}\n            onItemRename={this.onMainPanelItemRename}\n            onItemMove={this.onMoveItem}\n            onItemCopy={this.onCopyItem}\n            onItemConvert={this.onConvertItem}\n            onAddFolder={this.onAddFolder}\n            onAddFile={this.onAddFile}\n            onFileTagChanged={this.onFileTagChanged}\n            isDirentSelected={this.state.isDirentSelected}\n            isAllDirentSelected={this.state.isAllDirentSelected}\n            onAllDirentSelected={this.onAllDirentSelected}\n            isDirentDetailShow={this.state.isDirentDetailShow}\n            selectedDirent={this.state.selectedDirentList && this.state.selectedDirentList[0]}\n            selectedDirentList={this.state.selectedDirentList}\n            onItemsMove={this.onMoveItems}\n            onItemsCopy={this.onCopyItems}\n            onItemsDelete={this.onDeleteItems}\n            closeDirentDetail={this.closeDirentDetail}\n            showDirentDetail={this.showDirentDetail}\n            direntDetailPanelTab={this.state.direntDetailPanelTab}\n            onDeleteRepoTag={this.onDeleteRepoTag}\n            onToolbarFileTagChanged={this.onToolbarFileTagChanged}\n            updateDetail={this.state.updateDetail}\n            onListContainerScroll={this.onListContainerScroll}\n            loadDirentList={this.loadDirentList}\n          />\n          {canUpload && this.state.pathExist && !this.state.isViewFile && (\n            <FileUploader\n              ref={uploader => this.uploader = uploader}\n              dragAndDrop={true}\n              path={this.state.path}\n              repoID={this.props.repoID}\n              direntList={this.state.direntList}\n              onFileUploadSuccess={this.onFileUploadSuccess}\n              isCustomPermission={isCustomPermission}\n            />\n          )}\n        </div>\n        {isCopyMoveProgressDialogShow && (\n          <CopyMoveDirentProgressDialog\n            type={this.state.asyncOperationType}\n            asyncOperatedFilesLength={this.state.asyncOperatedFilesLength}\n            asyncOperationProgress={this.state.asyncOperationProgress}\n            toggleDialog={this.onMoveProgressDialogToggle}\n          />\n        )}\n        {isDeleteFolderDialogOpen && (\n          <DeleteFolderDialog\n            repoID={this.props.repoID}\n            path={this.state.folderToDelete}\n            deleteFolder={this.deleteFolder}\n            toggleDialog={this.toggleDeleteFolderDialog}\n          />\n        )}\n      </Fragment>\n    );\n  }\n}\n\nLibContentView.propTypes = propTypes;\n\nexport default LibContentView;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}