{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport OutlineItem from './outline-item';\nimport { useScrollContext } from '../hooks/use-scroll-context';\nimport './style.css';\nvar getHeaderList = function getHeaderList(children) {\n  var headerList = [];\n  children.forEach(function (node) {\n    if (node.type === 'header2' || node.type === 'header3') {\n      headerList.push(node);\n    }\n  });\n  return headerList;\n};\nvar Outline = function Outline(_ref) {\n  var editor = _ref.editor;\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var scrollRef = useScrollContext();\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    headerList = _useState2[0],\n    setHeaderList = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    activeId = _useState4[0],\n    setActiveId = _useState4[1];\n  useEffect(function () {\n    var headerList = getHeaderList(editor.children);\n    setHeaderList(headerList);\n  }, [editor.children]);\n  var handleScroll = useCallback(function (e) {\n    var scrollTop = scrollRef.current.scrollTop;\n    var styles = getComputedStyle(scrollRef === null || scrollRef === void 0 ? void 0 : scrollRef.current);\n    var paddingTop = parseInt(styles.paddingTop);\n    for (var i = 0; i < headerList.length; i++) {\n      var headerItem = headerList[i];\n      var dom = document.getElementById(headerItem.id);\n      var offsetTop = dom.offsetTop,\n        offsetHeight = dom.offsetHeight;\n      var _styles = getComputedStyle(dom);\n      var marginTop = parseInt(_styles.marginTop);\n      if (offsetTop + offsetHeight + marginTop > scrollTop - paddingTop) {\n        setActiveId(headerItem.id);\n        break;\n      }\n    }\n  }, [headerList, scrollRef]);\n  useEffect(function () {\n    var observerRefValue = null;\n    if (scrollRef.current) {\n      scrollRef.current.addEventListener('scroll', handleScroll);\n      observerRefValue = scrollRef.current;\n    }\n    return function () {\n      observerRefValue.removeEventListener('scroll', handleScroll);\n    };\n  }, [handleScroll, scrollRef]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-wiki-viewer-outline\"\n  }, headerList.length === 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"empty-container\"\n  }, t('No_out_line')), headerList.length > 0 && headerList.map(function (node, index) {\n    return /*#__PURE__*/React.createElement(OutlineItem, {\n      key: index,\n      node: node,\n      activeId: activeId\n    });\n  }));\n};\nexport default Outline;","map":{"version":3,"names":["React","useCallback","useEffect","useState","useTranslation","OutlineItem","useScrollContext","getHeaderList","children","headerList","forEach","node","type","push","Outline","_ref","editor","_useTranslation","t","scrollRef","_useState","_useState2","_slicedToArray","setHeaderList","_useState3","_useState4","activeId","setActiveId","handleScroll","e","scrollTop","current","styles","getComputedStyle","paddingTop","parseInt","i","length","headerItem","dom","document","getElementById","id","offsetTop","offsetHeight","marginTop","observerRefValue","addEventListener","removeEventListener","createElement","className","map","index","key"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/wiki-outline/index.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport OutlineItem from './outline-item';\nimport { useScrollContext } from '../hooks/use-scroll-context';\nimport './style.css';\nconst getHeaderList = children => {\n  const headerList = [];\n  children.forEach(node => {\n    if (node.type === 'header2' || node.type === 'header3') {\n      headerList.push(node);\n    }\n  });\n  return headerList;\n};\nconst Outline = _ref => {\n  let {\n    editor\n  } = _ref;\n  const {\n    t\n  } = useTranslation();\n  const scrollRef = useScrollContext();\n  const [headerList, setHeaderList] = useState([]);\n  const [activeId, setActiveId] = useState('');\n  useEffect(() => {\n    const headerList = getHeaderList(editor.children);\n    setHeaderList(headerList);\n  }, [editor.children]);\n  const handleScroll = useCallback(e => {\n    const scrollTop = scrollRef.current.scrollTop;\n    const styles = getComputedStyle(scrollRef === null || scrollRef === void 0 ? void 0 : scrollRef.current);\n    const paddingTop = parseInt(styles.paddingTop);\n    for (let i = 0; i < headerList.length; i++) {\n      const headerItem = headerList[i];\n      const dom = document.getElementById(headerItem.id);\n      const {\n        offsetTop,\n        offsetHeight\n      } = dom;\n      const styles = getComputedStyle(dom);\n      const marginTop = parseInt(styles.marginTop);\n      if (offsetTop + offsetHeight + marginTop > scrollTop - paddingTop) {\n        setActiveId(headerItem.id);\n        break;\n      }\n    }\n  }, [headerList, scrollRef]);\n  useEffect(() => {\n    let observerRefValue = null;\n    if (scrollRef.current) {\n      scrollRef.current.addEventListener('scroll', handleScroll);\n      observerRefValue = scrollRef.current;\n    }\n    return () => {\n      observerRefValue.removeEventListener('scroll', handleScroll);\n    };\n  }, [handleScroll, scrollRef]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-wiki-viewer-outline\"\n  }, headerList.length === 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"empty-container\"\n  }, t('No_out_line')), headerList.length > 0 && headerList.map((node, index) => {\n    return /*#__PURE__*/React.createElement(OutlineItem, {\n      key: index,\n      node: node,\n      activeId: activeId\n    });\n  }));\n};\nexport default Outline;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}