{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";// This file is copied from frontend/src/components/file-uploader/file-uploader.js,\n// and modified according to the requirements of this page.\nimport React,{Fragment}from'react';import Resumablejs from'@seafile/resumablejs';import MD5 from'MD5';import{resumableUploadFileBlockSize,maxUploadFileSize,maxNumberOfFilesForFileupload}from'../../utils/constants';import{seafileAPI}from'../../utils/seafile-api';import{Utils}from'../../utils/utils';import{gettext}from'../../utils/constants';import UploadProgressDialog from'./upload-progress-dialog';import toaster from'../../components/toast';import'../../css/file-uploader.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var FileUploader=/*#__PURE__*/function(_React$Component){_inherits(FileUploader,_React$Component);var _super=_createSuper(FileUploader);function FileUploader(props){var _this;_classCallCheck(this,FileUploader);_this=_super.call(this,props);_this.componentWillUnmount=function(){window.onbeforeunload=null;if(_this.props.dragAndDrop===true){_this.resumable.disableDropOnDocument();}};_this.onbeforeunload=function(){if(window.uploader&&window.uploader.isUploadProgressDialogShow&&window.uploader.totalProgress!==100){return'';}};_this.bindCallbackHandler=function(){var _this$props=_this.props,minFileSizeErrorCallback=_this$props.minFileSizeErrorCallback,fileTypeErrorCallback=_this$props.fileTypeErrorCallback;if(_this.maxFilesErrorCallback){_this.resumable.opts.maxFilesErrorCallback=_this.maxFilesErrorCallback;}if(minFileSizeErrorCallback){_this.resumable.opts.minFileSizeErrorCallback=_this.props.minFileSizeErrorCallback;}if(_this.maxFileSizeErrorCallback){_this.resumable.opts.maxFileSizeErrorCallback=_this.maxFileSizeErrorCallback;}if(fileTypeErrorCallback){_this.resumable.opts.fileTypeErrorCallback=_this.props.fileTypeErrorCallback;}};_this.bindEventHandler=function(){_this.resumable.on('chunkingComplete',_this.onChunkingComplete.bind(_assertThisInitialized(_this)));_this.resumable.on('fileAdded',_this.onFileAdded.bind(_assertThisInitialized(_this)));_this.resumable.on('fileProgress',_this.onFileProgress.bind(_assertThisInitialized(_this)));_this.resumable.on('fileSuccess',_this.onFileUploadSuccess.bind(_assertThisInitialized(_this)));_this.resumable.on('fileError',_this.onFileError.bind(_assertThisInitialized(_this)));_this.resumable.on('uploadStart',_this.onUploadStart.bind(_assertThisInitialized(_this)));_this.resumable.on('progress',_this.onProgress.bind(_assertThisInitialized(_this)));_this.resumable.on('complete',_this.onComplete.bind(_assertThisInitialized(_this)));_this.resumable.on('error',_this.onError.bind(_assertThisInitialized(_this)));_this.resumable.on('dragstart',_this.onDragStart.bind(_assertThisInitialized(_this)));};_this.maxFilesErrorCallback=function(files,errorCount){var maxFiles=maxNumberOfFilesForFileupload;var message=gettext('Please upload no more than {maxFiles} files at a time.');message=message.replace('{maxFiles}',maxFiles);toaster.danger(message);};_this.maxFileSizeErrorCallback=function(file){var forbidUploadFileList=_this.state.forbidUploadFileList;forbidUploadFileList.push(file);_this.setState({forbidUploadFileList:forbidUploadFileList});};_this.onChunkingComplete=function(resumableFile){var path=_this.props.path;var fileName=resumableFile.fileName;var relativePath=resumableFile.relativePath;var isFile=fileName===relativePath;resumableFile.formData={};if(isFile){// upload file\nresumableFile.formData={parent_dir:path};}else{// upload folder\nvar relative_path=relativePath.slice(0,relativePath.lastIndexOf('/')+1);resumableFile.formData={parent_dir:path,relative_path:relative_path};}};_this.onFileAdded=function(resumableFile,files){var isFile=resumableFile.fileName===resumableFile.relativePath;if(isFile&&files.length===1){var hasRepetition=false;/*\n      let direntList = this.props.direntList;\n      for (let i = 0; i < direntList.length; i++) {\n        if (direntList[i].type === 'file' && direntList[i].name === resumableFile.fileName) {\n          hasRepetition = true;\n          break;\n        }\n      }\n      */if(hasRepetition){_this.setState({isUploadRemindDialogShow:true,currentResumableFile:resumableFile});}else{_this.setUploadFileList(_this.resumable.files);seafileAPI.sharedUploadLinkGetFileUploadUrl(_this.props.token).then(function(res){_this.resumable.opts.target=res.data.upload_link+'?ret-json=1';_this.resumableUpload(resumableFile);}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}}else{_this.setUploadFileList(_this.resumable.files);if(!_this.isUploadLinkLoaded){_this.isUploadLinkLoaded=true;seafileAPI.sharedUploadLinkGetFileUploadUrl(_this.props.token).then(function(res){_this.resumable.opts.target=res.data.upload_link+'?ret-json=1';_this.resumable.upload();}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}}};_this.resumableUpload=function(resumableFile){var _this$props2=_this.props,repoID=_this$props2.repoID,path=_this$props2.path;seafileAPI.getFileUploadedBytes(repoID,path,resumableFile.fileName).then(function(res){var uploadedBytes=res.data.uploadedBytes;var blockSize=parseInt(resumableUploadFileBlockSize)*1024*1024||1024*1024;var offset=Math.floor(uploadedBytes/blockSize);resumableFile.markChunksCompleted(offset);_this.resumable.upload();}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.filesAddedComplete=function(resumable,files){var forbidUploadFileList=_this.state.forbidUploadFileList;if(forbidUploadFileList.length>0&&files.length===0){_this.setState({isUploadProgressDialogShow:true,totalProgress:100});}};_this.setUploadFileList=function(){var uploadFileList=_this.resumable.files;_this.setState({uploadFileList:uploadFileList,isUploadProgressDialogShow:true});Utils.registerGlobalVariable('uploader','isUploadProgressDialogShow',true);};_this.onFileProgress=function(resumableFile){var uploadBitrate=_this.getBitrate();var uploadFileList=_this.state.uploadFileList.map(function(item){if(item.uniqueIdentifier===resumableFile.uniqueIdentifier){if(uploadBitrate){var lastSize=(item.size-item.size*item.progress())*8;var time=Math.floor(lastSize/uploadBitrate);item.remainingTime=time;}}return item;});_this.setState({uploadBitrate:uploadBitrate,uploadFileList:uploadFileList});};_this.getBitrate=function(){var loaded=0;var uploadBitrate=0;var now=new Date().getTime();_this.resumable.files.forEach(function(file){loaded+=file.progress()*file.size;});if(_this.timestamp){var timeDiff=now-_this.timestamp;if(timeDiff<_this.bitrateInterval){return _this.state.uploadBitrate;}// 1. Cancel will produce loaded greater than this.loaded\n// 2. reset can make this.loaded to be 0\nif(loaded<_this.loaded||_this.loaded===0){_this.loaded=loaded;//\n}uploadBitrate=(loaded-_this.loaded)*(1000/timeDiff)*8;}_this.timestamp=now;_this.loaded=loaded;return uploadBitrate;};// start uploading\n_this.onUploadStart=function(){/*\n    const message = gettext('File upload started');\n    toaster.notify(message);\n    */};_this.onProgress=function(){var progress=Math.round(_this.resumable.progress()*100);_this.setState({totalProgress:progress});Utils.registerGlobalVariable('uploader','totalProgress',progress);};_this.onFileUploadSuccess=function(resumableFile,message){var formData=resumableFile.formData;var currentTime=new Date().getTime()/1000;message=formData.replace?message:JSON.parse(message)[0];if(formData.relative_path){// upload folder\nvar relative_path=formData.relative_path;var dir_name=relative_path.slice(0,relative_path.indexOf('/'));var _dirent={id:message.id,name:dir_name,type:'dir',mtime:currentTime};// update folders cache\nvar isExist=_this.notifiedFolders.some(function(item){return item.name===_dirent.name;});if(!isExist){_this.notifiedFolders.push(_dirent);_this.props.onFileUploadSuccess(_dirent);}// update uploadFileList\nvar _uploadFileList=_this.state.uploadFileList.map(function(item){if(item.uniqueIdentifier===resumableFile.uniqueIdentifier){item.newFileName=relative_path+message.name;item.isSaved=true;}return item;});_this.setState({uploadFileList:_uploadFileList});return;}if(formData.replace){// upload file -- replace exist file\nvar fileName=resumableFile.fileName;var _dirent2={id:message,name:fileName,type:'file',mtime:currentTime};_this.props.onFileUploadSuccess(_dirent2);// this contance: just one file\nvar _uploadFileList2=_this.state.uploadFileList.map(function(item){if(item.uniqueIdentifier===resumableFile.uniqueIdentifier){item.newFileName=fileName;item.isSaved=true;}return item;});_this.setState({uploadFileList:_uploadFileList2});return;}// upload file -- add files\nvar dirent={id:message.id,type:'file',name:message.name,size:message.size,mtime:currentTime};_this.props.onFileUploadSuccess(dirent);var uploadFileList=_this.state.uploadFileList.map(function(item){if(item.uniqueIdentifier===resumableFile.uniqueIdentifier){item.newFileName=message.name;item.isSaved=true;}return item;});_this.setState({uploadFileList:uploadFileList});};_this.onFileError=function(resumableFile,message){var error='';if(!message){error=gettext('Network error');}else{// eg: '{\"error\": \"Internal error\" \\n }'\nvar errorMessage=message.replace(/\\n/g,'');errorMessage=JSON.parse(errorMessage);error=errorMessage.error;if(error==='File locked by others.'){error=gettext('File is locked by others.');}if(error==='Internal error.'){error=gettext('Internal Server Error');}}var uploadFileList=_this.state.uploadFileList.map(function(item){if(item.uniqueIdentifier===resumableFile.uniqueIdentifier){_this.state.retryFileList.push(item);item.error=error;}return item;});_this.loaded=0;// reset loaded data;\n_this.setState({retryFileList:_this.state.retryFileList,uploadFileList:uploadFileList});};_this.onComplete=function(){/*\n    if (!this.error) {\n      const message = gettext('All files uploaded');\n      toaster.success(message);\n    }\n    */_this.error=false;// reset it\n_this.notifiedFolders=[];// reset upload link loaded\n_this.isUploadLinkLoaded=false;};_this.onError=function(message,file){var msg=gettext('Error');if(file&&file.fileName){msg=gettext('Failed to upload {file_name}.').replace('{file_name}',file.fileName);}toaster.danger(msg,{'id':'file-error-msg'});_this.error=true;// reset upload link loaded\n_this.isUploadLinkLoaded=false;// After the error, the user can switch windows\nUtils.registerGlobalVariable('uploader','totalProgress',100);};_this.setHeaders=function(resumableFile,resumable){var offset=resumable.offset;var chunkSize=resumable.getOpt('chunkSize');var fileSize=resumableFile.size===0?1:resumableFile.size;var startByte=offset!==0?offset*chunkSize:0;var endByte=Math.min(fileSize,(offset+1)*chunkSize)-1;if(fileSize-resumable.endByte<chunkSize&&!resumable.getOpt('forceChunkSize')){endByte=fileSize;}var headers={'Accept':'application/json; text/javascript, */*; q=0.01','Content-Disposition':'attachment; filename=\"'+encodeURI(resumableFile.fileName)+'\"','Content-Range':'bytes '+startByte+'-'+endByte+'/'+fileSize};return headers;};_this.setQuery=function(resumableFile){var formData=resumableFile.formData;return formData;};_this.generateUniqueIdentifier=function(file){var relativePath=file.webkitRelativePath||file.relativePath||file.fileName||file.name;return MD5(relativePath+new Date())+relativePath;};_this.onClick=function(e){e.nativeEvent.stopImmediatePropagation();e.stopPropagation();};_this.onFileUpload=function(){_this.uploadInput.current.removeAttribute('webkitdirectory');_this.uploadInput.current.click();};_this.onFolderUpload=function(){_this.uploadInput.current.setAttribute('webkitdirectory','webkitdirectory');_this.uploadInput.current.click();};_this.onDragStart=function(){_this.uploadInput.current.setAttribute('webkitdirectory','webkitdirectory');};_this.onCloseUploadDialog=function(){_this.loaded=0;_this.resumable.files=[];// reset upload link loaded\n_this.isUploadLinkLoaded=false;_this.setState({isUploadProgressDialogShow:false,uploadFileList:[],forbidUploadFileList:[]});Utils.registerGlobalVariable('uploader','isUploadProgressDialogShow',false);};_this.onUploadCancel=function(uploadingItem){var uploadFileList=_this.state.uploadFileList.filter(function(item){if(item.uniqueIdentifier===uploadingItem.uniqueIdentifier){item.cancel();// execute cancel function will delete the file at the same time\nreturn false;}return true;});if(!_this.resumable.isUploading()){_this.setState({totalProgress:100});_this.loaded=0;}_this.setState({uploadFileList:uploadFileList});};_this.onCancelAllUploading=function(){var uploadFileList=_this.state.uploadFileList.filter(function(item){if(Math.round(item.progress()!==1)){item.cancel();return false;}return true;});_this.loaded=0;_this.setState({totalProgress:100,uploadFileList:uploadFileList});// reset upload link loaded\n_this.isUploadLinkLoaded=false;};_this.onUploadRetry=function(resumableFile){seafileAPI.sharedUploadLinkGetFileUploadUrl(_this.props.token).then(function(res){_this.resumable.opts.target=res.data.upload_link+'?ret-json=1';var retryFileList=_this.state.retryFileList.filter(function(item){return item.uniqueIdentifier!==resumableFile.uniqueIdentifier;});var uploadFileList=_this.state.uploadFileList.map(function(item){if(item.uniqueIdentifier===resumableFile.uniqueIdentifier){item.error=null;_this.retryUploadFile(item);}return item;});_this.setState({retryFileList:retryFileList,uploadFileList:uploadFileList});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.retryUploadFile=function(resumableFile){var _this$props3=_this.props,repoID=_this$props3.repoID,path=_this$props3.path;var fileName=resumableFile.fileName;var isFile=resumableFile.fileName===resumableFile.relativePath;if(!isFile){var relative_path=resumableFile.formData.relative_path;var prefix=path==='/'?path+relative_path:path+'/'+relative_path;fileName=prefix+fileName;}resumableFile.bootstrap();var firedRetry=false;resumableFile.resumableObj.on('chunkingComplete',function(){if(!firedRetry){seafileAPI.getFileUploadedBytes(repoID,path,fileName).then(function(res){var uploadedBytes=res.data.uploadedBytes;var blockSize=parseInt(resumableUploadFileBlockSize)*1024*1024||1024*1024;var offset=Math.floor(uploadedBytes/blockSize);resumableFile.markChunksCompleted(offset);resumableFile.resumableObj.upload();}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});}firedRetry=true;});};_this.replaceRepetitionFile=function(){var _this$props4=_this.props,repoID=_this$props4.repoID,path=_this$props4.path;seafileAPI.getUpdateLink(repoID,path).then(function(res){_this.resumable.opts.target=res.data;var resumableFile=_this.resumable.files[_this.resumable.files.length-1];resumableFile.formData['replace']=1;resumableFile.formData['target_file']=resumableFile.formData.parent_dir+resumableFile.fileName;_this.setUploadFileList(_this.resumable.files);_this.resumable.upload();}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.cancelFileUpload=function(){_this.resumable.files.pop();//delete latest file；\n};_this.state={retryFileList:[],uploadFileList:[],forbidUploadFileList:[],totalProgress:0,isUploadProgressDialogShow:false,currentResumableFile:null,uploadBitrate:0};_this.uploadInput=/*#__PURE__*/React.createRef();_this.notifiedFolders=[];_this.timestamp=null;_this.loaded=0;_this.bitrateInterval=500;// Interval in milliseconds to calculate the bitrate\n_this.isUploadLinkLoaded=false;window.onbeforeunload=_this.onbeforeunload;return _this;}_createClass(FileUploader,[{key:\"componentDidMount\",value:function componentDidMount(){this.resumable=new Resumablejs({target:'',query:this.setQuery||{},fileType:this.props.filetypes,maxFiles:maxNumberOfFilesForFileupload||undefined,maxFileSize:maxUploadFileSize*1000*1000||undefined,testMethod:this.props.testMethod||'post',testChunks:this.props.testChunks||false,headers:this.setHeaders||{},withCredentials:this.props.withCredentials||false,chunkSize:parseInt(resumableUploadFileBlockSize)*1024*1024||1*1024*1024,simultaneousUploads:this.props.simultaneousUploads||1,fileParameterName:this.props.fileParameterName,generateUniqueIdentifier:this.generateUniqueIdentifier,forceChunkSize:true,maxChunkRetries:3,minFileSize:0});this.resumable.assignBrowse(this.uploadInput.current,true);if(this.props.dragAndDrop){this.resumable.assignDrop(document.getElementById('upload-link-drop-zone'));}this.bindCallbackHandler();this.bindEventHandler();}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"file-uploader-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"file-uploader\",children:/*#__PURE__*/_jsx(\"input\",{className:\"upload-input\",type:\"file\",ref:this.uploadInput,onClick:this.onClick,\"aria-label\":gettext('Upload')})})}),/*#__PURE__*/_jsx(UploadProgressDialog,{retryFileList:this.state.retryFileList,uploadFileList:this.state.uploadFileList,forbidUploadFileList:this.state.forbidUploadFileList,totalProgress:this.state.totalProgress,uploadBitrate:this.state.uploadBitrate,onCloseUploadDialog:this.onCloseUploadDialog,onCancelAllUploading:this.onCancelAllUploading,onUploadCancel:this.onUploadCancel,onUploadRetry:this.onUploadRetry,onFileUpload:this.onFileUpload,onFolderUpload:this.onFolderUpload,isUploading:this.resumable?this.resumable.isUploading():false})]});}}]);return FileUploader;}(React.Component);export default FileUploader;","map":{"version":3,"names":["React","Fragment","Resumablejs","MD5","resumableUploadFileBlockSize","maxUploadFileSize","maxNumberOfFilesForFileupload","seafileAPI","Utils","gettext","UploadProgressDialog","toaster","jsx","_jsx","jsxs","_jsxs","FileUploader","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","componentWillUnmount","window","onbeforeunload","dragAndDrop","resumable","disableDropOnDocument","uploader","isUploadProgressDialogShow","totalProgress","bindCallbackHandler","_this$props","minFileSizeErrorCallback","fileTypeErrorCallback","maxFilesErrorCallback","opts","maxFileSizeErrorCallback","bindEventHandler","on","onChunkingComplete","bind","_assertThisInitialized","onFileAdded","onFileProgress","onFileUploadSuccess","onFileError","onUploadStart","onProgress","onComplete","onError","onDragStart","files","errorCount","maxFiles","message","replace","danger","file","forbidUploadFileList","state","push","setState","resumableFile","path","fileName","relativePath","isFile","formData","parent_dir","relative_path","slice","lastIndexOf","length","hasRepetition","isUploadRemindDialogShow","currentResumableFile","setUploadFileList","sharedUploadLinkGetFileUploadUrl","token","then","res","target","data","upload_link","resumableUpload","catch","error","errMessage","getErrorMsg","isUploadLinkLoaded","upload","_this$props2","repoID","getFileUploadedBytes","uploadedBytes","blockSize","parseInt","offset","Math","floor","markChunksCompleted","filesAddedComplete","uploadFileList","registerGlobalVariable","uploadBitrate","getBitrate","map","item","uniqueIdentifier","lastSize","size","progress","time","remainingTime","loaded","now","Date","getTime","forEach","timestamp","timeDiff","bitrateInterval","round","currentTime","JSON","parse","dir_name","indexOf","dirent","id","name","type","mtime","isExist","notifiedFolders","some","newFileName","isSaved","errorMessage","retryFileList","msg","setHeaders","chunkSize","getOpt","fileSize","startByte","endByte","min","headers","encodeURI","setQuery","generateUniqueIdentifier","webkitRelativePath","onClick","e","nativeEvent","stopImmediatePropagation","stopPropagation","onFileUpload","uploadInput","current","removeAttribute","click","onFolderUpload","setAttribute","onCloseUploadDialog","onUploadCancel","uploadingItem","filter","cancel","isUploading","onCancelAllUploading","onUploadRetry","retryUploadFile","_this$props3","prefix","bootstrap","firedRetry","resumableObj","replaceRepetitionFile","_this$props4","getUpdateLink","cancelFileUpload","pop","createRef","_createClass","key","value","componentDidMount","query","fileType","filetypes","undefined","maxFileSize","testMethod","testChunks","withCredentials","simultaneousUploads","fileParameterName","forceChunkSize","maxChunkRetries","minFileSize","assignBrowse","assignDrop","document","getElementById","render","children","className","ref","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/upload-link/file-uploader.js"],"sourcesContent":["// This file is copied from frontend/src/components/file-uploader/file-uploader.js,\n// and modified according to the requirements of this page.\nimport React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport Resumablejs from '@seafile/resumablejs';\nimport MD5 from 'MD5';\nimport { resumableUploadFileBlockSize, maxUploadFileSize, maxNumberOfFilesForFileupload } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\nimport { gettext } from '../../utils/constants';\nimport UploadProgressDialog from './upload-progress-dialog';\nimport toaster from '../../components/toast';\n\nimport '../../css/file-uploader.css';\n\nconst propTypes = {\n  dragAndDrop: PropTypes.bool.isRequired,\n  token: PropTypes.string.isRequired,\n  repoID: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired,\n\n  filetypes: PropTypes.array,\n  chunkSize: PropTypes.number,\n  withCredentials: PropTypes.bool,\n  testMethod: PropTypes.string,\n  testChunks: PropTypes.number,\n  simultaneousUploads: PropTypes.number,\n  fileParameterName: PropTypes.string,\n  minFileSizeErrorCallback: PropTypes.func,\n  fileTypeErrorCallback: PropTypes.func,\n  onFileUploadSuccess: PropTypes.func.isRequired,\n};\n\nclass FileUploader extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      retryFileList: [],\n      uploadFileList: [],\n      forbidUploadFileList: [],\n      totalProgress: 0,\n      isUploadProgressDialogShow: false,\n      currentResumableFile: null,\n      uploadBitrate: 0,\n    };\n\n    this.uploadInput = React.createRef();\n\n    this.notifiedFolders = [];\n\n    this.timestamp = null;\n    this.loaded = 0;\n    this.bitrateInterval = 500; // Interval in milliseconds to calculate the bitrate\n    this.isUploadLinkLoaded = false;\n\n    window.onbeforeunload = this.onbeforeunload;\n  }\n\n  componentDidMount() {\n    this.resumable = new Resumablejs({\n      target: '',\n      query: this.setQuery || {},\n      fileType: this.props.filetypes,\n      maxFiles: maxNumberOfFilesForFileupload || undefined,\n      maxFileSize: maxUploadFileSize * 1000 * 1000 || undefined,\n      testMethod: this.props.testMethod || 'post',\n      testChunks: this.props.testChunks || false,\n      headers: this.setHeaders || {},\n      withCredentials: this.props.withCredentials || false,\n      chunkSize: parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1 * 1024 * 1024,\n      simultaneousUploads: this.props.simultaneousUploads || 1,\n      fileParameterName: this.props.fileParameterName,\n      generateUniqueIdentifier: this.generateUniqueIdentifier,\n      forceChunkSize: true,\n      maxChunkRetries: 3,\n      minFileSize: 0,\n    });\n\n    this.resumable.assignBrowse(this.uploadInput.current, true);\n    if (this.props.dragAndDrop) {\n      this.resumable.assignDrop(document.getElementById('upload-link-drop-zone'));\n    }\n\n    this.bindCallbackHandler();\n    this.bindEventHandler();\n  }\n\n  componentWillUnmount = () => {\n    window.onbeforeunload = null;\n    if (this.props.dragAndDrop === true) {\n      this.resumable.disableDropOnDocument();\n    }\n  };\n\n  onbeforeunload = () => {\n    if (window.uploader &&\n        window.uploader.isUploadProgressDialogShow &&\n        window.uploader.totalProgress !== 100) {\n      return '';\n    }\n  };\n\n  bindCallbackHandler = () => {\n    let { minFileSizeErrorCallback, fileTypeErrorCallback } = this.props;\n\n    if (this.maxFilesErrorCallback) {\n      this.resumable.opts.maxFilesErrorCallback = this.maxFilesErrorCallback;\n    }\n\n    if (minFileSizeErrorCallback) {\n      this.resumable.opts.minFileSizeErrorCallback = this.props.minFileSizeErrorCallback;\n    }\n\n    if (this.maxFileSizeErrorCallback) {\n      this.resumable.opts.maxFileSizeErrorCallback = this.maxFileSizeErrorCallback;\n    }\n\n    if (fileTypeErrorCallback) {\n      this.resumable.opts.fileTypeErrorCallback = this.props.fileTypeErrorCallback;\n    }\n\n  };\n\n  bindEventHandler = () => {\n    this.resumable.on('chunkingComplete', this.onChunkingComplete.bind(this));\n    this.resumable.on('fileAdded', this.onFileAdded.bind(this));\n    this.resumable.on('fileProgress', this.onFileProgress.bind(this));\n    this.resumable.on('fileSuccess', this.onFileUploadSuccess.bind(this));\n    this.resumable.on('fileError', this.onFileError.bind(this));\n    this.resumable.on('uploadStart', this.onUploadStart.bind(this));\n    this.resumable.on('progress', this.onProgress.bind(this));\n    this.resumable.on('complete', this.onComplete.bind(this));\n    this.resumable.on('error', this.onError.bind(this));\n    this.resumable.on('dragstart', this.onDragStart.bind(this));\n  };\n\n  maxFilesErrorCallback = (files, errorCount) => {\n    let maxFiles = maxNumberOfFilesForFileupload;\n    let message = gettext('Please upload no more than {maxFiles} files at a time.');\n    message = message.replace('{maxFiles}', maxFiles);\n    toaster.danger(message);\n  };\n\n  maxFileSizeErrorCallback = (file) => {\n    let { forbidUploadFileList } = this.state;\n    forbidUploadFileList.push(file);\n    this.setState({forbidUploadFileList: forbidUploadFileList});\n  };\n\n  onChunkingComplete = (resumableFile) => {\n    let path = this.props.path;\n    let fileName = resumableFile.fileName;\n    let relativePath = resumableFile.relativePath;\n    let isFile = fileName === relativePath;\n\n    resumableFile.formData = {};\n    if (isFile) { // upload file\n      resumableFile.formData  = {\n        parent_dir: path,\n      };\n    } else { // upload folder\n      let relative_path = relativePath.slice(0, relativePath.lastIndexOf('/') + 1);\n      resumableFile.formData  = {\n        parent_dir: path,\n        relative_path: relative_path\n      };\n    }\n  };\n\n  onFileAdded = (resumableFile, files) => {\n    let isFile = resumableFile.fileName === resumableFile.relativePath;\n    if (isFile && files.length === 1) {\n      let hasRepetition = false;\n      /*\n      let direntList = this.props.direntList;\n      for (let i = 0; i < direntList.length; i++) {\n        if (direntList[i].type === 'file' && direntList[i].name === resumableFile.fileName) {\n          hasRepetition = true;\n          break;\n        }\n      }\n      */\n      if (hasRepetition) {\n        this.setState({\n          isUploadRemindDialogShow: true,\n          currentResumableFile: resumableFile,\n        });\n      } else {\n        this.setUploadFileList(this.resumable.files);\n        seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n          this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n          this.resumableUpload(resumableFile);\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    } else {\n      this.setUploadFileList(this.resumable.files);\n      if (!this.isUploadLinkLoaded) {\n        this.isUploadLinkLoaded = true;\n        seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n          this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n          this.resumable.upload();\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n    }\n  };\n\n  resumableUpload = (resumableFile) => {\n    let { repoID, path } = this.props;\n    seafileAPI.getFileUploadedBytes(repoID, path, resumableFile.fileName).then(res => {\n      let uploadedBytes = res.data.uploadedBytes;\n      let blockSize = parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1024 * 1024;\n      let offset = Math.floor(uploadedBytes / blockSize);\n      resumableFile.markChunksCompleted(offset);\n      this.resumable.upload();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  filesAddedComplete = (resumable, files) => {\n    let { forbidUploadFileList } = this.state;\n    if (forbidUploadFileList.length > 0 && files.length === 0) {\n      this.setState({\n        isUploadProgressDialogShow: true,\n        totalProgress: 100\n      });\n    }\n  };\n\n  setUploadFileList = () => {\n    let uploadFileList = this.resumable.files;\n    this.setState({\n      uploadFileList: uploadFileList,\n      isUploadProgressDialogShow: true,\n    });\n    Utils.registerGlobalVariable('uploader', 'isUploadProgressDialogShow', true);\n  };\n\n  onFileProgress = (resumableFile) => {\n    let uploadBitrate = this.getBitrate();\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        if (uploadBitrate) {\n          let lastSize = (item.size - (item.size * item.progress())) * 8;\n          let time = Math.floor(lastSize / uploadBitrate);\n          item.remainingTime = time;\n        }\n      }\n      return item;\n    });\n\n    this.setState({\n      uploadBitrate: uploadBitrate,\n      uploadFileList: uploadFileList\n    });\n  };\n\n  getBitrate = () => {\n    let loaded = 0;\n    let uploadBitrate = 0;\n    let now = new Date().getTime();\n\n    this.resumable.files.forEach(file => {\n      loaded += file.progress() * file.size;\n    });\n\n    if (this.timestamp) {\n      let timeDiff = (now - this.timestamp);\n      if (timeDiff < this.bitrateInterval) {\n        return this.state.uploadBitrate;\n      }\n\n      // 1. Cancel will produce loaded greater than this.loaded\n      // 2. reset can make this.loaded to be 0\n      if (loaded < this.loaded || this.loaded === 0) {\n        this.loaded = loaded; //\n      }\n\n      uploadBitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;\n    }\n\n    this.timestamp = now;\n    this.loaded = loaded;\n\n    return uploadBitrate;\n  };\n\n  // start uploading\n  onUploadStart = () => {\n    /*\n    const message = gettext('File upload started');\n    toaster.notify(message);\n    */\n  };\n\n  onProgress = () => {\n    let progress = Math.round(this.resumable.progress() * 100);\n    this.setState({totalProgress: progress});\n    Utils.registerGlobalVariable('uploader', 'totalProgress', progress);\n  };\n\n  onFileUploadSuccess = (resumableFile, message) => {\n    let formData = resumableFile.formData;\n    let currentTime = new Date().getTime()/1000;\n    message = formData.replace ? message : JSON.parse(message)[0];\n    if (formData.relative_path) { // upload folder\n      let relative_path = formData.relative_path;\n      let dir_name = relative_path.slice(0, relative_path.indexOf('/'));\n      let dirent = {\n        id: message.id,\n        name: dir_name,\n        type: 'dir',\n        mtime: currentTime,\n      };\n\n      // update folders cache\n      let isExist = this.notifiedFolders.some(item => {return item.name === dirent.name;});\n      if (!isExist) {\n        this.notifiedFolders.push(dirent);\n        this.props.onFileUploadSuccess(dirent);\n      }\n\n      // update uploadFileList\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.newFileName = relative_path + message.name;\n          item.isSaved = true;\n        }\n        return item;\n      });\n      this.setState({uploadFileList: uploadFileList});\n\n      return;\n    }\n\n    if (formData.replace) { // upload file -- replace exist file\n      let fileName = resumableFile.fileName;\n      let dirent = {\n        id: message,\n        name: fileName,\n        type: 'file',\n        mtime: currentTime\n      };\n      this.props.onFileUploadSuccess(dirent); // this contance: just one file\n\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.newFileName = fileName;\n          item.isSaved = true;\n        }\n        return item;\n      });\n      this.setState({uploadFileList: uploadFileList});\n\n      return;\n    }\n\n    // upload file -- add files\n    let dirent = {\n      id: message.id,\n      type: 'file',\n      name: message.name,\n      size: message.size,\n      mtime: currentTime,\n    };\n    this.props.onFileUploadSuccess(dirent);\n\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        item.newFileName = message.name;\n        item.isSaved = true;\n      }\n      return item;\n    });\n    this.setState({uploadFileList: uploadFileList});\n  };\n\n  onFileError = (resumableFile, message) => {\n    let error = '';\n    if (!message) {\n      error = gettext('Network error');\n    } else {\n      // eg: '{\"error\": \"Internal error\" \\n }'\n      let errorMessage = message.replace(/\\n/g, '');\n      errorMessage  = JSON.parse(errorMessage);\n      error = errorMessage.error;\n      if (error === 'File locked by others.') {\n        error = gettext('File is locked by others.');\n      }\n      if (error === 'Internal error.') {\n        error = gettext('Internal Server Error');\n      }\n    }\n\n    let uploadFileList = this.state.uploadFileList.map(item => {\n      if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n        this.state.retryFileList.push(item);\n        item.error = error;\n      }\n      return item;\n    });\n\n    this.loaded = 0;  // reset loaded data;\n    this.setState({\n      retryFileList: this.state.retryFileList,\n      uploadFileList: uploadFileList\n    });\n  };\n\n  onComplete = () => {\n    /*\n    if (!this.error) {\n      const message = gettext('All files uploaded');\n      toaster.success(message);\n    }\n    */\n    this.error = false; // reset it\n\n    this.notifiedFolders = [];\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n  };\n\n  onError = (message, file) => {\n    let msg = gettext('Error');\n    if (file && file.fileName) {\n      msg = gettext('Failed to upload {file_name}.')\n        .replace('{file_name}', file.fileName);\n    }\n    toaster.danger(msg, {'id': 'file-error-msg'});\n    this.error = true;\n\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    // After the error, the user can switch windows\n    Utils.registerGlobalVariable('uploader', 'totalProgress', 100);\n  };\n\n  setHeaders = (resumableFile, resumable) => {\n    let offset = resumable.offset;\n    let chunkSize = resumable.getOpt('chunkSize');\n    let fileSize = resumableFile.size === 0 ? 1 : resumableFile.size;\n    let startByte = offset !== 0 ? offset * chunkSize : 0;\n    let endByte = Math.min(fileSize, (offset + 1) * chunkSize) - 1;\n\n    if (fileSize - resumable.endByte < chunkSize && !resumable.getOpt('forceChunkSize')) {\n      endByte = fileSize;\n    }\n\n    let headers = {\n      'Accept': 'application/json; text/javascript, */*; q=0.01',\n      'Content-Disposition': 'attachment; filename=\"' + encodeURI(resumableFile.fileName) + '\"',\n      'Content-Range': 'bytes ' + startByte + '-' + endByte + '/' + fileSize,\n    };\n\n    return headers;\n  };\n\n  setQuery = (resumableFile) => {\n    let formData = resumableFile.formData;\n    return formData;\n  };\n\n  generateUniqueIdentifier = (file) => {\n    let relativePath = file.webkitRelativePath||file.relativePath||file.fileName||file.name;\n    return MD5(relativePath + new Date()) + relativePath;\n  };\n\n  onClick = (e) => {\n    e.nativeEvent.stopImmediatePropagation();\n    e.stopPropagation();\n  };\n\n  onFileUpload = () => {\n    this.uploadInput.current.removeAttribute('webkitdirectory');\n    this.uploadInput.current.click();\n  };\n\n  onFolderUpload = () => {\n    this.uploadInput.current.setAttribute('webkitdirectory', 'webkitdirectory');\n    this.uploadInput.current.click();\n  };\n\n  onDragStart = () => {\n    this.uploadInput.current.setAttribute('webkitdirectory', 'webkitdirectory');\n  };\n\n  onCloseUploadDialog = () => {\n    this.loaded = 0;\n    this.resumable.files = [];\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n    this.setState({isUploadProgressDialogShow: false, uploadFileList: [], forbidUploadFileList: []});\n    Utils.registerGlobalVariable('uploader', 'isUploadProgressDialogShow', false);\n  };\n\n  onUploadCancel = (uploadingItem) => {\n\n    let uploadFileList = this.state.uploadFileList.filter(item => {\n      if (item.uniqueIdentifier === uploadingItem.uniqueIdentifier) {\n        item.cancel(); // execute cancel function will delete the file at the same time\n        return false;\n      }\n      return true;\n    });\n\n    if (!this.resumable.isUploading()) {\n      this.setState({\n        totalProgress: 100\n      });\n      this.loaded = 0;\n    }\n\n    this.setState({uploadFileList: uploadFileList});\n  };\n\n  onCancelAllUploading = () => {\n    let uploadFileList = this.state.uploadFileList.filter(item => {\n      if (Math.round(item.progress() !== 1)) {\n        item.cancel();\n        return false;\n      }\n      return true;\n    });\n\n    this.loaded = 0;\n\n    this.setState({\n      totalProgress: 100,\n      uploadFileList: uploadFileList\n    });\n    // reset upload link loaded\n    this.isUploadLinkLoaded = false;\n  };\n\n  onUploadRetry = (resumableFile) => {\n    seafileAPI.sharedUploadLinkGetFileUploadUrl(this.props.token).then(res => {\n      this.resumable.opts.target = res.data.upload_link + '?ret-json=1';\n      let retryFileList = this.state.retryFileList.filter(item => {\n        return item.uniqueIdentifier !== resumableFile.uniqueIdentifier;\n      });\n      let uploadFileList = this.state.uploadFileList.map(item => {\n        if (item.uniqueIdentifier === resumableFile.uniqueIdentifier) {\n          item.error = null;\n          this.retryUploadFile(item);\n        }\n        return item;\n      });\n\n      this.setState({\n        retryFileList: retryFileList,\n        uploadFileList: uploadFileList\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  retryUploadFile = (resumableFile) => {\n    let { repoID, path } = this.props;\n    let fileName = resumableFile.fileName;\n    let isFile = resumableFile.fileName === resumableFile.relativePath;\n    if (!isFile) {\n      let relative_path = resumableFile.formData.relative_path;\n      let prefix = path === '/' ? (path + relative_path) : (path + '/' + relative_path);\n      fileName = prefix + fileName;\n    }\n\n    resumableFile.bootstrap();\n    var firedRetry = false;\n    resumableFile.resumableObj.on('chunkingComplete', () => {\n      if(!firedRetry) {\n        seafileAPI.getFileUploadedBytes(repoID, path, fileName).then(res => {\n          let uploadedBytes = res.data.uploadedBytes;\n          let blockSize = parseInt(resumableUploadFileBlockSize) * 1024 * 1024 || 1024 * 1024;\n          let offset = Math.floor(uploadedBytes / blockSize);\n          resumableFile.markChunksCompleted(offset);\n\n          resumableFile.resumableObj.upload();\n\n        }).catch(error => {\n          let errMessage = Utils.getErrorMsg(error);\n          toaster.danger(errMessage);\n        });\n      }\n      firedRetry = true;\n    });\n\n  };\n\n  replaceRepetitionFile = () => {\n    let { repoID, path } = this.props;\n    seafileAPI.getUpdateLink(repoID, path).then(res => {\n      this.resumable.opts.target = res.data;\n\n      let resumableFile = this.resumable.files[this.resumable.files.length - 1];\n      resumableFile.formData['replace'] = 1;\n      resumableFile.formData['target_file'] = resumableFile.formData.parent_dir + resumableFile.fileName;\n      this.setUploadFileList(this.resumable.files);\n      this.resumable.upload();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  cancelFileUpload = () => {\n    this.resumable.files.pop(); //delete latest file；\n  };\n\n  render() {\n    return (\n      <Fragment>\n        <div className=\"file-uploader-container\">\n          <div className=\"file-uploader\">\n            <input className=\"upload-input\" type=\"file\" ref={this.uploadInput} onClick={this.onClick} aria-label={gettext('Upload')} />\n          </div>\n        </div>\n        <UploadProgressDialog\n          retryFileList={this.state.retryFileList}\n          uploadFileList={this.state.uploadFileList}\n          forbidUploadFileList={this.state.forbidUploadFileList}\n          totalProgress={this.state.totalProgress}\n          uploadBitrate={this.state.uploadBitrate}\n          onCloseUploadDialog={this.onCloseUploadDialog}\n          onCancelAllUploading={this.onCancelAllUploading}\n          onUploadCancel={this.onUploadCancel}\n          onUploadRetry={this.onUploadRetry}\n          onFileUpload={this.onFileUpload}\n          onFolderUpload={this.onFolderUpload}\n          isUploading={this.resumable ? this.resumable.isUploading() : false}\n        />\n      </Fragment>\n    );\n  }\n}\n\nFileUploader.propTypes = propTypes;\n\nexport default FileUploader;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}