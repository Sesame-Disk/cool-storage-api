{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import ReactDom from'react-dom';import{seafileAPI}from'./utils/seafile-api';import{gettext,mediaUrl}from'./utils/constants';import SharedFileView from'./components/shared-file-view/shared-file-view';import SharedFileViewTip from'./components/shared-file-view/shared-file-view-tip';import Loading from'./components/loading';import PDFViewer from'./components/pdf-viewer';import'./css/pdf-file-view.css';import{jsx as _jsx}from\"react/jsx-runtime\";var _window$shared$pageOp=window.shared.pageOptions,repoID=_window$shared$pageOp.repoID,filePath=_window$shared$pageOp.filePath,err=_window$shared$pageOp.err,commitID=_window$shared$pageOp.commitID,fileType=_window$shared$pageOp.fileType,sharedToken=_window$shared$pageOp.sharedToken;var SharedFileViewDocument=/*#__PURE__*/function(_React$Component){_inherits(SharedFileViewDocument,_React$Component);var _super=_createSuper(SharedFileViewDocument);function SharedFileViewDocument(){_classCallCheck(this,SharedFileViewDocument);return _super.apply(this,arguments);}_createClass(SharedFileViewDocument,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(SharedFileView,{content:/*#__PURE__*/_jsx(FileContent,{})});}}]);return SharedFileViewDocument;}(React.Component);var FileContent=/*#__PURE__*/function(_React$Component2){_inherits(FileContent,_React$Component2);var _super2=_createSuper(FileContent);function FileContent(props){var _this;_classCallCheck(this,FileContent);_this=_super2.call(this,props);_this.state={isLoading:!err,errorMsg:''};return _this;}_createClass(FileContent,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;if(err){return;}var queryStatus=function queryStatus(){seafileAPI.queryOfficeFileConvertStatus(repoID,commitID,filePath,fileType.toLowerCase(),sharedToken).then(function(res){var convertStatus=res.data['status'];switch(convertStatus){case'PROCESSING':_this2.setState({isLoading:true});setTimeout(queryStatus,2000);break;case'ERROR':_this2.setState({isLoading:false,errorMsg:gettext('Document convertion failed.')});break;case'DONE':_this2.setState({isLoading:false,errorMsg:''});// eslint-disable-next-line\nvar scriptNode=document.createElement('script');scriptNode.type='text/javascript';scriptNode.src=\"\".concat(mediaUrl,\"js/pdf/web/viewer.js\");document.body.append(scriptNode);}}).catch(function(error){if(error.response){_this2.setState({isLoading:false,errorMsg:gettext('Document convertion failed.')});}else{_this2.setState({isLoading:false,errorMsg:gettext('Please check the network.')});}});};queryStatus();}},{key:\"render\",value:function render(){var _this$state=this.state,isLoading=_this$state.isLoading,errorMsg=_this$state.errorMsg;if(err){return/*#__PURE__*/_jsx(SharedFileViewTip,{});}if(isLoading){return/*#__PURE__*/_jsx(Loading,{});}if(errorMsg){return/*#__PURE__*/_jsx(SharedFileViewTip,{errorMsg:errorMsg});}return/*#__PURE__*/_jsx(\"div\",{className:\"shared-file-view-body pdf-file-view\",children:/*#__PURE__*/_jsx(PDFViewer,{})});}}]);return FileContent;}(React.Component);ReactDom.render(/*#__PURE__*/_jsx(SharedFileViewDocument,{}),document.getElementById('wrapper'));","map":{"version":3,"names":["React","ReactDom","seafileAPI","gettext","mediaUrl","SharedFileView","SharedFileViewTip","Loading","PDFViewer","jsx","_jsx","_window$shared$pageOp","window","shared","pageOptions","repoID","filePath","err","commitID","fileType","sharedToken","SharedFileViewDocument","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","render","content","FileContent","Component","_React$Component2","_super2","props","_this","call","state","isLoading","errorMsg","componentDidMount","_this2","queryStatus","queryOfficeFileConvertStatus","toLowerCase","then","res","convertStatus","data","setState","setTimeout","scriptNode","document","createElement","type","src","concat","body","append","catch","error","response","_this$state","className","children","getElementById"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/shared-file-view-document.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport { seafileAPI } from './utils/seafile-api';\nimport { gettext, mediaUrl} from './utils/constants';\nimport SharedFileView from './components/shared-file-view/shared-file-view';\nimport SharedFileViewTip from './components/shared-file-view/shared-file-view-tip';\nimport Loading from './components/loading';\nimport PDFViewer from './components/pdf-viewer';\n\nimport './css/pdf-file-view.css';\n\nconst {\n  repoID, filePath, err,\n  commitID, fileType, sharedToken\n} = window.shared.pageOptions;\n\nclass SharedFileViewDocument extends React.Component {\n  render() {\n    return <SharedFileView content={<FileContent />} />;\n  }\n}\n\nclass FileContent extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: !err,\n      errorMsg: ''\n    };\n  }\n\n  componentDidMount() {\n    if (err) {\n      return;\n    }\n\n    let queryStatus = () => {\n      seafileAPI.queryOfficeFileConvertStatus(repoID, commitID, filePath, fileType.toLowerCase(), sharedToken).then((res) => {\n        const convertStatus = res.data['status'];\n        switch (convertStatus) {\n          case 'PROCESSING':\n            this.setState({\n              isLoading: true\n            });\n            setTimeout(queryStatus, 2000);\n            break;\n          case 'ERROR':\n            this.setState({\n              isLoading: false,\n              errorMsg: gettext('Document convertion failed.')\n            });\n            break;\n          case 'DONE':\n            this.setState({\n              isLoading: false,\n              errorMsg: ''\n            });\n            // eslint-disable-next-line\n            let scriptNode = document.createElement('script');\n            scriptNode.type = 'text/javascript';\n            scriptNode.src = `${mediaUrl}js/pdf/web/viewer.js`;\n            document.body.append(scriptNode);\n        }\n      }).catch((error) => {\n        if (error.response) {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Document convertion failed.')\n          });\n        } else {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Please check the network.')\n          });\n        }\n      });\n    };\n\n    queryStatus();\n  }\n\n  render() {\n    const { isLoading, errorMsg } = this.state;\n\n    if (err) {\n      return <SharedFileViewTip />;\n    }\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <SharedFileViewTip errorMsg={errorMsg} />;\n    }\n\n    return (\n      <div className=\"shared-file-view-body pdf-file-view\">\n        <PDFViewer />\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SharedFileViewDocument />, document.getElementById('wrapper'));\n"],"mappings":"wkBAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,QAAQ,KAAM,WAAW,CAChC,OAASC,UAAU,KAAQ,qBAAqB,CAChD,OAASC,OAAO,CAAEC,QAAQ,KAAO,mBAAmB,CACpD,MAAO,CAAAC,cAAc,KAAM,gDAAgD,CAC3E,MAAO,CAAAC,iBAAiB,KAAM,oDAAoD,CAClF,MAAO,CAAAC,OAAO,KAAM,sBAAsB,CAC1C,MAAO,CAAAC,SAAS,KAAM,yBAAyB,CAE/C,MAAO,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEjC,IAAAC,qBAAA,CAGIC,MAAM,CAACC,MAAM,CAACC,WAAW,CAF3BC,MAAM,CAAAJ,qBAAA,CAANI,MAAM,CAAEC,QAAQ,CAAAL,qBAAA,CAARK,QAAQ,CAAEC,GAAG,CAAAN,qBAAA,CAAHM,GAAG,CACrBC,QAAQ,CAAAP,qBAAA,CAARO,QAAQ,CAAEC,QAAQ,CAAAR,qBAAA,CAARQ,QAAQ,CAAEC,WAAW,CAAAT,qBAAA,CAAXS,WAAW,CACH,GAExB,CAAAC,sBAAsB,uBAAAC,gBAAA,EAAAC,SAAA,CAAAF,sBAAA,CAAAC,gBAAA,MAAAE,MAAA,CAAAC,YAAA,CAAAJ,sBAAA,WAAAA,uBAAA,EAAAK,eAAA,MAAAL,sBAAA,SAAAG,MAAA,CAAAG,KAAA,MAAAC,SAAA,GAAAC,YAAA,CAAAR,sBAAA,GAAAS,GAAA,UAAAC,KAAA,CAC1B,SAAAC,OAAA,CAAS,CACP,mBAAOtB,IAAA,CAACL,cAAc,EAAC4B,OAAO,cAAEvB,IAAA,CAACwB,WAAW,GAAE,CAAE,CAAE,CAAC,CACrD,CAAC,WAAAb,sBAAA,GAHkCrB,KAAK,CAACmC,SAAS,KAM9C,CAAAD,WAAW,uBAAAE,iBAAA,EAAAb,SAAA,CAAAW,WAAA,CAAAE,iBAAA,MAAAC,OAAA,CAAAZ,YAAA,CAAAS,WAAA,EAEf,SAAAA,YAAYI,KAAK,CAAE,KAAAC,KAAA,CAAAb,eAAA,MAAAQ,WAAA,EACjBK,KAAA,CAAAF,OAAA,CAAAG,IAAA,MAAMF,KAAK,EACXC,KAAA,CAAKE,KAAK,CAAG,CACXC,SAAS,CAAE,CAACzB,GAAG,CACf0B,QAAQ,CAAE,EACZ,CAAC,CAAC,OAAAJ,KAAA,CACJ,CAACV,YAAA,CAAAK,WAAA,GAAAJ,GAAA,qBAAAC,KAAA,CAED,SAAAa,kBAAA,CAAoB,KAAAC,MAAA,MAClB,GAAI5B,GAAG,CAAE,CACP,OACF,CAEA,GAAI,CAAA6B,WAAW,CAAG,QAAd,CAAAA,WAAWA,CAAA,CAAS,CACtB5C,UAAU,CAAC6C,4BAA4B,CAAChC,MAAM,CAAEG,QAAQ,CAAEF,QAAQ,CAAEG,QAAQ,CAAC6B,WAAW,CAAC,CAAC,CAAE5B,WAAW,CAAC,CAAC6B,IAAI,CAAC,SAACC,GAAG,CAAK,CACrH,GAAM,CAAAC,aAAa,CAAGD,GAAG,CAACE,IAAI,CAAC,QAAQ,CAAC,CACxC,OAAQD,aAAa,EACnB,IAAK,YAAY,CACfN,MAAI,CAACQ,QAAQ,CAAC,CACZX,SAAS,CAAE,IACb,CAAC,CAAC,CACFY,UAAU,CAACR,WAAW,CAAE,IAAI,CAAC,CAC7B,MACF,IAAK,OAAO,CACVD,MAAI,CAACQ,QAAQ,CAAC,CACZX,SAAS,CAAE,KAAK,CAChBC,QAAQ,CAAExC,OAAO,CAAC,6BAA6B,CACjD,CAAC,CAAC,CACF,MACF,IAAK,MAAM,CACT0C,MAAI,CAACQ,QAAQ,CAAC,CACZX,SAAS,CAAE,KAAK,CAChBC,QAAQ,CAAE,EACZ,CAAC,CAAC,CACF;AACA,GAAI,CAAAY,UAAU,CAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CACjDF,UAAU,CAACG,IAAI,CAAG,iBAAiB,CACnCH,UAAU,CAACI,GAAG,IAAAC,MAAA,CAAMxD,QAAQ,wBAAsB,CAClDoD,QAAQ,CAACK,IAAI,CAACC,MAAM,CAACP,UAAU,CAAC,CACpC,CACF,CAAC,CAAC,CAACQ,KAAK,CAAC,SAACC,KAAK,CAAK,CAClB,GAAIA,KAAK,CAACC,QAAQ,CAAE,CAClBpB,MAAI,CAACQ,QAAQ,CAAC,CACZX,SAAS,CAAE,KAAK,CAChBC,QAAQ,CAAExC,OAAO,CAAC,6BAA6B,CACjD,CAAC,CAAC,CACJ,CAAC,IAAM,CACL0C,MAAI,CAACQ,QAAQ,CAAC,CACZX,SAAS,CAAE,KAAK,CAChBC,QAAQ,CAAExC,OAAO,CAAC,2BAA2B,CAC/C,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CACJ,CAAC,CAED2C,WAAW,CAAC,CAAC,CACf,CAAC,GAAAhB,GAAA,UAAAC,KAAA,CAED,SAAAC,OAAA,CAAS,CACP,IAAAkC,WAAA,CAAgC,IAAI,CAACzB,KAAK,CAAlCC,SAAS,CAAAwB,WAAA,CAATxB,SAAS,CAAEC,QAAQ,CAAAuB,WAAA,CAARvB,QAAQ,CAE3B,GAAI1B,GAAG,CAAE,CACP,mBAAOP,IAAA,CAACJ,iBAAiB,GAAE,CAAC,CAC9B,CAEA,GAAIoC,SAAS,CAAE,CACb,mBAAOhC,IAAA,CAACH,OAAO,GAAE,CAAC,CACpB,CAEA,GAAIoC,QAAQ,CAAE,CACZ,mBAAOjC,IAAA,CAACJ,iBAAiB,EAACqC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CAClD,CAEA,mBACEjC,IAAA,QAAKyD,SAAS,CAAC,qCAAqC,CAAAC,QAAA,cAClD1D,IAAA,CAACF,SAAS,GAAE,CAAC,CACV,CAAC,CAEV,CAAC,WAAA0B,WAAA,GAhFuBlC,KAAK,CAACmC,SAAS,EAmFzClC,QAAQ,CAAC+B,MAAM,cAACtB,IAAA,CAACW,sBAAsB,GAAE,CAAC,CAAEmC,QAAQ,CAACa,cAAc,CAAC,SAAS,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}