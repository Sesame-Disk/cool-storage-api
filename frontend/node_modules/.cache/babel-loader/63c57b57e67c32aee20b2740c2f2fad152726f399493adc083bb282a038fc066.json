{"ast":null,"code":"import _toConsumableArray from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import{gettext,PER_PAGE,filePath}from'../../utils/constants';import editUtilities from'../../utils/editor-utilities';import Loading from'../../components/loading';import HistoryListView from'../../components/history-list-view/history-list-view';import toaster from'../../components/toast';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SidePanel=/*#__PURE__*/function(_React$Component){_inherits(SidePanel,_React$Component);var _super=_createSuper(SidePanel);function SidePanel(props){var _this;_classCallCheck(this,SidePanel);_this=_super.call(this,props);_this.reloadMore=function(){if(!_this.state.isReloadingData){var currentPage=_this.state.currentPage+1;_this.setState({currentPage:currentPage,isReloadingData:true});editUtilities.listFileHistoryRecords(filePath,currentPage,PER_PAGE).then(function(res){_this.updateResultState(res.data);_this.setState({isReloadingData:false});});}};_this.onItemRestore=function(currentItem){var commitId=currentItem.commit_id;editUtilities.revertFile(filePath,commitId).then(function(res){if(res.data.success){_this.setState({isLoading:true});_this.refershFileList();}var message=gettext('Successfully restored.');toaster.success(message);});};_this.onItemClick=function(item,preItem){_this.props.onItemClick(item,preItem);};_this.state={historyInfo:'',currentPage:1,hasMore:false,isLoading:true,isError:false,fileOwner:'',isReloadingData:false};return _this;}_createClass(SidePanel,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;editUtilities.listFileHistoryRecords(filePath,1,PER_PAGE).then(function(res){var historyList=res.data;if(historyList.length===0){_this2.setState({isLoading:false});throw Error('there has an error in server');}_this2.initResultState(res.data);});}},{key:\"refershFileList\",value:function refershFileList(){var _this3=this;editUtilities.listFileHistoryRecords(filePath,1,PER_PAGE).then(function(res){_this3.initResultState(res.data);});}},{key:\"initResultState\",value:function initResultState(result){if(result.data.length){this.setState({historyInfo:result.data,currentPage:result.page,hasMore:result.total_count>PER_PAGE*this.state.currentPage,isLoading:false,isError:false,fileOwner:result.data[0].creator_email});}}},{key:\"updateResultState\",value:function updateResultState(result){if(result.data.length){this.setState({historyInfo:[].concat(_toConsumableArray(this.state.historyInfo),_toConsumableArray(result.data)),currentPage:result.page,hasMore:result.total_count>PER_PAGE*this.state.currentPage,isLoading:false,isError:false,fileOwner:result.data[0].creator_email});}}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"div\",{className:\"side-panel history-side-panel\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"side-panel-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"history-side-panel-title\",children:gettext('History Versions')}),/*#__PURE__*/_jsxs(\"div\",{className:\"history-body\",children:[this.state.isLoading&&/*#__PURE__*/_jsx(Loading,{}),this.state.historyInfo&&/*#__PURE__*/_jsx(HistoryListView,{hasMore:this.state.hasMore,isReloadingData:this.state.isReloadingData,historyList:this.state.historyInfo,reloadMore:this.reloadMore,onItemClick:this.onItemClick,onItemRestore:this.onItemRestore})]})]})});}}]);return SidePanel;}(React.Component);export default SidePanel;","map":{"version":3,"names":["React","gettext","PER_PAGE","filePath","editUtilities","Loading","HistoryListView","toaster","jsx","_jsx","jsxs","_jsxs","SidePanel","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","reloadMore","state","isReloadingData","currentPage","setState","listFileHistoryRecords","then","res","updateResultState","data","onItemRestore","currentItem","commitId","commit_id","revertFile","success","isLoading","refershFileList","message","onItemClick","item","preItem","historyInfo","hasMore","isError","fileOwner","_createClass","key","value","componentDidMount","_this2","historyList","length","Error","initResultState","_this3","result","page","total_count","creator_email","concat","_toConsumableArray","render","className","children","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/file-history/side-panel.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { gettext, PER_PAGE, filePath } from '../../utils/constants';\nimport editUtilities from '../../utils/editor-utilities';\nimport Loading from '../../components/loading';\nimport HistoryListView from '../../components/history-list-view/history-list-view';\nimport toaster from '../../components/toast';\n\nconst propTypes = {\n  onItemClick: PropTypes.func.isRequired,\n};\n\nclass SidePanel extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      historyInfo: '',\n      currentPage: 1,\n      hasMore: false,\n      isLoading: true,\n      isError: false,\n      fileOwner: '',\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      let historyList = res.data;\n      if (historyList.length === 0) {\n        this.setState({isLoading: false});\n        throw Error('there has an error in server');\n      }\n      this.initResultState(res.data);\n    });\n  }\n\n  refershFileList() {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      this.initResultState(res.data);\n    });\n  }\n\n  initResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: result.data,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email,\n      });\n    }\n  }\n\n  updateResultState(result) {\n    if (result.data.length) {\n      this.setState({\n        historyInfo: [...this.state.historyInfo, ...result.data],\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n        isError: false,\n        fileOwner: result.data[0].creator_email\n      });\n    }\n  }\n\n  reloadMore = () => {\n    if (!this.state.isReloadingData) {\n      let currentPage = this.state.currentPage + 1;\n      this.setState({\n        currentPage: currentPage,\n        isReloadingData: true,\n      });\n      editUtilities.listFileHistoryRecords(filePath, currentPage, PER_PAGE).then(res => {\n        this.updateResultState(res.data);\n        this.setState({isReloadingData: false});\n      });\n    }\n  };\n\n  onItemRestore = (currentItem) => {\n    let commitId = currentItem.commit_id;\n    editUtilities.revertFile(filePath, commitId).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n      let message = gettext('Successfully restored.');\n      toaster.success(message);\n    });\n  };\n\n  onItemClick =(item, preItem) => {\n    this.props.onItemClick(item, preItem);\n  };\n\n  render() {\n    return (\n      <div className=\"side-panel history-side-panel\">\n        <div className=\"side-panel-center\">\n          <div className=\"history-side-panel-title\">{gettext('History Versions')}</div>\n          <div className=\"history-body\">\n            {this.state.isLoading && <Loading />}\n            {this.state.historyInfo &&\n              <HistoryListView\n                hasMore={this.state.hasMore}\n                isReloadingData={this.state.isReloadingData}\n                historyList={this.state.historyInfo}\n                reloadMore={this.reloadMore}\n                onItemClick={this.onItemClick}\n                onItemRestore={this.onItemRestore}\n              />\n            }\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = propTypes;\n\nexport default SidePanel;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}