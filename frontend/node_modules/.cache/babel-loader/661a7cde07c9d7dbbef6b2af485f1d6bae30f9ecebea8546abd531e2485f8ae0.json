{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import ReactDom from'react-dom';import{seafileAPI}from'./utils/seafile-api';import{siteRoot,gettext}from'./utils/constants';import FileView from'./components/file-view/file-view';import FileViewTip from'./components/file-view/file-view-tip';import Loading from'./components/loading';import'./css/spreadsheet-file-view.css';import{jsx as _jsx}from\"react/jsx-runtime\";var _window$app$pageOptio=window.app.pageOptions,repoID=_window$app$pageOptio.repoID,filePath=_window$app$pageOptio.filePath,err=_window$app$pageOptio.err,commitID=_window$app$pageOptio.commitID,fileType=_window$app$pageOptio.fileType,fileName=_window$app$pageOptio.fileName;var ViewFileSpreadsheet=/*#__PURE__*/function(_React$Component){_inherits(ViewFileSpreadsheet,_React$Component);var _super=_createSuper(ViewFileSpreadsheet);function ViewFileSpreadsheet(){_classCallCheck(this,ViewFileSpreadsheet);return _super.apply(this,arguments);}_createClass(ViewFileSpreadsheet,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(FileView,{content:/*#__PURE__*/_jsx(FileContent,{})});}}]);return ViewFileSpreadsheet;}(React.Component);var FileContent=/*#__PURE__*/function(_React$Component2){_inherits(FileContent,_React$Component2);var _super2=_createSuper(FileContent);function FileContent(props){var _this;_classCallCheck(this,FileContent);_this=_super2.call(this,props);_this.setIframeHeight=function(e){var iframe=e.currentTarget;iframe.height=iframe.contentDocument.body.scrollHeight;};_this.state={isLoading:!err,errorMsg:''};return _this;}_createClass(FileContent,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;if(err){return;}var queryStatus=function queryStatus(){seafileAPI.queryOfficeFileConvertStatus(repoID,commitID,filePath,fileType.toLowerCase()).then(function(res){var convertStatus=res.data['status'];switch(convertStatus){case'QUEUED':case'PROCESSING':_this2.setState({isLoading:true});setTimeout(queryStatus,2000);break;case'ERROR':_this2.setState({isLoading:false,errorMsg:gettext('Document convertion failed.')});break;case'DONE':_this2.setState({isLoading:false,errorMsg:''});}}).catch(function(error){if(error.response){_this2.setState({isLoading:false,errorMsg:gettext('Document convertion failed.')});}else{_this2.setState({isLoading:false,errorMsg:gettext('Please check the network.')});}});};queryStatus();}},{key:\"render\",value:function render(){var _this$state=this.state,isLoading=_this$state.isLoading,errorMsg=_this$state.errorMsg;if(err){return/*#__PURE__*/_jsx(FileViewTip,{});}if(isLoading){return/*#__PURE__*/_jsx(Loading,{});}if(errorMsg){return/*#__PURE__*/_jsx(FileViewTip,{errorMsg:errorMsg});}return/*#__PURE__*/_jsx(\"div\",{className:\"file-view-content flex-1 spreadsheet-file-view\",children:/*#__PURE__*/_jsx(\"iframe\",{id:\"spreadsheet-container\",title:fileName,src:\"\".concat(siteRoot,\"office-convert/static/\").concat(repoID,\"/\").concat(commitID).concat(encodeURIComponent(filePath),\"/index.html\"),onLoad:this.setIframeHeight})});}}]);return FileContent;}(React.Component);ReactDom.render(/*#__PURE__*/_jsx(ViewFileSpreadsheet,{}),document.getElementById('wrapper'));","map":{"version":3,"names":["React","ReactDom","seafileAPI","siteRoot","gettext","FileView","FileViewTip","Loading","jsx","_jsx","_window$app$pageOptio","window","app","pageOptions","repoID","filePath","err","commitID","fileType","fileName","ViewFileSpreadsheet","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","render","content","FileContent","Component","_React$Component2","_super2","props","_this","call","setIframeHeight","e","iframe","currentTarget","height","contentDocument","body","scrollHeight","state","isLoading","errorMsg","componentDidMount","_this2","queryStatus","queryOfficeFileConvertStatus","toLowerCase","then","res","convertStatus","data","setState","setTimeout","catch","error","response","_this$state","className","children","id","title","src","concat","encodeURIComponent","onLoad","document","getElementById"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/view-file-spreadsheet.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport { seafileAPI } from './utils/seafile-api';\nimport { siteRoot, gettext } from './utils/constants';\nimport FileView from './components/file-view/file-view';\nimport FileViewTip from './components/file-view/file-view-tip';\nimport Loading from './components/loading';\n\nimport './css/spreadsheet-file-view.css';\n\nconst {\n  repoID, filePath, err,\n  commitID, fileType, fileName\n} = window.app.pageOptions;\n\nclass ViewFileSpreadsheet extends React.Component {\n  render() {\n    return (\n      <FileView content={<FileContent />} />\n    );\n  }\n}\n\nclass FileContent extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: !err,\n      errorMsg: ''\n    };\n  }\n\n  componentDidMount() {\n    if (err) {\n      return;\n    }\n\n    let queryStatus = () => {\n      seafileAPI.queryOfficeFileConvertStatus(repoID, commitID, filePath, fileType.toLowerCase()).then((res) => {\n        const convertStatus = res.data['status'];\n        switch (convertStatus) {\n          case 'QUEUED':\n          case 'PROCESSING':\n            this.setState({\n              isLoading: true\n            });\n            setTimeout(queryStatus, 2000);\n            break;\n          case 'ERROR':\n            this.setState({\n              isLoading: false,\n              errorMsg: gettext('Document convertion failed.')\n            });\n            break;\n          case 'DONE':\n            this.setState({\n              isLoading: false,\n              errorMsg: ''\n            });\n        }\n      }).catch((error) => {\n        if (error.response) {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Document convertion failed.')\n          });\n        } else {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Please check the network.')\n          });\n        }\n      });\n    };\n\n    queryStatus();\n  }\n\n  setIframeHeight = (e) => {\n    const iframe = e.currentTarget;\n    iframe.height = iframe.contentDocument.body.scrollHeight;\n  };\n\n  render() {\n    const { isLoading, errorMsg } = this.state;\n\n    if (err) {\n      return <FileViewTip />;\n    }\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <FileViewTip errorMsg={errorMsg} />;\n    }\n\n    return (\n      <div className=\"file-view-content flex-1 spreadsheet-file-view\">\n        <iframe id=\"spreadsheet-container\" title={fileName} src={`${siteRoot}office-convert/static/${repoID}/${commitID}${encodeURIComponent(filePath)}/index.html`} onLoad={this.setIframeHeight}></iframe>\n      </div>\n    );\n  }\n}\n\nReactDom.render(<ViewFileSpreadsheet />, document.getElementById('wrapper'));\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}