{"ast":null,"code":"import { ReactEditor } from '@seafile/slate-react';\nimport context from '../../context';\nimport { useScrollContext } from '../hooks/use-scroll-context';\nexport var getSelectionRange = function getSelectionRange() {\n  if (window.getSelection) {\n    var sel = window.getSelection();\n    if (sel.getRangeAt && sel.rangeCount) {\n      return sel.getRangeAt(0);\n    }\n  } else if (document.selection && document.selection.createRange) {\n    return document.selection.createRange();\n  }\n  return null;\n};\nexport var getCursorPosition = function getCursorPosition() {\n  var x = 0;\n  var y = 0;\n  var range = getSelectionRange();\n  if (range) {\n    var rect = range.getBoundingClientRect();\n    var headerHeight = 93;\n    x = rect.x || 0;\n    y = rect.y - headerHeight + (rect.height - 24) / 2 || 0;\n  }\n  return {\n    x: x,\n    y: y\n  };\n};\nexport var useCursorPosition = function useCursorPosition() {\n  var scrollRef = useScrollContext();\n  var _ref = scrollRef.current || {},\n    _ref$scrollTop = _ref.scrollTop,\n    scrollTop = _ref$scrollTop === void 0 ? 0 : _ref$scrollTop;\n  var position = getCursorPosition();\n  if (position.y !== 0) {\n    position.y = position.y + scrollTop;\n  }\n  return position;\n};\nexport var getAvatarUrl = function getAvatarUrl() {\n  var server = context.getSetting('serviceUrl');\n  var avatarUrl = \"\".concat(server, \"/media/avatars/default.png\");\n  return avatarUrl;\n};\nexport var getElementCommentCountTop = function getElementCommentCountTop(editor, element, scrollTop) {\n  var minY;\n  var children = element.children || [];\n  children.forEach(function (child) {\n    var childDom = ReactEditor.toDOMNode(editor, child);\n\n    // use child real dom\n    var childRealDom = childDom.childNodes[0];\n    var _ref2 = childRealDom ? childRealDom.getBoundingClientRect() : {\n        y: 0\n      },\n      y = _ref2.y;\n    if (!minY) minY = y;\n    minY = Math.min(minY, y);\n  });\n  return minY - 93 + scrollTop; // 100: header height(56) + toolbar height(37)\n};","map":{"version":3,"names":["ReactEditor","context","useScrollContext","getSelectionRange","window","getSelection","sel","getRangeAt","rangeCount","document","selection","createRange","getCursorPosition","x","y","range","rect","getBoundingClientRect","headerHeight","height","useCursorPosition","scrollRef","_ref","current","_ref$scrollTop","scrollTop","position","getAvatarUrl","server","getSetting","avatarUrl","concat","getElementCommentCountTop","editor","element","minY","children","forEach","child","childDom","toDOMNode","childRealDom","childNodes","_ref2","Math","min"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/comment/helper.js"],"sourcesContent":["import { ReactEditor } from '@seafile/slate-react';\nimport context from '../../context';\nimport { useScrollContext } from '../hooks/use-scroll-context';\nexport const getSelectionRange = () => {\n  if (window.getSelection) {\n    const sel = window.getSelection();\n    if (sel.getRangeAt && sel.rangeCount) {\n      return sel.getRangeAt(0);\n    }\n  } else if (document.selection && document.selection.createRange) {\n    return document.selection.createRange();\n  }\n  return null;\n};\nexport const getCursorPosition = () => {\n  let x = 0;\n  let y = 0;\n  let range = getSelectionRange();\n  if (range) {\n    const rect = range.getBoundingClientRect();\n    const headerHeight = 93;\n    x = rect.x || 0;\n    y = rect.y - headerHeight + (rect.height - 24) / 2 || 0;\n  }\n  return {\n    x: x,\n    y: y\n  };\n};\nexport const useCursorPosition = () => {\n  const scrollRef = useScrollContext();\n  const {\n    scrollTop = 0\n  } = scrollRef.current || {};\n  let position = getCursorPosition();\n  if (position.y !== 0) {\n    position.y = position.y + scrollTop;\n  }\n  return position;\n};\nexport const getAvatarUrl = () => {\n  const server = context.getSetting('serviceUrl');\n  const avatarUrl = \"\".concat(server, \"/media/avatars/default.png\");\n  return avatarUrl;\n};\nexport const getElementCommentCountTop = (editor, element, scrollTop) => {\n  let minY;\n  const children = element.children || [];\n  children.forEach(child => {\n    const childDom = ReactEditor.toDOMNode(editor, child);\n\n    // use child real dom\n    const childRealDom = childDom.childNodes[0];\n    const {\n      y\n    } = childRealDom ? childRealDom.getBoundingClientRect() : {\n      y: 0\n    };\n    if (!minY) minY = y;\n    minY = Math.min(minY, y);\n  });\n  return minY - 93 + scrollTop; // 100: header height(56) + toolbar height(37)\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}