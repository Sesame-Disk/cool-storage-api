{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import{Utils}from'../../utils/utils';import SelectEditor from'./select-editor';import{seafileAPI}from'../../utils/seafile-api';import CustomPermission from'../../models/custom-permission';import toaster from'../toast';import{isPro}from'../../utils/constants';import{jsx as _jsx}from\"react/jsx-runtime\";var SharePermissionEditor=/*#__PURE__*/function(_React$Component){_inherits(SharePermissionEditor,_React$Component);var _super=_createSuper(SharePermissionEditor);function SharePermissionEditor(props){var _this;_classCallCheck(this,SharePermissionEditor);_this=_super.call(this,props);_this.listCustomPermissions=function(){var _this$props=_this.props,repoID=_this$props.repoID,isSysAdmin=_this$props.isSysAdmin;if(isSysAdmin){_this.setState({isLoading:false,customPermissions:[]});return;}var cacheData=localStorage.getItem(_this.CACHE_KEY);if(cacheData){var _JSON$parse=JSON.parse(cacheData),permissions=_JSON$parse.permission_list;var customPermissions=permissions.map(function(item){return new CustomPermission(item);});_this.setState({isLoading:false,customPermissions:customPermissions});return;}seafileAPI.listCustomPermissions(repoID).then(function(res){var permissions=res.data.permission_list;localStorage.setItem(_this.CACHE_KEY,JSON.stringify(res.data));var customPermissions=permissions.map(function(item){return new CustomPermission(item);});_this.setState({isLoading:false,customPermissions:customPermissions});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);_this.setState({isLoading:false});});};_this.translatePermission=function(permission){var value=Utils.sharePerms(permission);if(!value){var customPermissions=_this.state.customPermissions;var item=customPermissions.find(function(item){return item.id+''===permission;});value=item&&item.name;}return value;};_this.translateExplanation=function(explanation){var value=Utils.sharePermsExplanation(explanation);if(!value){var customPermissions=_this.state.customPermissions;var item=customPermissions.find(function(item){return item.id+''===explanation;});value=item&&item.description;}return value;};_this.getPermissions=function(){var permissions=_this.props.permissions;var newPermissions=permissions.slice();var customPermissions=_this.state.customPermissions;if(!_this.customPermissions){if(customPermissions.length>0){customPermissions.forEach(function(item){newPermissions.push(item.id+'');});}_this.customPermissions=newPermissions;}return _this.customPermissions;};_this.state={isLoading:true,customPermissions:[]};_this.customPermissions=null;var _repoID=_this.props.repoID;_this.CACHE_KEY=_repoID?\"custom_permissions_\".concat(_repoID):'';return _this;}_createClass(SharePermissionEditor,[{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.repoID&&isPro){this.listCustomPermissions();}else{this.setState({isLoading:false,customPermissions:[]});}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){isPro&&localStorage.removeItem(this.CACHE_KEY);}},{key:\"render\",value:function render(){var isLoading=this.state.isLoading;if(isLoading){return null;}return/*#__PURE__*/_jsx(SelectEditor,{isTextMode:this.props.isTextMode,isEditing:this.props.isEditing,isEditIconShow:this.props.isEditIconShow,autoFocus:this.props.autoFocus,options:this.getPermissions(),currentOption:this.props.currentPermission,onOptionChanged:this.props.onPermissionChanged,translateOption:this.translatePermission,translateExplanation:this.translateExplanation,enableAddCustomPermission:this.props.enableAddCustomPermission,onAddCustomPermissionToggle:this.props.onAddCustomPermissionToggle});}}]);return SharePermissionEditor;}(React.Component);SharePermissionEditor.defaultProps={isEditing:false,autoFocus:false};export default SharePermissionEditor;","map":{"version":3,"names":["React","Utils","SelectEditor","seafileAPI","CustomPermission","toaster","isPro","jsx","_jsx","SharePermissionEditor","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","listCustomPermissions","_this$props","repoID","isSysAdmin","setState","isLoading","customPermissions","cacheData","localStorage","getItem","CACHE_KEY","_JSON$parse","JSON","parse","permissions","permission_list","map","item","then","res","data","setItem","stringify","catch","error","errMessage","getErrorMsg","danger","translatePermission","permission","value","sharePerms","state","find","id","name","translateExplanation","explanation","sharePermsExplanation","description","getPermissions","newPermissions","slice","length","forEach","push","concat","_createClass","key","componentDidMount","componentWillUnmount","removeItem","render","isTextMode","isEditing","isEditIconShow","autoFocus","options","currentOption","currentPermission","onOptionChanged","onPermissionChanged","translateOption","enableAddCustomPermission","onAddCustomPermissionToggle","Component","defaultProps"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/select-editor/share-permission-editor.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Utils } from '../../utils/utils';\nimport SelectEditor from './select-editor';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport CustomPermission from '../../models/custom-permission';\nimport toaster from '../toast';\nimport { isPro } from '../../utils/constants';\n\nconst propTypes = {\n  repoID: PropTypes.string,\n  isTextMode: PropTypes.bool.isRequired,\n  isEditing: PropTypes.bool,\n  autoFocus: PropTypes.bool,\n  isEditIconShow: PropTypes.bool.isRequired,\n  permissions: PropTypes.array.isRequired,\n  currentPermission: PropTypes.string.isRequired,\n  onPermissionChanged: PropTypes.func.isRequired,\n  enableAddCustomPermission: PropTypes.bool,\n  onAddCustomPermissionToggle: PropTypes.func,\n  isSysAdmin: PropTypes.bool,\n};\n\nclass SharePermissionEditor extends React.Component {\n\n  static defaultProps = {\n    isEditing: false,\n    autoFocus: false,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      customPermissions: []\n    };\n\n    this.customPermissions = null;\n    const { repoID } = this.props;\n    this.CACHE_KEY = repoID ? `custom_permissions_${repoID}` : '';\n  }\n\n  componentDidMount() {\n    if (this.props.repoID && isPro) {\n      this.listCustomPermissions();\n    } else {\n      this.setState({\n        isLoading: false,\n        customPermissions: [],\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    isPro && localStorage.removeItem(this.CACHE_KEY);\n  }\n\n  listCustomPermissions = () => {\n    const { repoID, isSysAdmin } = this.props;\n    if (isSysAdmin) {\n      this.setState({\n        isLoading: false,\n        customPermissions: []\n      });\n      return;\n    }\n    const cacheData = localStorage.getItem(this.CACHE_KEY);\n    if (cacheData) {\n      const { permission_list: permissions } = JSON.parse(cacheData);\n      const customPermissions = permissions.map(item => new CustomPermission(item));\n      this.setState({\n        isLoading: false,\n        customPermissions: customPermissions\n      });\n      return;\n    }\n\n    seafileAPI.listCustomPermissions(repoID).then(res => {\n      const { permission_list: permissions } = res.data;\n      localStorage.setItem(this.CACHE_KEY, JSON.stringify(res.data));\n      const customPermissions = permissions.map(item => new CustomPermission(item));\n      this.setState({\n        isLoading: false,\n        customPermissions: customPermissions\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n      this.setState({isLoading: false});\n    });\n  };\n\n  translatePermission = (permission) => {\n    let value = Utils.sharePerms(permission);\n    if (!value) {\n      const { customPermissions } = this.state;\n      const item = customPermissions.find(item => item.id + '' === permission);\n      value = item && item.name;\n    }\n    return value;\n  };\n\n  translateExplanation = (explanation) => {\n    let value = Utils.sharePermsExplanation(explanation);\n    if (!value) {\n      const { customPermissions } = this.state;\n      const item = customPermissions.find(item => item.id + '' === explanation);\n      value = item && item.description;\n    }\n    return value;\n  };\n\n  getPermissions = () => {\n    const { permissions } = this.props;\n    let newPermissions = permissions.slice();\n    const { customPermissions } = this.state;\n    if (!this.customPermissions) {\n      if (customPermissions.length > 0) {\n        customPermissions.forEach(item => {\n          newPermissions.push(item.id + '');\n        });\n      }\n      this.customPermissions = newPermissions;\n    }\n    return this.customPermissions;\n  };\n\n  render() {\n\n    const { isLoading } = this.state;\n    if (isLoading) {\n      return null;\n    }\n\n    return (\n      <SelectEditor\n        isTextMode={this.props.isTextMode}\n        isEditing={this.props.isEditing}\n        isEditIconShow={this.props.isEditIconShow}\n        autoFocus={this.props.autoFocus}\n        options={this.getPermissions()}\n        currentOption={this.props.currentPermission}\n        onOptionChanged={this.props.onPermissionChanged}\n        translateOption={this.translatePermission}\n        translateExplanation={this.translateExplanation}\n        enableAddCustomPermission={this.props.enableAddCustomPermission}\n        onAddCustomPermissionToggle={this.props.onAddCustomPermissionToggle}\n      />\n    );\n  }\n}\n\nSharePermissionEditor.propTypes = propTypes;\n\nexport default SharePermissionEditor;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}