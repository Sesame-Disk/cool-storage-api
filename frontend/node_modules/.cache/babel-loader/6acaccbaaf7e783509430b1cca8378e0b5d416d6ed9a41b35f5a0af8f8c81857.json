{"ast":null,"code":"import _objectSpread from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component,Fragment}from'react';import{Form,FormGroup,Input,Label,Col}from'reactstrap';import{Utils}from'../../../utils/utils';import{seafileAPI}from'../../../utils/seafile-api';import{gettext}from'../../../utils/constants';import toaster from'../../../components/toast';import MainPanelTopbar from'../main-panel-topbar';import Content from'./orgs-content';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SearchOrgs=/*#__PURE__*/function(_Component){_inherits(SearchOrgs,_Component);var _super=_createSuper(SearchOrgs);function SearchOrgs(props){var _this;_classCallCheck(this,SearchOrgs);_this=_super.call(this,props);_this.getItems=function(){seafileAPI.sysAdminSearchOrgs(_this.state.query.trim()).then(function(res){_this.setState({loading:false,orgList:res.data.organization_list});}).catch(function(error){_this.setState({loading:false,errorMsg:Utils.getErrorMsg(error,true)// true: show login tip if 403\n});});};_this.updateRole=function(orgID,role){var orgInfo={};orgInfo.role=role;seafileAPI.sysAdminUpdateOrg(orgID,orgInfo).then(function(res){var newOrgList=_this.state.orgList.map(function(org){if(org.org_id==orgID){org.role=role;}return org;});_this.setState({orgList:newOrgList});toaster.success(gettext('Edit succeeded'));}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.deleteOrg=function(orgID){seafileAPI.sysAdminDeleteOrg(orgID).then(function(res){var orgList=_this.state.orgList.filter(function(org){return org.org_id!=orgID;});_this.setState({orgList:orgList});toaster.success(gettext('Successfully deleted 1 item.'));}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.handleInputChange=function(e){_this.setState({query:e.target.value},_this.checkSubmitBtnActive);};_this.checkSubmitBtnActive=function(){var query=_this.state.query;_this.setState({isSubmitBtnActive:query.trim()});};_this.handleKeyDown=function(e){if(e.keyCode===13){var isSubmitBtnActive=_this.state.isSubmitBtnActive;if(isSubmitBtnActive){_this.getItems();}}};_this.state={query:'',isSubmitBtnActive:false,loading:true,errorMsg:'',orgList:[]};return _this;}_createClass(SearchOrgs,[{key:\"componentDidMount\",value:function componentDidMount(){var params=new URL(document.location).searchParams;this.setState({query:params.get('query')||''},this.getItems);}},{key:\"render\",value:function render(){var _this$state=this.state,query=_this$state.query,isSubmitBtnActive=_this$state.isSubmitBtnActive;return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MainPanelTopbar,_objectSpread({},this.props)),/*#__PURE__*/_jsx(\"div\",{className:\"main-panel-center flex-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"cur-view-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cur-view-path\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"sf-heading\",children:gettext('Organizations')})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cur-view-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"border-bottom font-weight-normal mb-2 pb-1\",children:gettext('Search Organizations')}),/*#__PURE__*/_jsx(\"p\",{className:\"text-secondary small\",children:gettext('Tip: you can search by keyword in name.')}),/*#__PURE__*/_jsxs(Form,{tag:'div',children:[/*#__PURE__*/_jsxs(FormGroup,{row:true,children:[/*#__PURE__*/_jsx(Label,{for:\"name\",sm:1,children:gettext('Name')}),/*#__PURE__*/_jsx(Col,{sm:5,children:/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"query\",id:\"name\",value:query,onChange:this.handleInputChange,onKeyDown:this.handleKeyDown})})]}),/*#__PURE__*/_jsx(FormGroup,{row:true,children:/*#__PURE__*/_jsx(Col,{sm:{size:5,offset:1},children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-primary\",disabled:!isSubmitBtnActive,onClick:this.getItems,children:gettext('Submit')})})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"border-bottom font-weight-normal mb-2 pb-1\",children:gettext('Result')}),/*#__PURE__*/_jsx(Content,{loading:this.state.loading,errorMsg:this.state.errorMsg,items:this.state.orgList,updateRole:this.updateRole,deleteOrg:this.deleteOrg})]})]})]})})]});}}]);return SearchOrgs;}(Component);export default SearchOrgs;","map":{"version":3,"names":["React","Component","Fragment","Form","FormGroup","Input","Label","Col","Utils","seafileAPI","gettext","toaster","MainPanelTopbar","Content","jsx","_jsx","jsxs","_jsxs","SearchOrgs","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","getItems","sysAdminSearchOrgs","state","query","trim","then","res","setState","loading","orgList","data","organization_list","catch","error","errorMsg","getErrorMsg","updateRole","orgID","role","orgInfo","sysAdminUpdateOrg","newOrgList","map","org","org_id","success","errMessage","danger","deleteOrg","sysAdminDeleteOrg","filter","handleInputChange","e","target","value","checkSubmitBtnActive","isSubmitBtnActive","handleKeyDown","keyCode","_createClass","key","componentDidMount","params","URL","document","location","searchParams","get","render","_this$state","children","_objectSpread","className","tag","row","for","sm","type","name","id","onChange","onKeyDown","size","offset","disabled","onClick","items"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/sys-admin/orgs/search-orgs.js"],"sourcesContent":["import React, { Component, Fragment } from 'react';\nimport { Form, FormGroup, Input, Label, Col } from 'reactstrap';\nimport { Utils } from '../../../utils/utils';\nimport { seafileAPI } from '../../../utils/seafile-api';\nimport { gettext } from '../../../utils/constants';\nimport toaster from '../../../components/toast';\nimport MainPanelTopbar from '../main-panel-topbar';\nimport Content from './orgs-content';\n\n\nclass SearchOrgs extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      query: '',\n      isSubmitBtnActive: false,\n      loading: true,\n      errorMsg: '',\n      orgList: []\n    };\n  }\n\n  componentDidMount () {\n    let params = (new URL(document.location)).searchParams;\n    this.setState({\n      query: params.get('query') || ''\n    }, this.getItems);\n  }\n\n  getItems = () => {\n    seafileAPI.sysAdminSearchOrgs(this.state.query.trim()).then(res => {\n      this.setState({\n        loading: false,\n        orgList: res.data.organization_list\n      });\n    }).catch((error) => {\n      this.setState({\n        loading: false,\n        errorMsg: Utils.getErrorMsg(error, true) // true: show login tip if 403\n      });\n    });\n  };\n\n  updateRole = (orgID, role) => {\n    let orgInfo = {};\n    orgInfo.role = role;\n    seafileAPI.sysAdminUpdateOrg(orgID, orgInfo).then(res => {\n      let newOrgList = this.state.orgList.map(org => {\n        if (org.org_id == orgID) {\n          org.role = role;\n        }\n        return org;\n      });\n      this.setState({orgList: newOrgList});\n      toaster.success(gettext('Edit succeeded'));\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  deleteOrg = (orgID) => {\n    seafileAPI.sysAdminDeleteOrg(orgID).then(res => {\n      let orgList = this.state.orgList.filter(org => {\n        return org.org_id != orgID;\n      });\n      this.setState({orgList: orgList});\n      toaster.success(gettext('Successfully deleted 1 item.'));\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  handleInputChange = (e) => {\n    this.setState({\n      query: e.target.value\n    }, this.checkSubmitBtnActive);\n  };\n\n  checkSubmitBtnActive = () => {\n    const { query } = this.state;\n    this.setState({\n      isSubmitBtnActive: query.trim()\n    });\n  };\n\n  handleKeyDown = (e) => {\n    if (e.keyCode === 13) {\n      const { isSubmitBtnActive } = this.state;\n      if (isSubmitBtnActive) {\n        this.getItems();\n      }\n    }\n  };\n\n  render() {\n    const { query, isSubmitBtnActive } = this.state;\n    return (\n      <Fragment>\n        <MainPanelTopbar {...this.props} />\n        <div className=\"main-panel-center flex-row\">\n          <div className=\"cur-view-container\">\n            <div className=\"cur-view-path\">\n              <h3 className=\"sf-heading\">{gettext('Organizations')}</h3>\n            </div>\n            <div className=\"cur-view-content\">\n              <div className=\"mt-4 mb-6\">\n                <h4 className=\"border-bottom font-weight-normal mb-2 pb-1\">{gettext('Search Organizations')}</h4>\n                <p className=\"text-secondary small\">{gettext('Tip: you can search by keyword in name.')}</p>\n                <Form tag={'div'}>\n                  <FormGroup row>\n                    <Label for=\"name\" sm={1}>{gettext('Name')}</Label>\n                    <Col sm={5}>\n                      <Input type=\"text\" name=\"query\" id=\"name\" value={query} onChange={this.handleInputChange} onKeyDown={this.handleKeyDown} />\n                    </Col>\n                  </FormGroup>\n                  <FormGroup row>\n                    <Col sm={{size: 5, offset: 1}}>\n                      <button className=\"btn btn-outline-primary\" disabled={!isSubmitBtnActive} onClick={this.getItems}>{gettext('Submit')}</button>\n                    </Col>\n                  </FormGroup>\n                </Form>\n              </div>\n              <div className=\"mt-4 mb-6\">\n                <h4 className=\"border-bottom font-weight-normal mb-2 pb-1\">{gettext('Result')}</h4>\n                <Content\n                  loading={this.state.loading}\n                  errorMsg={this.state.errorMsg}\n                  items={this.state.orgList}\n                  updateRole={this.updateRole}\n                  deleteOrg={this.deleteOrg}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nexport default SearchOrgs;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}