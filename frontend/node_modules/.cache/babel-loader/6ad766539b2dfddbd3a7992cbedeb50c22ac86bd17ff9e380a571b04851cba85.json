{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\nvar _slicedToArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _toConsumableArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _createForOfIteratorHelper = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _slate = require(\"slate\");\nvar _slateReact = require(\"slate-react\");\nvar _elementTypes = require(\"../constants/element-types\");\nvar _prismjs = _interopRequireDefault(require(\"./prismjs\"));\nvar _normalizeTokens = require(\"./normalize-tokens\");\nvar _constant = require(\"../plugins/code-block/render-elem/constant\");\nvar mergeMaps = function mergeMaps() {\n  var map = new Map();\n  for (var _len = arguments.length, maps = new Array(_len), _key = 0; _key < _len; _key++) {\n    maps[_key] = arguments[_key];\n  }\n  for (var _i = 0, _maps = maps; _i < _maps.length; _i++) {\n    var m = _maps[_i];\n    var _iterator = _createForOfIteratorHelper(m),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var item = _step.value;\n        map.set.apply(map, _toConsumableArray(item));\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n  }\n  return map;\n};\nvar getChildNodeToDecorations = function getChildNodeToDecorations(_ref) {\n  var _ref2 = _slicedToArray(_ref, 2),\n    block = _ref2[0],\n    blockPath = _ref2[1];\n  var nodeToDecorations = new Map();\n  var text = block.children.map(function (line) {\n    return _slate.Node.string(line);\n  }).join('\\n');\n  var language = _constant.LANGUAGE_MAP[block.lang] ? block.lang : 'text';\n  var tokens = _prismjs.default.tokenize(text, _prismjs.default.languages[language]);\n  var normalizedTokens = (0, _normalizeTokens.normalizeTokens)(tokens); // make tokens flat and grouped by line\n  var blockChildren = block.children;\n  for (var index = 0; index < normalizedTokens.length; index++) {\n    var _tokens = normalizedTokens[index];\n    var element = blockChildren[index];\n    if (element) {\n      if (!nodeToDecorations.has(element)) {\n        nodeToDecorations.set(element, []);\n      }\n    }\n    var start = 0;\n    var _iterator2 = _createForOfIteratorHelper(_tokens),\n      _step2;\n    try {\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        var token = _step2.value;\n        var length = token.content.length;\n        if (!length) {\n          continue;\n        }\n        var end = start + length;\n        var path = [].concat(_toConsumableArray(blockPath), [index, 0]);\n        var range = _objectSpread({\n          anchor: {\n            path: path,\n            offset: start\n          },\n          focus: {\n            path: path,\n            offset: end\n          },\n          token: true\n        }, Object.fromEntries(token.types.map(function (type) {\n          return [type, true];\n        })));\n        if (nodeToDecorations.get(element)) {\n          nodeToDecorations.get(element).push(range);\n        }\n        start = end;\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n  }\n  return nodeToDecorations;\n};\nvar SetNodeToDecorations = function SetNodeToDecorations() {\n  var editor = (0, _slateReact.useSlate)();\n  var blockEntries = Array.from(_slate.Editor.nodes(editor, {\n    at: [],\n    mode: 'highest',\n    match: function match(n) {\n      return _slate.Element.isElement(n) && n.type === _elementTypes.CODE_BLOCK;\n    }\n  }));\n  var nodeToDecorations = mergeMaps.apply(void 0, _toConsumableArray(blockEntries.map(getChildNodeToDecorations)));\n  editor.nodeToDecorations = nodeToDecorations;\n  return null;\n};\nvar _default = exports.default = SetNodeToDecorations;","map":{"version":3,"names":["_objectSpread","require","default","_slicedToArray","_toConsumableArray","_createForOfIteratorHelper","_interopRequireDefault","Object","defineProperty","exports","value","_slate","_slateReact","_elementTypes","_prismjs","_normalizeTokens","_constant","mergeMaps","map","Map","_len","arguments","length","maps","Array","_key","_i","_maps","m","_iterator","_step","s","n","done","item","set","apply","err","e","f","getChildNodeToDecorations","_ref","_ref2","block","blockPath","nodeToDecorations","text","children","line","Node","string","join","language","LANGUAGE_MAP","lang","tokens","tokenize","languages","normalizedTokens","normalizeTokens","blockChildren","index","element","has","start","_iterator2","_step2","token","content","end","path","concat","range","anchor","offset","focus","fromEntries","types","type","get","push","SetNodeToDecorations","editor","useSlate","blockEntries","from","Editor","nodes","at","mode","match","Element","isElement","CODE_BLOCK","_default"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/seafile-editor/dist/extension/highlight/set-node-decorations.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _slate = require(\"slate\");\nvar _slateReact = require(\"slate-react\");\nvar _elementTypes = require(\"../constants/element-types\");\nvar _prismjs = _interopRequireDefault(require(\"./prismjs\"));\nvar _normalizeTokens = require(\"./normalize-tokens\");\nvar _constant = require(\"../plugins/code-block/render-elem/constant\");\nconst mergeMaps = function () {\n  const map = new Map();\n  for (var _len = arguments.length, maps = new Array(_len), _key = 0; _key < _len; _key++) {\n    maps[_key] = arguments[_key];\n  }\n  for (const m of maps) {\n    for (const item of m) {\n      map.set(...item);\n    }\n  }\n  return map;\n};\nconst getChildNodeToDecorations = _ref => {\n  let [block, blockPath] = _ref;\n  const nodeToDecorations = new Map();\n  const text = block.children.map(line => _slate.Node.string(line)).join('\\n');\n  const language = _constant.LANGUAGE_MAP[block.lang] ? block.lang : 'text';\n  const tokens = _prismjs.default.tokenize(text, _prismjs.default.languages[language]);\n  const normalizedTokens = (0, _normalizeTokens.normalizeTokens)(tokens); // make tokens flat and grouped by line\n  const blockChildren = block.children;\n  for (let index = 0; index < normalizedTokens.length; index++) {\n    const tokens = normalizedTokens[index];\n    const element = blockChildren[index];\n    if (element) {\n      if (!nodeToDecorations.has(element)) {\n        nodeToDecorations.set(element, []);\n      }\n    }\n    let start = 0;\n    for (const token of tokens) {\n      const length = token.content.length;\n      if (!length) {\n        continue;\n      }\n      const end = start + length;\n      const path = [...blockPath, index, 0];\n      const range = {\n        anchor: {\n          path,\n          offset: start\n        },\n        focus: {\n          path,\n          offset: end\n        },\n        token: true,\n        ...Object.fromEntries(token.types.map(type => [type, true]))\n      };\n      if (nodeToDecorations.get(element)) {\n        nodeToDecorations.get(element).push(range);\n      }\n      start = end;\n    }\n  }\n  return nodeToDecorations;\n};\nconst SetNodeToDecorations = () => {\n  const editor = (0, _slateReact.useSlate)();\n  const blockEntries = Array.from(_slate.Editor.nodes(editor, {\n    at: [],\n    mode: 'highest',\n    match: n => _slate.Element.isElement(n) && n.type === _elementTypes.CODE_BLOCK\n  }));\n  const nodeToDecorations = mergeMaps(...blockEntries.map(getChildNodeToDecorations));\n  editor.nodeToDecorations = nodeToDecorations;\n  return null;\n};\nvar _default = exports.default = SetNodeToDecorations;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}