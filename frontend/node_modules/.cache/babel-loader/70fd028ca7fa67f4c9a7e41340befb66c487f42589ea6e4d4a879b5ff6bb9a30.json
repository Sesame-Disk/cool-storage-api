{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _toConsumableArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _objectSpread = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.updateImage = exports.lazyLoadImage = exports.isMenuDisabled = exports.insertSeafileImage = exports.insertImage = exports.handleUpdateImage = exports.getImagesUrlList = void 0;\nvar _slate = require(\"slate\");\nvar _slugid = _interopRequireDefault(require(\"slugid\"));\nvar _helper = require(\"../header/helper\");\nvar _elementTypes = require(\"../../constants/element-types\");\nvar _core = require(\"../../core\");\nvar _helpers = require(\"../code-block/helpers\");\nvar isMenuDisabled = function isMenuDisabled(editor, readonly) {\n  if (readonly) return true;\n  var isHeader = (0, _helper.getHeaderType)(editor);\n  if (isHeader) return true;\n  if ((0, _helpers.isInCodeBlock)(editor)) return true;\n  return false;\n};\nexports.isMenuDisabled = isMenuDisabled;\nvar insertImage = function insertImage(editor, url, title) {\n  var imageNode = {\n    type: _elementTypes.IMAGE,\n    id: _slugid.default.nice(),\n    data: _objectSpread({\n      init: true,\n      src: url\n    }, title && {\n      title: title\n    }),\n    children: [(0, _core.generateDefaultText)()]\n  };\n  _slate.Transforms.insertNodes(editor, imageNode, {\n    at: editor.selection,\n    select: true\n  });\n  (0, _core.focusEditor)(editor);\n};\nexports.insertImage = insertImage;\nvar insertSeafileImage = function insertSeafileImage(_ref) {\n  var editor = _ref.editor,\n    url = _ref.url,\n    title = _ref.title,\n    selection = _ref.selection;\n  var imageNode = {\n    type: _elementTypes.IMAGE,\n    id: _slugid.default.nice(),\n    data: _objectSpread({\n      src: url\n    }, title && {\n      title: title\n    }),\n    children: [(0, _core.generateDefaultText)()]\n  };\n  _slate.Transforms.insertNodes(editor, imageNode, {\n    at: selection,\n    select: true\n  });\n};\nexports.insertSeafileImage = insertSeafileImage;\nvar updateImage = function updateImage(editor, data) {\n  _slate.Transforms.setNodes(editor, {\n    data: data\n  }, {\n    match: function match(n) {\n      return (0, _core.getNodeType)(n) === _elementTypes.IMAGE;\n    },\n    at: editor.selection,\n    voids: true\n  });\n};\nexports.updateImage = updateImage;\nvar getImagesUrlList = function getImagesUrlList(nodes) {\n  var nodeIndex = 0;\n  var list = [];\n  while (nodes && nodeIndex <= nodes.length - 1) {\n    var currentNode = nodes[nodeIndex];\n    if (currentNode.type === _elementTypes.IMAGE) {\n      var _currentNode$data = currentNode.data,\n        data = _currentNode$data === void 0 ? {} : _currentNode$data;\n      data.src && list.push(data.src);\n    } else {\n      list.push.apply(list, _toConsumableArray(getImagesUrlList(currentNode.children)));\n    }\n    nodeIndex++;\n  }\n  return list;\n};\nexports.getImagesUrlList = getImagesUrlList;\nvar handleUpdateImage = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(editor, file) {\n    var imgUrl;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if (!editor.api.uploadLocalImage) {\n            _context.next = 11;\n            break;\n          }\n          _context.prev = 1;\n          _context.next = 4;\n          return editor.api.uploadLocalImage(file);\n        case 4:\n          imgUrl = _context.sent;\n          insertImage(editor, imgUrl);\n          _context.next = 11;\n          break;\n        case 8:\n          _context.prev = 8;\n          _context.t0 = _context[\"catch\"](1);\n          console.log('error', _context.t0);\n        case 11:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee, null, [[1, 8]]);\n  }));\n  return function handleUpdateImage(_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexports.handleUpdateImage = handleUpdateImage;\nvar lazyLoadImage = function lazyLoadImage(url, resolve, reject) {\n  if (!url) {\n    reject('img path is require');\n    return;\n  }\n  var image = new Image();\n  image.onload = function () {\n    resolve(image);\n  };\n  image.onerror = function (e) {\n    reject(e);\n  };\n  image.src = url;\n};\nexports.lazyLoadImage = lazyLoadImage;","map":{"version":3,"names":["_regeneratorRuntime","require","default","_asyncToGenerator","_toConsumableArray","_objectSpread","_interopRequireDefault","Object","defineProperty","exports","value","updateImage","lazyLoadImage","isMenuDisabled","insertSeafileImage","insertImage","handleUpdateImage","getImagesUrlList","_slate","_slugid","_helper","_elementTypes","_core","_helpers","editor","readonly","isHeader","getHeaderType","isInCodeBlock","url","title","imageNode","type","IMAGE","id","nice","data","init","src","children","generateDefaultText","Transforms","insertNodes","at","selection","select","focusEditor","_ref","setNodes","match","n","getNodeType","voids","nodes","nodeIndex","list","length","currentNode","_currentNode$data","push","apply","_ref2","mark","_callee","file","imgUrl","wrap","_callee$","_context","prev","next","api","uploadLocalImage","sent","t0","console","log","stop","_x","_x2","arguments","resolve","reject","image","Image","onload","onerror","e"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/seafile-editor/dist/extension/plugins/image/helper.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.updateImage = exports.lazyLoadImage = exports.isMenuDisabled = exports.insertSeafileImage = exports.insertImage = exports.handleUpdateImage = exports.getImagesUrlList = void 0;\nvar _slate = require(\"slate\");\nvar _slugid = _interopRequireDefault(require(\"slugid\"));\nvar _helper = require(\"../header/helper\");\nvar _elementTypes = require(\"../../constants/element-types\");\nvar _core = require(\"../../core\");\nvar _helpers = require(\"../code-block/helpers\");\nconst isMenuDisabled = (editor, readonly) => {\n  if (readonly) return true;\n  const isHeader = (0, _helper.getHeaderType)(editor);\n  if (isHeader) return true;\n  if ((0, _helpers.isInCodeBlock)(editor)) return true;\n  return false;\n};\nexports.isMenuDisabled = isMenuDisabled;\nconst insertImage = (editor, url, title) => {\n  const imageNode = {\n    type: _elementTypes.IMAGE,\n    id: _slugid.default.nice(),\n    data: {\n      init: true,\n      src: url,\n      ...(title && {\n        title\n      })\n    },\n    children: [(0, _core.generateDefaultText)()]\n  };\n  _slate.Transforms.insertNodes(editor, imageNode, {\n    at: editor.selection,\n    select: true\n  });\n  (0, _core.focusEditor)(editor);\n};\nexports.insertImage = insertImage;\nconst insertSeafileImage = _ref => {\n  let {\n    editor,\n    url,\n    title,\n    selection\n  } = _ref;\n  const imageNode = {\n    type: _elementTypes.IMAGE,\n    id: _slugid.default.nice(),\n    data: {\n      src: url,\n      ...(title && {\n        title\n      })\n    },\n    children: [(0, _core.generateDefaultText)()]\n  };\n  _slate.Transforms.insertNodes(editor, imageNode, {\n    at: selection,\n    select: true\n  });\n};\nexports.insertSeafileImage = insertSeafileImage;\nconst updateImage = (editor, data) => {\n  _slate.Transforms.setNodes(editor, {\n    data\n  }, {\n    match: n => (0, _core.getNodeType)(n) === _elementTypes.IMAGE,\n    at: editor.selection,\n    voids: true\n  });\n};\nexports.updateImage = updateImage;\nconst getImagesUrlList = nodes => {\n  let nodeIndex = 0;\n  const list = [];\n  while (nodes && nodeIndex <= nodes.length - 1) {\n    const currentNode = nodes[nodeIndex];\n    if (currentNode.type === _elementTypes.IMAGE) {\n      const {\n        data = {}\n      } = currentNode;\n      data.src && list.push(data.src);\n    } else {\n      list.push(...getImagesUrlList(currentNode.children));\n    }\n    nodeIndex++;\n  }\n  return list;\n};\nexports.getImagesUrlList = getImagesUrlList;\nconst handleUpdateImage = async (editor, file) => {\n  if (editor.api.uploadLocalImage) {\n    try {\n      const imgUrl = await editor.api.uploadLocalImage(file);\n      insertImage(editor, imgUrl);\n    } catch (error) {\n      console.log('error', error);\n    }\n  }\n};\nexports.handleUpdateImage = handleUpdateImage;\nconst lazyLoadImage = (url, resolve, reject) => {\n  if (!url) {\n    reject('img path is require');\n    return;\n  }\n  const image = new Image();\n  image.onload = () => {\n    resolve(image);\n  };\n  image.onerror = e => {\n    reject(e);\n  };\n  image.src = url;\n};\nexports.lazyLoadImage = lazyLoadImage;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}