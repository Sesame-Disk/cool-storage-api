{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { Element, Transforms, Path } from '@seafile/slate';\nimport { LIST_ITEM } from '../../../constants';\nimport { getChildren, getNode, getPreviousPath, match } from '../../../core';\nimport { getListTypes } from '../queries';\nimport { moveListItemsToList, normalizeListItem, normalizeNestedList } from '../transforms';\nimport { generateEmptyListItem } from '../model';\nexport var normalizeList = function normalizeList(editor) {\n  var normalizeNode = editor.normalizeNode;\n  return function (_ref) {\n    var _ref3 = _slicedToArray(_ref, 2),\n      node = _ref3[0],\n      path = _ref3[1];\n    if (!Element.isElement(node)) {\n      return normalizeNode([node, path]);\n    }\n    var listTypes = getListTypes();\n\n    // root\n    if (listTypes.includes(node.type)) {\n      var children = getChildren([node, path]);\n      var nonLiChild = children.find(function (_ref2) {\n        var _ref4 = _slicedToArray(_ref2, 1),\n          child = _ref4[0];\n        return child.type !== LIST_ITEM;\n      });\n      if (nonLiChild) {\n        var listItem = generateEmptyListItem();\n        Transforms.wrapNodes(editor, listItem, {\n          at: nonLiChild[1]\n        });\n        return;\n      }\n    }\n    if (match(node, [], {\n      type: listTypes\n    })) {\n      if (!node.children.length || !node.children.find(function (item) {\n        return item.type === LIST_ITEM;\n      })) {\n        Transforms.removeNodes(editor, {\n          at: path\n        });\n        return;\n      }\n      var nextPath = Path.next(path);\n      var nextNode = getNode(editor, nextPath);\n      if ((nextNode === null || nextNode === void 0 ? void 0 : nextNode.type) === node.type) {\n        moveListItemsToList(editor, {\n          fromList: [nextNode, nextPath],\n          toList: [node, path],\n          deleteFromList: true\n        });\n      }\n      var prevPath = getPreviousPath(path);\n      var prevNode = getNode(editor, prevPath);\n      if ((prevNode === null || prevNode === void 0 ? void 0 : prevNode.type) === node.type) {\n        editor.normalizeNode([prevNode, prevPath]);\n        return;\n      }\n      if (normalizeNestedList(editor, {\n        nestedListItem: [node, path]\n      })) {\n        return;\n      }\n    }\n    if (node.type === LIST_ITEM) {\n      if (normalizeListItem(editor, {\n        listItem: [node, path]\n      })) {\n        return;\n      }\n    }\n    normalizeNode([node, path]);\n  };\n};","map":{"version":3,"names":["Element","Transforms","Path","LIST_ITEM","getChildren","getNode","getPreviousPath","match","getListTypes","moveListItemsToList","normalizeListItem","normalizeNestedList","generateEmptyListItem","normalizeList","editor","normalizeNode","_ref","_ref3","_slicedToArray","node","path","isElement","listTypes","includes","type","children","nonLiChild","find","_ref2","_ref4","child","listItem","wrapNodes","at","length","item","removeNodes","nextPath","next","nextNode","fromList","toList","deleteFromList","prevPath","prevNode","nestedListItem"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/list/plugin/normalize-list.js"],"sourcesContent":["import { Element, Transforms, Path } from '@seafile/slate';\nimport { LIST_ITEM } from '../../../constants';\nimport { getChildren, getNode, getPreviousPath, match } from '../../../core';\nimport { getListTypes } from '../queries';\nimport { moveListItemsToList, normalizeListItem, normalizeNestedList } from '../transforms';\nimport { generateEmptyListItem } from '../model';\nexport const normalizeList = editor => {\n  const {\n    normalizeNode\n  } = editor;\n  return _ref => {\n    let [node, path] = _ref;\n    if (!Element.isElement(node)) {\n      return normalizeNode([node, path]);\n    }\n    const listTypes = getListTypes();\n\n    // root\n    if (listTypes.includes(node.type)) {\n      const children = getChildren([node, path]);\n      const nonLiChild = children.find(_ref2 => {\n        let [child] = _ref2;\n        return child.type !== LIST_ITEM;\n      });\n      if (nonLiChild) {\n        const listItem = generateEmptyListItem();\n        Transforms.wrapNodes(editor, listItem, {\n          at: nonLiChild[1]\n        });\n        return;\n      }\n    }\n    if (match(node, [], {\n      type: listTypes\n    })) {\n      if (!node.children.length || !node.children.find(item => item.type === LIST_ITEM)) {\n        Transforms.removeNodes(editor, {\n          at: path\n        });\n        return;\n      }\n      const nextPath = Path.next(path);\n      const nextNode = getNode(editor, nextPath);\n      if ((nextNode === null || nextNode === void 0 ? void 0 : nextNode.type) === node.type) {\n        moveListItemsToList(editor, {\n          fromList: [nextNode, nextPath],\n          toList: [node, path],\n          deleteFromList: true\n        });\n      }\n      const prevPath = getPreviousPath(path);\n      const prevNode = getNode(editor, prevPath);\n      if ((prevNode === null || prevNode === void 0 ? void 0 : prevNode.type) === node.type) {\n        editor.normalizeNode([prevNode, prevPath]);\n        return;\n      }\n      if (normalizeNestedList(editor, {\n        nestedListItem: [node, path]\n      })) {\n        return;\n      }\n    }\n    if (node.type === LIST_ITEM) {\n      if (normalizeListItem(editor, {\n        listItem: [node, path]\n      })) {\n        return;\n      }\n    }\n    normalizeNode([node, path]);\n  };\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}