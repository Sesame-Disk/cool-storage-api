{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Node } from '@seafile/slate';\nimport useSelectionUpdate from '../../hooks/use-selection-update';\nimport { useCursorPosition } from '../helper';\nimport CommentList from './comment-list';\nimport { useSelectionElement } from '../../hooks/use-selection-element';\nimport { useCommentContext } from '../hooks/comment-hooks/use-comment-context';\nimport ElementsCommentCount from './elements-comment-count';\nimport { ELEMENT_TYPE } from '../../extension/constants';\nimport { Z_INDEX } from '../../constants';\nvar EditorComment = function EditorComment(_ref) {\n  var deleteUnseenNotifications = _ref.deleteUnseenNotifications,\n    editor = _ref.editor;\n  useSelectionUpdate();\n  var selectionElement = useSelectionElement({\n    editor: editor\n  });\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isShowComments = _useState2[0],\n    setIsShowComments = _useState2[1];\n  var onAddCommentToggle = useCallback(function () {\n    setIsShowComments(true);\n  }, []);\n\n  // When selectionElement update, recalculate comment's panel state\n  var _useState3 = useState([]),\n    _useState4 = _slicedToArray(_useState3, 2),\n    comments = _useState4[0],\n    setComments = _useState4[1];\n  var element_comments_map = useCommentContext().commentsInfo.element_comments_map;\n  useEffect(function () {\n    var comments = element_comments_map[selectionElement === null || selectionElement === void 0 ? void 0 : selectionElement.id];\n    var unresolvedComments = comments && comments.filter(function (item) {\n      return !item.resolved;\n    });\n    var hasComments = unresolvedComments && unresolvedComments.length > 0;\n    if (hasComments) {\n      setIsShowComments(true);\n      setComments(comments);\n      return;\n    }\n    setComments([]);\n    setIsShowComments(false);\n  }, [element_comments_map, selectionElement, editor.selection]);\n  var hiddenComment = useCallback(function () {\n    setComments([]);\n    setIsShowComments(false);\n  }, []);\n  var cursor = useCursorPosition();\n  var style = useMemo(function () {\n    var _Node$string;\n    if (selectionElement && ((_Node$string = Node.string(selectionElement)) === null || _Node$string === void 0 ? void 0 : _Node$string.length) === 0 && !selectionElement.children.find(function (n) {\n      return n.type === ELEMENT_TYPE.IMAGE;\n    })) {\n      return {\n        top: '-99999px'\n      };\n    }\n    var comments = element_comments_map[selectionElement === null || selectionElement === void 0 ? void 0 : selectionElement.id];\n    var unresolvedComments = comments && comments.filter(function (item) {\n      return !item.resolved;\n    });\n    var hasComments = unresolvedComments && unresolvedComments.length > 0;\n    if (hasComments) return {\n      top: '-99999px'\n    };\n    if (cursor.y === 0 || isShowComments) return {\n      top: '-99999px'\n    };\n    return {\n      top: cursor.y,\n      zIndex: Z_INDEX.COMMENT_ADD\n    };\n  }, [selectionElement, element_comments_map, cursor.y, isShowComments]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-comment-container\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-container-main\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-container-right\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-add-wrapper\",\n    style: style\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"add-comment-icon\",\n    onClick: onAddCommentToggle\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-add-comment mr-1\"\n  }))), /*#__PURE__*/React.createElement(ElementsCommentCount, {\n    elementCommentsMap: element_comments_map,\n    selectionElement: selectionElement,\n    editor: editor\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-list-wrapper\",\n    style: isShowComments ? {\n      width: '294px'\n    } : null\n  }, isShowComments && /*#__PURE__*/React.createElement(CommentList, {\n    comments: comments,\n    selectionElement: selectionElement,\n    hiddenComment: hiddenComment,\n    deleteUnseenNotifications: deleteUnseenNotifications\n  }))));\n};\nexport default EditorComment;","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","Node","useSelectionUpdate","useCursorPosition","CommentList","useSelectionElement","useCommentContext","ElementsCommentCount","ELEMENT_TYPE","Z_INDEX","EditorComment","_ref","deleteUnseenNotifications","editor","selectionElement","_useState","_useState2","_slicedToArray","isShowComments","setIsShowComments","onAddCommentToggle","_useState3","_useState4","comments","setComments","element_comments_map","commentsInfo","id","unresolvedComments","filter","item","resolved","hasComments","length","selection","hiddenComment","cursor","style","_Node$string","string","children","find","n","type","IMAGE","top","y","zIndex","COMMENT_ADD","createElement","className","onClick","elementCommentsMap","width"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/comment/components/editor-comment.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Node } from '@seafile/slate';\nimport useSelectionUpdate from '../../hooks/use-selection-update';\nimport { useCursorPosition } from '../helper';\nimport CommentList from './comment-list';\nimport { useSelectionElement } from '../../hooks/use-selection-element';\nimport { useCommentContext } from '../hooks/comment-hooks/use-comment-context';\nimport ElementsCommentCount from './elements-comment-count';\nimport { ELEMENT_TYPE } from '../../extension/constants';\nimport { Z_INDEX } from '../../constants';\nconst EditorComment = _ref => {\n  let {\n    deleteUnseenNotifications,\n    editor\n  } = _ref;\n  useSelectionUpdate();\n  const selectionElement = useSelectionElement({\n    editor\n  });\n  const [isShowComments, setIsShowComments] = useState(false);\n  const onAddCommentToggle = useCallback(() => {\n    setIsShowComments(true);\n  }, []);\n\n  // When selectionElement update, recalculate comment's panel state\n  const [comments, setComments] = useState([]);\n  const {\n    element_comments_map\n  } = useCommentContext().commentsInfo;\n  useEffect(() => {\n    const comments = element_comments_map[selectionElement === null || selectionElement === void 0 ? void 0 : selectionElement.id];\n    const unresolvedComments = comments && comments.filter(item => !item.resolved);\n    const hasComments = unresolvedComments && unresolvedComments.length > 0;\n    if (hasComments) {\n      setIsShowComments(true);\n      setComments(comments);\n      return;\n    }\n    setComments([]);\n    setIsShowComments(false);\n  }, [element_comments_map, selectionElement, editor.selection]);\n  const hiddenComment = useCallback(() => {\n    setComments([]);\n    setIsShowComments(false);\n  }, []);\n  const cursor = useCursorPosition();\n  const style = useMemo(() => {\n    var _Node$string;\n    if (selectionElement && ((_Node$string = Node.string(selectionElement)) === null || _Node$string === void 0 ? void 0 : _Node$string.length) === 0 && !selectionElement.children.find(n => n.type === ELEMENT_TYPE.IMAGE)) {\n      return {\n        top: '-99999px'\n      };\n    }\n    const comments = element_comments_map[selectionElement === null || selectionElement === void 0 ? void 0 : selectionElement.id];\n    const unresolvedComments = comments && comments.filter(item => !item.resolved);\n    const hasComments = unresolvedComments && unresolvedComments.length > 0;\n    if (hasComments) return {\n      top: '-99999px'\n    };\n    if (cursor.y === 0 || isShowComments) return {\n      top: '-99999px'\n    };\n    return {\n      top: cursor.y,\n      zIndex: Z_INDEX.COMMENT_ADD\n    };\n  }, [selectionElement, element_comments_map, cursor.y, isShowComments]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-comment-container\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-container-main\"\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-container-right\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-add-wrapper\",\n    style: style\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"add-comment-icon\",\n    onClick: onAddCommentToggle\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-add-comment mr-1\"\n  }))), /*#__PURE__*/React.createElement(ElementsCommentCount, {\n    elementCommentsMap: element_comments_map,\n    selectionElement: selectionElement,\n    editor: editor\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-list-wrapper\",\n    style: isShowComments ? {\n      width: '294px'\n    } : null\n  }, isShowComments && /*#__PURE__*/React.createElement(CommentList, {\n    comments: comments,\n    selectionElement: selectionElement,\n    hiddenComment: hiddenComment,\n    deleteUnseenNotifications: deleteUnseenNotifications\n  }))));\n};\nexport default EditorComment;"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,WAAW,EAAEC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACxE,SAASC,IAAI,QAAQ,gBAAgB;AACrC,OAAOC,kBAAkB,MAAM,kCAAkC;AACjE,SAASC,iBAAiB,QAAQ,WAAW;AAC7C,OAAOC,WAAW,MAAM,gBAAgB;AACxC,SAASC,mBAAmB,QAAQ,mCAAmC;AACvE,SAASC,iBAAiB,QAAQ,4CAA4C;AAC9E,OAAOC,oBAAoB,MAAM,0BAA0B;AAC3D,SAASC,YAAY,QAAQ,2BAA2B;AACxD,SAASC,OAAO,QAAQ,iBAAiB;AACzC,IAAMC,aAAa,GAAG,SAAhBA,aAAaA,CAAGC,IAAI,EAAI;EAC5B,IACEC,yBAAyB,GAEvBD,IAAI,CAFNC,yBAAyB;IACzBC,MAAM,GACJF,IAAI,CADNE,MAAM;EAERX,kBAAkB,CAAC,CAAC;EACpB,IAAMY,gBAAgB,GAAGT,mBAAmB,CAAC;IAC3CQ,MAAM,EAANA;EACF,CAAC,CAAC;EACF,IAAAE,SAAA,GAA4Cf,QAAQ,CAAC,KAAK,CAAC;IAAAgB,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAApDG,cAAc,GAAAF,UAAA;IAAEG,iBAAiB,GAAAH,UAAA;EACxC,IAAMI,kBAAkB,GAAGvB,WAAW,CAAC,YAAM;IAC3CsB,iBAAiB,CAAC,IAAI,CAAC;EACzB,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,IAAAE,UAAA,GAAgCrB,QAAQ,CAAC,EAAE,CAAC;IAAAsB,UAAA,GAAAL,cAAA,CAAAI,UAAA;IAArCE,QAAQ,GAAAD,UAAA;IAAEE,WAAW,GAAAF,UAAA;EAC5B,IACEG,oBAAoB,GAClBnB,iBAAiB,CAAC,CAAC,CAACoB,YAAY,CADlCD,oBAAoB;EAEtB3B,SAAS,CAAC,YAAM;IACd,IAAMyB,QAAQ,GAAGE,oBAAoB,CAACX,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAACa,EAAE,CAAC;IAC9H,IAAMC,kBAAkB,GAAGL,QAAQ,IAAIA,QAAQ,CAACM,MAAM,CAAC,UAAAC,IAAI;MAAA,OAAI,CAACA,IAAI,CAACC,QAAQ;IAAA,EAAC;IAC9E,IAAMC,WAAW,GAAGJ,kBAAkB,IAAIA,kBAAkB,CAACK,MAAM,GAAG,CAAC;IACvE,IAAID,WAAW,EAAE;MACfb,iBAAiB,CAAC,IAAI,CAAC;MACvBK,WAAW,CAACD,QAAQ,CAAC;MACrB;IACF;IACAC,WAAW,CAAC,EAAE,CAAC;IACfL,iBAAiB,CAAC,KAAK,CAAC;EAC1B,CAAC,EAAE,CAACM,oBAAoB,EAAEX,gBAAgB,EAAED,MAAM,CAACqB,SAAS,CAAC,CAAC;EAC9D,IAAMC,aAAa,GAAGtC,WAAW,CAAC,YAAM;IACtC2B,WAAW,CAAC,EAAE,CAAC;IACfL,iBAAiB,CAAC,KAAK,CAAC;EAC1B,CAAC,EAAE,EAAE,CAAC;EACN,IAAMiB,MAAM,GAAGjC,iBAAiB,CAAC,CAAC;EAClC,IAAMkC,KAAK,GAAGtC,OAAO,CAAC,YAAM;IAC1B,IAAIuC,YAAY;IAChB,IAAIxB,gBAAgB,IAAI,CAAC,CAACwB,YAAY,GAAGrC,IAAI,CAACsC,MAAM,CAACzB,gBAAgB,CAAC,MAAM,IAAI,IAAIwB,YAAY,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,YAAY,CAACL,MAAM,MAAM,CAAC,IAAI,CAACnB,gBAAgB,CAAC0B,QAAQ,CAACC,IAAI,CAAC,UAAAC,CAAC;MAAA,OAAIA,CAAC,CAACC,IAAI,KAAKnC,YAAY,CAACoC,KAAK;IAAA,EAAC,EAAE;MACxN,OAAO;QACLC,GAAG,EAAE;MACP,CAAC;IACH;IACA,IAAMtB,QAAQ,GAAGE,oBAAoB,CAACX,gBAAgB,KAAK,IAAI,IAAIA,gBAAgB,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,gBAAgB,CAACa,EAAE,CAAC;IAC9H,IAAMC,kBAAkB,GAAGL,QAAQ,IAAIA,QAAQ,CAACM,MAAM,CAAC,UAAAC,IAAI;MAAA,OAAI,CAACA,IAAI,CAACC,QAAQ;IAAA,EAAC;IAC9E,IAAMC,WAAW,GAAGJ,kBAAkB,IAAIA,kBAAkB,CAACK,MAAM,GAAG,CAAC;IACvE,IAAID,WAAW,EAAE,OAAO;MACtBa,GAAG,EAAE;IACP,CAAC;IACD,IAAIT,MAAM,CAACU,CAAC,KAAK,CAAC,IAAI5B,cAAc,EAAE,OAAO;MAC3C2B,GAAG,EAAE;IACP,CAAC;IACD,OAAO;MACLA,GAAG,EAAET,MAAM,CAACU,CAAC;MACbC,MAAM,EAAEtC,OAAO,CAACuC;IAClB,CAAC;EACH,CAAC,EAAE,CAAClC,gBAAgB,EAAEW,oBAAoB,EAAEW,MAAM,CAACU,CAAC,EAAE5B,cAAc,CAAC,CAAC;EACtE,OAAO,aAAatB,KAAK,CAACqD,aAAa,CAAC,KAAK,EAAE;IAC7CC,SAAS,EAAE;EACb,CAAC,EAAE,aAAatD,KAAK,CAACqD,aAAa,CAAC,KAAK,EAAE;IACzCC,SAAS,EAAE;EACb,CAAC,CAAC,EAAE,aAAatD,KAAK,CAACqD,aAAa,CAAC,KAAK,EAAE;IAC1CC,SAAS,EAAE;EACb,CAAC,EAAE,aAAatD,KAAK,CAACqD,aAAa,CAAC,KAAK,EAAE;IACzCC,SAAS,EAAE,qBAAqB;IAChCb,KAAK,EAAEA;EACT,CAAC,EAAE,aAAazC,KAAK,CAACqD,aAAa,CAAC,MAAM,EAAE;IAC1CC,SAAS,EAAE,kBAAkB;IAC7BC,OAAO,EAAE/B;EACX,CAAC,EAAE,aAAaxB,KAAK,CAACqD,aAAa,CAAC,GAAG,EAAE;IACvCC,SAAS,EAAE;EACb,CAAC,CAAC,CAAC,CAAC,EAAE,aAAatD,KAAK,CAACqD,aAAa,CAAC1C,oBAAoB,EAAE;IAC3D6C,kBAAkB,EAAE3B,oBAAoB;IACxCX,gBAAgB,EAAEA,gBAAgB;IAClCD,MAAM,EAAEA;EACV,CAAC,CAAC,EAAE,aAAajB,KAAK,CAACqD,aAAa,CAAC,KAAK,EAAE;IAC1CC,SAAS,EAAE,sBAAsB;IACjCb,KAAK,EAAEnB,cAAc,GAAG;MACtBmC,KAAK,EAAE;IACT,CAAC,GAAG;EACN,CAAC,EAAEnC,cAAc,IAAI,aAAatB,KAAK,CAACqD,aAAa,CAAC7C,WAAW,EAAE;IACjEmB,QAAQ,EAAEA,QAAQ;IAClBT,gBAAgB,EAAEA,gBAAgB;IAClCqB,aAAa,EAAEA,aAAa;IAC5BvB,yBAAyB,EAAEA;EAC7B,CAAC,CAAC,CAAC,CAAC,CAAC;AACP,CAAC;AACD,eAAeF,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}