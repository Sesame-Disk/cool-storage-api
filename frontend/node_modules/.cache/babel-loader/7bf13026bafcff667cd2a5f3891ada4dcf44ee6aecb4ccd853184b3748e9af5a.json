{"ast":null,"code":"import { Transforms, Node, Editor } from '@seafile/slate';\nimport { ReactEditor } from '@seafile/slate-react';\nimport { FILE_LINK_INSET_INPUT_TEMP, SDOC_LINK } from '../../constants';\nimport { getFileSearchInputEntry, insertTempInput, isTriggeredByShortcut } from './helpers';\nimport { getSelectedElems } from '../../core';\nvar withSdocLink = function withSdocLink(editor) {\n  var isInline = editor.isInline,\n    deleteBackward = editor.deleteBackward,\n    insertText = editor.insertText,\n    onCompositionStart = editor.onCompositionStart;\n  var newEditor = editor;\n\n  // Rewrite isInline\n  newEditor.isInline = function (elem) {\n    var type = elem.type;\n    var isInlineElem = [SDOC_LINK, FILE_LINK_INSET_INPUT_TEMP].includes(type);\n    if (isInlineElem) return true;\n    return isInline(elem);\n  };\n  newEditor.deleteBackward = function (unit) {\n    var selection = newEditor.selection;\n    if (selection === null) {\n      return deleteBackward(unit);\n    }\n\n    // Delete file link node when the input is empty\n    var selectedElems = getSelectedElems(newEditor);\n    var fileLinkSearchInputNode = selectedElems.find(function (elem) {\n      return elem.type === FILE_LINK_INSET_INPUT_TEMP;\n    });\n    if (fileLinkSearchInputNode) {\n      var path = ReactEditor.findPath(editor, fileLinkSearchInputNode);\n      if (Node.string(fileLinkSearchInputNode).length === 0) return Transforms.delete(newEditor, {\n        at: path\n      });\n    }\n    var nodeEntry = Editor.node(newEditor, newEditor.selection);\n    if (nodeEntry && Node.string(nodeEntry[0]).length === 0) {\n      var beforePath = nodeEntry[1];\n      beforePath.splice(-1, 1, Math.max(nodeEntry[1].at(-1) - 1, 0));\n      var beforeNodeEntry = Editor.node(newEditor, beforePath);\n      if (beforeNodeEntry && [SDOC_LINK, FILE_LINK_INSET_INPUT_TEMP].includes(beforeNodeEntry[0].type)) {\n        Transforms.delete(newEditor, {\n          at: beforeNodeEntry[1]\n        });\n        return;\n      }\n      return deleteBackward(unit);\n    }\n    return deleteBackward(unit);\n  };\n  newEditor.insertText = function (text) {\n    if (text !== '[') return insertText(text);\n    // If user press '[[', open file modal\n    if (isTriggeredByShortcut(newEditor)) {\n      insertText(text);\n      insertTempInput(newEditor);\n      return;\n    }\n    return insertText(text);\n  };\n  newEditor.onCompositionStart = function (event) {\n    var fileSearchInputNodeEntry = getFileSearchInputEntry(newEditor);\n    if (fileSearchInputNodeEntry) {\n      event.preventDefault();\n      return true;\n    }\n    return onCompositionStart && onCompositionStart(event);\n  };\n  return newEditor;\n};\nexport default withSdocLink;","map":{"version":3,"names":["Transforms","Node","Editor","ReactEditor","FILE_LINK_INSET_INPUT_TEMP","SDOC_LINK","getFileSearchInputEntry","insertTempInput","isTriggeredByShortcut","getSelectedElems","withSdocLink","editor","isInline","deleteBackward","insertText","onCompositionStart","newEditor","elem","type","isInlineElem","includes","unit","selection","selectedElems","fileLinkSearchInputNode","find","path","findPath","string","length","delete","at","nodeEntry","node","beforePath","splice","Math","max","beforeNodeEntry","text","event","fileSearchInputNodeEntry","preventDefault"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/sdoc-link/plugin.js"],"sourcesContent":["import { Transforms, Node, Editor } from '@seafile/slate';\nimport { ReactEditor } from '@seafile/slate-react';\nimport { FILE_LINK_INSET_INPUT_TEMP, SDOC_LINK } from '../../constants';\nimport { getFileSearchInputEntry, insertTempInput, isTriggeredByShortcut } from './helpers';\nimport { getSelectedElems } from '../../core';\nconst withSdocLink = editor => {\n  const {\n    isInline,\n    deleteBackward,\n    insertText,\n    onCompositionStart\n  } = editor;\n  const newEditor = editor;\n\n  // Rewrite isInline\n  newEditor.isInline = elem => {\n    const {\n      type\n    } = elem;\n    const isInlineElem = [SDOC_LINK, FILE_LINK_INSET_INPUT_TEMP].includes(type);\n    if (isInlineElem) return true;\n    return isInline(elem);\n  };\n  newEditor.deleteBackward = unit => {\n    const {\n      selection\n    } = newEditor;\n    if (selection === null) {\n      return deleteBackward(unit);\n    }\n\n    // Delete file link node when the input is empty\n    const selectedElems = getSelectedElems(newEditor);\n    const fileLinkSearchInputNode = selectedElems.find(elem => elem.type === FILE_LINK_INSET_INPUT_TEMP);\n    if (fileLinkSearchInputNode) {\n      const path = ReactEditor.findPath(editor, fileLinkSearchInputNode);\n      if (Node.string(fileLinkSearchInputNode).length === 0) return Transforms.delete(newEditor, {\n        at: path\n      });\n    }\n    const nodeEntry = Editor.node(newEditor, newEditor.selection);\n    if (nodeEntry && Node.string(nodeEntry[0]).length === 0) {\n      const beforePath = nodeEntry[1];\n      beforePath.splice(-1, 1, Math.max(nodeEntry[1].at(-1) - 1, 0));\n      const beforeNodeEntry = Editor.node(newEditor, beforePath);\n      if (beforeNodeEntry && [SDOC_LINK, FILE_LINK_INSET_INPUT_TEMP].includes(beforeNodeEntry[0].type)) {\n        Transforms.delete(newEditor, {\n          at: beforeNodeEntry[1]\n        });\n        return;\n      }\n      return deleteBackward(unit);\n    }\n    return deleteBackward(unit);\n  };\n  newEditor.insertText = text => {\n    if (text !== '[') return insertText(text);\n    // If user press '[[', open file modal\n    if (isTriggeredByShortcut(newEditor)) {\n      insertText(text);\n      insertTempInput(newEditor);\n      return;\n    }\n    return insertText(text);\n  };\n  newEditor.onCompositionStart = event => {\n    const fileSearchInputNodeEntry = getFileSearchInputEntry(newEditor);\n    if (fileSearchInputNodeEntry) {\n      event.preventDefault();\n      return true;\n    }\n    return onCompositionStart && onCompositionStart(event);\n  };\n  return newEditor;\n};\nexport default withSdocLink;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}