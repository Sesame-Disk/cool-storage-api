{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useState, useRef } from 'react';\nimport { CustomTableSizeDialog, SplitCellSettingDialog } from '../../plugins/table/dialogs';\nimport AddLinkDialog from '../../plugins/link/dialog/add-link-dialog';\nimport SelectFileDialog from '../select-file-dialog/index.js';\nimport EventBus from '../../../utils/event-bus';\nimport { INTERNAL_EVENT } from '../../../constants';\nimport { ELEMENT_TYPE, INSERT_POSITION, LOCAL_IMAGE } from '../../constants';\nimport { insertImage } from '../../plugins/image/helpers';\nimport context from '../../../../context.js';\nimport FileLinkInsertDialog from '../file-insert-dialog/index.js';\nvar InsertElementDialog = function InsertElementDialog(_ref) {\n  var editor = _ref.editor;\n  var _useState = useState(''),\n    _useState2 = _slicedToArray(_useState, 2),\n    dialogType = _useState2[0],\n    setDialogType = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    element = _useState4[0],\n    setElement = _useState4[1];\n  var _useState5 = useState(INSERT_POSITION.CURRENT),\n    _useState6 = _slicedToArray(_useState5, 2),\n    insertPosition = _useState6[0],\n    setInsertPosition = _useState6[1];\n  var _useState7 = useState(null),\n    _useState8 = _slicedToArray(_useState7, 2),\n    slateNode = _useState8[0],\n    setSlateNode = _useState8[1];\n  var _useState9 = useState(null),\n    _useState10 = _slicedToArray(_useState9, 2),\n    insertLinkCallback = _useState10[0],\n    setInsertLinkCallback = _useState10[1];\n  var _useState11 = useState(editor),\n    _useState12 = _slicedToArray(_useState11, 2),\n    validEditor = _useState12[0],\n    setValidEditor = _useState12[1];\n  var uploadLocalImageInputRef = useRef();\n  var onFileChanged = useCallback(function (event) {\n    var files = event.target.files;\n    context.uploadLocalImage(files).then(function (fileUrl) {\n      insertImage(validEditor, fileUrl, validEditor.selection, insertPosition);\n      if (uploadLocalImageInputRef.current) {\n        uploadLocalImageInputRef.current.value = '';\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [validEditor, uploadLocalImageInputRef, insertPosition, slateNode]);\n  useEffect(function () {\n    var eventBus = EventBus.getInstance();\n    var toggleDialogSubscribe = eventBus.subscribe(INTERNAL_EVENT.INSERT_ELEMENT, toggleDialog);\n    return function () {\n      toggleDialogSubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var toggleDialog = useCallback(function (_ref2) {\n    var type = _ref2.type,\n      element = _ref2.element,\n      _ref2$insertPosition = _ref2.insertPosition,\n      insertPosition = _ref2$insertPosition === void 0 ? INSERT_POSITION.CURRENT : _ref2$insertPosition,\n      slateNode = _ref2.slateNode,\n      insertFileLinkCallback = _ref2.insertFileLinkCallback,\n      insertSdocFileLinkCallback = _ref2.insertSdocFileLinkCallback,\n      paramEditor = _ref2.editor;\n    setInsertPosition(insertPosition);\n    setSlateNode(slateNode);\n    setElement(element);\n    setDialogType(type);\n    setInsertLinkCallback({\n      insertSdocFileLinkCallback: insertSdocFileLinkCallback,\n      insertFileLinkCallback: insertFileLinkCallback\n    });\n    // Apply for comment editor, as it has a different editor instance\n    setValidEditor(paramEditor || editor);\n    if (type === LOCAL_IMAGE) {\n      setTimeout(function () {\n        uploadLocalImageInputRef.current && uploadLocalImageInputRef.current.click();\n      }, 0);\n    }\n  }, [editor]);\n  var closeDialog = useCallback(function () {\n    setInsertPosition(INSERT_POSITION.CURRENT);\n    setSlateNode(null);\n    setElement('');\n    setDialogType('');\n    setInsertLinkCallback(null);\n    setValidEditor(null);\n  }, []);\n  var props = {\n    insertPosition: insertPosition,\n    slateNode: slateNode,\n    editor: validEditor,\n    element: element,\n    closeDialog: closeDialog\n  };\n  switch (dialogType) {\n    case ELEMENT_TYPE.TABLE:\n      {\n        return /*#__PURE__*/React.createElement(CustomTableSizeDialog, props);\n      }\n    case ELEMENT_TYPE.TABLE_CELL:\n      {\n        return /*#__PURE__*/React.createElement(SplitCellSettingDialog, props);\n      }\n    case ELEMENT_TYPE.LINK:\n      {\n        return /*#__PURE__*/React.createElement(AddLinkDialog, props);\n      }\n    case ELEMENT_TYPE.SDOC_LINK:\n      {\n        var sdocLinkProps = {\n          editor: validEditor,\n          dialogType: dialogType,\n          insertLinkCallback: insertLinkCallback,\n          closeDialog: closeDialog\n        };\n        return /*#__PURE__*/React.createElement(SelectFileDialog, sdocLinkProps);\n      }\n    case ELEMENT_TYPE.FILE_LINK:\n      {\n        var fileLinkProps = {\n          editor: validEditor,\n          dialogType: dialogType,\n          insertLinkCallback: insertLinkCallback,\n          closeDialog: closeDialog\n        };\n        return /*#__PURE__*/React.createElement(SelectFileDialog, fileLinkProps);\n      }\n    case LOCAL_IMAGE:\n      {\n        return /*#__PURE__*/React.createElement(\"input\", {\n          onClick: function onClick(e) {\n            return e.stopPropagation();\n          },\n          ref: uploadLocalImageInputRef,\n          type: \"file\",\n          multiple: true,\n          accept: \"image/*\",\n          style: {\n            display: 'none'\n          },\n          onChange: onFileChanged\n        });\n      }\n    case ELEMENT_TYPE.FILE_LINK_INSET_INPUT_TEMP:\n      {\n        return /*#__PURE__*/React.createElement(FileLinkInsertDialog, {\n          element: slateNode,\n          editor: editor,\n          closeDialog: closeDialog\n        });\n      }\n    default:\n      {\n        return null;\n      }\n  }\n};\nexport default InsertElementDialog;","map":{"version":3,"names":["React","useCallback","useEffect","useState","useRef","CustomTableSizeDialog","SplitCellSettingDialog","AddLinkDialog","SelectFileDialog","EventBus","INTERNAL_EVENT","ELEMENT_TYPE","INSERT_POSITION","LOCAL_IMAGE","insertImage","context","FileLinkInsertDialog","InsertElementDialog","_ref","editor","_useState","_useState2","_slicedToArray","dialogType","setDialogType","_useState3","_useState4","element","setElement","_useState5","CURRENT","_useState6","insertPosition","setInsertPosition","_useState7","_useState8","slateNode","setSlateNode","_useState9","_useState10","insertLinkCallback","setInsertLinkCallback","_useState11","_useState12","validEditor","setValidEditor","uploadLocalImageInputRef","onFileChanged","event","files","target","uploadLocalImage","then","fileUrl","selection","current","value","eventBus","getInstance","toggleDialogSubscribe","subscribe","INSERT_ELEMENT","toggleDialog","_ref2","type","_ref2$insertPosition","insertFileLinkCallback","insertSdocFileLinkCallback","paramEditor","setTimeout","click","closeDialog","props","TABLE","createElement","TABLE_CELL","LINK","SDOC_LINK","sdocLinkProps","FILE_LINK","fileLinkProps","onClick","e","stopPropagation","ref","multiple","accept","style","display","onChange","FILE_LINK_INSET_INPUT_TEMP"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/commons/insert-element-dialog/index.js"],"sourcesContent":["import React, { useCallback, useEffect, useState, useRef } from 'react';\nimport { CustomTableSizeDialog, SplitCellSettingDialog } from '../../plugins/table/dialogs';\nimport AddLinkDialog from '../../plugins/link/dialog/add-link-dialog';\nimport SelectFileDialog from '../select-file-dialog/index.js';\nimport EventBus from '../../../utils/event-bus';\nimport { INTERNAL_EVENT } from '../../../constants';\nimport { ELEMENT_TYPE, INSERT_POSITION, LOCAL_IMAGE } from '../../constants';\nimport { insertImage } from '../../plugins/image/helpers';\nimport context from '../../../../context.js';\nimport FileLinkInsertDialog from '../file-insert-dialog/index.js';\nconst InsertElementDialog = _ref => {\n  let {\n    editor\n  } = _ref;\n  const [dialogType, setDialogType] = useState('');\n  const [element, setElement] = useState('');\n  const [insertPosition, setInsertPosition] = useState(INSERT_POSITION.CURRENT);\n  const [slateNode, setSlateNode] = useState(null);\n  const [insertLinkCallback, setInsertLinkCallback] = useState(null);\n  const [validEditor, setValidEditor] = useState(editor);\n  const uploadLocalImageInputRef = useRef();\n  const onFileChanged = useCallback(event => {\n    const files = event.target.files;\n    context.uploadLocalImage(files).then(fileUrl => {\n      insertImage(validEditor, fileUrl, validEditor.selection, insertPosition);\n      if (uploadLocalImageInputRef.current) {\n        uploadLocalImageInputRef.current.value = '';\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [validEditor, uploadLocalImageInputRef, insertPosition, slateNode]);\n  useEffect(() => {\n    const eventBus = EventBus.getInstance();\n    const toggleDialogSubscribe = eventBus.subscribe(INTERNAL_EVENT.INSERT_ELEMENT, toggleDialog);\n    return () => {\n      toggleDialogSubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const toggleDialog = useCallback(_ref2 => {\n    let {\n      type,\n      element,\n      insertPosition = INSERT_POSITION.CURRENT,\n      slateNode,\n      insertFileLinkCallback,\n      insertSdocFileLinkCallback,\n      editor: paramEditor\n    } = _ref2;\n    setInsertPosition(insertPosition);\n    setSlateNode(slateNode);\n    setElement(element);\n    setDialogType(type);\n    setInsertLinkCallback({\n      insertSdocFileLinkCallback,\n      insertFileLinkCallback\n    });\n    // Apply for comment editor, as it has a different editor instance\n    setValidEditor(paramEditor || editor);\n    if (type === LOCAL_IMAGE) {\n      setTimeout(() => {\n        uploadLocalImageInputRef.current && uploadLocalImageInputRef.current.click();\n      }, 0);\n    }\n  }, [editor]);\n  const closeDialog = useCallback(() => {\n    setInsertPosition(INSERT_POSITION.CURRENT);\n    setSlateNode(null);\n    setElement('');\n    setDialogType('');\n    setInsertLinkCallback(null);\n    setValidEditor(null);\n  }, []);\n  const props = {\n    insertPosition,\n    slateNode,\n    editor: validEditor,\n    element,\n    closeDialog\n  };\n  switch (dialogType) {\n    case ELEMENT_TYPE.TABLE:\n      {\n        return /*#__PURE__*/React.createElement(CustomTableSizeDialog, props);\n      }\n    case ELEMENT_TYPE.TABLE_CELL:\n      {\n        return /*#__PURE__*/React.createElement(SplitCellSettingDialog, props);\n      }\n    case ELEMENT_TYPE.LINK:\n      {\n        return /*#__PURE__*/React.createElement(AddLinkDialog, props);\n      }\n    case ELEMENT_TYPE.SDOC_LINK:\n      {\n        const sdocLinkProps = {\n          editor: validEditor,\n          dialogType,\n          insertLinkCallback,\n          closeDialog\n        };\n        return /*#__PURE__*/React.createElement(SelectFileDialog, sdocLinkProps);\n      }\n    case ELEMENT_TYPE.FILE_LINK:\n      {\n        const fileLinkProps = {\n          editor: validEditor,\n          dialogType,\n          insertLinkCallback,\n          closeDialog\n        };\n        return /*#__PURE__*/React.createElement(SelectFileDialog, fileLinkProps);\n      }\n    case LOCAL_IMAGE:\n      {\n        return /*#__PURE__*/React.createElement(\"input\", {\n          onClick: e => e.stopPropagation(),\n          ref: uploadLocalImageInputRef,\n          type: \"file\",\n          multiple: true,\n          accept: \"image/*\",\n          style: {\n            display: 'none'\n          },\n          onChange: onFileChanged\n        });\n      }\n    case ELEMENT_TYPE.FILE_LINK_INSET_INPUT_TEMP:\n      {\n        return /*#__PURE__*/React.createElement(FileLinkInsertDialog, {\n          element: slateNode,\n          editor: editor,\n          closeDialog: closeDialog\n        });\n      }\n    default:\n      {\n        return null;\n      }\n  }\n};\nexport default InsertElementDialog;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}