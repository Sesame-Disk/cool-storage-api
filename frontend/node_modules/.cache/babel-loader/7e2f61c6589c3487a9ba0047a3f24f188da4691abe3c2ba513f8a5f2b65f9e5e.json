{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Loading from '../components/loading';\nimport DocInfo from '../components/doc-info';\nimport DocOperations from '../components/doc-operations';\nimport Layout, { Header, Content } from '../layout';\nimport context from '../context';\nimport ErrorBoundary from './error-boundary';\nimport { PublishedRevisionDiffViewer } from '../basic-sdk';\nimport { resetWebTitle } from '../utils';\nimport '../assets/css/simple-editor.css';\nvar PublishedRevisionViewer = function PublishedRevisionViewer() {\n  context.initApi();\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var _useState = useState(true),\n    _useState2 = _slicedToArray(_useState, 2),\n    isFirstLoading = _useState2[0],\n    setIsFirstLoading = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    errorMessage = _useState4[0],\n    setErrorMessage = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    isShowChanges = _useState6[0],\n    setShowChanges = _useState6[1];\n  var _useState7 = useState({}),\n    _useState8 = _slicedToArray(_useState7, 2),\n    changes = _useState8[0],\n    setChanges = _useState8[1];\n  var _useState9 = useState({}),\n    _useState10 = _slicedToArray(_useState9, 2),\n    document = _useState10[0],\n    setDocument = _useState10[1];\n\n  // useMount: reset title\n  useEffect(function () {\n    resetWebTitle(t);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(function () {\n    context.getPublishedRevisionContent().then(function (res) {\n      var revisionContentString = res.data.content;\n      var document = JSON.parse(revisionContentString);\n      setDocument(document);\n      setIsFirstLoading(false);\n    }).catch(function (error) {\n      // eslint-disable-next-line\n      console.log(error);\n      var errorMessage = 'Load_doc_content_error';\n      if (error && error.response) {\n        var _ref = error.response.data || {},\n          error_type = _ref.error_type;\n        if (error_type === 'content_invalid') {\n          errorMessage = 'Sdoc_format_invalid';\n        }\n      }\n      setErrorMessage(errorMessage);\n      setIsFirstLoading(false);\n    });\n  }, []);\n  var setDiffChanges = useCallback(function (diff) {\n    setChanges(diff);\n  }, []);\n  var handleViewChangesToggle = useCallback(function (isShowChanges) {\n    setShowChanges(isShowChanges);\n  }, []);\n  if (isFirstLoading) {\n    return /*#__PURE__*/React.createElement(Loading, null);\n  }\n  if (errorMessage) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"error-page\"\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"error-tip\"\n    }, t(errorMessage)));\n  }\n  return /*#__PURE__*/React.createElement(ErrorBoundary, null, /*#__PURE__*/React.createElement(Layout, null, /*#__PURE__*/React.createElement(Header, null, /*#__PURE__*/React.createElement(DocInfo, {\n    isEditMode: false,\n    isPublished: true\n  }), /*#__PURE__*/React.createElement(DocOperations, {\n    isShowChanges: isShowChanges,\n    changes: changes,\n    isPublished: true,\n    handleViewChangesToggle: handleViewChangesToggle\n  })), /*#__PURE__*/React.createElement(Content, null, /*#__PURE__*/React.createElement(PublishedRevisionDiffViewer, {\n    isShowChanges: isShowChanges,\n    revisionContent: document,\n    didMountCallback: setDiffChanges\n  }))));\n};\nexport default PublishedRevisionViewer;","map":{"version":3,"names":["React","useCallback","useEffect","useState","useTranslation","Loading","DocInfo","DocOperations","Layout","Header","Content","context","ErrorBoundary","PublishedRevisionDiffViewer","resetWebTitle","PublishedRevisionViewer","initApi","_useTranslation","t","_useState","_useState2","_slicedToArray","isFirstLoading","setIsFirstLoading","_useState3","_useState4","errorMessage","setErrorMessage","_useState5","_useState6","isShowChanges","setShowChanges","_useState7","_useState8","changes","setChanges","_useState9","_useState10","document","setDocument","getPublishedRevisionContent","then","res","revisionContentString","data","content","JSON","parse","catch","error","console","log","response","_ref","error_type","setDiffChanges","diff","handleViewChangesToggle","createElement","className","isEditMode","isPublished","revisionContent","didMountCallback"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/pages/published-revision-viewer.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport Loading from '../components/loading';\nimport DocInfo from '../components/doc-info';\nimport DocOperations from '../components/doc-operations';\nimport Layout, { Header, Content } from '../layout';\nimport context from '../context';\nimport ErrorBoundary from './error-boundary';\nimport { PublishedRevisionDiffViewer } from '../basic-sdk';\nimport { resetWebTitle } from '../utils';\nimport '../assets/css/simple-editor.css';\nconst PublishedRevisionViewer = () => {\n  context.initApi();\n  const {\n    t\n  } = useTranslation();\n  const [isFirstLoading, setIsFirstLoading] = useState(true);\n  const [errorMessage, setErrorMessage] = useState('');\n  const [isShowChanges, setShowChanges] = useState(false);\n  const [changes, setChanges] = useState({});\n  const [document, setDocument] = useState({});\n\n  // useMount: reset title\n  useEffect(() => {\n    resetWebTitle(t);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    context.getPublishedRevisionContent().then(res => {\n      const {\n        content: revisionContentString\n      } = res.data;\n      const document = JSON.parse(revisionContentString);\n      setDocument(document);\n      setIsFirstLoading(false);\n    }).catch(error => {\n      // eslint-disable-next-line\n      console.log(error);\n      let errorMessage = 'Load_doc_content_error';\n      if (error && error.response) {\n        const {\n          error_type\n        } = error.response.data || {};\n        if (error_type === 'content_invalid') {\n          errorMessage = 'Sdoc_format_invalid';\n        }\n      }\n      setErrorMessage(errorMessage);\n      setIsFirstLoading(false);\n    });\n  }, []);\n  const setDiffChanges = useCallback(diff => {\n    setChanges(diff);\n  }, []);\n  const handleViewChangesToggle = useCallback(isShowChanges => {\n    setShowChanges(isShowChanges);\n  }, []);\n  if (isFirstLoading) {\n    return /*#__PURE__*/React.createElement(Loading, null);\n  }\n  if (errorMessage) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"error-page\"\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"error-tip\"\n    }, t(errorMessage)));\n  }\n  return /*#__PURE__*/React.createElement(ErrorBoundary, null, /*#__PURE__*/React.createElement(Layout, null, /*#__PURE__*/React.createElement(Header, null, /*#__PURE__*/React.createElement(DocInfo, {\n    isEditMode: false,\n    isPublished: true\n  }), /*#__PURE__*/React.createElement(DocOperations, {\n    isShowChanges: isShowChanges,\n    changes: changes,\n    isPublished: true,\n    handleViewChangesToggle: handleViewChangesToggle\n  })), /*#__PURE__*/React.createElement(Content, null, /*#__PURE__*/React.createElement(PublishedRevisionDiffViewer, {\n    isShowChanges: isShowChanges,\n    revisionContent: document,\n    didMountCallback: setDiffChanges\n  }))));\n};\nexport default PublishedRevisionViewer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}