{"ast":null,"code":"import _toConsumableArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _defineProperty from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport slugid from 'slugid';\nimport { ELEMENT_TYPE, ADDED_STYLE, DELETED_STYLE, TEXT_STYLE_MAP } from '../../basic-sdk/extension/constants';\nimport ObjectUtils from './object-utils';\nimport DiffText from './diff-text';\nimport { normalizeChildren } from './document-utils';\n\n// ignore\nvar IGNORE_KEYS = ['BOLD', 'ITALIC', 'bold', 'italic', 'columns', 'minHeight', 'min_height', 'language', 'white_space'];\nvar generatorDiffTextElement = function generatorDiffTextElement(textElement, diffType) {\n  var style = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  if (!textElement) return null;\n  if (!diffType) return textElement;\n  var id = textElement.id;\n  return _objectSpread(_objectSpread({}, textElement), {}, _defineProperty({\n    id: id || slugid.nice()\n  }, diffType, true), style);\n};\nexport var getTopLevelChanges = function getTopLevelChanges(changes) {\n  var topLevelChanges = [];\n  var articleEl = document.getElementById('sdoc-editor');\n  changes.forEach(function (item) {\n    var dom = document.querySelectorAll(\"[data-id=\\\"\".concat(item, \"\\\"]\"))[0];\n    if (!dom) return [];\n    while (((_dom = dom) === null || _dom === void 0 ? void 0 : (_dom$dataset = _dom.dataset) === null || _dom$dataset === void 0 ? void 0 : _dom$dataset.root) !== 'true' || ((_dom2 = dom) === null || _dom2 === void 0 ? void 0 : _dom2.parentNode) !== articleEl) {\n      var _dom, _dom$dataset, _dom2, _dom3;\n      if (!((_dom3 = dom) === null || _dom3 === void 0 ? void 0 : _dom3.parentNode) || dom instanceof Document) break;\n      var parentNode = dom.parentNode;\n      if (parentNode instanceof Document) {\n        break;\n      } else {\n        dom = parentNode;\n      }\n    }\n    topLevelChanges.push(dom.dataset.id);\n  });\n  return Array.from(new Set(topLevelChanges));\n};\n\n// Merge consecutive added areas or deleted areas\nexport var getMergedChanges = function getMergedChanges(topLevelChanges, diffValue) {\n  var topLevelChangesValue = [];\n  var changes = [];\n  diffValue.forEach(function (item) {\n    if (topLevelChanges.includes(item.id)) {\n      var obj = {\n        id: item.id,\n        value: item\n      };\n      topLevelChangesValue.push(obj);\n    }\n  });\n  topLevelChangesValue.forEach(function (item) {\n    var _changes;\n    var preChange = (_changes = changes[changes.length - 1]) === null || _changes === void 0 ? void 0 : _changes.value;\n    var curChange = item.value;\n    if ((curChange === null || curChange === void 0 ? void 0 : curChange.add) && (preChange === null || preChange === void 0 ? void 0 : preChange.add)) return;\n    if ((curChange === null || curChange === void 0 ? void 0 : curChange.delete) && (preChange === null || preChange === void 0 ? void 0 : preChange.delete)) return;\n    changes.push(item);\n  });\n  return changes.map(function (item) {\n    return item.id;\n  });\n};\n\n// Depth facilitates each child node, adding diffType to each end node\nvar generatorDiffElement = function generatorDiffElement(element, diffType) {\n  var _objectSpread3;\n  var style = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  if (!element) return null;\n  if (!Array.isArray(element.children) || element.children.length === 0) {\n    return generatorDiffTextElement(element, diffType, style);\n  }\n  return _objectSpread(_objectSpread({}, element), {}, (_objectSpread3 = {}, _defineProperty(_objectSpread3, diffType, true), _defineProperty(_objectSpread3, \"children\", element.children.map(function (item) {\n    return generatorDiffElement(item, diffType, style);\n  })), _objectSpread3));\n};\nexport var generateIdMapAndIds = function generateIdMapAndIds(elements) {\n  var map = {};\n  var ids = [];\n  if (!Array.isArray(elements) || elements.length === 0) return {\n    map: map,\n    ids: ids\n  };\n  elements.forEach(function (element) {\n    ids.push(element.id);\n    map[element.id] = element;\n  });\n  return {\n    map: map,\n    ids: ids\n  };\n};\nvar hasChildren = function hasChildren(element) {\n  if (!element) return false;\n  if (!Array.isArray(element.children) || element.children.length === 0) return false;\n  return true;\n};\n\n// id diffs\nexport var getIdDiffs = function getIdDiffs(oldIds, newIds) {\n  var diff = new DiffText(oldIds, newIds);\n  return diff.getDiffs();\n};\n\n// text diffs\nvar getTextDiff = function getTextDiff(element, oldElement, diff) {\n  var newText = element.text;\n  var oldText = oldElement.text;\n  var textDiff = new DiffText(oldText || '', newText || '');\n  var textDiffs = textDiff.getDiffs();\n  var newChildren = [];\n  textDiffs.forEach(function (item, index) {\n    var id = \"\".concat(element.id || slugid.nice(), \"-\").concat(index);\n    var elementItem = {\n      id: id,\n      text: item.value\n    };\n    if (item.added) {\n      diff.changes.push(id);\n      var commonChild = generatorDiffTextElement(elementItem, TEXT_STYLE_MAP.ADD, ADDED_STYLE);\n      newChildren.push(commonChild);\n    } else if (item.removed) {\n      diff.changes.push(id);\n      var _commonChild = generatorDiffTextElement(elementItem, TEXT_STYLE_MAP.DELETE, DELETED_STYLE);\n      newChildren.push(_commonChild);\n    } else {\n      var _commonChild2 = generatorDiffTextElement(elementItem);\n      newChildren.push(_commonChild2);\n    }\n  });\n  return newChildren;\n};\nvar getCommonDiff = function getCommonDiff(element, oldElement, diff) {\n  if (!hasChildren(element) && !hasChildren(oldElement)) {\n    var _newChildren = getTextDiff(element, oldElement, diff);\n    return [_objectSpread(_objectSpread({}, element), {}, {\n      children: _newChildren\n    })];\n  }\n  if (!hasChildren(element) || !hasChildren(oldElement)) {\n    var elementId = element.id || slugid.nice();\n    diff.changes.push(\"\".concat(elementId, \"_delete\"));\n    return [generatorDiffElement(_objectSpread(_objectSpread({}, oldElement), {}, {\n      id: \"\".concat(elementId, \"_delete\")\n    }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE), generatorDiffElement(_objectSpread(_objectSpread({}, element), {}, {\n      id: \"\".concat(elementId, \"_add\")\n    }), TEXT_STYLE_MAP.ADD, ADDED_STYLE)];\n  }\n\n  // Content does not change\n  if (ObjectUtils.isSameObject(element, oldElement, [].concat(IGNORE_KEYS, ['type']))) {\n    return [element];\n  }\n\n  // Compare content\n  var currentChildren = element.children;\n  var oldChildren = oldElement.children;\n  var _generateIdMapAndIds = generateIdMapAndIds(currentChildren),\n    currentMap = _generateIdMapAndIds.map,\n    currentIds = _generateIdMapAndIds.ids;\n  var _generateIdMapAndIds2 = generateIdMapAndIds(oldChildren),\n    oldMap = _generateIdMapAndIds2.map,\n    oldIds = _generateIdMapAndIds2.ids;\n  var idDiffs = getIdDiffs(oldIds, currentIds);\n  var newChildren = [];\n  idDiffs.forEach(function (idDiff) {\n    var ids = idDiff.value;\n    var isAdded = idDiff.added;\n    var isDelete = idDiff.removed;\n    ids.forEach(function (id) {\n      var newChildrenElement = currentMap[id];\n      var oldChildrenElement = oldMap[id];\n      if (isAdded) {\n        diff.changes.push(id);\n        newChildren.push(generatorDiffElement(newChildrenElement, TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n      } else if (isDelete) {\n        diff.changes.push(id);\n        newChildren.push(generatorDiffElement(oldChildrenElement, TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n      } else {\n        if (ObjectUtils.isSameObject(newChildrenElement, oldChildrenElement, IGNORE_KEYS)) {\n          newChildren.push(newChildrenElement);\n        } else {\n          if (newChildrenElement.type === oldChildrenElement.type) {\n            if (!newChildrenElement.type) {\n              var textDiffs = getTextDiff(newChildrenElement, oldChildrenElement, diff);\n              newChildren.push.apply(newChildren, _toConsumableArray(textDiffs));\n            } else if (newChildrenElement.type === ELEMENT_TYPE.IMAGE) {\n              if (newChildrenElement.data.src === oldChildrenElement.data.src) {\n                newChildren.push(newChildrenElement);\n              } else {\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, element), {}, {\n                  id: element.id + '_add'\n                }), TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, oldChildrenElement), {}, {\n                  id: element.id + '_delete'\n                }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n              }\n            } else if (newChildrenElement.type === ELEMENT_TYPE.LINK) {\n              if (newChildrenElement.title !== oldChildrenElement.title) {\n                var diffElements = getCommonDiff(newChildrenElement, oldChildrenElement, diff);\n                newChildren.push.apply(newChildren, _toConsumableArray(diffElements));\n              } else if (newChildrenElement.href !== oldChildrenElement.href) {\n                diff.changes.push(oldChildrenElement.id + '_delete');\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, oldChildrenElement), {}, {\n                  id: oldChildrenElement.id + '_delete'\n                }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, newChildrenElement), {}, {\n                  id: newChildrenElement.id + '_add'\n                }), TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n              } else {\n                newChildren.push(newChildrenElement);\n              }\n            } else if (newChildrenElement.type === ELEMENT_TYPE.TABLE_ROW || newChildrenElement.type === ELEMENT_TYPE.TABLE_CELL) {\n              var newRows = getCommonDiff(newChildrenElement, oldChildrenElement, diff);\n              newChildren.push.apply(newChildren, _toConsumableArray(newRows));\n            } else {\n              var commonDiffs = getCommonDiff(newChildrenElement, oldChildrenElement, diff);\n              newChildren.push.apply(newChildren, _toConsumableArray(commonDiffs));\n            }\n          } else {\n            diff.changes.push(oldChildrenElement.id + '_delete');\n            newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, oldChildrenElement), {}, {\n              id: oldChildrenElement.id + '_delete'\n            }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n            newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, newChildrenElement), {}, {\n              id: newChildrenElement.id + '_add'\n            }), TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n          }\n        }\n      }\n    });\n  });\n  return [_objectSpread(_objectSpread({}, element), {}, {\n    children: newChildren\n  })];\n};\nvar updateDiffValue = function updateDiffValue(diff, element, oldElement) {\n  if (!diff || !element || !oldElement) return;\n  if (ObjectUtils.isSameObject(element, oldElement, IGNORE_KEYS)) {\n    diff.value.push(element);\n    return;\n  }\n  var elements = getCommonDiff(element, oldElement, diff);\n  elements.forEach(function (item) {\n    // Changing empty characters to other characters\n    if (!item.add && item.children.find(function (child) {\n      return child.add === true;\n    })) {\n      item.add = true;\n    }\n    diff.value.push(item);\n  });\n};\n\n/**\n * params:\n    * currentValue: current version document content\n    * oldValue: last version document content\n * return { value: [], change: [] }\n*/\nvar getElementDiffValue = function getElementDiffValue(currentContent, oldContent) {\n  // init\n  var diff = {\n    value: [],\n    changes: []\n  };\n  var _generateIdMapAndIds3 = generateIdMapAndIds(currentContent),\n    currentContentMap = _generateIdMapAndIds3.map,\n    currentIds = _generateIdMapAndIds3.ids;\n  var _generateIdMapAndIds4 = generateIdMapAndIds(oldContent),\n    oldContentMap = _generateIdMapAndIds4.map,\n    oldIds = _generateIdMapAndIds4.ids;\n  var diffs = getIdDiffs(oldIds, currentIds);\n  diffs.forEach(function (diffItem) {\n    var elementIds = diffItem.value;\n    if (diffItem.removed) {\n      elementIds.forEach(function (elementId) {\n        diff.changes.push(elementId);\n        var element = oldContentMap[elementId];\n        var diffElement = generatorDiffElement(element, TEXT_STYLE_MAP.DELETE, DELETED_STYLE);\n        diff.value.push(diffElement);\n      });\n    } else if (diffItem.added) {\n      elementIds.forEach(function (elementId) {\n        diff.changes.push(elementId);\n        var element = currentContentMap[elementId];\n        var diffElement = generatorDiffElement(element, TEXT_STYLE_MAP.ADD, ADDED_STYLE);\n        diff.value.push(diffElement);\n      });\n    } else {\n      elementIds.forEach(function (elementId) {\n        var element = currentContentMap[elementId];\n        updateDiffValue(diff, element, oldContentMap[element.id]);\n      });\n    }\n  });\n  return diff;\n};\n\n/**\n * params:\n    * currentValue: current version document\n    * oldValue: last version document\n * return { value: [], change: [] }\n*/\nexport var getDiff = function getDiff() {\n  var currentValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    children: []\n  };\n  var oldValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    children: []\n  };\n  if (!currentValue && !oldValue) return {\n    value: [],\n    changes: []\n  };\n  if (!currentValue && oldValue) return {\n    value: normalizeChildren(oldValue.children),\n    changes: []\n  };\n  if (currentValue && !oldValue) return {\n    value: normalizeChildren(currentValue.children),\n    changes: []\n  };\n  var _objectSpread4 = _objectSpread(_objectSpread({}, currentValue), {}, {\n      children: normalizeChildren(currentValue.children)\n    }),\n    currentVersion = _objectSpread4.version,\n    currentContent = _objectSpread4.children;\n  var _objectSpread5 = _objectSpread(_objectSpread({}, oldValue), {}, {\n      children: normalizeChildren(oldValue.children)\n    }),\n    oldVersion = _objectSpread5.version,\n    oldContent = _objectSpread5.children;\n  if (currentVersion === oldVersion) return {\n    value: currentContent,\n    changes: []\n  };\n  return getElementDiffValue(currentContent, oldContent);\n};\nwindow.getIdDiffs = getIdDiffs;","map":{"version":3,"names":["_objectSpread","slugid","ELEMENT_TYPE","ADDED_STYLE","DELETED_STYLE","TEXT_STYLE_MAP","ObjectUtils","DiffText","normalizeChildren","IGNORE_KEYS","generatorDiffTextElement","textElement","diffType","style","arguments","length","undefined","id","_defineProperty","nice","getTopLevelChanges","changes","topLevelChanges","articleEl","document","getElementById","forEach","item","dom","querySelectorAll","concat","_dom","_dom$dataset","dataset","root","_dom2","parentNode","_dom3","Document","push","Array","from","Set","getMergedChanges","diffValue","topLevelChangesValue","includes","obj","value","_changes","preChange","curChange","add","delete","map","generatorDiffElement","element","_objectSpread3","isArray","children","generateIdMapAndIds","elements","ids","hasChildren","getIdDiffs","oldIds","newIds","diff","getDiffs","getTextDiff","oldElement","newText","text","oldText","textDiff","textDiffs","newChildren","index","elementItem","added","commonChild","ADD","removed","DELETE","getCommonDiff","elementId","isSameObject","currentChildren","oldChildren","_generateIdMapAndIds","currentMap","currentIds","_generateIdMapAndIds2","oldMap","idDiffs","idDiff","isAdded","isDelete","newChildrenElement","oldChildrenElement","type","apply","_toConsumableArray","IMAGE","data","src","LINK","title","diffElements","href","TABLE_ROW","TABLE_CELL","newRows","commonDiffs","updateDiffValue","find","child","getElementDiffValue","currentContent","oldContent","_generateIdMapAndIds3","currentContentMap","_generateIdMapAndIds4","oldContentMap","diffs","diffItem","elementIds","diffElement","getDiff","currentValue","oldValue","_objectSpread4","currentVersion","version","_objectSpread5","oldVersion","window"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/utils/diff.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport slugid from 'slugid';\nimport { ELEMENT_TYPE, ADDED_STYLE, DELETED_STYLE, TEXT_STYLE_MAP } from '../../basic-sdk/extension/constants';\nimport ObjectUtils from './object-utils';\nimport DiffText from './diff-text';\nimport { normalizeChildren } from './document-utils';\n\n// ignore\nconst IGNORE_KEYS = ['BOLD', 'ITALIC', 'bold', 'italic', 'columns', 'minHeight', 'min_height', 'language', 'white_space'];\nconst generatorDiffTextElement = function (textElement, diffType) {\n  let style = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  if (!textElement) return null;\n  if (!diffType) return textElement;\n  const id = textElement.id;\n  return _objectSpread(_objectSpread({}, textElement), {}, {\n    id: id || slugid.nice(),\n    [diffType]: true\n  }, style);\n};\nexport const getTopLevelChanges = changes => {\n  const topLevelChanges = [];\n  const articleEl = document.getElementById('sdoc-editor');\n  changes.forEach(item => {\n    let dom = document.querySelectorAll(\"[data-id=\\\"\".concat(item, \"\\\"]\"))[0];\n    if (!dom) return [];\n    while (((_dom = dom) === null || _dom === void 0 ? void 0 : (_dom$dataset = _dom.dataset) === null || _dom$dataset === void 0 ? void 0 : _dom$dataset.root) !== 'true' || ((_dom2 = dom) === null || _dom2 === void 0 ? void 0 : _dom2.parentNode) !== articleEl) {\n      var _dom, _dom$dataset, _dom2, _dom3;\n      if (!((_dom3 = dom) === null || _dom3 === void 0 ? void 0 : _dom3.parentNode) || dom instanceof Document) break;\n      const parentNode = dom.parentNode;\n      if (parentNode instanceof Document) {\n        break;\n      } else {\n        dom = parentNode;\n      }\n    }\n    topLevelChanges.push(dom.dataset.id);\n  });\n  return Array.from(new Set(topLevelChanges));\n};\n\n// Merge consecutive added areas or deleted areas\nexport const getMergedChanges = (topLevelChanges, diffValue) => {\n  const topLevelChangesValue = [];\n  const changes = [];\n  diffValue.forEach(item => {\n    if (topLevelChanges.includes(item.id)) {\n      const obj = {\n        id: item.id,\n        value: item\n      };\n      topLevelChangesValue.push(obj);\n    }\n  });\n  topLevelChangesValue.forEach(item => {\n    var _changes;\n    const preChange = (_changes = changes[changes.length - 1]) === null || _changes === void 0 ? void 0 : _changes.value;\n    const curChange = item.value;\n    if ((curChange === null || curChange === void 0 ? void 0 : curChange.add) && (preChange === null || preChange === void 0 ? void 0 : preChange.add)) return;\n    if ((curChange === null || curChange === void 0 ? void 0 : curChange.delete) && (preChange === null || preChange === void 0 ? void 0 : preChange.delete)) return;\n    changes.push(item);\n  });\n  return changes.map(item => item.id);\n};\n\n// Depth facilitates each child node, adding diffType to each end node\nconst generatorDiffElement = function (element, diffType) {\n  let style = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  if (!element) return null;\n  if (!Array.isArray(element.children) || element.children.length === 0) {\n    return generatorDiffTextElement(element, diffType, style);\n  }\n  return _objectSpread(_objectSpread({}, element), {}, {\n    [diffType]: true,\n    children: element.children.map(item => generatorDiffElement(item, diffType, style))\n  });\n};\nexport const generateIdMapAndIds = elements => {\n  let map = {};\n  let ids = [];\n  if (!Array.isArray(elements) || elements.length === 0) return {\n    map,\n    ids\n  };\n  elements.forEach(element => {\n    ids.push(element.id);\n    map[element.id] = element;\n  });\n  return {\n    map,\n    ids\n  };\n};\nconst hasChildren = element => {\n  if (!element) return false;\n  if (!Array.isArray(element.children) || element.children.length === 0) return false;\n  return true;\n};\n\n// id diffs\nexport const getIdDiffs = (oldIds, newIds) => {\n  const diff = new DiffText(oldIds, newIds);\n  return diff.getDiffs();\n};\n\n// text diffs\nconst getTextDiff = (element, oldElement, diff) => {\n  const newText = element.text;\n  const oldText = oldElement.text;\n  const textDiff = new DiffText(oldText || '', newText || '');\n  const textDiffs = textDiff.getDiffs();\n  let newChildren = [];\n  textDiffs.forEach((item, index) => {\n    const id = \"\".concat(element.id || slugid.nice(), \"-\").concat(index);\n    let elementItem = {\n      id,\n      text: item.value\n    };\n    if (item.added) {\n      diff.changes.push(id);\n      const commonChild = generatorDiffTextElement(elementItem, TEXT_STYLE_MAP.ADD, ADDED_STYLE);\n      newChildren.push(commonChild);\n    } else if (item.removed) {\n      diff.changes.push(id);\n      const commonChild = generatorDiffTextElement(elementItem, TEXT_STYLE_MAP.DELETE, DELETED_STYLE);\n      newChildren.push(commonChild);\n    } else {\n      const commonChild = generatorDiffTextElement(elementItem);\n      newChildren.push(commonChild);\n    }\n  });\n  return newChildren;\n};\nconst getCommonDiff = (element, oldElement, diff) => {\n  if (!hasChildren(element) && !hasChildren(oldElement)) {\n    const newChildren = getTextDiff(element, oldElement, diff);\n    return [_objectSpread(_objectSpread({}, element), {}, {\n      children: newChildren\n    })];\n  }\n  if (!hasChildren(element) || !hasChildren(oldElement)) {\n    const elementId = element.id || slugid.nice();\n    diff.changes.push(\"\".concat(elementId, \"_delete\"));\n    return [generatorDiffElement(_objectSpread(_objectSpread({}, oldElement), {}, {\n      id: \"\".concat(elementId, \"_delete\")\n    }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE), generatorDiffElement(_objectSpread(_objectSpread({}, element), {}, {\n      id: \"\".concat(elementId, \"_add\")\n    }), TEXT_STYLE_MAP.ADD, ADDED_STYLE)];\n  }\n\n  // Content does not change\n  if (ObjectUtils.isSameObject(element, oldElement, [...IGNORE_KEYS, 'type'])) {\n    return [element];\n  }\n\n  // Compare content\n  const {\n    children: currentChildren\n  } = element;\n  const {\n    children: oldChildren\n  } = oldElement;\n  const {\n    map: currentMap,\n    ids: currentIds\n  } = generateIdMapAndIds(currentChildren);\n  const {\n    map: oldMap,\n    ids: oldIds\n  } = generateIdMapAndIds(oldChildren);\n  const idDiffs = getIdDiffs(oldIds, currentIds);\n  let newChildren = [];\n  idDiffs.forEach(idDiff => {\n    const ids = idDiff.value;\n    const isAdded = idDiff.added;\n    const isDelete = idDiff.removed;\n    ids.forEach(id => {\n      const newChildrenElement = currentMap[id];\n      const oldChildrenElement = oldMap[id];\n      if (isAdded) {\n        diff.changes.push(id);\n        newChildren.push(generatorDiffElement(newChildrenElement, TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n      } else if (isDelete) {\n        diff.changes.push(id);\n        newChildren.push(generatorDiffElement(oldChildrenElement, TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n      } else {\n        if (ObjectUtils.isSameObject(newChildrenElement, oldChildrenElement, IGNORE_KEYS)) {\n          newChildren.push(newChildrenElement);\n        } else {\n          if (newChildrenElement.type === oldChildrenElement.type) {\n            if (!newChildrenElement.type) {\n              const textDiffs = getTextDiff(newChildrenElement, oldChildrenElement, diff);\n              newChildren.push(...textDiffs);\n            } else if (newChildrenElement.type === ELEMENT_TYPE.IMAGE) {\n              if (newChildrenElement.data.src === oldChildrenElement.data.src) {\n                newChildren.push(newChildrenElement);\n              } else {\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, element), {}, {\n                  id: element.id + '_add'\n                }), TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, oldChildrenElement), {}, {\n                  id: element.id + '_delete'\n                }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n              }\n            } else if (newChildrenElement.type === ELEMENT_TYPE.LINK) {\n              if (newChildrenElement.title !== oldChildrenElement.title) {\n                const diffElements = getCommonDiff(newChildrenElement, oldChildrenElement, diff);\n                newChildren.push(...diffElements);\n              } else if (newChildrenElement.href !== oldChildrenElement.href) {\n                diff.changes.push(oldChildrenElement.id + '_delete');\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, oldChildrenElement), {}, {\n                  id: oldChildrenElement.id + '_delete'\n                }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n                newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, newChildrenElement), {}, {\n                  id: newChildrenElement.id + '_add'\n                }), TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n              } else {\n                newChildren.push(newChildrenElement);\n              }\n            } else if (newChildrenElement.type === ELEMENT_TYPE.TABLE_ROW || newChildrenElement.type === ELEMENT_TYPE.TABLE_CELL) {\n              const newRows = getCommonDiff(newChildrenElement, oldChildrenElement, diff);\n              newChildren.push(...newRows);\n            } else {\n              const commonDiffs = getCommonDiff(newChildrenElement, oldChildrenElement, diff);\n              newChildren.push(...commonDiffs);\n            }\n          } else {\n            diff.changes.push(oldChildrenElement.id + '_delete');\n            newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, oldChildrenElement), {}, {\n              id: oldChildrenElement.id + '_delete'\n            }), TEXT_STYLE_MAP.DELETE, DELETED_STYLE));\n            newChildren.push(generatorDiffTextElement(_objectSpread(_objectSpread({}, newChildrenElement), {}, {\n              id: newChildrenElement.id + '_add'\n            }), TEXT_STYLE_MAP.ADD, ADDED_STYLE));\n          }\n        }\n      }\n    });\n  });\n  return [_objectSpread(_objectSpread({}, element), {}, {\n    children: newChildren\n  })];\n};\nconst updateDiffValue = (diff, element, oldElement) => {\n  if (!diff || !element || !oldElement) return;\n  if (ObjectUtils.isSameObject(element, oldElement, IGNORE_KEYS)) {\n    diff.value.push(element);\n    return;\n  }\n  const elements = getCommonDiff(element, oldElement, diff);\n  elements.forEach(item => {\n    // Changing empty characters to other characters\n    if (!item.add && item.children.find(child => child.add === true)) {\n      item.add = true;\n    }\n    diff.value.push(item);\n  });\n};\n\n/**\n * params:\n    * currentValue: current version document content\n    * oldValue: last version document content\n * return { value: [], change: [] }\n*/\nconst getElementDiffValue = (currentContent, oldContent) => {\n  // init\n  let diff = {\n    value: [],\n    changes: []\n  };\n  const {\n    map: currentContentMap,\n    ids: currentIds\n  } = generateIdMapAndIds(currentContent);\n  const {\n    map: oldContentMap,\n    ids: oldIds\n  } = generateIdMapAndIds(oldContent);\n  const diffs = getIdDiffs(oldIds, currentIds);\n  diffs.forEach(diffItem => {\n    const elementIds = diffItem.value;\n    if (diffItem.removed) {\n      elementIds.forEach(elementId => {\n        diff.changes.push(elementId);\n        const element = oldContentMap[elementId];\n        const diffElement = generatorDiffElement(element, TEXT_STYLE_MAP.DELETE, DELETED_STYLE);\n        diff.value.push(diffElement);\n      });\n    } else if (diffItem.added) {\n      elementIds.forEach(elementId => {\n        diff.changes.push(elementId);\n        const element = currentContentMap[elementId];\n        const diffElement = generatorDiffElement(element, TEXT_STYLE_MAP.ADD, ADDED_STYLE);\n        diff.value.push(diffElement);\n      });\n    } else {\n      elementIds.forEach(elementId => {\n        const element = currentContentMap[elementId];\n        updateDiffValue(diff, element, oldContentMap[element.id]);\n      });\n    }\n  });\n  return diff;\n};\n\n/**\n * params:\n    * currentValue: current version document\n    * oldValue: last version document\n * return { value: [], change: [] }\n*/\nexport const getDiff = function () {\n  let currentValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    children: []\n  };\n  let oldValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    children: []\n  };\n  if (!currentValue && !oldValue) return {\n    value: [],\n    changes: []\n  };\n  if (!currentValue && oldValue) return {\n    value: normalizeChildren(oldValue.children),\n    changes: []\n  };\n  if (currentValue && !oldValue) return {\n    value: normalizeChildren(currentValue.children),\n    changes: []\n  };\n  const {\n    version: currentVersion,\n    children: currentContent\n  } = _objectSpread(_objectSpread({}, currentValue), {}, {\n    children: normalizeChildren(currentValue.children)\n  });\n  const {\n    version: oldVersion,\n    children: oldContent\n  } = _objectSpread(_objectSpread({}, oldValue), {}, {\n    children: normalizeChildren(oldValue.children)\n  });\n  if (currentVersion === oldVersion) return {\n    value: currentContent,\n    changes: []\n  };\n  return getElementDiffValue(currentContent, oldContent);\n};\nwindow.getIdDiffs = getIdDiffs;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}