{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport InlineBugFixer from '../../commons/Inline-bug-fix-wrapper';\nimport { ElementPopover } from '../../commons';\nimport { getAboveBlockNode } from '../../core';\nimport { ReactEditor } from '@seafile/slate-react';\nimport { Node, Transforms } from '@seafile/slate';\nimport { transformToText } from './helper';\nimport { useScrollContext } from '../../../hooks/use-scroll-context';\nimport { INSERT_POSITION } from '../../constants';\nimport QuickInsertBlockMenu from '../../toolbar/insert-element-toolbar';\nvar RenderQuickInsert = function RenderQuickInsert(_ref, editor) {\n  var attributes = _ref.attributes,\n    children = _ref.children,\n    element = _ref.element,\n    readonly = _ref.readonly;\n  var _useState = useState({\n      top: 0,\n      left: 0\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    menuStyle = _useState2[0],\n    setMenuStyle = _useState2[1];\n  var sideMenuRef = useRef(null);\n  var scrollRef = useScrollContext();\n  var insertElmRef = useRef(null);\n  var aboveBlockNode = getAboveBlockNode(editor);\n  var searchText = Node.string(element);\n  var handleClick = useCallback(function (e) {\n    if (!insertElmRef.current.contains(e.target)) {\n      transformToText(editor, element);\n    }\n  }, [editor, element]);\n  var genStyle = function genStyle(top, left) {\n    var overflowY = top + sideMenuRef.current.offsetHeight - document.body.clientHeight;\n    if (overflowY > 0) {\n      top = top - overflowY - 10;\n    }\n    return \"top: \".concat(top, \"px; left: \").concat(left, \"px\");\n  };\n  var handleInsertMenuStyle = useCallback(function () {\n    var currentDom = ReactEditor.toDOMNode(editor, element);\n    var _currentDom$getBoundi = currentDom.getBoundingClientRect(),\n      left = _currentDom$getBoundi.left,\n      top = _currentDom$getBoundi.top;\n    var style = genStyle(top, left - 10);\n    setMenuStyle(style);\n  }, [editor, element]);\n  var handleScroll = useCallback(function (e) {\n    handleInsertMenuStyle();\n  }, [handleInsertMenuStyle]);\n  useEffect(function () {\n    var scrollDom = scrollRef.current;\n    handleInsertMenuStyle();\n    document.addEventListener('click', handleClick);\n    scrollDom.addEventListener('scroll', handleScroll);\n    return function () {\n      document.removeEventListener('click', handleClick);\n      scrollDom.removeEventListener('scroll', handleScroll);\n    };\n  }, [editor, element, handleClick, handleInsertMenuStyle, handleScroll, scrollRef]);\n  var handleInsertBlock = function handleInsertBlock(node) {\n    Transforms.delete(editor, {\n      at: ReactEditor.findPath(editor, element)\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"span\", {\n    ref: insertElmRef\n  }, /*#__PURE__*/React.createElement(\"span\", Object.assign({}, attributes, {\n    className: \"\"\n  }), /*#__PURE__*/React.createElement(InlineBugFixer, null), /*#__PURE__*/React.createElement(\"span\", null, \"/\", children), /*#__PURE__*/React.createElement(InlineBugFixer, null), /*#__PURE__*/React.createElement(ElementPopover, {\n    className: \"sdoc-side-menu-popover\",\n    style: menuStyle\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: sideMenuRef,\n    className: \"sdoc-side-menu sdoc-dropdown-menu\"\n  }, /*#__PURE__*/React.createElement(QuickInsertBlockMenu, {\n    insertPosition: INSERT_POSITION.AFTER,\n    slateNode: aboveBlockNode === null || aboveBlockNode === void 0 ? void 0 : aboveBlockNode[0],\n    searchText: searchText,\n    callback: handleInsertBlock\n  })))));\n};\nexport default RenderQuickInsert;","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useState","InlineBugFixer","ElementPopover","getAboveBlockNode","ReactEditor","Node","Transforms","transformToText","useScrollContext","INSERT_POSITION","QuickInsertBlockMenu","RenderQuickInsert","_ref","editor","attributes","children","element","readonly","_useState","top","left","_useState2","_slicedToArray","menuStyle","setMenuStyle","sideMenuRef","scrollRef","insertElmRef","aboveBlockNode","searchText","string","handleClick","e","current","contains","target","genStyle","overflowY","offsetHeight","document","body","clientHeight","concat","handleInsertMenuStyle","currentDom","toDOMNode","_currentDom$getBoundi","getBoundingClientRect","style","handleScroll","scrollDom","addEventListener","removeEventListener","handleInsertBlock","node","delete","at","findPath","createElement","ref","Object","assign","className","insertPosition","AFTER","slateNode","callback"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/quick-insert/render-elem.js"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport InlineBugFixer from '../../commons/Inline-bug-fix-wrapper';\nimport { ElementPopover } from '../../commons';\nimport { getAboveBlockNode } from '../../core';\nimport { ReactEditor } from '@seafile/slate-react';\nimport { Node, Transforms } from '@seafile/slate';\nimport { transformToText } from './helper';\nimport { useScrollContext } from '../../../hooks/use-scroll-context';\nimport { INSERT_POSITION } from '../../constants';\nimport QuickInsertBlockMenu from '../../toolbar/insert-element-toolbar';\nconst RenderQuickInsert = (_ref, editor) => {\n  let {\n    attributes,\n    children,\n    element,\n    readonly\n  } = _ref;\n  const [menuStyle, setMenuStyle] = useState({\n    top: 0,\n    left: 0\n  });\n  const sideMenuRef = useRef(null);\n  const scrollRef = useScrollContext();\n  const insertElmRef = useRef(null);\n  const aboveBlockNode = getAboveBlockNode(editor);\n  const searchText = Node.string(element);\n  const handleClick = useCallback(e => {\n    if (!insertElmRef.current.contains(e.target)) {\n      transformToText(editor, element);\n    }\n  }, [editor, element]);\n  const genStyle = (top, left) => {\n    const overflowY = top + sideMenuRef.current.offsetHeight - document.body.clientHeight;\n    if (overflowY > 0) {\n      top = top - overflowY - 10;\n    }\n    return \"top: \".concat(top, \"px; left: \").concat(left, \"px\");\n  };\n  const handleInsertMenuStyle = useCallback(() => {\n    const currentDom = ReactEditor.toDOMNode(editor, element);\n    const {\n      left,\n      top\n    } = currentDom.getBoundingClientRect();\n    const style = genStyle(top, left - 10);\n    setMenuStyle(style);\n  }, [editor, element]);\n  const handleScroll = useCallback(e => {\n    handleInsertMenuStyle();\n  }, [handleInsertMenuStyle]);\n  useEffect(() => {\n    const scrollDom = scrollRef.current;\n    handleInsertMenuStyle();\n    document.addEventListener('click', handleClick);\n    scrollDom.addEventListener('scroll', handleScroll);\n    return () => {\n      document.removeEventListener('click', handleClick);\n      scrollDom.removeEventListener('scroll', handleScroll);\n    };\n  }, [editor, element, handleClick, handleInsertMenuStyle, handleScroll, scrollRef]);\n  const handleInsertBlock = node => {\n    Transforms.delete(editor, {\n      at: ReactEditor.findPath(editor, element)\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"span\", {\n    ref: insertElmRef\n  }, /*#__PURE__*/React.createElement(\"span\", Object.assign({}, attributes, {\n    className: \"\"\n  }), /*#__PURE__*/React.createElement(InlineBugFixer, null), /*#__PURE__*/React.createElement(\"span\", null, \"/\", children), /*#__PURE__*/React.createElement(InlineBugFixer, null), /*#__PURE__*/React.createElement(ElementPopover, {\n    className: \"sdoc-side-menu-popover\",\n    style: menuStyle\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: sideMenuRef,\n    className: \"sdoc-side-menu sdoc-dropdown-menu\"\n  }, /*#__PURE__*/React.createElement(QuickInsertBlockMenu, {\n    insertPosition: INSERT_POSITION.AFTER,\n    slateNode: aboveBlockNode === null || aboveBlockNode === void 0 ? void 0 : aboveBlockNode[0],\n    searchText: searchText,\n    callback: handleInsertBlock\n  })))));\n};\nexport default RenderQuickInsert;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}