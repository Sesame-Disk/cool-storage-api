{"ast":null,"code":"import _defineProperty from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from'react';import{UncontrolledPopover}from'reactstrap';import{gettext}from'../../../../../utils/constants';import SearchInput from'../search-input';import{getSelectColumnOptions}from'../../../../../utils/extra-attributes';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SingleSelectEditor=/*#__PURE__*/function(_Component){_inherits(SingleSelectEditor,_Component);var _super=_createSuper(SingleSelectEditor);function SingleSelectEditor(_props){var _this;_classCallCheck(this,SingleSelectEditor);_this=_super.call(this,_props);_this.getCascadeColumnValue=function(props){var column=props.column,row=props.row,columns=props.columns;var data=column.data;var _ref=data||{},cascade_column_key=_ref.cascade_column_key;if(!cascade_column_key)return'';var cascadeColumn=columns.find(function(item){return item.key===cascade_column_key;});if(!cascadeColumn)return'';return row[cascade_column_key];};_this.getSelectColumnOptions=function(props){var column=props.column,row=props.row,columns=props.columns;var options=getSelectColumnOptions(column);var data=column.data;var _ref2=data||{},cascade_column_key=_ref2.cascade_column_key,cascade_settings=_ref2.cascade_settings;if(cascade_column_key){var cascadeColumn=columns.find(function(item){return item.key===cascade_column_key;});if(cascadeColumn){var cascadeColumnValue=row[cascade_column_key];if(!cascadeColumnValue)return[];var cascadeSetting=cascade_settings[cascadeColumnValue];if(!cascadeSetting||!Array.isArray(cascadeSetting)||cascadeSetting.length===0)return[];return options.filter(function(option){return cascadeSetting.includes(option.id);});}}return options;};_this.toggle=function(){_this.ref.toggle();_this.props.onUpdateState();};_this.onChangeSearch=function(searchVal){var oldSearchVal=_this.state.searchVal;if(oldSearchVal===searchVal)return;var val=searchVal.toLowerCase();var filteredOptions=val?_this.options.filter(function(item){return item.name&&item.name.toLowerCase().indexOf(val)>-1;}):_this.options;_this.setState({searchVal:searchVal,filteredOptions:filteredOptions});};_this.onSelectOption=function(optionID){var column=_this.props.column;_this.setState({value:optionID},function(){_this.props.onCommit(_defineProperty({},column.key,optionID),column);_this.toggle();});};var _options=_this.getSelectColumnOptions(_props);_this.state={value:_props.row[_props.column.key],searchVal:'',highlightIndex:-1,maxItemNum:0,itemHeight:0,filteredOptions:_options};_this.options=_options;_this.timer=null;_this.editorKey=\"single-select-editor-\".concat(_props.column.key);return _this;}_createClass(SingleSelectEditor,[{key:\"UNSAFE_componentWillReceiveProps\",value:function UNSAFE_componentWillReceiveProps(nextProps){var currentCascadeColumnValue=this.getCascadeColumnValue(this.props);var nextCascadeColumnValue=this.getCascadeColumnValue(nextProps);if(currentCascadeColumnValue!==nextCascadeColumnValue){this.options=this.getSelectColumnOptions(nextProps);this.setState({filteredOptions:this.options});}}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,value=_this$state.value,filteredOptions=_this$state.filteredOptions;var column=this.props.column;return/*#__PURE__*/_jsx(UncontrolledPopover,{target:this.editorKey,className:\"single-select-editor-popover\",trigger:\"legacy\",placement:\"bottom-start\",hideArrow:true,toggle:this.toggle,ref:function ref(_ref3){return _this2.ref=_ref3;},children:/*#__PURE__*/_jsxs(\"div\",{className:\"single-select-editor-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"search-single-selects\",children:/*#__PURE__*/_jsx(SearchInput,{placeholder:gettext('Find an option'),onKeyDown:this.onKeyDown,onChange:this.onChangeSearch,autoFocus:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"single-select-editor-content\",children:filteredOptions.map(function(option){var isSelected=value===option.id;var style={backgroundColor:option.color,color:option.textColor||null,maxWidth:Math.max(200-62,column.width?column.width-62:0)};return/*#__PURE__*/_jsxs(\"div\",{className:\"single-select-option-container\",onClick:_this2.onSelectOption.bind(_this2,isSelected?null:option.id),children:[/*#__PURE__*/_jsx(\"div\",{className:\"single-select-option\",style:style,children:option.name}),/*#__PURE__*/_jsx(\"div\",{className:\"single-select-option-selected\",children:isSelected&&/*#__PURE__*/_jsx(\"i\",{})})]},option.id);})})]})});}}]);return SingleSelectEditor;}(Component);export default SingleSelectEditor;","map":{"version":3,"names":["React","Component","UncontrolledPopover","gettext","SearchInput","getSelectColumnOptions","jsx","_jsx","jsxs","_jsxs","SingleSelectEditor","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","getCascadeColumnValue","column","row","columns","data","_ref","cascade_column_key","cascadeColumn","find","item","key","options","_ref2","cascade_settings","cascadeColumnValue","cascadeSetting","Array","isArray","length","filter","option","includes","id","toggle","ref","onUpdateState","onChangeSearch","searchVal","oldSearchVal","state","val","toLowerCase","filteredOptions","name","indexOf","setState","onSelectOption","optionID","value","onCommit","_defineProperty","highlightIndex","maxItemNum","itemHeight","timer","editorKey","concat","_createClass","UNSAFE_componentWillReceiveProps","nextProps","currentCascadeColumnValue","nextCascadeColumnValue","render","_this2","_this$state","target","className","trigger","placement","hideArrow","children","placeholder","onKeyDown","onChange","autoFocus","map","isSelected","style","backgroundColor","color","textColor","maxWidth","Math","max","width","onClick","bind"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/dialog/extra-attributes-dialog/editor/single-select/single-select-editor.js"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { UncontrolledPopover } from 'reactstrap';\nimport { gettext } from '../../../../../utils/constants';\nimport SearchInput from '../search-input';\nimport { getSelectColumnOptions } from '../../../../../utils/extra-attributes';\n\nclass SingleSelectEditor extends Component {\n\n  constructor(props) {\n    super(props);\n    const options = this.getSelectColumnOptions(props);\n    this.state = {\n      value: props.row[props.column.key],\n      searchVal: '',\n      highlightIndex: -1,\n      maxItemNum: 0,\n      itemHeight: 0,\n      filteredOptions: options,\n    };\n    this.options = options;\n    this.timer = null;\n    this.editorKey = `single-select-editor-${props.column.key}`;\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const currentCascadeColumnValue = this.getCascadeColumnValue(this.props);\n    const nextCascadeColumnValue = this.getCascadeColumnValue(nextProps);\n    if (currentCascadeColumnValue !== nextCascadeColumnValue) {\n      this.options = this.getSelectColumnOptions(nextProps);\n      this.setState({ filteredOptions: this.options });\n    }\n  }\n\n  getCascadeColumnValue = (props) => {\n    const { column, row, columns } = props;\n    const { data } = column;\n    const { cascade_column_key } = data || {};\n    if (!cascade_column_key) return '';\n    const cascadeColumn = columns.find(item => item.key === cascade_column_key);\n    if (!cascadeColumn) return '';\n    return row[cascade_column_key];\n  };\n\n  getSelectColumnOptions = (props) => {\n    const { column, row, columns } = props;\n    let options = getSelectColumnOptions(column);\n    const { data } = column;\n    const { cascade_column_key, cascade_settings } = data || {};\n    if (cascade_column_key) {\n      const cascadeColumn = columns.find(item => item.key === cascade_column_key);\n      if (cascadeColumn) {\n        const cascadeColumnValue = row[cascade_column_key];\n        if (!cascadeColumnValue) return [];\n        const cascadeSetting = cascade_settings[cascadeColumnValue];\n        if (!cascadeSetting || !Array.isArray(cascadeSetting) || cascadeSetting.length === 0) return [];\n        return options.filter(option => cascadeSetting.includes(option.id));\n      }\n    }\n    return options;\n  };\n\n  toggle = () => {\n    this.ref.toggle();\n    this.props.onUpdateState();\n  };\n\n  onChangeSearch = (searchVal) => {\n    const { searchVal: oldSearchVal } = this.state;\n    if (oldSearchVal === searchVal) return;\n    const val = searchVal.toLowerCase();\n    const filteredOptions = val ?\n      this.options.filter((item) => item.name && item.name.toLowerCase().indexOf(val) > -1) : this.options;\n    this.setState({ searchVal, filteredOptions });\n  };\n\n  onSelectOption = (optionID) => {\n    const { column } = this.props;\n    this.setState({ value: optionID }, () => {\n      this.props.onCommit({ [column.key]: optionID }, column);\n      this.toggle();\n    });\n  };\n\n  render() {\n    const { value, filteredOptions } = this.state;\n    const { column } = this.props;\n\n    return (\n      <UncontrolledPopover\n        target={this.editorKey}\n        className=\"single-select-editor-popover\"\n        trigger=\"legacy\"\n        placement=\"bottom-start\"\n        hideArrow={true}\n        toggle={this.toggle}\n        ref={ref => this.ref = ref}\n      >\n        <div className=\"single-select-editor-container\">\n          <div className=\"search-single-selects\">\n            <SearchInput\n              placeholder={gettext('Find an option')}\n              onKeyDown={this.onKeyDown}\n              onChange={this.onChangeSearch}\n              autoFocus={true}\n            />\n          </div>\n          <div className=\"single-select-editor-content\">\n            {filteredOptions.map(option => {\n              const isSelected = value === option.id;\n              const style = {\n                backgroundColor: option.color,\n                color: option.textColor || null,\n                maxWidth: Math.max(200 - 62,  column.width ? column.width  -62 : 0)\n              };\n              return (\n                <div className=\"single-select-option-container\" key={option.id} onClick={this.onSelectOption.bind(this, isSelected ? null : option.id)}>\n                  <div className=\"single-select-option\" style={style}>{option.name}</div>\n                  <div className=\"single-select-option-selected\">\n                    {isSelected && (<i ></i>)}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </UncontrolledPopover>\n    );\n  }\n}\n\nSingleSelectEditor.propTypes = {\n  value: PropTypes.string,\n  row: PropTypes.object,\n  column: PropTypes.object,\n  columns: PropTypes.array,\n  onUpdateState: PropTypes.func,\n  onCommit: PropTypes.func,\n};\n\nexport default SingleSelectEditor;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}