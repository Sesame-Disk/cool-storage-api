{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useRef, useCallback, useState, useEffect, useMemo } from 'react';\nimport { useSlateStatic } from '@seafile/slate-react';\nimport classnames from 'classnames';\nimport ObjectUtils from '../../../../../../utils/object-utils';\nimport { useResizeHandlersContext, useTableSelectedRangeContext } from '../../hooks';\nimport { useScrollContext } from '../../../../../../hooks/use-scroll-context';\nimport { ELEMENT_TYPE } from '../../../../../constants';\nimport { findPath, getSelectedNodeByType } from '../../../../../core';\nimport { elementHasImage, getRowDomHeight } from '../../../helpers';\nvar RowHeader = function RowHeader(_ref) {\n  var row = _ref.row,\n    index = _ref.index,\n    addIconPosition = _ref.addIconPosition,\n    setAddIconPosition = _ref.setAddIconPosition,\n    setInsertRowIndex = _ref.setInsertRowIndex,\n    selectRange = _ref.selectRange,\n    tableSize = _ref.tableSize,\n    handleDragStart = _ref.handleDragStart,\n    handleDragEnd = _ref.handleDragEnd;\n  var editor = useSlateStatic();\n  var tableSelectedRange = editor.tableSelectedRange;\n  useEffect(function () {\n    setRowHeight(getRowDomHeight(editor, row));\n  }, [editor, row, tableSize]);\n  var oldRowHeight = getRowDomHeight(editor, row);\n  var _useState = useState(oldRowHeight),\n    _useState2 = _slicedToArray(_useState, 2),\n    rowHeight = _useState2[0],\n    setRowHeight = _useState2[1];\n  var rowHeaderRef = useRef(null);\n  var columns = useResizeHandlersContext();\n  var scrollContext = useScrollContext();\n  var selectedRange = useTableSelectedRangeContext();\n  var currentCell = getSelectedNodeByType(editor, ELEMENT_TYPE.TABLE_CELL);\n  var currentCellPath = currentCell ? findPath(editor, currentCell, [-1, -1]) : [-1, -1];\n  var pathLength = currentCellPath.length;\n  var canDrag = useMemo(function () {\n    var minRowIndex = tableSelectedRange.minRowIndex,\n      maxRowIndex = tableSelectedRange.maxRowIndex,\n      minColIndex = tableSelectedRange.minColIndex,\n      maxColIndex = tableSelectedRange.maxColIndex;\n    var _tableSize = _slicedToArray(tableSize, 2),\n      colNum = _tableSize[1];\n    var isSelectRow = minColIndex === 0 && maxColIndex === colNum - 1;\n    var isSelectRangeRow = minRowIndex <= index && index <= maxRowIndex;\n    var isSelectAllRows = minRowIndex === 0 && maxRowIndex === tableSize[0] - 1;\n    if (tableSize[0] === 1 || isSelectAllRows) return false;\n    if (isSelectRow && isSelectRangeRow) return true;\n    return false;\n  }, [index, tableSelectedRange, tableSize]);\n  useEffect(function () {\n    if (elementHasImage(row)) {\n      // There is a delay in image loading\n      var time = setTimeout(function () {\n        return setRowHeight(getRowDomHeight(editor, row));\n      }, 300);\n      return function () {\n        clearTimeout(time);\n      };\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [columns, row, index]);\n  var onMouseMove = useCallback(function (event) {\n    var _rowHeaderRef$current = rowHeaderRef.current.getBoundingClientRect(),\n      left = _rowHeaderRef$current.left,\n      height = _rowHeaderRef$current.height,\n      top = _rowHeaderRef$current.top;\n    var halfElementY = top + height / 2;\n    var nextAddIconPosition = {\n      left: left,\n      top: event.clientY > halfElementY ? top + height - 7 : top - 7\n    };\n    var _scrollContext$curren = scrollContext.current.getBoundingClientRect(),\n      scrollContextTop = _scrollContext$curren.top,\n      scrollContextHeight = _scrollContext$curren.height;\n    if (nextAddIconPosition.top < scrollContextTop) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (nextAddIconPosition.top > scrollContextTop + scrollContextHeight) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (ObjectUtils.isSameObject(nextAddIconPosition, addIconPosition)) return;\n    setInsertRowIndex(event.clientY > halfElementY ? index : index - 1);\n    setAddIconPosition(nextAddIconPosition);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, row, columns]);\n  var onMouseLeave = useCallback(function (event) {\n    setAddIconPosition(undefined);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, row, columns]);\n  var isSelectedARow = selectedRange.minColIndex === 0 && selectedRange.maxColIndex === tableSize[1] - 1;\n  var isSelectedSomeRow = selectedRange.minRowIndex <= index && index <= selectedRange.maxRowIndex;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames('sdoc-table-row-header', {\n      'range-selected': isSelectedARow && isSelectedSomeRow,\n      'range-selected-tip': !isSelectedARow && isSelectedSomeRow || currentCellPath[pathLength - 2] === index,\n      'drag': canDrag\n    }),\n    style: {\n      height: rowHeight\n    },\n    ref: rowHeaderRef,\n    onClick: function onClick() {\n      return selectRange(index);\n    },\n    onMouseMove: onMouseMove,\n    onMouseLeave: onMouseLeave,\n    onDragStart: handleDragStart,\n    onDragEnd: handleDragEnd,\n    draggable: canDrag\n  });\n};\nexport default RowHeader;","map":{"version":3,"names":["React","useRef","useCallback","useState","useEffect","useMemo","useSlateStatic","classnames","ObjectUtils","useResizeHandlersContext","useTableSelectedRangeContext","useScrollContext","ELEMENT_TYPE","findPath","getSelectedNodeByType","elementHasImage","getRowDomHeight","RowHeader","_ref","row","index","addIconPosition","setAddIconPosition","setInsertRowIndex","selectRange","tableSize","handleDragStart","handleDragEnd","editor","tableSelectedRange","setRowHeight","oldRowHeight","_useState","_useState2","_slicedToArray","rowHeight","rowHeaderRef","columns","scrollContext","selectedRange","currentCell","TABLE_CELL","currentCellPath","pathLength","length","canDrag","minRowIndex","maxRowIndex","minColIndex","maxColIndex","_tableSize","colNum","isSelectRow","isSelectRangeRow","isSelectAllRows","time","setTimeout","clearTimeout","onMouseMove","event","_rowHeaderRef$current","current","getBoundingClientRect","left","height","top","halfElementY","nextAddIconPosition","clientY","_scrollContext$curren","scrollContextTop","scrollContextHeight","undefined","isSameObject","onMouseLeave","isSelectedARow","isSelectedSomeRow","createElement","className","style","ref","onClick","onDragStart","onDragEnd","draggable"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/table/render/table-header/rows-header/row-header.js"],"sourcesContent":["import React, { useRef, useCallback, useState, useEffect, useMemo } from 'react';\nimport { useSlateStatic } from '@seafile/slate-react';\nimport classnames from 'classnames';\nimport ObjectUtils from '../../../../../../utils/object-utils';\nimport { useResizeHandlersContext, useTableSelectedRangeContext } from '../../hooks';\nimport { useScrollContext } from '../../../../../../hooks/use-scroll-context';\nimport { ELEMENT_TYPE } from '../../../../../constants';\nimport { findPath, getSelectedNodeByType } from '../../../../../core';\nimport { elementHasImage, getRowDomHeight } from '../../../helpers';\nconst RowHeader = _ref => {\n  let {\n    row,\n    index,\n    addIconPosition,\n    setAddIconPosition,\n    setInsertRowIndex,\n    selectRange,\n    tableSize,\n    handleDragStart,\n    handleDragEnd\n  } = _ref;\n  const editor = useSlateStatic();\n  const {\n    tableSelectedRange\n  } = editor;\n  useEffect(() => {\n    setRowHeight(getRowDomHeight(editor, row));\n  }, [editor, row, tableSize]);\n  const oldRowHeight = getRowDomHeight(editor, row);\n  const [rowHeight, setRowHeight] = useState(oldRowHeight);\n  const rowHeaderRef = useRef(null);\n  const columns = useResizeHandlersContext();\n  const scrollContext = useScrollContext();\n  const selectedRange = useTableSelectedRangeContext();\n  const currentCell = getSelectedNodeByType(editor, ELEMENT_TYPE.TABLE_CELL);\n  const currentCellPath = currentCell ? findPath(editor, currentCell, [-1, -1]) : [-1, -1];\n  const pathLength = currentCellPath.length;\n  const canDrag = useMemo(() => {\n    const {\n      minRowIndex,\n      maxRowIndex,\n      minColIndex,\n      maxColIndex\n    } = tableSelectedRange;\n    const [, colNum] = tableSize;\n    const isSelectRow = minColIndex === 0 && maxColIndex === colNum - 1;\n    const isSelectRangeRow = minRowIndex <= index && index <= maxRowIndex;\n    const isSelectAllRows = minRowIndex === 0 && maxRowIndex === tableSize[0] - 1;\n    if (tableSize[0] === 1 || isSelectAllRows) return false;\n    if (isSelectRow && isSelectRangeRow) return true;\n    return false;\n  }, [index, tableSelectedRange, tableSize]);\n  useEffect(() => {\n    if (elementHasImage(row)) {\n      // There is a delay in image loading\n      const time = setTimeout(() => setRowHeight(getRowDomHeight(editor, row)), 300);\n      return () => {\n        clearTimeout(time);\n      };\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [columns, row, index]);\n  const onMouseMove = useCallback(event => {\n    const {\n      left,\n      height,\n      top\n    } = rowHeaderRef.current.getBoundingClientRect();\n    const halfElementY = top + height / 2;\n    const nextAddIconPosition = {\n      left: left,\n      top: event.clientY > halfElementY ? top + height - 7 : top - 7\n    };\n    const {\n      top: scrollContextTop,\n      height: scrollContextHeight\n    } = scrollContext.current.getBoundingClientRect();\n    if (nextAddIconPosition.top < scrollContextTop) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (nextAddIconPosition.top > scrollContextTop + scrollContextHeight) {\n      setAddIconPosition(undefined);\n      return;\n    }\n    if (ObjectUtils.isSameObject(nextAddIconPosition, addIconPosition)) return;\n    setInsertRowIndex(event.clientY > halfElementY ? index : index - 1);\n    setAddIconPosition(nextAddIconPosition);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, row, columns]);\n  const onMouseLeave = useCallback(event => {\n    setAddIconPosition(undefined);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [index, addIconPosition, row, columns]);\n  const isSelectedARow = selectedRange.minColIndex === 0 && selectedRange.maxColIndex === tableSize[1] - 1;\n  const isSelectedSomeRow = selectedRange.minRowIndex <= index && index <= selectedRange.maxRowIndex;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classnames('sdoc-table-row-header', {\n      'range-selected': isSelectedARow && isSelectedSomeRow,\n      'range-selected-tip': !isSelectedARow && isSelectedSomeRow || currentCellPath[pathLength - 2] === index,\n      'drag': canDrag\n    }),\n    style: {\n      height: rowHeight\n    },\n    ref: rowHeaderRef,\n    onClick: () => selectRange(index),\n    onMouseMove: onMouseMove,\n    onMouseLeave: onMouseLeave,\n    onDragStart: handleDragStart,\n    onDragEnd: handleDragEnd,\n    draggable: canDrag\n  });\n};\nexport default RowHeader;"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,WAAW,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,OAAO,QAAQ,OAAO;AAChF,SAASC,cAAc,QAAQ,sBAAsB;AACrD,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,WAAW,MAAM,sCAAsC;AAC9D,SAASC,wBAAwB,EAAEC,4BAA4B,QAAQ,aAAa;AACpF,SAASC,gBAAgB,QAAQ,4CAA4C;AAC7E,SAASC,YAAY,QAAQ,0BAA0B;AACvD,SAASC,QAAQ,EAAEC,qBAAqB,QAAQ,qBAAqB;AACrE,SAASC,eAAe,EAAEC,eAAe,QAAQ,kBAAkB;AACnE,IAAMC,SAAS,GAAG,SAAZA,SAASA,CAAGC,IAAI,EAAI;EACxB,IACEC,GAAG,GASDD,IAAI,CATNC,GAAG;IACHC,KAAK,GAQHF,IAAI,CARNE,KAAK;IACLC,eAAe,GAObH,IAAI,CAPNG,eAAe;IACfC,kBAAkB,GAMhBJ,IAAI,CANNI,kBAAkB;IAClBC,iBAAiB,GAKfL,IAAI,CALNK,iBAAiB;IACjBC,WAAW,GAITN,IAAI,CAJNM,WAAW;IACXC,SAAS,GAGPP,IAAI,CAHNO,SAAS;IACTC,eAAe,GAEbR,IAAI,CAFNQ,eAAe;IACfC,aAAa,GACXT,IAAI,CADNS,aAAa;EAEf,IAAMC,MAAM,GAAGtB,cAAc,CAAC,CAAC;EAC/B,IACEuB,kBAAkB,GAChBD,MAAM,CADRC,kBAAkB;EAEpBzB,SAAS,CAAC,YAAM;IACd0B,YAAY,CAACd,eAAe,CAACY,MAAM,EAAET,GAAG,CAAC,CAAC;EAC5C,CAAC,EAAE,CAACS,MAAM,EAAET,GAAG,EAAEM,SAAS,CAAC,CAAC;EAC5B,IAAMM,YAAY,GAAGf,eAAe,CAACY,MAAM,EAAET,GAAG,CAAC;EACjD,IAAAa,SAAA,GAAkC7B,QAAQ,CAAC4B,YAAY,CAAC;IAAAE,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAAjDG,SAAS,GAAAF,UAAA;IAAEH,YAAY,GAAAG,UAAA;EAC9B,IAAMG,YAAY,GAAGnC,MAAM,CAAC,IAAI,CAAC;EACjC,IAAMoC,OAAO,GAAG5B,wBAAwB,CAAC,CAAC;EAC1C,IAAM6B,aAAa,GAAG3B,gBAAgB,CAAC,CAAC;EACxC,IAAM4B,aAAa,GAAG7B,4BAA4B,CAAC,CAAC;EACpD,IAAM8B,WAAW,GAAG1B,qBAAqB,CAACc,MAAM,EAAEhB,YAAY,CAAC6B,UAAU,CAAC;EAC1E,IAAMC,eAAe,GAAGF,WAAW,GAAG3B,QAAQ,CAACe,MAAM,EAAEY,WAAW,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;EACxF,IAAMG,UAAU,GAAGD,eAAe,CAACE,MAAM;EACzC,IAAMC,OAAO,GAAGxC,OAAO,CAAC,YAAM;IAC5B,IACEyC,WAAW,GAITjB,kBAAkB,CAJpBiB,WAAW;MACXC,WAAW,GAGTlB,kBAAkB,CAHpBkB,WAAW;MACXC,WAAW,GAETnB,kBAAkB,CAFpBmB,WAAW;MACXC,WAAW,GACTpB,kBAAkB,CADpBoB,WAAW;IAEb,IAAAC,UAAA,GAAAhB,cAAA,CAAmBT,SAAS;MAAnB0B,MAAM,GAAAD,UAAA;IACf,IAAME,WAAW,GAAGJ,WAAW,KAAK,CAAC,IAAIC,WAAW,KAAKE,MAAM,GAAG,CAAC;IACnE,IAAME,gBAAgB,GAAGP,WAAW,IAAI1B,KAAK,IAAIA,KAAK,IAAI2B,WAAW;IACrE,IAAMO,eAAe,GAAGR,WAAW,KAAK,CAAC,IAAIC,WAAW,KAAKtB,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC;IAC7E,IAAIA,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI6B,eAAe,EAAE,OAAO,KAAK;IACvD,IAAIF,WAAW,IAAIC,gBAAgB,EAAE,OAAO,IAAI;IAChD,OAAO,KAAK;EACd,CAAC,EAAE,CAACjC,KAAK,EAAES,kBAAkB,EAAEJ,SAAS,CAAC,CAAC;EAC1CrB,SAAS,CAAC,YAAM;IACd,IAAIW,eAAe,CAACI,GAAG,CAAC,EAAE;MACxB;MACA,IAAMoC,IAAI,GAAGC,UAAU,CAAC;QAAA,OAAM1B,YAAY,CAACd,eAAe,CAACY,MAAM,EAAET,GAAG,CAAC,CAAC;MAAA,GAAE,GAAG,CAAC;MAC9E,OAAO,YAAM;QACXsC,YAAY,CAACF,IAAI,CAAC;MACpB,CAAC;IACH;;IAEA;EACF,CAAC,EAAE,CAAClB,OAAO,EAAElB,GAAG,EAAEC,KAAK,CAAC,CAAC;EACzB,IAAMsC,WAAW,GAAGxD,WAAW,CAAC,UAAAyD,KAAK,EAAI;IACvC,IAAAC,qBAAA,GAIIxB,YAAY,CAACyB,OAAO,CAACC,qBAAqB,CAAC,CAAC;MAH9CC,IAAI,GAAAH,qBAAA,CAAJG,IAAI;MACJC,MAAM,GAAAJ,qBAAA,CAANI,MAAM;MACNC,GAAG,GAAAL,qBAAA,CAAHK,GAAG;IAEL,IAAMC,YAAY,GAAGD,GAAG,GAAGD,MAAM,GAAG,CAAC;IACrC,IAAMG,mBAAmB,GAAG;MAC1BJ,IAAI,EAAEA,IAAI;MACVE,GAAG,EAAEN,KAAK,CAACS,OAAO,GAAGF,YAAY,GAAGD,GAAG,GAAGD,MAAM,GAAG,CAAC,GAAGC,GAAG,GAAG;IAC/D,CAAC;IACD,IAAAI,qBAAA,GAGI/B,aAAa,CAACuB,OAAO,CAACC,qBAAqB,CAAC,CAAC;MAF1CQ,gBAAgB,GAAAD,qBAAA,CAArBJ,GAAG;MACKM,mBAAmB,GAAAF,qBAAA,CAA3BL,MAAM;IAER,IAAIG,mBAAmB,CAACF,GAAG,GAAGK,gBAAgB,EAAE;MAC9ChD,kBAAkB,CAACkD,SAAS,CAAC;MAC7B;IACF;IACA,IAAIL,mBAAmB,CAACF,GAAG,GAAGK,gBAAgB,GAAGC,mBAAmB,EAAE;MACpEjD,kBAAkB,CAACkD,SAAS,CAAC;MAC7B;IACF;IACA,IAAIhE,WAAW,CAACiE,YAAY,CAACN,mBAAmB,EAAE9C,eAAe,CAAC,EAAE;IACpEE,iBAAiB,CAACoC,KAAK,CAACS,OAAO,GAAGF,YAAY,GAAG9C,KAAK,GAAGA,KAAK,GAAG,CAAC,CAAC;IACnEE,kBAAkB,CAAC6C,mBAAmB,CAAC;;IAEvC;EACF,CAAC,EAAE,CAAC/C,KAAK,EAAEC,eAAe,EAAEF,GAAG,EAAEkB,OAAO,CAAC,CAAC;EAC1C,IAAMqC,YAAY,GAAGxE,WAAW,CAAC,UAAAyD,KAAK,EAAI;IACxCrC,kBAAkB,CAACkD,SAAS,CAAC;;IAE7B;EACF,CAAC,EAAE,CAACpD,KAAK,EAAEC,eAAe,EAAEF,GAAG,EAAEkB,OAAO,CAAC,CAAC;EAC1C,IAAMsC,cAAc,GAAGpC,aAAa,CAACS,WAAW,KAAK,CAAC,IAAIT,aAAa,CAACU,WAAW,KAAKxB,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC;EACxG,IAAMmD,iBAAiB,GAAGrC,aAAa,CAACO,WAAW,IAAI1B,KAAK,IAAIA,KAAK,IAAImB,aAAa,CAACQ,WAAW;EAClG,OAAO,aAAa/C,KAAK,CAAC6E,aAAa,CAAC,KAAK,EAAE;IAC7CC,SAAS,EAAEvE,UAAU,CAAC,uBAAuB,EAAE;MAC7C,gBAAgB,EAAEoE,cAAc,IAAIC,iBAAiB;MACrD,oBAAoB,EAAE,CAACD,cAAc,IAAIC,iBAAiB,IAAIlC,eAAe,CAACC,UAAU,GAAG,CAAC,CAAC,KAAKvB,KAAK;MACvG,MAAM,EAAEyB;IACV,CAAC,CAAC;IACFkC,KAAK,EAAE;MACLf,MAAM,EAAE7B;IACV,CAAC;IACD6C,GAAG,EAAE5C,YAAY;IACjB6C,OAAO,EAAE,SAAAA,QAAA;MAAA,OAAMzD,WAAW,CAACJ,KAAK,CAAC;IAAA;IACjCsC,WAAW,EAAEA,WAAW;IACxBgB,YAAY,EAAEA,YAAY;IAC1BQ,WAAW,EAAExD,eAAe;IAC5ByD,SAAS,EAAExD,aAAa;IACxByD,SAAS,EAAEvC;EACb,CAAC,CAAC;AACJ,CAAC;AACD,eAAe5B,SAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}