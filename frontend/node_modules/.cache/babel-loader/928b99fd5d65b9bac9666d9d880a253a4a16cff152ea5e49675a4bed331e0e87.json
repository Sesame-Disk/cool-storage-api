{"ast":null,"code":"import _regeneratorRuntime from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport dayjs from 'dayjs';\nimport context from '../../../context';\nimport { useCommentListPosition } from '../../hooks/use-selection-position';\nimport { useCommentContext } from '../hooks/comment-hooks/use-comment-context';\nimport CommentEditor from './comment-editor';\nimport CommentItemWrapper from './comment-item-wrapper';\nimport EventBus from '../../utils/event-bus';\nimport { INTERNAL_EVENT } from '../../constants';\nimport './comment-list.css';\nvar CommentList = function CommentList(_ref) {\n  var comments = _ref.comments,\n    selectionElement = _ref.selectionElement,\n    hiddenComment = _ref.hiddenComment,\n    deleteUnseenNotifications = _ref.deleteUnseenNotifications;\n  var commentRef = useRef(null);\n  var position = useCommentListPosition();\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    activeComment = _useState2[0],\n    setActiveComment = _useState2[1];\n  var handelArticleClick = useCallback(function (event) {\n    if (event.target.className !== 'article') return;\n    hiddenComment();\n  }, [hiddenComment]);\n  // onMount: hidden comment\n  useEffect(function () {\n    var eventBus = EventBus.getInstance();\n    var unsubscribe = eventBus.subscribe(INTERNAL_EVENT.ARTICLE_CLICK, handelArticleClick);\n    return function () {\n      unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var onCommentClick = useCallback(function (comment) {\n    if (activeComment && activeComment.id === comment.id) return;\n    setActiveComment(comment);\n    deleteUnseenNotifications && deleteUnseenNotifications(comment);\n  }, [activeComment, deleteUnseenNotifications]);\n  var _useCommentContext = useCommentContext(),\n    dispatch = _useCommentContext.dispatch;\n  var insertComment = useCallback( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(elementId, comment) {\n      var res, returnComment, newComment;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return context.insertComment(comment);\n          case 2:\n            res = _context.sent;\n            returnComment = res.data.comment;\n            newComment = _objectSpread(_objectSpread({}, comment), {}, {\n              id: returnComment.id,\n              user_name: returnComment.user_name,\n              avatar_url: returnComment.avatar_url,\n              replies: []\n            });\n            dispatch({\n              type: 'INSERT_COMMENT',\n              payload: {\n                element_id: elementId,\n                comment: newComment\n              }\n            });\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }));\n    return function (_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [dispatch]);\n  var insertContent = useCallback(function (content) {\n    var user = context.getUserInfo();\n    var elementId = selectionElement === null || selectionElement === void 0 ? void 0 : selectionElement.id;\n    var time = dayjs().format('YYYY-MM-DD HH:mm:ss');\n    var comment = {\n      comment: content,\n      detail: {\n        element_id: elementId,\n        comment: content\n      },\n      author: user.username,\n      updated_at: time\n    };\n    insertComment(elementId, comment);\n  }, [insertComment, selectionElement]);\n  var resetActiveComment = useCallback(function (e) {\n    var commentWrapper = commentRef.current;\n    var clickIsInComment = commentWrapper && commentWrapper.contains(e.target) && commentWrapper !== e.target;\n    if (clickIsInComment) return;\n    setActiveComment(null);\n  }, []);\n  useEffect(function () {\n    document.addEventListener('click', resetActiveComment);\n    commentRef.current.scrollIntoView({\n      behavior: 'smooth',\n      block: 'nearest'\n    });\n    return function () {\n      document.removeEventListener('click', resetActiveComment);\n    };\n  }, [resetActiveComment]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: commentRef,\n    id: \"sdoc-comment-list-container\",\n    className: \"sdoc-comment-list-container\",\n    style: {\n      top: position.y\n    }\n  }, comments.length > 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-list\"\n  }, comments.map(function (comment) {\n    if (comment.resolved) return null;\n    var isActive = activeComment && activeComment.id === comment.id;\n    var props = {\n      key: comment.id,\n      comment: comment,\n      isActive: isActive,\n      onCommentClick: onCommentClick,\n      hiddenComment: function hiddenComment() {\n        return setActiveComment(null);\n      }\n    };\n    return /*#__PURE__*/React.createElement(CommentItemWrapper, props);\n  })), comments.length === 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-ui-container active\"\n  }, /*#__PURE__*/React.createElement(CommentEditor, {\n    type: \"comment\",\n    globalComment: true,\n    insertContent: insertContent,\n    hiddenComment: hiddenComment,\n    commentRef: commentRef\n  })));\n};\nexport default CommentList;","map":{"version":3,"names":["_objectSpread","React","useCallback","useEffect","useRef","useState","dayjs","context","useCommentListPosition","useCommentContext","CommentEditor","CommentItemWrapper","EventBus","INTERNAL_EVENT","CommentList","_ref","comments","selectionElement","hiddenComment","deleteUnseenNotifications","commentRef","position","_useState","_useState2","_slicedToArray","activeComment","setActiveComment","handelArticleClick","event","target","className","eventBus","getInstance","unsubscribe","subscribe","ARTICLE_CLICK","onCommentClick","comment","id","_useCommentContext","dispatch","insertComment","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","elementId","res","returnComment","newComment","wrap","_callee$","_context","prev","next","sent","data","user_name","avatar_url","replies","type","payload","element_id","stop","_x","_x2","apply","arguments","insertContent","content","user","getUserInfo","time","format","detail","author","username","updated_at","resetActiveComment","e","commentWrapper","current","clickIsInComment","contains","document","addEventListener","scrollIntoView","behavior","block","removeEventListener","createElement","ref","style","top","y","length","map","resolved","isActive","props","key","globalComment"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/comment/components/comment-list.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport dayjs from 'dayjs';\nimport context from '../../../context';\nimport { useCommentListPosition } from '../../hooks/use-selection-position';\nimport { useCommentContext } from '../hooks/comment-hooks/use-comment-context';\nimport CommentEditor from './comment-editor';\nimport CommentItemWrapper from './comment-item-wrapper';\nimport EventBus from '../../utils/event-bus';\nimport { INTERNAL_EVENT } from '../../constants';\nimport './comment-list.css';\nconst CommentList = _ref => {\n  let {\n    comments,\n    selectionElement,\n    hiddenComment,\n    deleteUnseenNotifications\n  } = _ref;\n  const commentRef = useRef(null);\n  const position = useCommentListPosition();\n  const [activeComment, setActiveComment] = useState(false);\n  const handelArticleClick = useCallback(event => {\n    if (event.target.className !== 'article') return;\n    hiddenComment();\n  }, [hiddenComment]);\n  // onMount: hidden comment\n  useEffect(() => {\n    const eventBus = EventBus.getInstance();\n    const unsubscribe = eventBus.subscribe(INTERNAL_EVENT.ARTICLE_CLICK, handelArticleClick);\n    return () => {\n      unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const onCommentClick = useCallback(comment => {\n    if (activeComment && activeComment.id === comment.id) return;\n    setActiveComment(comment);\n    deleteUnseenNotifications && deleteUnseenNotifications(comment);\n  }, [activeComment, deleteUnseenNotifications]);\n  const {\n    dispatch\n  } = useCommentContext();\n  const insertComment = useCallback(async (elementId, comment) => {\n    const res = await context.insertComment(comment);\n    const {\n      comment: returnComment\n    } = res.data;\n    const newComment = _objectSpread(_objectSpread({}, comment), {}, {\n      id: returnComment.id,\n      user_name: returnComment.user_name,\n      avatar_url: returnComment.avatar_url,\n      replies: []\n    });\n    dispatch({\n      type: 'INSERT_COMMENT',\n      payload: {\n        element_id: elementId,\n        comment: newComment\n      }\n    });\n  }, [dispatch]);\n  const insertContent = useCallback(content => {\n    const user = context.getUserInfo();\n    const elementId = selectionElement === null || selectionElement === void 0 ? void 0 : selectionElement.id;\n    const time = dayjs().format('YYYY-MM-DD HH:mm:ss');\n    const comment = {\n      comment: content,\n      detail: {\n        element_id: elementId,\n        comment: content\n      },\n      author: user.username,\n      updated_at: time\n    };\n    insertComment(elementId, comment);\n  }, [insertComment, selectionElement]);\n  const resetActiveComment = useCallback(e => {\n    const commentWrapper = commentRef.current;\n    const clickIsInComment = commentWrapper && commentWrapper.contains(e.target) && commentWrapper !== e.target;\n    if (clickIsInComment) return;\n    setActiveComment(null);\n  }, []);\n  useEffect(() => {\n    document.addEventListener('click', resetActiveComment);\n    commentRef.current.scrollIntoView({\n      behavior: 'smooth',\n      block: 'nearest'\n    });\n    return () => {\n      document.removeEventListener('click', resetActiveComment);\n    };\n  }, [resetActiveComment]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: commentRef,\n    id: \"sdoc-comment-list-container\",\n    className: \"sdoc-comment-list-container\",\n    style: {\n      top: position.y\n    }\n  }, comments.length > 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-list\"\n  }, comments.map(comment => {\n    if (comment.resolved) return null;\n    const isActive = activeComment && activeComment.id === comment.id;\n    const props = {\n      key: comment.id,\n      comment: comment,\n      isActive: isActive,\n      onCommentClick: onCommentClick,\n      hiddenComment: () => setActiveComment(null)\n    };\n    return /*#__PURE__*/React.createElement(CommentItemWrapper, props);\n  })), comments.length === 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"comment-ui-container active\"\n  }, /*#__PURE__*/React.createElement(CommentEditor, {\n    type: \"comment\",\n    globalComment: true,\n    insertContent: insertContent,\n    hiddenComment: hiddenComment,\n    commentRef: commentRef\n  })));\n};\nexport default CommentList;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}