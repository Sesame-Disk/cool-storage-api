{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { Editor, Range } from '@seafile/slate';\nimport { insertBreakList } from './insert-break-list';\nimport { onTabHandle } from './on-tab-handle';\nimport { normalizeList } from './normalize-list';\nimport { insertFragmentList } from './insert-fragment-list';\nimport { handleShortcut } from './shortcut';\nimport { focusEditor, getSelectedNodeEntryByType } from '../../../core';\nimport { LIST_ITEM } from '../../../constants';\nimport { isList } from '../../../toolbar/side-toolbar/helpers';\nimport { unwrapList } from '../transforms';\nvar withList = function withList(editor) {\n  var insertBreak = editor.insertBreak,\n    handleTab = editor.handleTab,\n    insertText = editor.insertText,\n    deleteBackward = editor.deleteBackward;\n  var newEditor = editor;\n  newEditor.insertBreak = function () {\n    if (insertBreakList(editor)) return;\n    insertBreak();\n    return;\n  };\n  newEditor.deleteBackward = function (unit) {\n    var selection = newEditor.selection;\n    if (selection === null) {\n      deleteBackward(unit);\n      return;\n    }\n    var listItemEntry = getSelectedNodeEntryByType(editor, LIST_ITEM);\n    if (listItemEntry) {\n      var _listItemEntry = _slicedToArray(listItemEntry, 2),\n        listItemPath = _listItemEntry[1];\n\n      // Transforms to paragraph when press backspace at the start of the list item, and the list item is the first child of the list\n      var isAtStartOfListItem = Editor.isStart(editor, selection.anchor, listItemPath);\n      var isCollapsed = Range.isCollapsed(selection);\n      if (isCollapsed && isAtStartOfListItem) {\n        var previous = Editor.previous(editor, {\n          at: listItemPath\n        });\n        // previous is undefined when the list item is the first child of the list\n        if (!previous) {\n          unwrapList(newEditor, {\n            at: listItemPath\n          });\n          var focusPoint = Editor.start(newEditor, listItemPath);\n          focusEditor(newEditor, focusPoint);\n          return;\n        }\n      }\n    }\n    // nothing todo\n    deleteBackward(unit);\n  };\n  newEditor.handleTab = function (event) {\n    if (!newEditor.selection) {\n      handleTab && handleTab();\n      return;\n    }\n    if (onTabHandle(newEditor, event)) return;\n    handleTab && handleTab();\n  };\n  newEditor.insertFragment = insertFragmentList(newEditor);\n  newEditor.normalizeNode = normalizeList(editor);\n  newEditor.insertText = function (text) {\n    var isPreventInsert = handleShortcut(newEditor, text);\n    if (isPreventInsert) return;\n    return insertText(text);\n  };\n  newEditor.onCopy = function (event) {\n    var path = Editor.path(newEditor, newEditor.selection, {\n      edge: 'start'\n    });\n    if (isList(newEditor, path)) {\n      event.stopPropagation();\n    }\n  };\n  newEditor.cut = function (event) {\n    var path = Editor.path(newEditor, newEditor.selection, {\n      edge: 'start'\n    });\n    if (isList(newEditor, path)) {\n      event.stopPropagation();\n    }\n  };\n  return newEditor;\n};\nexport default withList;","map":{"version":3,"names":["Editor","Range","insertBreakList","onTabHandle","normalizeList","insertFragmentList","handleShortcut","focusEditor","getSelectedNodeEntryByType","LIST_ITEM","isList","unwrapList","withList","editor","insertBreak","handleTab","insertText","deleteBackward","newEditor","unit","selection","listItemEntry","_listItemEntry","_slicedToArray","listItemPath","isAtStartOfListItem","isStart","anchor","isCollapsed","previous","at","focusPoint","start","event","insertFragment","normalizeNode","text","isPreventInsert","onCopy","path","edge","stopPropagation","cut"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/list/plugin/index.js"],"sourcesContent":["import { Editor, Range } from '@seafile/slate';\nimport { insertBreakList } from './insert-break-list';\nimport { onTabHandle } from './on-tab-handle';\nimport { normalizeList } from './normalize-list';\nimport { insertFragmentList } from './insert-fragment-list';\nimport { handleShortcut } from './shortcut';\nimport { focusEditor, getSelectedNodeEntryByType } from '../../../core';\nimport { LIST_ITEM } from '../../../constants';\nimport { isList } from '../../../toolbar/side-toolbar/helpers';\nimport { unwrapList } from '../transforms';\nconst withList = editor => {\n  const {\n    insertBreak,\n    handleTab,\n    insertText,\n    deleteBackward\n  } = editor;\n  const newEditor = editor;\n  newEditor.insertBreak = () => {\n    if (insertBreakList(editor)) return;\n    insertBreak();\n    return;\n  };\n  newEditor.deleteBackward = unit => {\n    const {\n      selection\n    } = newEditor;\n    if (selection === null) {\n      deleteBackward(unit);\n      return;\n    }\n    const listItemEntry = getSelectedNodeEntryByType(editor, LIST_ITEM);\n    if (listItemEntry) {\n      const [, listItemPath] = listItemEntry;\n\n      // Transforms to paragraph when press backspace at the start of the list item, and the list item is the first child of the list\n      const isAtStartOfListItem = Editor.isStart(editor, selection.anchor, listItemPath);\n      const isCollapsed = Range.isCollapsed(selection);\n      if (isCollapsed && isAtStartOfListItem) {\n        const previous = Editor.previous(editor, {\n          at: listItemPath\n        });\n        // previous is undefined when the list item is the first child of the list\n        if (!previous) {\n          unwrapList(newEditor, {\n            at: listItemPath\n          });\n          const focusPoint = Editor.start(newEditor, listItemPath);\n          focusEditor(newEditor, focusPoint);\n          return;\n        }\n      }\n    }\n    // nothing todo\n    deleteBackward(unit);\n  };\n  newEditor.handleTab = event => {\n    if (!newEditor.selection) {\n      handleTab && handleTab();\n      return;\n    }\n    if (onTabHandle(newEditor, event)) return;\n    handleTab && handleTab();\n  };\n  newEditor.insertFragment = insertFragmentList(newEditor);\n  newEditor.normalizeNode = normalizeList(editor);\n  newEditor.insertText = text => {\n    const isPreventInsert = handleShortcut(newEditor, text);\n    if (isPreventInsert) return;\n    return insertText(text);\n  };\n  newEditor.onCopy = event => {\n    const path = Editor.path(newEditor, newEditor.selection, {\n      edge: 'start'\n    });\n    if (isList(newEditor, path)) {\n      event.stopPropagation();\n    }\n  };\n  newEditor.cut = event => {\n    const path = Editor.path(newEditor, newEditor.selection, {\n      edge: 'start'\n    });\n    if (isList(newEditor, path)) {\n      event.stopPropagation();\n    }\n  };\n  return newEditor;\n};\nexport default withList;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}