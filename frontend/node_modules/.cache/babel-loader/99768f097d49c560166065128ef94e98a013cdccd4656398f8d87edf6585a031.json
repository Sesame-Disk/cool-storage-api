{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from'react';import{Tooltip}from'reactstrap';import{seafileAPI}from'../../utils/seafile-api';import{gettext}from'../../utils/constants';import{Utils}from'../../utils/utils';import RepoTag from'../../models/repo-tag';import toaster from'../toast';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var TagListFooter=/*#__PURE__*/function(_Component){_inherits(TagListFooter,_Component);var _super=_createSuper(TagListFooter);function TagListFooter(props){var _this;_classCallCheck(this,TagListFooter);_this=_super.call(this,props);_this.toggleTooltip=function(){_this.setState({showTooltip:!_this.state.showTooltip});};_this.onClickImport=function(){_this.importOptionsInput.click();};_this.importTagsInputChange=function(){if(!_this.importOptionsInput.files||!_this.importOptionsInput.files.length){toaster.warning(gettext('Please select a file'));return;}var fileReader=new FileReader();fileReader.onload=_this.onImportTags.bind(_assertThisInitialized(_this));fileReader.onerror=_this.onImportTagsError.bind(_assertThisInitialized(_this));fileReader.readAsText(_this.importOptionsInput.files[0]);};_this.getValidTags=function(tags){var validTags=[];var tagNameMap={};_this.props.repotagList.forEach(function(tag){return tagNameMap[tag.name]=true;});for(var i=0;i<tags.length;i++){if(!tags[i]||typeof tags[i]!=='object'||!tags[i].name||!tags[i].color){continue;}if(!tagNameMap[tags[i].name]){validTags.push({name:tags[i].name,color:tags[i].color});tagNameMap[tags[i].name]=true;}}return validTags;};_this.onImportTags=function(event){var tags=[];try{tags=JSON.parse(event.target.result);// handle JSON file format is error\n}catch(error){toaster.danger(gettext('The imported tags are invalid'));return;}if(!Array.isArray(tags)||tags.length===0){toaster.danger(gettext('The imported tags are invalid'));return;}var validTags=_this.getValidTags(tags);if(validTags.length===0){toaster.warning(gettext('The imported tag already exists'));return;}seafileAPI.createRepoTags(_this.props.repoID,validTags).then(function(res){toaster.success(gettext('Tags imported'));var repotagList=[];res.data.repo_tags.forEach(function(item){var repo_tag=new RepoTag(item);repotagList.push(repo_tag);});_this.props.updateTags(repotagList);}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});_this.importOptionsInput.value=null;};_this.onImportTagsError=function(){toaster.success(gettext('Failed to import tags. Please reupload.'));};_this.getDownloadUrl=function(){var tags=_this.props.repotagList.map(function(item){return{name:item.name,color:item.color};});return\"data:text/json;charset=utf-8,\".concat(encodeURIComponent(JSON.stringify(tags)));};_this.state={showTooltip:false};return _this;}_createClass(TagListFooter,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{className:\"tag-list-footer\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"fa fa-question-circle mr-2\",style:{color:'#999'},id:\"import-export-tags-tip\"}),/*#__PURE__*/_jsx(Tooltip,{toggle:this.toggleTooltip,delay:{show:0,hide:0},target:\"import-export-tags-tip\",placement:\"bottom\",isOpen:this.state.showTooltip,children:gettext('Use the import/export function to transfer tags quickly to another library. (The export is in JSON format.)')}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:function ref(_ref){return _this2.importOptionsInput=_ref;},accept:\".json\",className:\"d-none\",onChange:this.importTagsInputChange}),/*#__PURE__*/_jsx(\"span\",{className:\"item-text\",onClick:this.onClickImport,children:gettext('Import tags')}),/*#__PURE__*/_jsx(\"span\",{className:\"mx-2\",children:\"|\"}),/*#__PURE__*/_jsx(\"a\",{href:this.getDownloadUrl(),download:\"tags.json\",onClick:this.props.toggle,children:/*#__PURE__*/_jsx(\"span\",{className:\"item-text\",children:gettext('Export tags')})})]});}}]);return TagListFooter;}(Component);export{TagListFooter as default};","map":{"version":3,"names":["React","Component","Tooltip","seafileAPI","gettext","Utils","RepoTag","toaster","jsx","_jsx","jsxs","_jsxs","TagListFooter","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","toggleTooltip","setState","showTooltip","state","onClickImport","importOptionsInput","click","importTagsInputChange","files","length","warning","fileReader","FileReader","onload","onImportTags","bind","_assertThisInitialized","onerror","onImportTagsError","readAsText","getValidTags","tags","validTags","tagNameMap","repotagList","forEach","tag","name","i","color","push","event","JSON","parse","target","result","error","danger","Array","isArray","createRepoTags","repoID","then","res","success","data","repo_tags","item","repo_tag","updateTags","catch","errMessage","getErrorMsg","value","getDownloadUrl","map","concat","encodeURIComponent","stringify","_createClass","key","render","_this2","className","children","style","id","toggle","delay","show","hide","placement","isOpen","type","ref","accept","onChange","onClick","href","download","default"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/popover/tag-list-footer.js"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Tooltip } from 'reactstrap';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext } from '../../utils/constants';\nimport { Utils } from '../../utils/utils';\nimport RepoTag from '../../models/repo-tag';\nimport toaster from '../toast';\n\nexport default class TagListFooter extends Component {\n\n  static propTypes = {\n    repoID: PropTypes.string.isRequired,\n    toggle: PropTypes.func.isRequired,\n    repotagList: PropTypes.array.isRequired,\n    updateTags: PropTypes.func.isRequired,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      showTooltip: false,\n    };\n  }\n\n  toggleTooltip = () => {\n    this.setState({showTooltip: !this.state.showTooltip});\n  };\n\n  onClickImport = () => {\n    this.importOptionsInput.click();\n  };\n\n  importTagsInputChange = () => {\n    if (!this.importOptionsInput.files || !this.importOptionsInput.files.length) {\n      toaster.warning(gettext('Please select a file'));\n      return;\n    }\n    const fileReader = new FileReader();\n    fileReader.onload = this.onImportTags.bind(this);\n    fileReader.onerror = this.onImportTagsError.bind(this);\n    fileReader.readAsText(this.importOptionsInput.files[0]);\n  };\n\n  getValidTags = (tags) => {\n    let validTags = [];\n    let tagNameMap = {};\n    this.props.repotagList.forEach(tag => tagNameMap[tag.name] = true);\n    for (let i = 0; i < tags.length; i++) {\n      if (!tags[i] || typeof tags[i] !== 'object' || !tags[i].name || !tags[i].color) {\n        continue;\n      }\n      if (!tagNameMap[tags[i].name]) {\n        validTags.push(\n          {\n            name: tags[i].name,\n            color: tags[i].color,\n          }\n        );\n        tagNameMap[tags[i].name] = true;\n      }\n    }\n    return validTags;\n  };\n\n  onImportTags = (event) => {\n    let tags = [];\n    try {\n      tags = JSON.parse(event.target.result); // handle JSON file format is error\n    } catch (error) {\n      toaster.danger(gettext('The imported tags are invalid'));\n      return;\n    }\n    if (!Array.isArray(tags) || tags.length === 0) {\n      toaster.danger(gettext('The imported tags are invalid'));\n      return;\n    }\n    let validTags = this.getValidTags(tags);\n    if (validTags.length === 0) {\n      toaster.warning(gettext('The imported tag already exists'));\n      return;\n    }\n    seafileAPI.createRepoTags(this.props.repoID, validTags).then((res) => {\n      toaster.success(gettext('Tags imported'));\n      let repotagList = [];\n      res.data.repo_tags.forEach(item => {\n        let repo_tag = new RepoTag(item);\n        repotagList.push(repo_tag);\n      });\n      this.props.updateTags(repotagList);\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n    this.importOptionsInput.value = null;\n  };\n\n  onImportTagsError = () => {\n    toaster.success(gettext('Failed to import tags. Please reupload.'));\n  };\n\n  getDownloadUrl = () => {\n    const tags = this.props.repotagList.map(item => {\n      return { name: item.name, color: item.color };\n    });\n    return `data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(tags))}`;\n  };\n\n  render() {\n    return (\n      <div className=\"tag-list-footer\">\n        <span className=\"fa fa-question-circle mr-2\" style={{color: '#999'}} id=\"import-export-tags-tip\"></span>\n        <Tooltip\n          toggle={this.toggleTooltip}\n          delay={{show: 0, hide: 0}}\n          target='import-export-tags-tip'\n          placement='bottom'\n          isOpen={this.state.showTooltip}\n        >\n          {gettext('Use the import/export function to transfer tags quickly to another library. (The export is in JSON format.)')}\n        </Tooltip>\n        <input\n          type=\"file\"\n          ref={ref => this.importOptionsInput = ref}\n          accept='.json'\n          className=\"d-none\"\n          onChange={this.importTagsInputChange}\n        />\n        <span className=\"item-text\" onClick={this.onClickImport}>{gettext('Import tags')}</span>\n        <span className=\"mx-2\">|</span>\n        <a href={this.getDownloadUrl()} download='tags.json' onClick={this.props.toggle}>\n          <span className=\"item-text\">{gettext('Export tags')}</span>\n        </a>\n      </div>\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}