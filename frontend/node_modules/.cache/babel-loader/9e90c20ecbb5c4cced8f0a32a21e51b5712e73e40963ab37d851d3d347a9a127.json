{"ast":null,"code":"import React, { useEffect, useRef, useImperativeHandle, forwardRef, useMemo } from 'react';\nimport SdocEditor from './sdoc-editor';\nimport { RevisionDiffViewer } from '../views';\nimport context from '../../context';\nimport { createDefaultEditor } from '../extension';\nimport withNodeId from '../node-id';\nimport { withSocketIO } from '../socket';\nimport { PAGE_EDIT_AREA_WIDTH } from '../constants';\nvar RevisionEditor = forwardRef(function (_ref, ref) {\n  var isShowChanges = _ref.isShowChanges,\n    isReloading = _ref.isReloading,\n    document = _ref.document,\n    revisionContent = _ref.revisionContent,\n    didMountCallback = _ref.didMountCallback;\n  var editorRef = useRef(null);\n  var editor = useMemo(function () {\n    var defaultEditor = createDefaultEditor();\n    var editorConfig = context.getEditorConfig();\n    var newEditor = withNodeId(withSocketIO(defaultEditor, {\n      document: document,\n      config: editorConfig\n    }));\n    var cursors = document.cursors;\n    newEditor.cursors = cursors || {};\n    newEditor.width = PAGE_EDIT_AREA_WIDTH; // default width\n    return newEditor;\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // useMount: init socket connection\n  useEffect(function () {\n    editor.openConnection();\n    return function () {\n      editor.closeConnection();\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // The parent component can call the method of this component through ref\n  useImperativeHandle(ref, function () {\n    return {\n      setSlateValue: function setSlateValue(document) {\n        return editorRef.current.setSlateValue(document);\n      },\n      updateDocumentVersion: function updateDocumentVersion(document) {\n        return editorRef.current.updateDocumentVersion(document);\n      },\n      // get value\n      getSlateValue: function getSlateValue() {\n        return editorRef.current.getSlateValue();\n      }\n\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    };\n  }, [editorRef]);\n  if (isShowChanges) {\n    return /*#__PURE__*/React.createElement(RevisionDiffViewer, {\n      editor: editor,\n      revisionContent: revisionContent,\n      didMountCallback: didMountCallback\n    });\n  }\n  return /*#__PURE__*/React.createElement(SdocEditor, {\n    ref: editorRef,\n    editor: editor,\n    isReloading: isReloading,\n    document: document,\n    showComment: true\n  });\n});\nexport default RevisionEditor;","map":{"version":3,"names":["React","useEffect","useRef","useImperativeHandle","forwardRef","useMemo","SdocEditor","RevisionDiffViewer","context","createDefaultEditor","withNodeId","withSocketIO","PAGE_EDIT_AREA_WIDTH","RevisionEditor","_ref","ref","isShowChanges","isReloading","document","revisionContent","didMountCallback","editorRef","editor","defaultEditor","editorConfig","getEditorConfig","newEditor","config","cursors","width","openConnection","closeConnection","setSlateValue","current","updateDocumentVersion","getSlateValue","createElement","showComment"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/editor/revision-editor.js"],"sourcesContent":["import React, { useEffect, useRef, useImperativeHandle, forwardRef, useMemo } from 'react';\nimport SdocEditor from './sdoc-editor';\nimport { RevisionDiffViewer } from '../views';\nimport context from '../../context';\nimport { createDefaultEditor } from '../extension';\nimport withNodeId from '../node-id';\nimport { withSocketIO } from '../socket';\nimport { PAGE_EDIT_AREA_WIDTH } from '../constants';\nconst RevisionEditor = forwardRef((_ref, ref) => {\n  let {\n    isShowChanges,\n    isReloading,\n    document,\n    revisionContent,\n    didMountCallback\n  } = _ref;\n  const editorRef = useRef(null);\n  const editor = useMemo(() => {\n    const defaultEditor = createDefaultEditor();\n    const editorConfig = context.getEditorConfig();\n    const newEditor = withNodeId(withSocketIO(defaultEditor, {\n      document,\n      config: editorConfig\n    }));\n    const {\n      cursors\n    } = document;\n    newEditor.cursors = cursors || {};\n    newEditor.width = PAGE_EDIT_AREA_WIDTH; // default width\n    return newEditor;\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // useMount: init socket connection\n  useEffect(() => {\n    editor.openConnection();\n    return () => {\n      editor.closeConnection();\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // The parent component can call the method of this component through ref\n  useImperativeHandle(ref, () => ({\n    setSlateValue: document => {\n      return editorRef.current.setSlateValue(document);\n    },\n    updateDocumentVersion: document => {\n      return editorRef.current.updateDocumentVersion(document);\n    },\n    // get value\n    getSlateValue: () => {\n      return editorRef.current.getSlateValue();\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }), [editorRef]);\n  if (isShowChanges) {\n    return /*#__PURE__*/React.createElement(RevisionDiffViewer, {\n      editor: editor,\n      revisionContent: revisionContent,\n      didMountCallback: didMountCallback\n    });\n  }\n  return /*#__PURE__*/React.createElement(SdocEditor, {\n    ref: editorRef,\n    editor: editor,\n    isReloading: isReloading,\n    document: document,\n    showComment: true\n  });\n});\nexport default RevisionEditor;"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,mBAAmB,EAAEC,UAAU,EAAEC,OAAO,QAAQ,OAAO;AAC1F,OAAOC,UAAU,MAAM,eAAe;AACtC,SAASC,kBAAkB,QAAQ,UAAU;AAC7C,OAAOC,OAAO,MAAM,eAAe;AACnC,SAASC,mBAAmB,QAAQ,cAAc;AAClD,OAAOC,UAAU,MAAM,YAAY;AACnC,SAASC,YAAY,QAAQ,WAAW;AACxC,SAASC,oBAAoB,QAAQ,cAAc;AACnD,IAAMC,cAAc,GAAGT,UAAU,CAAC,UAACU,IAAI,EAAEC,GAAG,EAAK;EAC/C,IACEC,aAAa,GAKXF,IAAI,CALNE,aAAa;IACbC,WAAW,GAITH,IAAI,CAJNG,WAAW;IACXC,QAAQ,GAGNJ,IAAI,CAHNI,QAAQ;IACRC,eAAe,GAEbL,IAAI,CAFNK,eAAe;IACfC,gBAAgB,GACdN,IAAI,CADNM,gBAAgB;EAElB,IAAMC,SAAS,GAAGnB,MAAM,CAAC,IAAI,CAAC;EAC9B,IAAMoB,MAAM,GAAGjB,OAAO,CAAC,YAAM;IAC3B,IAAMkB,aAAa,GAAGd,mBAAmB,CAAC,CAAC;IAC3C,IAAMe,YAAY,GAAGhB,OAAO,CAACiB,eAAe,CAAC,CAAC;IAC9C,IAAMC,SAAS,GAAGhB,UAAU,CAACC,YAAY,CAACY,aAAa,EAAE;MACvDL,QAAQ,EAARA,QAAQ;MACRS,MAAM,EAAEH;IACV,CAAC,CAAC,CAAC;IACH,IACEI,OAAO,GACLV,QAAQ,CADVU,OAAO;IAETF,SAAS,CAACE,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;IACjCF,SAAS,CAACG,KAAK,GAAGjB,oBAAoB,CAAC,CAAC;IACxC,OAAOc,SAAS;;IAEhB;EACF,CAAC,EAAE,EAAE,CAAC;;EAEN;EACAzB,SAAS,CAAC,YAAM;IACdqB,MAAM,CAACQ,cAAc,CAAC,CAAC;IACvB,OAAO,YAAM;MACXR,MAAM,CAACS,eAAe,CAAC,CAAC;IAC1B,CAAC;;IAED;EACF,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA5B,mBAAmB,CAACY,GAAG,EAAE;IAAA,OAAO;MAC9BiB,aAAa,EAAE,SAAAA,cAAAd,QAAQ,EAAI;QACzB,OAAOG,SAAS,CAACY,OAAO,CAACD,aAAa,CAACd,QAAQ,CAAC;MAClD,CAAC;MACDgB,qBAAqB,EAAE,SAAAA,sBAAAhB,QAAQ,EAAI;QACjC,OAAOG,SAAS,CAACY,OAAO,CAACC,qBAAqB,CAAChB,QAAQ,CAAC;MAC1D,CAAC;MACD;MACAiB,aAAa,EAAE,SAAAA,cAAA,EAAM;QACnB,OAAOd,SAAS,CAACY,OAAO,CAACE,aAAa,CAAC,CAAC;MAC1C;;MAEA;IACF,CAAC;EAAA,CAAC,EAAE,CAACd,SAAS,CAAC,CAAC;EAChB,IAAIL,aAAa,EAAE;IACjB,OAAO,aAAahB,KAAK,CAACoC,aAAa,CAAC7B,kBAAkB,EAAE;MAC1De,MAAM,EAAEA,MAAM;MACdH,eAAe,EAAEA,eAAe;MAChCC,gBAAgB,EAAEA;IACpB,CAAC,CAAC;EACJ;EACA,OAAO,aAAapB,KAAK,CAACoC,aAAa,CAAC9B,UAAU,EAAE;IAClDS,GAAG,EAAEM,SAAS;IACdC,MAAM,EAAEA,MAAM;IACdL,WAAW,EAAEA,WAAW;IACxBC,QAAQ,EAAEA,QAAQ;IAClBmB,WAAW,EAAE;EACf,CAAC,CAAC;AACJ,CAAC,CAAC;AACF,eAAexB,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}