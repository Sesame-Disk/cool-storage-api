{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { useCallback, useEffect, useState } from 'react';\nimport context from '../context';\nexport var useDocument = function useDocument() {\n  var isSdocRevision = context.getSetting('isSdocRevision');\n  var isPublished = context.getSetting('isPublished');\n  var _useState = useState(true),\n    _useState2 = _slicedToArray(_useState, 2),\n    isFirstLoading = _useState2[0],\n    setIsFirstLoading = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isReloading = _useState4[0],\n    setIsReloading = _useState4[1];\n  var _useState5 = useState({\n      version: 0,\n      children: [],\n      cursors: {}\n    }),\n    _useState6 = _slicedToArray(_useState5, 2),\n    document = _useState6[0],\n    setDocument = _useState6[1];\n  var _useState7 = useState(''),\n    _useState8 = _slicedToArray(_useState7, 2),\n    errorMessage = _useState8[0],\n    setErrorMessage = _useState8[1];\n  var loadDocument = useCallback(function () {\n    return new Promise(function (resolve, reject) {\n      context.getFileContent().then(function (res) {\n        var result = res.data;\n        if (result && !result.children) {\n          result = {\n            version: 0,\n            children: result.content,\n            cursors: result.cursors || {}\n          };\n        }\n        resolve(result);\n      }).catch(function (error) {\n        // eslint-disable-next-line\n        console.log(error);\n        var errorMessage = 'Load_doc_content_error';\n        if (error && error.response) {\n          var _ref = error.response.data || {},\n            error_type = _ref.error_type;\n          if (error_type === 'content_invalid') {\n            errorMessage = 'Sdoc_format_invalid';\n          }\n        }\n        reject(errorMessage);\n      });\n    });\n  }, []);\n  var reloadDocument = useCallback(function () {\n    setIsReloading(true);\n    loadDocument().then(function (document) {\n      setDocument(document);\n      setIsReloading(false);\n    }).catch(function (errorMessage) {\n      setIsReloading(false);\n      setErrorMessage(errorMessage);\n      setDocument(null);\n      setIsReloading(false);\n    });\n  }, [loadDocument]);\n  useEffect(function () {\n    if (isSdocRevision && isPublished) return;\n    loadDocument().then(function (document) {\n      setDocument(document);\n      setIsFirstLoading(false);\n    }).catch(function (errorMessage) {\n      setErrorMessage(errorMessage);\n      setDocument(null);\n      setIsFirstLoading(false);\n    });\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return {\n    isFirstLoading: isFirstLoading,\n    isReloading: isReloading,\n    errorMessage: errorMessage,\n    document: document,\n    loadDocument: loadDocument,\n    reloadDocument: reloadDocument,\n    setErrorMessage: setErrorMessage\n  };\n};","map":{"version":3,"names":["useCallback","useEffect","useState","context","useDocument","isSdocRevision","getSetting","isPublished","_useState","_useState2","_slicedToArray","isFirstLoading","setIsFirstLoading","_useState3","_useState4","isReloading","setIsReloading","_useState5","version","children","cursors","_useState6","document","setDocument","_useState7","_useState8","errorMessage","setErrorMessage","loadDocument","Promise","resolve","reject","getFileContent","then","res","result","data","content","catch","error","console","log","response","_ref","error_type","reloadDocument"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/hooks/use-document.js"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport context from '../context';\nexport const useDocument = () => {\n  const isSdocRevision = context.getSetting('isSdocRevision');\n  const isPublished = context.getSetting('isPublished');\n  const [isFirstLoading, setIsFirstLoading] = useState(true);\n  const [isReloading, setIsReloading] = useState(false);\n  const [document, setDocument] = useState({\n    version: 0,\n    children: [],\n    cursors: {}\n  });\n  const [errorMessage, setErrorMessage] = useState('');\n  const loadDocument = useCallback(() => {\n    return new Promise((resolve, reject) => {\n      context.getFileContent().then(res => {\n        let result = res.data;\n        if (result && !result.children) {\n          result = {\n            version: 0,\n            children: result.content,\n            cursors: result.cursors || {}\n          };\n        }\n        resolve(result);\n      }).catch(error => {\n        // eslint-disable-next-line\n        console.log(error);\n        let errorMessage = 'Load_doc_content_error';\n        if (error && error.response) {\n          const {\n            error_type\n          } = error.response.data || {};\n          if (error_type === 'content_invalid') {\n            errorMessage = 'Sdoc_format_invalid';\n          }\n        }\n        reject(errorMessage);\n      });\n    });\n  }, []);\n  const reloadDocument = useCallback(() => {\n    setIsReloading(true);\n    loadDocument().then(document => {\n      setDocument(document);\n      setIsReloading(false);\n    }).catch(errorMessage => {\n      setIsReloading(false);\n      setErrorMessage(errorMessage);\n      setDocument(null);\n      setIsReloading(false);\n    });\n  }, [loadDocument]);\n  useEffect(() => {\n    if (isSdocRevision && isPublished) return;\n    loadDocument().then(document => {\n      setDocument(document);\n      setIsFirstLoading(false);\n    }).catch(errorMessage => {\n      setErrorMessage(errorMessage);\n      setDocument(null);\n      setIsFirstLoading(false);\n    });\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return {\n    isFirstLoading,\n    isReloading,\n    errorMessage,\n    document,\n    loadDocument,\n    reloadDocument,\n    setErrorMessage\n  };\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}