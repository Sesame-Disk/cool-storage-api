{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { Transforms, Path, Editor } from '@seafile/slate';\nimport { LIST_ITEM } from '../../../constants';\nimport { getAboveNode, getNode, isLastChild } from '../../../core';\nimport { hasListChild } from '../queries';\nimport { moveListItemsToList } from './move-list-items-to-list';\nimport { unwrapList } from './unwrap-list';\nimport { generateEmptyList } from '../model';\nexport var movedListItemUp = function movedListItemUp(editor, _ref) {\n  var list = _ref.list,\n    listItem = _ref.listItem;\n  var move = function move() {\n    var _list = _slicedToArray(list, 2),\n      listNode = _list[0],\n      listPath = _list[1];\n    var _listItem = _slicedToArray(listItem, 2),\n      liNode = _listItem[0],\n      liPath = _listItem[1];\n\n    // 获取上层 list-item 节点\n    var liParent = getAboveNode(editor, {\n      at: listPath,\n      match: {\n        type: [LIST_ITEM]\n      }\n    });\n\n    // 如果上层节点不存在, 说明当前 list 为顶层 list, list[ol] > 'li'\n    if (!liParent) {\n      var _toListPath = null;\n      try {\n        _toListPath = Path.next(listPath);\n      } catch (err) {\n        return;\n      }\n      var condA = hasListChild(liNode);\n      var condB = !isLastChild(list, liPath);\n      if (condA || condB) {\n        // 创建一个新的兄弟节点\n        var _list2 = generateEmptyList(listNode.type);\n        Transforms.insertNodes(editor, _list2, {\n          at: _toListPath\n        });\n      }\n\n      // 如果包含子节点，将子节点移动到新创建的节点中\n      if (condA) {\n        var toListNode = getNode(editor, _toListPath);\n        if (!toListNode) return;\n\n        // 将子节点，移动到新创建的节点中\n        moveListItemsToList(editor, {\n          formListItem: listItem,\n          toList: [toListNode, _toListPath]\n        });\n      }\n\n      // 如果不是最后一个节点\n      if (condB) {\n        var _toListNode = getNode(editor, _toListPath);\n        if (!_toListNode) return;\n\n        // 将当前节点之后的兄弟节点，移动到新创建的 list 中\n        moveListItemsToList(editor, {\n          fromList: list,\n          fromStartIndex: liPath[liPath.length - 1] + 1,\n          toList: [_toListNode, _toListPath],\n          deleteFromList: false\n        });\n      }\n\n      // unwrap the list\n      unwrapList(editor, {\n        at: liPath.concat(0)\n      });\n      return true;\n    }\n\n    // 如果上层节点存在，说明当前 list 为 子 list, li > list[ol] > 'li'\n    var _liParent = _slicedToArray(liParent, 2),\n      liParentPath = _liParent[1];\n    // is last: false\n    // li > list[ol] > li\n    //               > li\n    var toListPath = liPath.concat([1]);\n    if (!isLastChild(list, liPath)) {\n      // 此处取巧：\n      // 第一步：把当前节点的兄弟节点，移动到当前节点 “子节点（ol）” 的孩子节点中\n      // 第二步：把当前节点的字节点，移动为当前节点 “父节点” 的 “兄弟” 节点\n      if (!hasListChild(liNode)) {\n        var _list3 = generateEmptyList(listNode.type);\n        Transforms.insertNodes(editor, _list3, {\n          at: toListPath\n        });\n      }\n      var _toListNode2 = getNode(editor, toListPath);\n      if (!_toListNode2) return;\n\n      // move next siblings to li sublist\n      moveListItemsToList(editor, {\n        fromListItem: liParent,\n        toList: [_toListNode2, toListPath],\n        fromStartIndex: liPath[liPath.length - 1] + 1,\n        deleteFromList: false\n      });\n    }\n\n    // is last: true\n    // li > list[ol] > li\n    var movedUpLiPath = Path.next(liParentPath);\n    Transforms.moveNodes(editor, {\n      at: liPath,\n      to: movedUpLiPath\n    });\n    return true;\n  };\n  var moved = false;\n  Editor.withoutNormalizing(editor, function () {\n    moved = move();\n  });\n  return moved;\n};","map":{"version":3,"names":["Transforms","Path","Editor","LIST_ITEM","getAboveNode","getNode","isLastChild","hasListChild","moveListItemsToList","unwrapList","generateEmptyList","movedListItemUp","editor","_ref","list","listItem","move","_list","_slicedToArray","listNode","listPath","_listItem","liNode","liPath","liParent","at","match","type","toListPath","next","err","condA","condB","insertNodes","toListNode","formListItem","toList","fromList","fromStartIndex","length","deleteFromList","concat","_liParent","liParentPath","fromListItem","movedUpLiPath","moveNodes","to","moved","withoutNormalizing"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/list/transforms/move-list-item-up.js"],"sourcesContent":["import { Transforms, Path, Editor } from '@seafile/slate';\nimport { LIST_ITEM } from '../../../constants';\nimport { getAboveNode, getNode, isLastChild } from '../../../core';\nimport { hasListChild } from '../queries';\nimport { moveListItemsToList } from './move-list-items-to-list';\nimport { unwrapList } from './unwrap-list';\nimport { generateEmptyList } from '../model';\nexport const movedListItemUp = (editor, _ref) => {\n  let {\n    list,\n    listItem\n  } = _ref;\n  const move = () => {\n    const [listNode, listPath] = list;\n    const [liNode, liPath] = listItem;\n\n    // 获取上层 list-item 节点\n    const liParent = getAboveNode(editor, {\n      at: listPath,\n      match: {\n        type: [LIST_ITEM]\n      }\n    });\n\n    // 如果上层节点不存在, 说明当前 list 为顶层 list, list[ol] > 'li'\n    if (!liParent) {\n      let toListPath = null;\n      try {\n        toListPath = Path.next(listPath);\n      } catch (err) {\n        return;\n      }\n      const condA = hasListChild(liNode);\n      const condB = !isLastChild(list, liPath);\n      if (condA || condB) {\n        // 创建一个新的兄弟节点\n        const list = generateEmptyList(listNode.type);\n        Transforms.insertNodes(editor, list, {\n          at: toListPath\n        });\n      }\n\n      // 如果包含子节点，将子节点移动到新创建的节点中\n      if (condA) {\n        const toListNode = getNode(editor, toListPath);\n        if (!toListNode) return;\n\n        // 将子节点，移动到新创建的节点中\n        moveListItemsToList(editor, {\n          formListItem: listItem,\n          toList: [toListNode, toListPath]\n        });\n      }\n\n      // 如果不是最后一个节点\n      if (condB) {\n        const toListNode = getNode(editor, toListPath);\n        if (!toListNode) return;\n\n        // 将当前节点之后的兄弟节点，移动到新创建的 list 中\n        moveListItemsToList(editor, {\n          fromList: list,\n          fromStartIndex: liPath[liPath.length - 1] + 1,\n          toList: [toListNode, toListPath],\n          deleteFromList: false\n        });\n      }\n\n      // unwrap the list\n      unwrapList(editor, {\n        at: liPath.concat(0)\n      });\n      return true;\n    }\n\n    // 如果上层节点存在，说明当前 list 为 子 list, li > list[ol] > 'li'\n    const [, liParentPath] = liParent;\n    // is last: false\n    // li > list[ol] > li\n    //               > li\n    const toListPath = liPath.concat([1]);\n    if (!isLastChild(list, liPath)) {\n      // 此处取巧：\n      // 第一步：把当前节点的兄弟节点，移动到当前节点 “子节点（ol）” 的孩子节点中\n      // 第二步：把当前节点的字节点，移动为当前节点 “父节点” 的 “兄弟” 节点\n      if (!hasListChild(liNode)) {\n        const list = generateEmptyList(listNode.type);\n        Transforms.insertNodes(editor, list, {\n          at: toListPath\n        });\n      }\n      const toListNode = getNode(editor, toListPath);\n      if (!toListNode) return;\n\n      // move next siblings to li sublist\n      moveListItemsToList(editor, {\n        fromListItem: liParent,\n        toList: [toListNode, toListPath],\n        fromStartIndex: liPath[liPath.length - 1] + 1,\n        deleteFromList: false\n      });\n    }\n\n    // is last: true\n    // li > list[ol] > li\n    const movedUpLiPath = Path.next(liParentPath);\n    Transforms.moveNodes(editor, {\n      at: liPath,\n      to: movedUpLiPath\n    });\n    return true;\n  };\n  let moved = false;\n  Editor.withoutNormalizing(editor, () => {\n    moved = move();\n  });\n  return moved;\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}