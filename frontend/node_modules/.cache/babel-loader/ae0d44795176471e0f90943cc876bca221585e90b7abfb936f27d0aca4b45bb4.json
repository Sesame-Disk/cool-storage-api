{"ast":null,"code":"import _classCallCheck from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport React, { Fragment } from 'react';\nimport { EventBus } from '../../../basic-sdk';\nimport context from '../../../context';\nimport CollaboratorsPopover from './collaborators-popover';\nvar CollaboratorsOperation = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(CollaboratorsOperation, _React$PureComponent);\n  var _super = _createSuper(CollaboratorsOperation);\n  function CollaboratorsOperation(props) {\n    var _this;\n    _classCallCheck(this, CollaboratorsOperation);\n    _this = _super.call(this, props);\n    _defineProperty(_assertThisInitialized(_this), \"onUserJoinRoom\", function (userInfo) {\n      var collaborators = _this.state.collaborators;\n      var newCollaborators = collaborators.slice();\n      if (!newCollaborators.find(function (user) {\n        return user.username === userInfo.username;\n      })) {\n        newCollaborators.push(userInfo);\n        _this.setState({\n          collaborators: newCollaborators\n        });\n      }\n    });\n    _defineProperty(_assertThisInitialized(_this), \"onUserLeaveRoom\", function (username) {\n      if (_this.currentUser.username === username) return;\n      var collaborators = _this.state.collaborators;\n      var newCollaborators = collaborators.slice();\n      if (newCollaborators.find(function (user) {\n        return user.username === username;\n      })) {\n        newCollaborators = newCollaborators.filter(function (user) {\n          return user.username !== username;\n        });\n        _this.setState({\n          collaborators: newCollaborators\n        });\n      }\n    });\n    var _userInfo = context.getUserInfo();\n    _this.state = {\n      collaborators: [_userInfo]\n    };\n    _this.currentUser = _userInfo;\n    return _this;\n  }\n  _createClass(CollaboratorsOperation, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n      context.getCollaborators().then(function (res) {\n        var collaborators = res.data.collaborators;\n\n        // delete current user and push it at first one\n        var currentUserIndex = collaborators.findIndex(function (user) {\n          return user.username === _this2.currentUser.username;\n        });\n        if (currentUserIndex > -1) {\n          collaborators.splice(currentUserIndex, 1);\n        }\n        collaborators.unshift(_this2.currentUser);\n        _this2.setState({\n          collaborators: collaborators\n        });\n      });\n      var eventBus = EventBus.getInstance();\n      this.unsubscribeJoinEvent = eventBus.subscribe('join-room', this.onUserJoinRoom);\n      this.unsubscribeLeaveEvent = eventBus.subscribe('leave-room', this.onUserLeaveRoom);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unsubscribeJoinEvent();\n      this.unsubscribeLeaveEvent();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var collaborators = this.state.collaborators;\n      return /*#__PURE__*/React.createElement(Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"op-item\",\n        id: \"collaborators\"\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"sdocfont sdoc-user mr-1\"\n      }), collaborators.length), /*#__PURE__*/React.createElement(CollaboratorsPopover, {\n        collaborators: collaborators\n      }));\n    }\n  }]);\n  return CollaboratorsOperation;\n}(React.PureComponent);\nexport default CollaboratorsOperation;","map":{"version":3,"names":["_defineProperty","React","Fragment","EventBus","context","CollaboratorsPopover","CollaboratorsOperation","_React$PureComponent","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","_assertThisInitialized","userInfo","collaborators","state","newCollaborators","slice","find","user","username","push","setState","currentUser","filter","_userInfo","getUserInfo","_createClass","key","value","componentDidMount","_this2","getCollaborators","then","res","data","currentUserIndex","findIndex","splice","unshift","eventBus","getInstance","unsubscribeJoinEvent","subscribe","onUserJoinRoom","unsubscribeLeaveEvent","onUserLeaveRoom","componentWillUnmount","render","createElement","className","id","length","PureComponent"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/components/doc-operations/collaborators-operation/index.js"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport React, { Fragment } from 'react';\nimport { EventBus } from '../../../basic-sdk';\nimport context from '../../../context';\nimport CollaboratorsPopover from './collaborators-popover';\nclass CollaboratorsOperation extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    _defineProperty(this, \"onUserJoinRoom\", userInfo => {\n      const {\n        collaborators\n      } = this.state;\n      let newCollaborators = collaborators.slice();\n      if (!newCollaborators.find(user => user.username === userInfo.username)) {\n        newCollaborators.push(userInfo);\n        this.setState({\n          collaborators: newCollaborators\n        });\n      }\n    });\n    _defineProperty(this, \"onUserLeaveRoom\", username => {\n      if (this.currentUser.username === username) return;\n      const {\n        collaborators\n      } = this.state;\n      let newCollaborators = collaborators.slice();\n      if (newCollaborators.find(user => user.username === username)) {\n        newCollaborators = newCollaborators.filter(user => user.username !== username);\n        this.setState({\n          collaborators: newCollaborators\n        });\n      }\n    });\n    const _userInfo = context.getUserInfo();\n    this.state = {\n      collaborators: [_userInfo]\n    };\n    this.currentUser = _userInfo;\n  }\n  componentDidMount() {\n    context.getCollaborators().then(res => {\n      const {\n        collaborators\n      } = res.data;\n\n      // delete current user and push it at first one\n      const currentUserIndex = collaborators.findIndex(user => user.username === this.currentUser.username);\n      if (currentUserIndex > -1) {\n        collaborators.splice(currentUserIndex, 1);\n      }\n      collaborators.unshift(this.currentUser);\n      this.setState({\n        collaborators\n      });\n    });\n    const eventBus = EventBus.getInstance();\n    this.unsubscribeJoinEvent = eventBus.subscribe('join-room', this.onUserJoinRoom);\n    this.unsubscribeLeaveEvent = eventBus.subscribe('leave-room', this.onUserLeaveRoom);\n  }\n  componentWillUnmount() {\n    this.unsubscribeJoinEvent();\n    this.unsubscribeLeaveEvent();\n  }\n  render() {\n    const {\n      collaborators\n    } = this.state;\n    return /*#__PURE__*/React.createElement(Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"op-item\",\n      id: \"collaborators\"\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"sdocfont sdoc-user mr-1\"\n    }), collaborators.length), /*#__PURE__*/React.createElement(CollaboratorsPopover, {\n      collaborators: collaborators\n    }));\n  }\n}\nexport default CollaboratorsOperation;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}