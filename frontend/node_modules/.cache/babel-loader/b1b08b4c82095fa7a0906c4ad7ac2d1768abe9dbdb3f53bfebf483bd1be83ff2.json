{"ast":null,"code":"import _assertThisInitialized from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import ReactDom from'react-dom';import toaster from'./components/toast';import{gettext}from'./utils/constants';import FileView from'./components/file-view/file-view';import SeafileCodeMirror from'./components/seafile-codemirror';import FileViewTip from'./components/file-view/file-view-tip';import{seafileAPI}from'./utils/seafile-api';import{Utils}from'./utils/utils';import'./css/text-file-view.css';import{jsx as _jsx}from\"react/jsx-runtime\";var _window$app$pageOptio=window.app.pageOptions,err=_window$app$pageOptio.err,fileExt=_window$app$pageOptio.fileExt,fileContent=_window$app$pageOptio.fileContent,repoID=_window$app$pageOptio.repoID,filePath=_window$app$pageOptio.filePath,fileName=_window$app$pageOptio.fileName,canEditFile=_window$app$pageOptio.canEditFile,username=_window$app$pageOptio.username;var FileContent=/*#__PURE__*/function(_React$Component){_inherits(FileContent,_React$Component);var _super=_createSuper(FileContent);function FileContent(){_classCallCheck(this,FileContent);return _super.apply(this,arguments);}_createClass(FileContent,[{key:\"render\",value:function render(){if(err){return/*#__PURE__*/_jsx(FileViewTip,{});}return/*#__PURE__*/_jsx(\"div\",{className:\"file-view-content flex-1 text-file-view\",children:/*#__PURE__*/_jsx(SeafileCodeMirror,{fileExt:fileExt,value:this.props.content,readOnly:!canEditFile,onChange:this.props.updateContent})});}}]);return FileContent;}(React.Component);var ViewFileText=/*#__PURE__*/function(_React$Component2){_inherits(ViewFileText,_React$Component2);var _super2=_createSuper(ViewFileText);function ViewFileText(props){var _this;_classCallCheck(this,ViewFileText);_this=_super2.call(this,props);_this.updateContent=function(value){_this.setState({needSave:true,content:value});};_this.addParticipant=function(){seafileAPI.addFileParticipants(repoID,filePath,[username]).then(function(res){if(res.status===200){_this.isParticipant=true;_this.getParticipants();}});};_this.getParticipants=function(){seafileAPI.listFileParticipants(repoID,filePath).then(function(res){var participants=res.data.participant_list;_this.setState({participants:participants});if(participants.length>0){_this.isParticipant=participants.every(function(participant){return participant.email==username;});}});};_this.onParticipantsChange=function(){_this.getParticipants();};_this.state={content:fileContent,needSave:false,isSaving:false,participants:[]};_this.onSave=_this.onSave.bind(_assertThisInitialized(_this));_this.isParticipant=false;return _this;}_createClass(ViewFileText,[{key:\"onSave\",value:function onSave(){var _this2=this;if(!this.isParticipant){this.addParticipant();}var dirPath=Utils.getDirName(filePath);return seafileAPI.getUpdateLink(repoID,dirPath).then(function(res){var uploadLink=res.data;_this2.setState({isSaving:true});return seafileAPI.updateFile(uploadLink,filePath,fileName,_this2.state.content).then(function(){toaster.success(gettext('Successfully saved'),{duration:2});_this2.setState({isSaving:false,needSave:false});});});}},{key:\"componentDidMount\",value:function componentDidMount(){this.getParticipants();}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(FileView,{content:/*#__PURE__*/_jsx(FileContent,{content:this.state.content,updateContent:this.updateContent}),isSaving:this.state.isSaving,needSave:this.state.needSave,onSave:this.onSave,participants:this.state.participants,onParticipantsChange:this.onParticipantsChange});}}]);return ViewFileText;}(React.Component);ReactDom.render(/*#__PURE__*/_jsx(ViewFileText,{}),document.getElementById('wrapper'));","map":{"version":3,"names":["React","ReactDom","toaster","gettext","FileView","SeafileCodeMirror","FileViewTip","seafileAPI","Utils","jsx","_jsx","_window$app$pageOptio","window","app","pageOptions","err","fileExt","fileContent","repoID","filePath","fileName","canEditFile","username","FileContent","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","render","className","children","props","content","readOnly","onChange","updateContent","Component","ViewFileText","_React$Component2","_super2","_this","call","setState","needSave","addParticipant","addFileParticipants","then","res","status","isParticipant","getParticipants","listFileParticipants","participants","data","participant_list","length","every","participant","email","onParticipantsChange","state","isSaving","onSave","bind","_assertThisInitialized","_this2","dirPath","getDirName","getUpdateLink","uploadLink","updateFile","success","duration","componentDidMount","document","getElementById"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/view-file-text.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport PropTypes from 'prop-types';\nimport toaster from './components/toast';\nimport { gettext } from './utils/constants';\nimport FileView from './components/file-view/file-view';\nimport SeafileCodeMirror from './components/seafile-codemirror';\nimport FileViewTip from './components/file-view/file-view-tip';\nimport { seafileAPI } from './utils/seafile-api';\nimport { Utils } from './utils/utils';\n\nimport './css/text-file-view.css';\nconst {\n  err, fileExt, fileContent, repoID, filePath, fileName, canEditFile, username\n} = window.app.pageOptions;\n\nconst propTypes = {\n  updateContent: PropTypes.func.isRequired,\n  content: PropTypes.string.isRequired,\n};\n\nclass FileContent extends React.Component {\n  render() {\n    if (err) {\n      return <FileViewTip />;\n    }\n\n    return (\n      <div className=\"file-view-content flex-1 text-file-view\">\n        <SeafileCodeMirror\n          fileExt={fileExt}\n          value={this.props.content}\n          readOnly={!canEditFile}\n          onChange={this.props.updateContent}\n        />\n      </div>\n    );\n  }\n}\n\nFileContent.propTypes = propTypes;\n\nclass ViewFileText extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      content: fileContent,\n      needSave: false,\n      isSaving: false,\n      participants: [],\n    };\n    this.onSave=this.onSave.bind(this);\n    this.isParticipant = false;\n  }\n\n\n  updateContent = (value) => {\n    this.setState({\n      needSave: true,\n      content: value,\n    });\n  };\n\n  onSave () {\n    if (!this.isParticipant) {\n      this.addParticipant();\n    }\n    let dirPath = Utils.getDirName(filePath);\n    return (\n      seafileAPI.getUpdateLink(repoID, dirPath).then((res) => {\n        const uploadLink = res.data;\n        this.setState({\n          isSaving: true\n        });\n        return seafileAPI.updateFile(\n          uploadLink,\n          filePath,\n          fileName,\n          this.state.content\n        ).then(() => {\n          toaster.success(gettext('Successfully saved'), {\n            duration: 2\n          });\n          this.setState({\n            isSaving: false,\n            needSave: false\n          });\n        });\n      })\n    );\n  }\n\n  addParticipant = () => {\n    seafileAPI.addFileParticipants(repoID, filePath, [username]).then((res) => {\n      if (res.status === 200) {\n        this.isParticipant = true;\n        this.getParticipants();\n      }\n    });\n  };\n\n  getParticipants = () => {\n    seafileAPI.listFileParticipants(repoID, filePath).then((res) => {\n      const participants = res.data.participant_list;\n      this.setState({ participants: participants });\n      if (participants.length > 0) {\n        this.isParticipant = participants.every((participant) => {\n          return participant.email == username;\n        });\n      }\n    });\n  };\n\n  onParticipantsChange = () => {\n    this.getParticipants();\n  };\n\n  componentDidMount() {\n    this.getParticipants();\n  }\n\n  render() {\n    return (\n      <FileView\n        content={\n          <FileContent\n            content={this.state.content}\n            updateContent={this.updateContent}\n          />\n        }\n        isSaving={this.state.isSaving}\n        needSave={this.state.needSave}\n        onSave={this.onSave}\n        participants={this.state.participants}\n        onParticipantsChange={this.onParticipantsChange}\n      />\n    );\n  }\n}\n\nReactDom.render(<ViewFileText />, document.getElementById('wrapper'));\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}