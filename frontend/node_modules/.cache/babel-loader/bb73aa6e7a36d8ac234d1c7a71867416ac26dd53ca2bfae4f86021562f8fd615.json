{"ast":null,"code":"import _toConsumableArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport React, { useEffect, useState, useImperativeHandle, forwardRef, useMemo, useCallback, useRef } from 'react';\nimport { Editor } from '@seafile/slate';\nimport deepCopy from 'deep-copy';\nimport context from '../../context';\nimport CommonLoading from '../../components/common-loading';\nimport { COMMENT_EDITOR_EDIT_AREA_WIDTH } from '../constants';\nimport { createCommentEditor } from '../extension';\nimport withNodeId from '../node-id';\nimport { withSocketIO } from '../socket';\nimport { focusEditor } from '../extension/core';\nimport { EditorContainer } from '../layout';\nimport { CollaboratorsProvider } from '../../hooks';\nimport { EventBus } from '../../basic-sdk';\nimport { EXTERNAL_EVENT } from '../../constants';\nimport CommentEditorToolbar from '../extension/toolbar/comment-editor-toolbar';\nimport CommentArticle from './comment-article';\nimport { ScrollContext } from '../hooks/use-scroll-context';\nvar SdocCommentEditor = forwardRef(function (_ref, ref) {\n  var propsEditor = _ref.editor,\n    document = _ref.document,\n    isReloading = _ref.isReloading,\n    type = _ref.type,\n    onSubmit = _ref.onSubmit,\n    submitBtnText = _ref.submitBtnText,\n    onCancel = _ref.onCancel;\n  var _useState = useState(document.children),\n    _useState2 = _slicedToArray(_useState, 2),\n    slateValue = _useState2[0],\n    _setSlateValue = _useState2[1];\n  var commentEditorContainerRef = useRef(null);\n  var validEditor = propsEditor || useMemo(function () {\n    var defaultEditor = createCommentEditor();\n    var editorConfig = context.getEditorConfig();\n    var newEditor = withNodeId(withSocketIO(defaultEditor, {\n      document: document,\n      config: editorConfig\n    }));\n    var cursors = document.cursors;\n    newEditor.cursors = cursors || {};\n    newEditor.width = COMMENT_EDITOR_EDIT_AREA_WIDTH; // default width\n\n    return newEditor;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // useMount: focus editor\n  useEffect(function () {\n    var _validEditor$children = _slicedToArray(validEditor.children, 1),\n      firstNode = _validEditor$children[0];\n    if (firstNode) {\n      var _firstNode$children = _slicedToArray(firstNode.children, 1),\n        firstNodeFirstChild = _firstNode$children[0];\n      if (firstNodeFirstChild) {\n        var endOfFirstNode = Editor.end(validEditor, [0, 0]);\n        var range = {\n          anchor: endOfFirstNode,\n          focus: endOfFirstNode\n        };\n        focusEditor(validEditor, range);\n      }\n      // Force refresh to fix comment list\n      _setSlateValue(_toConsumableArray(validEditor.children));\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var onRefreshDocument = useCallback(function () {\n    window.location.reload();\n  }, []);\n\n  // useMount: refresh document\n  useEffect(function () {\n    var eventBus = EventBus.getInstance();\n    eventBus.subscribe(EXTERNAL_EVENT.REFRESH_DOCUMENT, onRefreshDocument);\n  }, [onRefreshDocument]);\n\n  // The parent component can call the method of this component through ref\n  useImperativeHandle(ref, function () {\n    return {\n      setSlateValue: function setSlateValue(document) {\n        // Force update of editor's child elements\n        validEditor.children = document.children;\n        _setSlateValue(_toConsumableArray(document.children));\n      },\n      updateDocumentVersion: function updateDocumentVersion(document) {\n        validEditor.updateDocumentVersion(document);\n      },\n      // get value\n      getSlateValue: function getSlateValue() {\n        return deepCopy(_objectSpread(_objectSpread({}, document), {}, {\n          children: slateValue\n        }));\n      }\n\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    };\n  }, [document, validEditor, slateValue]);\n  if (isReloading) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"h-100 w-100 d-flex align-items-center justify-content-center\"\n    }, /*#__PURE__*/React.createElement(CommonLoading, null));\n  }\n  var handleFocusEditor = function handleFocusEditor(e) {\n    if (e.target === commentEditorContainerRef.current) {\n      var focusPoint = Editor.end(validEditor, []);\n      focusEditor(validEditor, focusPoint);\n    }\n  };\n  return /*#__PURE__*/React.createElement(EditorContainer, {\n    editor: validEditor\n  }, /*#__PURE__*/React.createElement(CollaboratorsProvider, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-comment-editor-wrapper\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: commentEditorContainerRef,\n    className: \"article sdoc-comment-editor\",\n    onClick: handleFocusEditor\n  }, /*#__PURE__*/React.createElement(ScrollContext.Provider, {\n    value: {\n      scrollRef: commentEditorContainerRef\n    }\n  }, /*#__PURE__*/React.createElement(CommentArticle, {\n    type: type,\n    editor: validEditor,\n    slateValue: slateValue,\n    updateSlateValue: _setSlateValue\n  }))), /*#__PURE__*/React.createElement(CommentEditorToolbar, {\n    editor: validEditor,\n    onSubmit: onSubmit,\n    submitBtnText: submitBtnText,\n    onCancel: onCancel\n  }))));\n});\nexport default SdocCommentEditor;","map":{"version":3,"names":["_objectSpread","React","useEffect","useState","useImperativeHandle","forwardRef","useMemo","useCallback","useRef","Editor","deepCopy","context","CommonLoading","COMMENT_EDITOR_EDIT_AREA_WIDTH","createCommentEditor","withNodeId","withSocketIO","focusEditor","EditorContainer","CollaboratorsProvider","EventBus","EXTERNAL_EVENT","CommentEditorToolbar","CommentArticle","ScrollContext","SdocCommentEditor","_ref","ref","propsEditor","editor","document","isReloading","type","onSubmit","submitBtnText","onCancel","_useState","children","_useState2","_slicedToArray","slateValue","setSlateValue","commentEditorContainerRef","validEditor","defaultEditor","editorConfig","getEditorConfig","newEditor","config","cursors","width","_validEditor$children","firstNode","_firstNode$children","firstNodeFirstChild","endOfFirstNode","end","range","anchor","focus","_toConsumableArray","onRefreshDocument","window","location","reload","eventBus","getInstance","subscribe","REFRESH_DOCUMENT","updateDocumentVersion","getSlateValue","createElement","className","handleFocusEditor","e","target","current","focusPoint","onClick","Provider","value","scrollRef","updateSlateValue"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/editor/sdoc-comment-editor.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport React, { useEffect, useState, useImperativeHandle, forwardRef, useMemo, useCallback, useRef } from 'react';\nimport { Editor } from '@seafile/slate';\nimport deepCopy from 'deep-copy';\nimport context from '../../context';\nimport CommonLoading from '../../components/common-loading';\nimport { COMMENT_EDITOR_EDIT_AREA_WIDTH } from '../constants';\nimport { createCommentEditor } from '../extension';\nimport withNodeId from '../node-id';\nimport { withSocketIO } from '../socket';\nimport { focusEditor } from '../extension/core';\nimport { EditorContainer } from '../layout';\nimport { CollaboratorsProvider } from '../../hooks';\nimport { EventBus } from '../../basic-sdk';\nimport { EXTERNAL_EVENT } from '../../constants';\nimport CommentEditorToolbar from '../extension/toolbar/comment-editor-toolbar';\nimport CommentArticle from './comment-article';\nimport { ScrollContext } from '../hooks/use-scroll-context';\nconst SdocCommentEditor = forwardRef((_ref, ref) => {\n  let {\n    editor: propsEditor,\n    document,\n    isReloading,\n    type,\n    onSubmit,\n    submitBtnText,\n    onCancel\n  } = _ref;\n  const [slateValue, setSlateValue] = useState(document.children);\n  const commentEditorContainerRef = useRef(null);\n  const validEditor = propsEditor || useMemo(() => {\n    const defaultEditor = createCommentEditor();\n    const editorConfig = context.getEditorConfig();\n    const newEditor = withNodeId(withSocketIO(defaultEditor, {\n      document,\n      config: editorConfig\n    }));\n    const {\n      cursors\n    } = document;\n    newEditor.cursors = cursors || {};\n    newEditor.width = COMMENT_EDITOR_EDIT_AREA_WIDTH; // default width\n\n    return newEditor;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // useMount: focus editor\n  useEffect(() => {\n    const [firstNode] = validEditor.children;\n    if (firstNode) {\n      const [firstNodeFirstChild] = firstNode.children;\n      if (firstNodeFirstChild) {\n        const endOfFirstNode = Editor.end(validEditor, [0, 0]);\n        const range = {\n          anchor: endOfFirstNode,\n          focus: endOfFirstNode\n        };\n        focusEditor(validEditor, range);\n      }\n      // Force refresh to fix comment list\n      setSlateValue([...validEditor.children]);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const onRefreshDocument = useCallback(() => {\n    window.location.reload();\n  }, []);\n\n  // useMount: refresh document\n  useEffect(() => {\n    const eventBus = EventBus.getInstance();\n    eventBus.subscribe(EXTERNAL_EVENT.REFRESH_DOCUMENT, onRefreshDocument);\n  }, [onRefreshDocument]);\n\n  // The parent component can call the method of this component through ref\n  useImperativeHandle(ref, () => ({\n    setSlateValue: document => {\n      // Force update of editor's child elements\n      validEditor.children = document.children;\n      setSlateValue([...document.children]);\n    },\n    updateDocumentVersion: document => {\n      validEditor.updateDocumentVersion(document);\n    },\n    // get value\n    getSlateValue: () => {\n      return deepCopy(_objectSpread(_objectSpread({}, document), {}, {\n        children: slateValue\n      }));\n    }\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }), [document, validEditor, slateValue]);\n  if (isReloading) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"h-100 w-100 d-flex align-items-center justify-content-center\"\n    }, /*#__PURE__*/React.createElement(CommonLoading, null));\n  }\n  const handleFocusEditor = e => {\n    if (e.target === commentEditorContainerRef.current) {\n      const focusPoint = Editor.end(validEditor, []);\n      focusEditor(validEditor, focusPoint);\n    }\n  };\n  return /*#__PURE__*/React.createElement(EditorContainer, {\n    editor: validEditor\n  }, /*#__PURE__*/React.createElement(CollaboratorsProvider, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-comment-editor-wrapper\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: commentEditorContainerRef,\n    className: \"article sdoc-comment-editor\",\n    onClick: handleFocusEditor\n  }, /*#__PURE__*/React.createElement(ScrollContext.Provider, {\n    value: {\n      scrollRef: commentEditorContainerRef\n    }\n  }, /*#__PURE__*/React.createElement(CommentArticle, {\n    type: type,\n    editor: validEditor,\n    slateValue: slateValue,\n    updateSlateValue: setSlateValue\n  }))), /*#__PURE__*/React.createElement(CommentEditorToolbar, {\n    editor: validEditor,\n    onSubmit: onSubmit,\n    submitBtnText: submitBtnText,\n    onCancel: onCancel\n  }))));\n});\nexport default SdocCommentEditor;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}