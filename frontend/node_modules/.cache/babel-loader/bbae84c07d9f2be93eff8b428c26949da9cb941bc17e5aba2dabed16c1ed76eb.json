{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import ListCustomPermission from'./list-custom-permissions';import AddCustomPermission from'./add-custom-permission';import EditCustomPermission from'./edit-custom-permission';import Loading from'../../loading';import{seafileAPI}from'../../../utils/seafile-api';import toaster from'../../toast';import{Utils}from'../../../utils/utils';import CustomPermission from'../../../models/custom-permission';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MANAGER_STATE={LIST:'list',ADD:'add',EDIT:'edit'};var CustomPermissionManager=/*#__PURE__*/function(_React$Component){_inherits(CustomPermissionManager,_React$Component);var _super=_createSuper(CustomPermissionManager);function CustomPermissionManager(props){var _this;_classCallCheck(this,CustomPermissionManager);_this=_super.call(this,props);_this.listCustomPermissions=function(){var repoID=_this.props.repoID;seafileAPI.listCustomPermissions(repoID).then(function(res){var permissions=res.data.permission_list.map(function(item){return new CustomPermission(item);});_this.setState({isLoading:false,permissions:permissions});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);_this.setState({isLoading:false});});};_this.addCustomPermission=function(permission_name,permission_desc,permission){var repoID=_this.props.repoID;seafileAPI.createCustomPermission(repoID,permission_name,permission_desc,permission).then(function(res){var permissions=_this.state.permissions;var customPermission=new CustomPermission(res.data.permission);permissions.unshift(customPermission);_this.setState({permissions:permissions,currentMode:MANAGER_STATE.LIST});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.editCustomPermission=function(newPermission){var repoID=_this.props.repoID;seafileAPI.updateCustomPermission(repoID,newPermission).then(function(res){var customPermission=new CustomPermission(res.data.permission);var permissions=_this.state.permissions;var newPermissions=permissions.map(function(item){if(item.id===customPermission.id){return customPermission;}return item;});_this.setState({permissions:newPermissions,currentMode:MANAGER_STATE.LIST});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.deleteCustomPermission=function(permission){var repoID=_this.props.repoID;var permissionID=permission.id;seafileAPI.deleteCustomPermission(repoID,permissionID).then(function(res){var permissions=_this.state.permissions;var newPermissions=permissions.filter(function(permission){return permission.id!==permissionID;});_this.setState({permissions:newPermissions});}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.onChangeMode=function(){_this.setState({currentMode:MANAGER_STATE.LIST});};_this.onAddCustomPermission=function(){_this.setState({currentMode:MANAGER_STATE.ADD});};_this.onEditCustomPermission=function(permission){_this.setState({currentMode:MANAGER_STATE.EDIT,currentPermission:permission});};_this.onDeleteCustomPermission=function(permission){_this.deleteCustomPermission(permission);};_this.state={currentMode:MANAGER_STATE.LIST,isLoading:true,permissions:[],currentPermission:null};return _this;}_createClass(CustomPermissionManager,[{key:\"componentDidMount\",value:function componentDidMount(){this.listCustomPermissions();}},{key:\"render\",value:function render(){if(this.state.isLoading){return/*#__PURE__*/_jsx(Loading,{});}var _this$state=this.state,currentMode=_this$state.currentMode,permissions=_this$state.permissions,currentPermission=_this$state.currentPermission;return/*#__PURE__*/_jsxs(\"div\",{className:\"custom-permission-manager\",children:[currentMode===MANAGER_STATE.LIST&&/*#__PURE__*/_jsx(ListCustomPermission,{permissions:permissions,onAddCustomPermission:this.onAddCustomPermission,onEditCustomPermission:this.onEditCustomPermission,onDeleteCustomPermission:this.onDeleteCustomPermission}),currentMode===MANAGER_STATE.ADD&&/*#__PURE__*/_jsx(AddCustomPermission,{onChangeMode:this.onChangeMode,addCustomPermission:this.addCustomPermission}),currentMode===MANAGER_STATE.EDIT&&/*#__PURE__*/_jsx(EditCustomPermission,{permission:currentPermission,onChangeMode:this.onChangeMode,editCustomPermission:this.editCustomPermission})]});}}]);return CustomPermissionManager;}(React.Component);export default CustomPermissionManager;","map":{"version":3,"names":["React","ListCustomPermission","AddCustomPermission","EditCustomPermission","Loading","seafileAPI","toaster","Utils","CustomPermission","jsx","_jsx","jsxs","_jsxs","MANAGER_STATE","LIST","ADD","EDIT","CustomPermissionManager","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","listCustomPermissions","repoID","then","res","permissions","data","permission_list","map","item","setState","isLoading","catch","error","errMessage","getErrorMsg","danger","addCustomPermission","permission_name","permission_desc","permission","createCustomPermission","state","customPermission","unshift","currentMode","editCustomPermission","newPermission","updateCustomPermission","newPermissions","id","deleteCustomPermission","permissionID","filter","onChangeMode","onAddCustomPermission","onEditCustomPermission","currentPermission","onDeleteCustomPermission","_createClass","key","value","componentDidMount","render","_this$state","className","children","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/dialog/custom-permission/custom-permission-manager.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport ListCustomPermission from './list-custom-permissions';\nimport AddCustomPermission from './add-custom-permission';\nimport EditCustomPermission from './edit-custom-permission';\nimport Loading from '../../loading';\nimport { seafileAPI } from '../../../utils/seafile-api';\nimport toaster from '../../toast';\nimport { Utils } from '../../../utils/utils';\nimport CustomPermission from '../../../models/custom-permission';\n\nconst propTypes = {\n  repoID: PropTypes.string.isRequired\n};\n\nconst MANAGER_STATE = {\n  LIST: 'list',\n  ADD: 'add',\n  EDIT: 'edit',\n};\n\nclass CustomPermissionManager extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentMode: MANAGER_STATE.LIST,\n      isLoading: true,\n      permissions: [],\n      currentPermission: null,\n    };\n  }\n\n  componentDidMount() {\n    this.listCustomPermissions();\n  }\n\n  listCustomPermissions = () => {\n    const { repoID } = this.props;\n    seafileAPI.listCustomPermissions(repoID).then(res => {\n      const permissions = res.data.permission_list.map(item => new CustomPermission(item));\n      this.setState({\n        isLoading: false,\n        permissions: permissions\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n      this.setState({isLoading: false});\n    });\n  };\n\n  addCustomPermission = (permission_name, permission_desc, permission) => {\n    const { repoID } = this.props;\n    seafileAPI.createCustomPermission(repoID, permission_name, permission_desc, permission).then(res => {\n      const { permissions } = this.state;\n      const customPermission = new CustomPermission(res.data.permission);\n      permissions.unshift(customPermission);\n      this.setState({\n        permissions,\n        currentMode: MANAGER_STATE.LIST\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  editCustomPermission = (newPermission) => {\n    const { repoID } = this.props;\n    seafileAPI.updateCustomPermission(repoID, newPermission).then(res => {\n      const customPermission = new CustomPermission(res.data.permission);\n      const { permissions } = this.state;\n      const newPermissions = permissions.map(item => {\n        if (item.id === customPermission.id) {\n          return customPermission;\n        }\n        return item;\n      });\n      this.setState({\n        permissions: newPermissions,\n        currentMode: MANAGER_STATE.LIST\n      });\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  deleteCustomPermission = (permission) => {\n    const { repoID } = this.props;\n    const { id: permissionID } = permission;\n    seafileAPI.deleteCustomPermission(repoID, permissionID).then(res => {\n      const { permissions } = this.state;\n      const newPermissions = permissions.filter(permission => permission.id !== permissionID);\n      this.setState({permissions: newPermissions});\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  onChangeMode = () => {\n    this.setState({currentMode: MANAGER_STATE.LIST});\n  };\n\n  onAddCustomPermission = () => {\n    this.setState({currentMode: MANAGER_STATE.ADD});\n  };\n\n  onEditCustomPermission = (permission) => {\n    this.setState({\n      currentMode: MANAGER_STATE.EDIT,\n      currentPermission: permission\n    });\n  };\n\n  onDeleteCustomPermission = (permission) => {\n    this.deleteCustomPermission(permission);\n  };\n\n  render() {\n\n    if (this.state.isLoading) {\n      return <Loading />;\n    }\n\n    const { currentMode, permissions, currentPermission } = this.state;\n    return (\n      <div className=\"custom-permission-manager\">\n        {currentMode === MANAGER_STATE.LIST && (\n          <ListCustomPermission\n            permissions={permissions}\n            onAddCustomPermission={this.onAddCustomPermission}\n            onEditCustomPermission={this.onEditCustomPermission}\n            onDeleteCustomPermission={this.onDeleteCustomPermission}\n          />\n        )}\n        {currentMode === MANAGER_STATE.ADD && (\n          <AddCustomPermission\n            onChangeMode={this.onChangeMode}\n            addCustomPermission={this.addCustomPermission}\n          />\n        )}\n        {currentMode === MANAGER_STATE.EDIT && (\n          <EditCustomPermission\n            permission={currentPermission}\n            onChangeMode={this.onChangeMode}\n            editCustomPermission={this.editCustomPermission}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nCustomPermissionManager.propTypes = propTypes;\n\nexport default CustomPermissionManager;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}