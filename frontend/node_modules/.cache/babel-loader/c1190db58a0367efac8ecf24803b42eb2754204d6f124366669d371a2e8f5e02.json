{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import className from'classnames';import{basicSetup}from'codemirror';import{EditorView}from'@codemirror/view';import{markdown}from'@codemirror/lang-markdown';import{languages}from'@codemirror/language-data';import'./code-mirror.css';import{jsx as _jsx}from\"react/jsx-runtime\";var SeafileCodeMirror=/*#__PURE__*/function(_React$Component){_inherits(SeafileCodeMirror,_React$Component);var _super=_createSuper(SeafileCodeMirror);function SeafileCodeMirror(){var _this;_classCallCheck(this,SeafileCodeMirror);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.onValueChanged=function(viewUpdate){var onChange=_this.props.onChange;if(onChange&&viewUpdate.docChanged){var doc=viewUpdate.state.doc;var value=doc.toString();onChange(value);}};_this.focus=function(){_this.view.focus();};_this.scrollIntoView=function(pos){EditorView.scrollIntoView(pos);};_this.setCodeMirrorRef=function(ref){_this.codeMirrorRef=ref;};return _this;}_createClass(SeafileCodeMirror,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var _this$props=this.props,initialValue=_this$props.initialValue,autoFocus=_this$props.autoFocus;this.view=new EditorView({doc:initialValue,extensions:[basicSetup,markdown({codeLanguages:languages}),EditorView.updateListener.of(function(viewUpdate){_this2.onValueChanged(viewUpdate);}),EditorView.lineWrapping],parent:this.codeMirrorRef});if(autoFocus)this.focus();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.view){this.view.destroy();}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(!prevProps.initialValue&&prevProps.initialValue!==this.props.initialValue){this.view.dispatch({changes:{from:0,to:this.view.state.doc.length,insert:this.props.initialValue}});}}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"div\",{className:className('sf-code-mirror',this.props.className),children:/*#__PURE__*/_jsx(\"div\",{ref:this.setCodeMirrorRef})});}}]);return SeafileCodeMirror;}(React.Component);export default SeafileCodeMirror;","map":{"version":3,"names":["React","className","basicSetup","EditorView","markdown","languages","jsx","_jsx","SeafileCodeMirror","_React$Component","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","onValueChanged","viewUpdate","onChange","props","docChanged","doc","state","value","toString","focus","view","scrollIntoView","pos","setCodeMirrorRef","ref","codeMirrorRef","_createClass","key","componentDidMount","_this2","_this$props","initialValue","autoFocus","extensions","codeLanguages","updateListener","of","lineWrapping","parent","componentWillUnmount","destroy","componentDidUpdate","prevProps","dispatch","changes","from","to","insert","render","children","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/plain-markdown-editor/code-mirror.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport className from 'classnames';\nimport { basicSetup } from 'codemirror';\nimport { EditorView } from '@codemirror/view';\nimport { markdown } from '@codemirror/lang-markdown';\nimport { languages } from '@codemirror/language-data';\n\nimport './code-mirror.css';\n\nconst propTypes = {\n  autoFocus: PropTypes.bool,\n  initialValue: PropTypes.string,\n  className: PropTypes.string,\n  onChange: PropTypes.func,\n};\n\nclass SeafileCodeMirror extends React.Component {\n\n  componentDidMount() {\n    const { initialValue, autoFocus } = this.props;\n\n    this.view = new EditorView({\n      doc: initialValue,\n      extensions: [\n        basicSetup,\n        markdown({ codeLanguages: languages }),\n        EditorView.updateListener.of((viewUpdate) => {\n          this.onValueChanged(viewUpdate);\n        }),\n        EditorView.lineWrapping\n      ],\n      parent: this.codeMirrorRef,\n    });\n    if (autoFocus) this.focus();\n  }\n\n  componentWillUnmount() {\n    if (this.view) {\n      this.view.destroy();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (!prevProps.initialValue && prevProps.initialValue !== this.props.initialValue) {\n      this.view.dispatch({\n        changes: {\n          from: 0,\n          to: this.view.state.doc.length,\n          insert: this.props.initialValue,\n        },\n      });\n    }\n  }\n\n  onValueChanged = (viewUpdate) => {\n    const { onChange } = this.props;\n    if (onChange && viewUpdate.docChanged) {\n      const doc = viewUpdate.state.doc;\n      const value = doc.toString();\n      onChange(value);\n    }\n  };\n\n  focus = () => {\n    this.view.focus();\n  };\n\n  scrollIntoView = (pos) => {\n    EditorView.scrollIntoView(pos);\n  };\n\n\n  setCodeMirrorRef = (ref) => {\n    this.codeMirrorRef = ref;\n  };\n\n  render() {\n    return (\n      <div className={className('sf-code-mirror', this.props.className)}>\n        <div ref={this.setCodeMirrorRef} />\n      </div>\n    );\n  }\n}\n\nSeafileCodeMirror.propTypes = propTypes;\n\nexport default SeafileCodeMirror;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}