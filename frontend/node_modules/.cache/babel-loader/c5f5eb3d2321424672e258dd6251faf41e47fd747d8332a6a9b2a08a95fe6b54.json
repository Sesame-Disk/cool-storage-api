{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import ReactDom from'react-dom';import{seafileAPI}from'./utils/seafile-api';import{siteRoot,gettext}from'./utils/constants';import SharedFileView from'./components/shared-file-view/shared-file-view';import SharedFileViewTip from'./components/shared-file-view/shared-file-view-tip';import Loading from'./components/loading';import'./css/spreadsheet-file-view.css';import{jsx as _jsx}from\"react/jsx-runtime\";var _window$shared$pageOp=window.shared.pageOptions,repoID=_window$shared$pageOp.repoID,filePath=_window$shared$pageOp.filePath,err=_window$shared$pageOp.err,commitID=_window$shared$pageOp.commitID,fileType=_window$shared$pageOp.fileType,fileName=_window$shared$pageOp.fileName,sharedToken=_window$shared$pageOp.sharedToken;var SharedFileViewSpreadsheet=/*#__PURE__*/function(_React$Component){_inherits(SharedFileViewSpreadsheet,_React$Component);var _super=_createSuper(SharedFileViewSpreadsheet);function SharedFileViewSpreadsheet(){_classCallCheck(this,SharedFileViewSpreadsheet);return _super.apply(this,arguments);}_createClass(SharedFileViewSpreadsheet,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(SharedFileView,{content:/*#__PURE__*/_jsx(FileContent,{})});}}]);return SharedFileViewSpreadsheet;}(React.Component);var FileContent=/*#__PURE__*/function(_React$Component2){_inherits(FileContent,_React$Component2);var _super2=_createSuper(FileContent);function FileContent(props){var _this;_classCallCheck(this,FileContent);_this=_super2.call(this,props);_this.setIframeHeight=function(e){var iframe=e.currentTarget;iframe.height=iframe.contentDocument.body.scrollHeight;};_this.state={isLoading:!err,errorMsg:''};return _this;}_createClass(FileContent,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;if(err){return;}var queryStatus=function queryStatus(){seafileAPI.queryOfficeFileConvertStatus(repoID,commitID,filePath,fileType.toLowerCase(),sharedToken).then(function(res){var convertStatus=res.data['status'];switch(convertStatus){case'QUEUED':case'PROCESSING':_this2.setState({isLoading:true});setTimeout(queryStatus,2000);break;case'ERROR':_this2.setState({isLoading:false,errorMsg:gettext('Document convertion failed.')});break;case'DONE':_this2.setState({isLoading:false,errorMsg:''});}}).catch(function(error){if(error.response){_this2.setState({isLoading:false,errorMsg:gettext('Document convertion failed.')});}else{_this2.setState({isLoading:false,errorMsg:gettext('Please check the network.')});}});};queryStatus();}},{key:\"render\",value:function render(){var _this$state=this.state,isLoading=_this$state.isLoading,errorMsg=_this$state.errorMsg;if(err){return/*#__PURE__*/_jsx(SharedFileViewTip,{});}if(isLoading){return/*#__PURE__*/_jsx(Loading,{});}if(errorMsg){return/*#__PURE__*/_jsx(SharedFileViewTip,{errorMsg:errorMsg});}return/*#__PURE__*/_jsx(\"div\",{className:\"shared-file-view-body spreadsheet-file-view\",children:/*#__PURE__*/_jsx(\"iframe\",{id:\"spreadsheet-container\",title:fileName,src:\"\".concat(siteRoot,\"office-convert/static/\").concat(repoID,\"/\").concat(commitID).concat(encodeURIComponent(filePath),\"/index.html?token=\").concat(sharedToken),onLoad:this.setIframeHeight})});}}]);return FileContent;}(React.Component);ReactDom.render(/*#__PURE__*/_jsx(SharedFileViewSpreadsheet,{}),document.getElementById('wrapper'));","map":{"version":3,"names":["React","ReactDom","seafileAPI","siteRoot","gettext","SharedFileView","SharedFileViewTip","Loading","jsx","_jsx","_window$shared$pageOp","window","shared","pageOptions","repoID","filePath","err","commitID","fileType","fileName","sharedToken","SharedFileViewSpreadsheet","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","render","content","FileContent","Component","_React$Component2","_super2","props","_this","call","setIframeHeight","e","iframe","currentTarget","height","contentDocument","body","scrollHeight","state","isLoading","errorMsg","componentDidMount","_this2","queryStatus","queryOfficeFileConvertStatus","toLowerCase","then","res","convertStatus","data","setState","setTimeout","catch","error","response","_this$state","className","children","id","title","src","concat","encodeURIComponent","onLoad","document","getElementById"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/shared-file-view-spreadsheet.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport { seafileAPI } from './utils/seafile-api';\nimport { siteRoot, gettext } from './utils/constants';\nimport SharedFileView from './components/shared-file-view/shared-file-view';\nimport SharedFileViewTip from './components/shared-file-view/shared-file-view-tip';\nimport Loading from './components/loading';\n\nimport './css/spreadsheet-file-view.css';\n\nconst {\n  repoID, filePath, err,\n  commitID, fileType, fileName, sharedToken\n} = window.shared.pageOptions;\n\nclass SharedFileViewSpreadsheet extends React.Component {\n  render() {\n    return (\n      <SharedFileView content={<FileContent />} />\n    );\n  }\n}\n\nclass FileContent extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: !err,\n      errorMsg: ''\n    };\n  }\n\n  componentDidMount() {\n    if (err) {\n      return;\n    }\n\n    let queryStatus = () => {\n      seafileAPI.queryOfficeFileConvertStatus(repoID, commitID, filePath, fileType.toLowerCase(), sharedToken).then((res) => {\n        const convertStatus = res.data['status'];\n        switch (convertStatus) {\n          case 'QUEUED':\n          case 'PROCESSING':\n            this.setState({\n              isLoading: true\n            });\n            setTimeout(queryStatus, 2000);\n            break;\n          case 'ERROR':\n            this.setState({\n              isLoading: false,\n              errorMsg: gettext('Document convertion failed.')\n            });\n            break;\n          case 'DONE':\n            this.setState({\n              isLoading: false,\n              errorMsg: ''\n            });\n        }\n      }).catch((error) => {\n        if (error.response) {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Document convertion failed.')\n          });\n        } else {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Please check the network.')\n          });\n        }\n      });\n    };\n\n    queryStatus();\n  }\n\n  setIframeHeight = (e) => {\n    const iframe = e.currentTarget;\n    iframe.height = iframe.contentDocument.body.scrollHeight;\n  };\n\n  render() {\n    const { isLoading, errorMsg } = this.state;\n\n    if (err) {\n      return <SharedFileViewTip />;\n    }\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <SharedFileViewTip errorMsg={errorMsg} />;\n    }\n\n    return (\n      <div className=\"shared-file-view-body spreadsheet-file-view\">\n        <iframe id=\"spreadsheet-container\" title={fileName} src={`${siteRoot}office-convert/static/${repoID}/${commitID}${encodeURIComponent(filePath)}/index.html?token=${sharedToken}`} onLoad={this.setIframeHeight}></iframe>\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SharedFileViewSpreadsheet />, document.getElementById('wrapper'));\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}