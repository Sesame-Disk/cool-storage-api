{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { Transforms, Editor, Path, Range } from '@seafile/slate';\nimport { LIST_ITEM, PARAGRAPH } from '../../../constants';\nimport { getAboveNode, isBlockTextEmptyAfterSelection, isStartPoint } from '../../../core';\nimport { generateEmptyListContent, generateEmptyListItem } from '../model';\n\n// list > list_item > paragraph\nexport var insertListItem = function insertListItem(editor) {\n  var paragraphEntry = getAboveNode(editor, {\n    match: {\n      type: PARAGRAPH\n    }\n  });\n  if (!paragraphEntry) return false;\n  var _paragraphEntry = _slicedToArray(paragraphEntry, 2),\n    paragraphPath = _paragraphEntry[1];\n  var listItemEntry = Editor.parent(editor, paragraphPath);\n  if (!listItemEntry) return false;\n  var _listItemEntry = _slicedToArray(listItemEntry, 2),\n    listItemNode = _listItemEntry[0],\n    listItemPath = _listItemEntry[1];\n  if (listItemNode.type !== LIST_ITEM) return false;\n  var success = false;\n  Editor.withoutNormalizing(editor, function () {\n    var _editor$selection;\n    if (!Range.isCollapsed(editor.selection)) {\n      // 删除选中的内容\n      Transforms.delete(editor, {\n        at: editor.selection\n      });\n    }\n    var _isStartPoint = isStartPoint(editor, (_editor$selection = editor.selection) === null || _editor$selection === void 0 ? void 0 : _editor$selection.focus, paragraphPath);\n    var isEndPoint = isBlockTextEmptyAfterSelection(editor);\n    var nextParagraphPath = Path.next(paragraphPath);\n    var nextListItemPath = Path.next(listItemPath);\n    if (_isStartPoint) {\n      // listItem 有内容，光标在开始\n      var itemContent = generateEmptyListContent();\n      Transforms.insertNodes(editor, itemContent, {\n        at: listItemPath\n      });\n      var listItem = generateEmptyListItem();\n      Transforms.wrapNodes(editor, listItem, {\n        at: listItemPath\n      });\n      success = true;\n      return;\n    }\n    if (!isEndPoint) {\n      // listItem 有内容，光标在中间\n      Transforms.splitNodes(editor);\n      var _listItem = generateEmptyListItem();\n      Transforms.wrapNodes(editor, _listItem, {\n        at: nextParagraphPath\n      });\n      Transforms.moveNodes(editor, {\n        at: nextParagraphPath,\n        to: nextListItemPath\n      });\n      Transforms.select(editor, nextListItemPath);\n      Transforms.collapse(editor, {\n        edge: 'start'\n      });\n      success = true;\n    } else {\n      var _Editor$marks;\n      // listItem 有内容，光标在结尾\n      var marks = (_Editor$marks = Editor.marks(editor)) === null || _Editor$marks === void 0 ? void 0 : _Editor$marks.key;\n      var _itemContent = generateEmptyListContent();\n      Transforms.insertNodes(editor, _objectSpread(_objectSpread({}, _itemContent), marks), {\n        at: nextListItemPath\n      });\n      var _listItem2 = generateEmptyListItem();\n      Transforms.wrapNodes(editor, _listItem2, {\n        at: nextListItemPath\n      });\n      Transforms.select(editor, nextListItemPath);\n      success = true;\n    }\n    if (listItemNode.children.length > 1) {\n      Transforms.moveNodes(editor, {\n        at: nextParagraphPath,\n        to: nextListItemPath.concat(1)\n      });\n      success = true;\n    }\n  });\n  return success;\n};","map":{"version":3,"names":["_objectSpread","Transforms","Editor","Path","Range","LIST_ITEM","PARAGRAPH","getAboveNode","isBlockTextEmptyAfterSelection","isStartPoint","generateEmptyListContent","generateEmptyListItem","insertListItem","editor","paragraphEntry","match","type","_paragraphEntry","_slicedToArray","paragraphPath","listItemEntry","parent","_listItemEntry","listItemNode","listItemPath","success","withoutNormalizing","_editor$selection","isCollapsed","selection","delete","at","_isStartPoint","focus","isEndPoint","nextParagraphPath","next","nextListItemPath","itemContent","insertNodes","listItem","wrapNodes","splitNodes","moveNodes","to","select","collapse","edge","_Editor$marks","marks","key","children","length","concat"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/list/transforms/insert-list-item.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport { Transforms, Editor, Path, Range } from '@seafile/slate';\nimport { LIST_ITEM, PARAGRAPH } from '../../../constants';\nimport { getAboveNode, isBlockTextEmptyAfterSelection, isStartPoint } from '../../../core';\nimport { generateEmptyListContent, generateEmptyListItem } from '../model';\n\n// list > list_item > paragraph\nexport const insertListItem = editor => {\n  const paragraphEntry = getAboveNode(editor, {\n    match: {\n      type: PARAGRAPH\n    }\n  });\n  if (!paragraphEntry) return false;\n  const [, paragraphPath] = paragraphEntry;\n  const listItemEntry = Editor.parent(editor, paragraphPath);\n  if (!listItemEntry) return false;\n  const [listItemNode, listItemPath] = listItemEntry;\n  if (listItemNode.type !== LIST_ITEM) return false;\n  let success = false;\n  Editor.withoutNormalizing(editor, () => {\n    var _editor$selection;\n    if (!Range.isCollapsed(editor.selection)) {\n      // 删除选中的内容\n      Transforms.delete(editor, {\n        at: editor.selection\n      });\n    }\n    const _isStartPoint = isStartPoint(editor, (_editor$selection = editor.selection) === null || _editor$selection === void 0 ? void 0 : _editor$selection.focus, paragraphPath);\n    const isEndPoint = isBlockTextEmptyAfterSelection(editor);\n    const nextParagraphPath = Path.next(paragraphPath);\n    const nextListItemPath = Path.next(listItemPath);\n    if (_isStartPoint) {\n      // listItem 有内容，光标在开始\n      const itemContent = generateEmptyListContent();\n      Transforms.insertNodes(editor, itemContent, {\n        at: listItemPath\n      });\n      const listItem = generateEmptyListItem();\n      Transforms.wrapNodes(editor, listItem, {\n        at: listItemPath\n      });\n      success = true;\n      return;\n    }\n    if (!isEndPoint) {\n      // listItem 有内容，光标在中间\n      Transforms.splitNodes(editor);\n      const listItem = generateEmptyListItem();\n      Transforms.wrapNodes(editor, listItem, {\n        at: nextParagraphPath\n      });\n      Transforms.moveNodes(editor, {\n        at: nextParagraphPath,\n        to: nextListItemPath\n      });\n      Transforms.select(editor, nextListItemPath);\n      Transforms.collapse(editor, {\n        edge: 'start'\n      });\n      success = true;\n    } else {\n      var _Editor$marks;\n      // listItem 有内容，光标在结尾\n      const marks = (_Editor$marks = Editor.marks(editor)) === null || _Editor$marks === void 0 ? void 0 : _Editor$marks.key;\n      const itemContent = generateEmptyListContent();\n      Transforms.insertNodes(editor, _objectSpread(_objectSpread({}, itemContent), marks), {\n        at: nextListItemPath\n      });\n      const listItem = generateEmptyListItem();\n      Transforms.wrapNodes(editor, listItem, {\n        at: nextListItemPath\n      });\n      Transforms.select(editor, nextListItemPath);\n      success = true;\n    }\n    if (listItemNode.children.length > 1) {\n      Transforms.moveNodes(editor, {\n        at: nextParagraphPath,\n        to: nextListItemPath.concat(1)\n      });\n      success = true;\n    }\n  });\n  return success;\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}