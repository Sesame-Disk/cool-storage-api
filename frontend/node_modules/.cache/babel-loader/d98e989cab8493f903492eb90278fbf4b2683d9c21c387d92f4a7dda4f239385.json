{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { Editor, Transforms } from '@seafile/slate';\nimport EventBus from '../../../../utils/event-bus';\nimport { focusEditor } from '../../../core';\nimport { useCollaborators } from '../../../../../hooks';\nimport { useParticipantsContext } from '../../../../comment/hooks/use-participants';\nimport { searchCollaborators } from '../../../../comment/utils';\nimport { INTERNAL_EVENT } from '../../../../constants';\nimport { DOWN, FONT_SIZE_WIDTH, LINE_HEIGHT, POPOVER_ADDING_HEIGHT, UP } from '../../../../comment/constants';\nimport { eventStopPropagation } from '../../../../utils/mouse-event';\nimport { getSelectionCoords } from '../../../../../utils';\nimport { KeyCodes } from '../../../../../constants';\nimport CommentParticipantItem from './comment-participant-item';\nimport { getMentionTempIptEntry, insertMention, sortCollaborators, transformToText } from '../helper';\nimport { ElementPopover } from '../../../commons';\nimport './index.css';\nvar ParticipantPopover = function ParticipantPopover(_ref) {\n  var editor = _ref.editor,\n    searchText = _ref.searchText;\n  var collaboratorsPopoverRef = useRef(null);\n  var _useCollaborators = useCollaborators(),\n    collaborators = _useCollaborators.collaborators;\n  var _useParticipantsConte = useParticipantsContext(),\n    addParticipants = _useParticipantsConte.addParticipants,\n    participants = _useParticipantsConte.participants;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    searchedCollaborators = _useState2[0],\n    setSearchedCollaborators = _useState2[1];\n  var _useState3 = useState(-1),\n    _useState4 = _slicedToArray(_useState3, 2),\n    activeCollaboratorIndex = _useState4[0],\n    setActiveCollaboratorIndex = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    validCollaborators = _useState6[0],\n    setValidCollaborators = _useState6[1];\n  useEffect(function () {\n    var sortedCollaborators = sortCollaborators(collaborators, participants);\n    setValidCollaborators(sortedCollaborators);\n  }, [collaborators, participants]);\n  useEffect(function () {\n    return function () {\n      transformToText(editor);\n    };\n  }, [editor]);\n  var hideCommentPopover = useCallback(function () {\n    if (searchedCollaborators.length === 0) return;\n    setSearchedCollaborators([]);\n    setActiveCollaboratorIndex(-1);\n  }, [searchedCollaborators]);\n  var handleForceClickPopover = useCallback(function (event) {\n    var _collaboratorsPopover;\n    if (!((_collaboratorsPopover = collaboratorsPopoverRef.current) === null || _collaboratorsPopover === void 0 ? void 0 : _collaboratorsPopover.contains(event.target))) {\n      transformToText(editor);\n    }\n  }, [editor]);\n\n  // onMount: handleCommentPopover\n  useEffect(function () {\n    document.addEventListener('mousedown', handleForceClickPopover);\n    return function () {\n      document.removeEventListener('mousedown', handleForceClickPopover);\n    };\n  }, [handleForceClickPopover]);\n  var setScrollTop = useCallback(function (offsetTop, itemOffsetHeight, mouseDownType) {\n    var _collaboratorsPopover2 = collaboratorsPopoverRef.current,\n      offsetHeight = _collaboratorsPopover2.offsetHeight,\n      scrollTop = _collaboratorsPopover2.scrollTop;\n    if (mouseDownType === DOWN) {\n      if (offsetTop + itemOffsetHeight - scrollTop - offsetHeight + POPOVER_ADDING_HEIGHT > 0) {\n        var top = offsetTop + itemOffsetHeight - offsetHeight + POPOVER_ADDING_HEIGHT;\n        collaboratorsPopoverRef.current.scrollTop = top;\n      }\n    }\n    if (mouseDownType === UP) {\n      if (offsetTop < scrollTop) {\n        collaboratorsPopoverRef.current.scrollTop = offsetTop - POPOVER_ADDING_HEIGHT;\n      }\n    }\n  }, []);\n  var setCollaboratorsPopoverPosition = useCallback(function (caretPosition) {\n    if (!collaboratorsPopoverRef.current) return;\n    var _collaboratorsPopover3 = collaboratorsPopoverRef.current.getBoundingClientRect(),\n      height = _collaboratorsPopover3.height,\n      width = _collaboratorsPopover3.width;\n    var offsetHeight = collaboratorsPopoverRef.current.offsetHeight;\n\n    // Whether the vertical direction exceeds the screen\n    var isVerticalDirectionBeyondScreen = height + caretPosition.y + LINE_HEIGHT > window.innerHeight;\n\n    // if the vertical direction exceeds the screen, collaboratorsPopoverRef appear above the cursor\n    var top = isVerticalDirectionBeyondScreen ? \"\".concat(caretPosition.y - offsetHeight + LINE_HEIGHT, \"px\") : \"\".concat(caretPosition.y + LINE_HEIGHT, \"px\");\n    collaboratorsPopoverRef.current.style.top = top;\n\n    // Whether the horizontal direction exceeds the screen\n    var isHorizontalDirectionBeyondScreen = caretPosition.x + FONT_SIZE_WIDTH + width > window.innerWidth;\n\n    // if the horizontal direction exceeds the screen, collaboratorsPopoverRef is displayed against the right side of the screen\n    var left = isHorizontalDirectionBeyondScreen ? \"\".concat(window.innerWidth - width, \"px\") : \"\".concat(caretPosition.x + FONT_SIZE_WIDTH, \"px\");\n    collaboratorsPopoverRef.current.style.left = left;\n  }, [collaboratorsPopoverRef]);\n  var getSearchedCollaborators = useCallback(function (searchingText) {\n    if (!searchingText.length) return validCollaborators;\n    if (searchingText) return searchCollaborators(validCollaborators, searchingText);\n    return [];\n  }, [validCollaborators]);\n  var handleInvolvedKeyUp = useCallback(function () {\n    var searchedCollaborators = getSearchedCollaborators(searchText);\n    if (searchedCollaborators.length === 0) {\n      hideCommentPopover();\n      return;\n    }\n    setActiveCollaboratorIndex(0);\n    setSearchedCollaborators(searchedCollaborators);\n    setTimeout(function () {\n      var caretPosition = getSelectionCoords();\n      setCollaboratorsPopoverPosition(caretPosition);\n    }, 1);\n  }, [getSearchedCollaborators, searchText, hideCommentPopover, setCollaboratorsPopoverPosition]);\n  var handleSelectingCollaborator = useCallback(function (event, direction) {\n    eventStopPropagation(event);\n    var collaboratorsLen = searchedCollaborators.length;\n    if (collaboratorsLen === 0) return;\n    var nextActiveCollaboratorIndex = activeCollaboratorIndex;\n    if (direction === DOWN) {\n      nextActiveCollaboratorIndex++;\n      if (nextActiveCollaboratorIndex >= collaboratorsLen) {\n        nextActiveCollaboratorIndex = 0;\n      }\n    } else {\n      nextActiveCollaboratorIndex--;\n      if (nextActiveCollaboratorIndex < 0) {\n        nextActiveCollaboratorIndex = collaboratorsLen - 1;\n      }\n    }\n    setActiveCollaboratorIndex(nextActiveCollaboratorIndex);\n  }, [searchedCollaborators, activeCollaboratorIndex]);\n  var onSelectCollaborator = useCallback(function (collaborator) {\n    var _getMentionTempIptEnt = getMentionTempIptEntry(editor),\n      _getMentionTempIptEnt2 = _slicedToArray(_getMentionTempIptEnt, 2),\n      node = _getMentionTempIptEnt2[0],\n      path = _getMentionTempIptEnt2[1];\n    insertMention(editor, collaborator);\n    addParticipants(collaborator.username);\n    Transforms.removeNodes(editor, {\n      at: path\n    });\n    var focusPath = Editor.next(editor, {\n      at: path\n    })[1];\n    focusEditor(editor, Editor.start(editor, focusPath));\n    hideCommentPopover();\n  }, [editor, hideCommentPopover, addParticipants]);\n  var handleSelectCollaborator = useCallback(function (event) {\n    if (searchedCollaborators.length === 0) return;\n    onSelectCollaborator(searchedCollaborators[activeCollaboratorIndex]);\n  }, [searchedCollaborators, activeCollaboratorIndex, onSelectCollaborator]);\n  var handleMentionChosen = useCallback(function (_ref2) {\n    var event = _ref2.event;\n    if (event.keyCode === KeyCodes.DownArrow) {\n      handleSelectingCollaborator(event, DOWN);\n      return;\n    }\n    if (event.keyCode === KeyCodes.UpArrow) {\n      handleSelectingCollaborator(event, UP);\n      return;\n    }\n    if (event.keyCode === KeyCodes.Enter) {\n      if (collaboratorsPopoverRef.current) {\n        handleSelectCollaborator();\n        event.preventDefault();\n      } else {\n        transformToText(editor);\n      }\n      return;\n    }\n    if (event.keyCode === KeyCodes.Esc) {\n      transformToText(editor);\n      return;\n    }\n    handleInvolvedKeyUp(event);\n  }, [editor, handleInvolvedKeyUp, handleSelectCollaborator, handleSelectingCollaborator]);\n  var handleSearchTextChange = useCallback(function () {\n    var newCollaborators = getSearchedCollaborators(searchText);\n    if (newCollaborators.length === 0) {\n      hideCommentPopover();\n      return;\n    }\n    setSearchedCollaborators(newCollaborators);\n    setTimeout(function () {\n      var caretPosition = getSelectionCoords();\n      setCollaboratorsPopoverPosition(caretPosition);\n    }, 1);\n  }, [getSearchedCollaborators, hideCommentPopover, searchText, setCollaboratorsPopoverPosition]);\n  useEffect(function () {\n    handleSearchTextChange();\n    setActiveCollaboratorIndex(0);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchText, validCollaborators]);\n  useEffect(function () {\n    var eventBus = EventBus.getInstance();\n    var unsubscribe = eventBus.subscribe(INTERNAL_EVENT.HANDLE_MENTION_TEMP_CHOSEN, handleMentionChosen);\n    return function () {\n      unsubscribe();\n    };\n  }, [handleMentionChosen, searchText, validCollaborators]);\n  if (searchedCollaborators.length === 0) return null;\n  return /*#__PURE__*/React.createElement(ElementPopover, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-comment-caret-list\",\n    ref: collaboratorsPopoverRef\n  }, searchedCollaborators.map(function (participant, index) {\n    return /*#__PURE__*/React.createElement(CommentParticipantItem, {\n      key: participant.username,\n      participantIndex: index,\n      activeParticipantIndex: activeCollaboratorIndex,\n      participant: participant,\n      setScrollTop: setScrollTop,\n      onSelectParticipant: onSelectCollaborator\n    });\n  })));\n};\nexport default ParticipantPopover;","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useState","Editor","Transforms","EventBus","focusEditor","useCollaborators","useParticipantsContext","searchCollaborators","INTERNAL_EVENT","DOWN","FONT_SIZE_WIDTH","LINE_HEIGHT","POPOVER_ADDING_HEIGHT","UP","eventStopPropagation","getSelectionCoords","KeyCodes","CommentParticipantItem","getMentionTempIptEntry","insertMention","sortCollaborators","transformToText","ElementPopover","ParticipantPopover","_ref","editor","searchText","collaboratorsPopoverRef","_useCollaborators","collaborators","_useParticipantsConte","addParticipants","participants","_useState","_useState2","_slicedToArray","searchedCollaborators","setSearchedCollaborators","_useState3","_useState4","activeCollaboratorIndex","setActiveCollaboratorIndex","_useState5","_useState6","validCollaborators","setValidCollaborators","sortedCollaborators","hideCommentPopover","length","handleForceClickPopover","event","_collaboratorsPopover","current","contains","target","document","addEventListener","removeEventListener","setScrollTop","offsetTop","itemOffsetHeight","mouseDownType","_collaboratorsPopover2","offsetHeight","scrollTop","top","setCollaboratorsPopoverPosition","caretPosition","_collaboratorsPopover3","getBoundingClientRect","height","width","isVerticalDirectionBeyondScreen","y","window","innerHeight","concat","style","isHorizontalDirectionBeyondScreen","x","innerWidth","left","getSearchedCollaborators","searchingText","handleInvolvedKeyUp","setTimeout","handleSelectingCollaborator","direction","collaboratorsLen","nextActiveCollaboratorIndex","onSelectCollaborator","collaborator","_getMentionTempIptEnt","_getMentionTempIptEnt2","node","path","username","removeNodes","at","focusPath","next","start","handleSelectCollaborator","handleMentionChosen","_ref2","keyCode","DownArrow","UpArrow","Enter","preventDefault","Esc","handleSearchTextChange","newCollaborators","eventBus","getInstance","unsubscribe","subscribe","HANDLE_MENTION_TEMP_CHOSEN","createElement","className","ref","map","participant","index","key","participantIndex","activeParticipantIndex","onSelectParticipant"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/mention/render-elem/participant-popover.js"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { Editor, Transforms } from '@seafile/slate';\nimport EventBus from '../../../../utils/event-bus';\nimport { focusEditor } from '../../../core';\nimport { useCollaborators } from '../../../../../hooks';\nimport { useParticipantsContext } from '../../../../comment/hooks/use-participants';\nimport { searchCollaborators } from '../../../../comment/utils';\nimport { INTERNAL_EVENT } from '../../../../constants';\nimport { DOWN, FONT_SIZE_WIDTH, LINE_HEIGHT, POPOVER_ADDING_HEIGHT, UP } from '../../../../comment/constants';\nimport { eventStopPropagation } from '../../../../utils/mouse-event';\nimport { getSelectionCoords } from '../../../../../utils';\nimport { KeyCodes } from '../../../../../constants';\nimport CommentParticipantItem from './comment-participant-item';\nimport { getMentionTempIptEntry, insertMention, sortCollaborators, transformToText } from '../helper';\nimport { ElementPopover } from '../../../commons';\nimport './index.css';\nconst ParticipantPopover = _ref => {\n  let {\n    editor,\n    searchText\n  } = _ref;\n  const collaboratorsPopoverRef = useRef(null);\n  const {\n    collaborators\n  } = useCollaborators();\n  const {\n    addParticipants,\n    participants\n  } = useParticipantsContext();\n  const [searchedCollaborators, setSearchedCollaborators] = useState([]);\n  const [activeCollaboratorIndex, setActiveCollaboratorIndex] = useState(-1);\n  const [validCollaborators, setValidCollaborators] = useState([]);\n  useEffect(() => {\n    const sortedCollaborators = sortCollaborators(collaborators, participants);\n    setValidCollaborators(sortedCollaborators);\n  }, [collaborators, participants]);\n  useEffect(() => {\n    return () => {\n      transformToText(editor);\n    };\n  }, [editor]);\n  const hideCommentPopover = useCallback(() => {\n    if (searchedCollaborators.length === 0) return;\n    setSearchedCollaborators([]);\n    setActiveCollaboratorIndex(-1);\n  }, [searchedCollaborators]);\n  const handleForceClickPopover = useCallback(event => {\n    var _collaboratorsPopover;\n    if (!((_collaboratorsPopover = collaboratorsPopoverRef.current) === null || _collaboratorsPopover === void 0 ? void 0 : _collaboratorsPopover.contains(event.target))) {\n      transformToText(editor);\n    }\n  }, [editor]);\n\n  // onMount: handleCommentPopover\n  useEffect(() => {\n    document.addEventListener('mousedown', handleForceClickPopover);\n    return () => {\n      document.removeEventListener('mousedown', handleForceClickPopover);\n    };\n  }, [handleForceClickPopover]);\n  const setScrollTop = useCallback((offsetTop, itemOffsetHeight, mouseDownType) => {\n    const {\n      offsetHeight,\n      scrollTop\n    } = collaboratorsPopoverRef.current;\n    if (mouseDownType === DOWN) {\n      if (offsetTop + itemOffsetHeight - scrollTop - offsetHeight + POPOVER_ADDING_HEIGHT > 0) {\n        let top = offsetTop + itemOffsetHeight - offsetHeight + POPOVER_ADDING_HEIGHT;\n        collaboratorsPopoverRef.current.scrollTop = top;\n      }\n    }\n    if (mouseDownType === UP) {\n      if (offsetTop < scrollTop) {\n        collaboratorsPopoverRef.current.scrollTop = offsetTop - POPOVER_ADDING_HEIGHT;\n      }\n    }\n  }, []);\n  const setCollaboratorsPopoverPosition = useCallback(caretPosition => {\n    if (!collaboratorsPopoverRef.current) return;\n    const {\n      height,\n      width\n    } = collaboratorsPopoverRef.current.getBoundingClientRect();\n    const {\n      offsetHeight\n    } = collaboratorsPopoverRef.current;\n\n    // Whether the vertical direction exceeds the screen\n    const isVerticalDirectionBeyondScreen = height + caretPosition.y + LINE_HEIGHT > window.innerHeight;\n\n    // if the vertical direction exceeds the screen, collaboratorsPopoverRef appear above the cursor\n    const top = isVerticalDirectionBeyondScreen ? \"\".concat(caretPosition.y - offsetHeight + LINE_HEIGHT, \"px\") : \"\".concat(caretPosition.y + LINE_HEIGHT, \"px\");\n    collaboratorsPopoverRef.current.style.top = top;\n\n    // Whether the horizontal direction exceeds the screen\n    const isHorizontalDirectionBeyondScreen = caretPosition.x + FONT_SIZE_WIDTH + width > window.innerWidth;\n\n    // if the horizontal direction exceeds the screen, collaboratorsPopoverRef is displayed against the right side of the screen\n    const left = isHorizontalDirectionBeyondScreen ? \"\".concat(window.innerWidth - width, \"px\") : \"\".concat(caretPosition.x + FONT_SIZE_WIDTH, \"px\");\n    collaboratorsPopoverRef.current.style.left = left;\n  }, [collaboratorsPopoverRef]);\n  const getSearchedCollaborators = useCallback(searchingText => {\n    if (!searchingText.length) return validCollaborators;\n    if (searchingText) return searchCollaborators(validCollaborators, searchingText);\n    return [];\n  }, [validCollaborators]);\n  const handleInvolvedKeyUp = useCallback(() => {\n    const searchedCollaborators = getSearchedCollaborators(searchText);\n    if (searchedCollaborators.length === 0) {\n      hideCommentPopover();\n      return;\n    }\n    setActiveCollaboratorIndex(0);\n    setSearchedCollaborators(searchedCollaborators);\n    setTimeout(() => {\n      const caretPosition = getSelectionCoords();\n      setCollaboratorsPopoverPosition(caretPosition);\n    }, 1);\n  }, [getSearchedCollaborators, searchText, hideCommentPopover, setCollaboratorsPopoverPosition]);\n  const handleSelectingCollaborator = useCallback((event, direction) => {\n    eventStopPropagation(event);\n    const collaboratorsLen = searchedCollaborators.length;\n    if (collaboratorsLen === 0) return;\n    let nextActiveCollaboratorIndex = activeCollaboratorIndex;\n    if (direction === DOWN) {\n      nextActiveCollaboratorIndex++;\n      if (nextActiveCollaboratorIndex >= collaboratorsLen) {\n        nextActiveCollaboratorIndex = 0;\n      }\n    } else {\n      nextActiveCollaboratorIndex--;\n      if (nextActiveCollaboratorIndex < 0) {\n        nextActiveCollaboratorIndex = collaboratorsLen - 1;\n      }\n    }\n    setActiveCollaboratorIndex(nextActiveCollaboratorIndex);\n  }, [searchedCollaborators, activeCollaboratorIndex]);\n  const onSelectCollaborator = useCallback(collaborator => {\n    const [node, path] = getMentionTempIptEntry(editor);\n    insertMention(editor, collaborator);\n    addParticipants(collaborator.username);\n    Transforms.removeNodes(editor, {\n      at: path\n    });\n    const focusPath = Editor.next(editor, {\n      at: path\n    })[1];\n    focusEditor(editor, Editor.start(editor, focusPath));\n    hideCommentPopover();\n  }, [editor, hideCommentPopover, addParticipants]);\n  const handleSelectCollaborator = useCallback(event => {\n    if (searchedCollaborators.length === 0) return;\n    onSelectCollaborator(searchedCollaborators[activeCollaboratorIndex]);\n  }, [searchedCollaborators, activeCollaboratorIndex, onSelectCollaborator]);\n  const handleMentionChosen = useCallback(_ref2 => {\n    let {\n      event\n    } = _ref2;\n    if (event.keyCode === KeyCodes.DownArrow) {\n      handleSelectingCollaborator(event, DOWN);\n      return;\n    }\n    if (event.keyCode === KeyCodes.UpArrow) {\n      handleSelectingCollaborator(event, UP);\n      return;\n    }\n    if (event.keyCode === KeyCodes.Enter) {\n      if (collaboratorsPopoverRef.current) {\n        handleSelectCollaborator();\n        event.preventDefault();\n      } else {\n        transformToText(editor);\n      }\n      return;\n    }\n    if (event.keyCode === KeyCodes.Esc) {\n      transformToText(editor);\n      return;\n    }\n    handleInvolvedKeyUp(event);\n  }, [editor, handleInvolvedKeyUp, handleSelectCollaborator, handleSelectingCollaborator]);\n  const handleSearchTextChange = useCallback(() => {\n    const newCollaborators = getSearchedCollaborators(searchText);\n    if (newCollaborators.length === 0) {\n      hideCommentPopover();\n      return;\n    }\n    setSearchedCollaborators(newCollaborators);\n    setTimeout(() => {\n      const caretPosition = getSelectionCoords();\n      setCollaboratorsPopoverPosition(caretPosition);\n    }, 1);\n  }, [getSearchedCollaborators, hideCommentPopover, searchText, setCollaboratorsPopoverPosition]);\n  useEffect(() => {\n    handleSearchTextChange();\n    setActiveCollaboratorIndex(0);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchText, validCollaborators]);\n  useEffect(() => {\n    const eventBus = EventBus.getInstance();\n    const unsubscribe = eventBus.subscribe(INTERNAL_EVENT.HANDLE_MENTION_TEMP_CHOSEN, handleMentionChosen);\n    return () => {\n      unsubscribe();\n    };\n  }, [handleMentionChosen, searchText, validCollaborators]);\n  if (searchedCollaborators.length === 0) return null;\n  return /*#__PURE__*/React.createElement(ElementPopover, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-comment-caret-list\",\n    ref: collaboratorsPopoverRef\n  }, searchedCollaborators.map((participant, index) => /*#__PURE__*/React.createElement(CommentParticipantItem, {\n    key: participant.username,\n    participantIndex: index,\n    activeParticipantIndex: activeCollaboratorIndex,\n    participant: participant,\n    setScrollTop: setScrollTop,\n    onSelectParticipant: onSelectCollaborator\n  }))));\n};\nexport default ParticipantPopover;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}