{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _toConsumableArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport { Transforms, Editor, Path, Element } from '@seafile/slate';\nimport { PARAGRAPH } from '../../../constants';\nimport { getChildren, getDeepInlineChildren, match } from '../../../core';\nimport { getListTypes } from '../queries';\nimport { movedListItemUp } from './move-list-item-up';\nimport { generateEmptyListContent } from '../model';\nexport var normalizeListItem = function normalizeListItem(editor, _ref) {\n  var listItem = _ref.listItem;\n  var changed = false;\n  var validLiChildrenTypes = [].concat(_toConsumableArray(getListTypes()), [PARAGRAPH]);\n  var _listItem = _slicedToArray(listItem, 2),\n    liPath = _listItem[1];\n  var liChildren = getChildren(listItem);\n  var invalidLiChildrenPathRefs = liChildren.filter(function (_ref2) {\n    var _ref5 = _slicedToArray(_ref2, 1),\n      child = _ref5[0];\n    return !validLiChildrenTypes.includes(child.type);\n  }).map(function (_ref3) {\n    var _ref6 = _slicedToArray(_ref3, 2),\n      childPath = _ref6[1];\n    return Editor.pathRef(editor, childPath);\n  });\n  var firstLiChild = liChildren[0];\n  var _ref7 = firstLiChild !== null && firstLiChild !== void 0 ? firstLiChild : [],\n    _ref8 = _slicedToArray(_ref7, 2),\n    firstLiChildNode = _ref8[0],\n    firstLiChildPath = _ref8[1];\n  if (!firstLiChild || !Editor.isBlock(editor, firstLiChildNode)) {\n    var itemContent = generateEmptyListContent();\n    Transforms.insertNodes(editor, itemContent, {\n      at: liPath.concat([0])\n    });\n    return true;\n  }\n  if (Editor.isBlock(editor, firstLiChildNode) && !match(firstLiChildNode, [], {\n    type: [PARAGRAPH]\n  })) {\n    if (match(firstLiChildNode, [], {\n      type: getListTypes()\n    })) {\n      var parent = Editor.parent(editor, listItem[1]);\n      var subList = firstLiChild;\n      var children = getChildren(firstLiChild).reverse();\n      children.forEach(function (c) {\n        movedListItemUp(editor, {\n          list: subList,\n          listItem: c\n        });\n      });\n      Transforms.removeNodes(editor, {\n        at: [].concat(_toConsumableArray(parent[1]), [0])\n      });\n      return true;\n    }\n    if (validLiChildrenTypes.includes(firstLiChildNode.type)) {\n      return true;\n    }\n    Transforms.setNodes(editor, {\n      type: PARAGRAPH\n    }, {\n      at: firstLiChildPath\n    });\n    changed = true;\n  }\n  var licChildren = getChildren(firstLiChild);\n  if (licChildren.length) {\n    var _licChildren;\n    var blockPathRefs = [];\n    var inlineChildren = [];\n    var _iterator = _createForOfIteratorHelper(licChildren),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var licChild = _step.value;\n        if (!(Element.isElement(licChild[0]) && Editor.isBlock(editor, licChild[0]))) {\n          break;\n        }\n        blockPathRefs.push(Editor.pathRef(editor, licChild[1]));\n        inlineChildren.push.apply(inlineChildren, _toConsumableArray(getDeepInlineChildren(editor, {\n          children: getChildren(licChild)\n        })));\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n    var to = Path.next((_licChildren = licChildren[licChildren.length - 1]) === null || _licChildren === void 0 ? void 0 : _licChildren[1]);\n    inlineChildren.reverse().forEach(function (_ref4) {\n      var _ref9 = _slicedToArray(_ref4, 2),\n        path = _ref9[1];\n      Transforms.moveNodes(editor, {\n        at: path,\n        to: to\n      });\n    });\n    blockPathRefs.forEach(function (pathRef) {\n      var path = pathRef.unref();\n      path && Transforms.removeNodes(editor, {\n        at: path\n      });\n    });\n    if (blockPathRefs.length) {\n      changed = true;\n    }\n  }\n  if (changed) return true;\n  invalidLiChildrenPathRefs.reverse().forEach(function (ref) {\n    var path = ref.unref();\n    path && Transforms.moveNodes(editor, {\n      at: path,\n      to: firstLiChildPath.concat([0])\n    });\n  });\n  return !!invalidLiChildrenPathRefs.length;\n};","map":{"version":3,"names":["Transforms","Editor","Path","Element","PARAGRAPH","getChildren","getDeepInlineChildren","match","getListTypes","movedListItemUp","generateEmptyListContent","normalizeListItem","editor","_ref","listItem","changed","validLiChildrenTypes","concat","_toConsumableArray","_listItem","_slicedToArray","liPath","liChildren","invalidLiChildrenPathRefs","filter","_ref2","_ref5","child","includes","type","map","_ref3","_ref6","childPath","pathRef","firstLiChild","_ref7","_ref8","firstLiChildNode","firstLiChildPath","isBlock","itemContent","insertNodes","at","parent","subList","children","reverse","forEach","c","list","removeNodes","setNodes","licChildren","length","_licChildren","blockPathRefs","inlineChildren","_iterator","_createForOfIteratorHelper","_step","s","n","done","licChild","value","isElement","push","apply","err","e","f","to","next","_ref4","_ref9","path","moveNodes","unref","ref"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/list/transforms/normalize-list-item.js"],"sourcesContent":["import { Transforms, Editor, Path, Element } from '@seafile/slate';\nimport { PARAGRAPH } from '../../../constants';\nimport { getChildren, getDeepInlineChildren, match } from '../../../core';\nimport { getListTypes } from '../queries';\nimport { movedListItemUp } from './move-list-item-up';\nimport { generateEmptyListContent } from '../model';\nexport const normalizeListItem = (editor, _ref) => {\n  let {\n    listItem\n  } = _ref;\n  let changed = false;\n  const validLiChildrenTypes = [...getListTypes(), PARAGRAPH];\n  const [, liPath] = listItem;\n  const liChildren = getChildren(listItem);\n  const invalidLiChildrenPathRefs = liChildren.filter(_ref2 => {\n    let [child] = _ref2;\n    return !validLiChildrenTypes.includes(child.type);\n  }).map(_ref3 => {\n    let [, childPath] = _ref3;\n    return Editor.pathRef(editor, childPath);\n  });\n  const firstLiChild = liChildren[0];\n  const [firstLiChildNode, firstLiChildPath] = firstLiChild !== null && firstLiChild !== void 0 ? firstLiChild : [];\n  if (!firstLiChild || !Editor.isBlock(editor, firstLiChildNode)) {\n    const itemContent = generateEmptyListContent();\n    Transforms.insertNodes(editor, itemContent, {\n      at: liPath.concat([0])\n    });\n    return true;\n  }\n  if (Editor.isBlock(editor, firstLiChildNode) && !match(firstLiChildNode, [], {\n    type: [PARAGRAPH]\n  })) {\n    if (match(firstLiChildNode, [], {\n      type: getListTypes()\n    })) {\n      const parent = Editor.parent(editor, listItem[1]);\n      const subList = firstLiChild;\n      const children = getChildren(firstLiChild).reverse();\n      children.forEach(c => {\n        movedListItemUp(editor, {\n          list: subList,\n          listItem: c\n        });\n      });\n      Transforms.removeNodes(editor, {\n        at: [...parent[1], 0]\n      });\n      return true;\n    }\n    if (validLiChildrenTypes.includes(firstLiChildNode.type)) {\n      return true;\n    }\n    Transforms.setNodes(editor, {\n      type: PARAGRAPH\n    }, {\n      at: firstLiChildPath\n    });\n    changed = true;\n  }\n  const licChildren = getChildren(firstLiChild);\n  if (licChildren.length) {\n    var _licChildren;\n    const blockPathRefs = [];\n    const inlineChildren = [];\n    for (const licChild of licChildren) {\n      if (!(Element.isElement(licChild[0]) && Editor.isBlock(editor, licChild[0]))) {\n        break;\n      }\n      blockPathRefs.push(Editor.pathRef(editor, licChild[1]));\n      inlineChildren.push(...getDeepInlineChildren(editor, {\n        children: getChildren(licChild)\n      }));\n    }\n    const to = Path.next((_licChildren = licChildren[licChildren.length - 1]) === null || _licChildren === void 0 ? void 0 : _licChildren[1]);\n    inlineChildren.reverse().forEach(_ref4 => {\n      let [, path] = _ref4;\n      Transforms.moveNodes(editor, {\n        at: path,\n        to\n      });\n    });\n    blockPathRefs.forEach(pathRef => {\n      const path = pathRef.unref();\n      path && Transforms.removeNodes(editor, {\n        at: path\n      });\n    });\n    if (blockPathRefs.length) {\n      changed = true;\n    }\n  }\n  if (changed) return true;\n  invalidLiChildrenPathRefs.reverse().forEach(ref => {\n    const path = ref.unref();\n    path && Transforms.moveNodes(editor, {\n      at: path,\n      to: firstLiChildPath.concat([0])\n    });\n  });\n  return !!invalidLiChildrenPathRefs.length;\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}