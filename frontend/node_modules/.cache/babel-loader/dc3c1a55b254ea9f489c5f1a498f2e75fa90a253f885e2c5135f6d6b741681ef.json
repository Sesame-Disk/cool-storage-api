{"ast":null,"code":"import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import NotificationPopover from'./notification-popover';import{seafileAPI}from'../../utils/seafile-api';import{gettext}from'../../utils/constants';import NoticeItem from'./notice-item';import UserNotificationsDialog from'../../user-notifications';import{Utils}from'../../utils/utils';import'../../css/notification.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Notification=/*#__PURE__*/function(_React$Component){_inherits(Notification,_React$Component);var _super=_createSuper(Notification);function Notification(props){var _this;_classCallCheck(this,Notification);_this=_super.call(this,props);_this.onClick=function(e){e.preventDefault();if(_this.state.showNotice){seafileAPI.updateNotifications();_this.setState({showNotice:false,unseenCount:0});}else{_this.loadNotices();_this.setState({showNotice:true});}};_this.loadNotices=function(){var page=1;var perPage=5;seafileAPI.listNotifications(page,perPage).then(function(res){var noticeList=res.data.notification_list;_this.setState({noticeList:noticeList});});};_this.onNoticeItemClick=function(noticeItem){var noticeList=_this.state.noticeList.map(function(item){if(item.id===noticeItem.id){item.seen=true;}return item;});seafileAPI.markNoticeAsRead(noticeItem.id);var unseenCount=_this.state.unseenCount===0?0:_this.state.unseenCount-1;_this.setState({noticeList:noticeList,unseenCount:unseenCount});};_this.getInitDialogState=function(){var searchParams=Utils.getUrlSearches();return searchParams.notifications==='all';};_this.onNotificationDialogToggle=function(){var newSearch=_this.state.isShowNotificationDialog?null:'all';Utils.updateSearchParameter('notifications',newSearch);_this.setState({isShowNotificationDialog:!_this.state.isShowNotificationDialog});};_this.onNotificationListToggle=function(){_this.setState({showNotice:false});};_this.onMarkAllNotifications=function(){seafileAPI.updateNotifications().then(function(){_this.setState({unseenCount:0});}).catch(function(error){_this.setState({errorMsg:Utils.getErrorMsg(error,true)});});};_this.state={showNotice:false,unseenCount:0,noticeList:[],isShowNotificationDialog:_this.getInitDialogState()};return _this;}_createClass(Notification,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;seafileAPI.getUnseenNotificationCount().then(function(res){_this2.setState({unseenCount:res.data.unseen_count});});}},{key:\"render\",value:function render(){var _this3=this;var unseenCount=this.state.unseenCount;return/*#__PURE__*/_jsxs(\"div\",{id:\"notifications\",children:[/*#__PURE__*/_jsxs(\"a\",{href:\"#\",onClick:this.onClick,className:\"no-deco\",id:\"notice-icon\",title:gettext('Notifications'),\"aria-label\":gettext('Notifications'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"sf2-icon-bell\",id:\"notification-popover\"}),/*#__PURE__*/_jsx(\"span\",{className:\"num \".concat(unseenCount?'':'hide'),children:unseenCount})]}),this.state.showNotice&&/*#__PURE__*/_jsx(NotificationPopover,{headerText:gettext('Notification'),bodyText:gettext('Mark all as read'),footerText:gettext('View all notifications'),onNotificationListToggle:this.onNotificationListToggle,onNotificationDialogToggle:this.onNotificationDialogToggle,onMarkAllNotifications:this.onMarkAllNotifications,children:/*#__PURE__*/_jsx(\"ul\",{className:\"notice-list list-unstyled\",id:\"notice-popover\",children:this.state.noticeList.map(function(item){return/*#__PURE__*/_jsx(NoticeItem,{noticeItem:item,onNoticeItemClick:_this3.onNoticeItemClick},item.id);})})}),this.state.isShowNotificationDialog&&/*#__PURE__*/_jsx(UserNotificationsDialog,{onNotificationDialogToggle:this.onNotificationDialogToggle})]});}}]);return Notification;}(React.Component);export default Notification;","map":{"version":3,"names":["React","NotificationPopover","seafileAPI","gettext","NoticeItem","UserNotificationsDialog","Utils","jsx","_jsx","jsxs","_jsxs","Notification","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","onClick","e","preventDefault","state","showNotice","updateNotifications","setState","unseenCount","loadNotices","page","perPage","listNotifications","then","res","noticeList","data","notification_list","onNoticeItemClick","noticeItem","map","item","id","seen","markNoticeAsRead","getInitDialogState","searchParams","getUrlSearches","notifications","onNotificationDialogToggle","newSearch","isShowNotificationDialog","updateSearchParameter","onNotificationListToggle","onMarkAllNotifications","catch","error","errorMsg","getErrorMsg","_createClass","key","value","componentDidMount","_this2","getUnseenNotificationCount","unseen_count","render","_this3","children","href","className","title","concat","headerText","bodyText","footerText","Component"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/components/common/notification.js"],"sourcesContent":["import React from 'react';\nimport NotificationPopover from './notification-popover';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext } from '../../utils/constants';\nimport NoticeItem from './notice-item';\nimport UserNotificationsDialog from '../../user-notifications';\nimport { Utils } from '../../utils/utils';\nimport '../../css/notification.css';\n\nclass Notification extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showNotice: false,\n      unseenCount: 0,\n      noticeList: [],\n      isShowNotificationDialog: this.getInitDialogState(),\n    };\n  }\n\n  componentDidMount() {\n    seafileAPI.getUnseenNotificationCount().then(res => {\n      this.setState({unseenCount: res.data.unseen_count});\n    });\n  }\n\n  onClick = (e) => {\n    e.preventDefault();\n    if (this.state.showNotice) {\n      seafileAPI.updateNotifications();\n      this.setState({\n        showNotice: false,\n        unseenCount: 0\n      });\n    } else {\n      this.loadNotices();\n      this.setState({showNotice: true});\n    }\n  };\n\n  loadNotices = () => {\n    let page = 1;\n    let perPage = 5;\n    seafileAPI.listNotifications(page, perPage).then(res => {\n      let noticeList = res.data.notification_list;\n      this.setState({noticeList: noticeList});\n    });\n  };\n\n  onNoticeItemClick = (noticeItem) => {\n    let noticeList = this.state.noticeList.map(item => {\n      if (item.id === noticeItem.id) {\n        item.seen = true;\n      }\n      return item;\n    });\n    seafileAPI.markNoticeAsRead(noticeItem.id);\n    let unseenCount = this.state.unseenCount === 0 ? 0 : this.state.unseenCount - 1;\n    this.setState({\n      noticeList: noticeList,\n      unseenCount: unseenCount,\n    });\n\n  };\n\n  getInitDialogState = () => {\n    const searchParams = Utils.getUrlSearches();\n    return searchParams.notifications === 'all';\n  };\n\n  onNotificationDialogToggle = () => {\n    let newSearch = this.state.isShowNotificationDialog ? null : 'all';\n    Utils.updateSearchParameter('notifications', newSearch);\n    this.setState({isShowNotificationDialog: !this.state.isShowNotificationDialog});\n  };\n\n  onNotificationListToggle = () => {\n    this.setState({showNotice: false});\n  };\n\n  onMarkAllNotifications = () => {\n    seafileAPI.updateNotifications().then(() => {\n      this.setState({\n        unseenCount: 0,\n      });\n    }).catch((error) => {\n      this.setState({\n        errorMsg: Utils.getErrorMsg(error, true)\n      });\n    });\n  };\n\n  render() {\n    const { unseenCount } = this.state;\n    return (\n      <div id=\"notifications\">\n        <a href=\"#\" onClick={this.onClick} className=\"no-deco\" id=\"notice-icon\" title={gettext('Notifications')} aria-label={gettext('Notifications')}>\n          <span className=\"sf2-icon-bell\" id=\"notification-popover\"></span>\n          <span className={`num ${unseenCount ? '' : 'hide'}`}>{unseenCount}</span>\n        </a>\n        {this.state.showNotice &&\n          <NotificationPopover\n            headerText={gettext('Notification')}\n            bodyText={gettext('Mark all as read')}\n            footerText={gettext('View all notifications')}\n            onNotificationListToggle={this.onNotificationListToggle}\n            onNotificationDialogToggle={this.onNotificationDialogToggle}\n            onMarkAllNotifications={this.onMarkAllNotifications}\n          >\n            <ul className=\"notice-list list-unstyled\" id=\"notice-popover\">\n              {this.state.noticeList.map(item => {\n                return (<NoticeItem key={item.id} noticeItem={item} onNoticeItemClick={this.onNoticeItemClick}/>);\n              })}\n            </ul>\n          </NotificationPopover>\n        }\n        {this.state.isShowNotificationDialog &&\n          <UserNotificationsDialog onNotificationDialogToggle={this.onNotificationDialogToggle} />\n        }\n      </div>\n    );\n  }\n}\n\nexport default Notification;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}