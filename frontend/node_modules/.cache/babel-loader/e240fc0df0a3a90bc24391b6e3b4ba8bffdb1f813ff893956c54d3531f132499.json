{"ast":null,"code":"import _regeneratorRuntime from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { useCallback, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport context from '../../../../context';\nimport EventBus from '../../../utils/event-bus';\nimport { EXTERNAL_EVENT } from '../../../../constants';\nimport { DOC_NOTIFICATION_REDUCER_TYPE } from '../../constants';\nimport { createNotify } from '../../utils';\nimport { useCollaborators } from '../../../../hooks';\nimport { INTERNAL_EVENT } from '../../../constants';\nexport var useNotificationsMount = function useNotificationsMount(dispatch) {\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var _useCollaborators = useCollaborators(),\n    collaborators = _useCollaborators.collaborators;\n  var popupBrowserCommentNotification = useCallback(function (notification) {\n    if (!notification) return;\n    var author = notification.author,\n      msgType = notification.msg_type,\n      reply = notification.reply,\n      comment = notification.comment;\n    var authorInfo = collaborators.find(function (collaborator) {\n      return collaborator.email === author;\n    });\n    var notificationContent = comment || reply;\n    var titleKey = msgType === 'comment' ? 'xxx_added_a_new_comment' : 'xxx_added_a_reply';\n    var title = t(titleKey, {\n      author: authorInfo ? authorInfo.name : t('Unknown')\n    });\n    var options = {\n      body: \"\".concat(notificationContent)\n    };\n    createNotify(title, options);\n  }, [collaborators, t]);\n  var request = useCallback( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(notification) {\n      var eventBus, res, notifications;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            popupBrowserCommentNotification(notification);\n            eventBus = EventBus.getInstance();\n            dispatch({\n              type: DOC_NOTIFICATION_REDUCER_TYPE.FETCHING\n            });\n            _context.prev = 3;\n            _context.next = 6;\n            return context.listUnseenNotifications();\n          case 6:\n            res = _context.sent;\n            notifications = res.data.notifications;\n            dispatch({\n              type: DOC_NOTIFICATION_REDUCER_TYPE.FETCHED,\n              payload: notifications\n            });\n            eventBus.dispatch(INTERNAL_EVENT.UNSEEN_NOTIFICATIONS_COUNT, notifications === null || notifications === void 0 ? void 0 : notifications.length);\n            _context.next = 16;\n            break;\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](3);\n            console.log(_context.t0);\n            dispatch({\n              type: DOC_NOTIFICATION_REDUCER_TYPE.FETCH_ERROR\n            });\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[3, 12]]);\n    }));\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }(), [popupBrowserCommentNotification]);\n  useEffect(function () {\n    request();\n    var eventBus = EventBus.getInstance();\n    var unsubscribeNewNotification = eventBus.subscribe(EXTERNAL_EVENT.NEW_NOTIFICATION, request);\n    return function () {\n      unsubscribeNewNotification();\n    };\n  }, [request]);\n};","map":{"version":3,"names":["useCallback","useEffect","useTranslation","context","EventBus","EXTERNAL_EVENT","DOC_NOTIFICATION_REDUCER_TYPE","createNotify","useCollaborators","INTERNAL_EVENT","useNotificationsMount","dispatch","_useTranslation","t","_useCollaborators","collaborators","popupBrowserCommentNotification","notification","author","msgType","msg_type","reply","comment","authorInfo","find","collaborator","email","notificationContent","titleKey","title","name","options","body","concat","request","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","eventBus","res","notifications","wrap","_callee$","_context","prev","next","getInstance","type","FETCHING","listUnseenNotifications","sent","data","FETCHED","payload","UNSEEN_NOTIFICATIONS_COUNT","length","t0","console","log","FETCH_ERROR","stop","_x","apply","arguments","unsubscribeNewNotification","subscribe","NEW_NOTIFICATION"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/comment/hooks/notification-hooks/use-notification-mount.js"],"sourcesContent":["import { useCallback, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport context from '../../../../context';\nimport EventBus from '../../../utils/event-bus';\nimport { EXTERNAL_EVENT } from '../../../../constants';\nimport { DOC_NOTIFICATION_REDUCER_TYPE } from '../../constants';\nimport { createNotify } from '../../utils';\nimport { useCollaborators } from '../../../../hooks';\nimport { INTERNAL_EVENT } from '../../../constants';\nexport const useNotificationsMount = dispatch => {\n  const {\n    t\n  } = useTranslation();\n  const {\n    collaborators\n  } = useCollaborators();\n  const popupBrowserCommentNotification = useCallback(notification => {\n    if (!notification) return;\n    const {\n      author,\n      msg_type: msgType,\n      reply,\n      comment\n    } = notification;\n    const authorInfo = collaborators.find(collaborator => collaborator.email === author);\n    const notificationContent = comment || reply;\n    const titleKey = msgType === 'comment' ? 'xxx_added_a_new_comment' : 'xxx_added_a_reply';\n    const title = t(titleKey, {\n      author: authorInfo ? authorInfo.name : t('Unknown')\n    });\n    const options = {\n      body: \"\".concat(notificationContent)\n    };\n    createNotify(title, options);\n  }, [collaborators, t]);\n  const request = useCallback(async notification => {\n    popupBrowserCommentNotification(notification);\n    const eventBus = EventBus.getInstance();\n    dispatch({\n      type: DOC_NOTIFICATION_REDUCER_TYPE.FETCHING\n    });\n    try {\n      const res = await context.listUnseenNotifications();\n      const notifications = res.data.notifications;\n      dispatch({\n        type: DOC_NOTIFICATION_REDUCER_TYPE.FETCHED,\n        payload: notifications\n      });\n      eventBus.dispatch(INTERNAL_EVENT.UNSEEN_NOTIFICATIONS_COUNT, notifications === null || notifications === void 0 ? void 0 : notifications.length);\n    } catch (error) {\n      console.log(error);\n      dispatch({\n        type: DOC_NOTIFICATION_REDUCER_TYPE.FETCH_ERROR\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [popupBrowserCommentNotification]);\n  useEffect(() => {\n    request();\n    const eventBus = EventBus.getInstance();\n    const unsubscribeNewNotification = eventBus.subscribe(EXTERNAL_EVENT.NEW_NOTIFICATION, request);\n    return () => {\n      unsubscribeNewNotification();\n    };\n  }, [request]);\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}