{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useContext, useEffect, useState, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport context from '../../../context';\nimport { User } from '../../../model';\nimport toaster from '../../../components/toast';\nimport { getErrorMsg } from '../../../utils';\nimport { EventBus } from '../../../basic-sdk';\nimport { EXTERNAL_EVENT } from '../../../constants';\nvar ParticipantsContext = React.createContext(null);\nexport var ParticipantsProvider = function ParticipantsProvider(props) {\n  var isSdocRevision = context.getSetting('isSdocRevision');\n  var isPublished = context.getSetting('isPublished');\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    participants = _useState2[0],\n    setParticipants = _useState2[1];\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var updateLocalParticipants = useCallback(function () {\n    var added = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    if (!Array.isArray(added) || added.length === 0) return;\n    var newParticipants = participants.slice(0);\n    added.forEach(function (participant) {\n      var newParticipant = new User(participant);\n      if (!newParticipants.find(function (item) {\n        return item.username === newParticipant.username;\n      })) {\n        newParticipants.push(newParticipant);\n      }\n    });\n    setParticipants(newParticipants);\n  }, [participants]);\n  var addParticipants = useCallback(function (otherEmail) {\n    if (participants.find(function (participant) {\n      return participant.username === otherEmail;\n    })) return;\n    context.addParticipants([otherEmail]).then(function (res) {\n      var success = res.data.success;\n      updateLocalParticipants(success);\n    }).catch(function (error) {\n      var errorMessage = getErrorMsg(error);\n      toaster.danger(t(errorMessage));\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [updateLocalParticipants, participants]);\n  var deleteLocalParticipant = useCallback(function (email) {\n    if (!participants.find(function (participant) {\n      return participant.username === email;\n    })) return;\n    var newParticipants = participants.slice(0);\n    newParticipants = newParticipants.filter(function (participant) {\n      return participant.username !== email;\n    });\n    setParticipants(newParticipants);\n  }, [participants]);\n  var deleteParticipant = useCallback(function (email) {\n    if (!participants.find(function (participant) {\n      return participant.username === email;\n    })) return;\n    context.deleteParticipants(email).then(function (res) {\n      var newParticipants = participants.slice(0);\n      newParticipants = newParticipants.filter(function (participant) {\n        return participant.username !== email;\n      });\n      setParticipants(newParticipants);\n    }).catch(function (error) {\n      var errorMessage = getErrorMsg(error);\n      toaster.danger(t(errorMessage));\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [participants]);\n  useEffect(function () {\n    if (isSdocRevision && isPublished) return;\n    context.listParticipants().then(function (res) {\n      var participants = res.data.participant_list;\n      updateLocalParticipants(participants);\n    }).catch(function (error) {});\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(function () {\n    var eventBus = EventBus.getInstance();\n    var unsubscribeParticipantAdded = eventBus.subscribe(EXTERNAL_EVENT.PARTICIPANT_ADDED, updateLocalParticipants);\n    var unsubscribeParticipantRemoved = eventBus.subscribe(EXTERNAL_EVENT.PARTICIPANT_REMOVED, deleteLocalParticipant);\n    return function () {\n      unsubscribeParticipantAdded();\n      unsubscribeParticipantRemoved();\n    };\n  }, [updateLocalParticipants, deleteLocalParticipant]);\n  return /*#__PURE__*/React.createElement(ParticipantsContext.Provider, {\n    value: {\n      participants: participants,\n      addParticipants: addParticipants,\n      deleteParticipant: deleteParticipant\n    }\n  }, props.children);\n};\nexport var useParticipantsContext = function useParticipantsContext() {\n  var context = useContext(ParticipantsContext);\n  if (!context) {\n    throw new Error('\\'ParticipantsContext\\' is null');\n  }\n  var participants = context.participants,\n    addParticipants = context.addParticipants,\n    deleteParticipant = context.deleteParticipant;\n  return {\n    participants: participants,\n    addParticipants: addParticipants,\n    deleteParticipant: deleteParticipant\n  };\n};","map":{"version":3,"names":["React","useContext","useEffect","useState","useCallback","useTranslation","context","User","toaster","getErrorMsg","EventBus","EXTERNAL_EVENT","ParticipantsContext","createContext","ParticipantsProvider","props","isSdocRevision","getSetting","isPublished","_useState","_useState2","_slicedToArray","participants","setParticipants","_useTranslation","t","updateLocalParticipants","added","arguments","length","undefined","Array","isArray","newParticipants","slice","forEach","participant","newParticipant","find","item","username","push","addParticipants","otherEmail","then","res","success","data","catch","error","errorMessage","danger","deleteLocalParticipant","email","filter","deleteParticipant","deleteParticipants","listParticipants","participant_list","eventBus","getInstance","unsubscribeParticipantAdded","subscribe","PARTICIPANT_ADDED","unsubscribeParticipantRemoved","PARTICIPANT_REMOVED","createElement","Provider","value","children","useParticipantsContext","Error"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/comment/hooks/use-participants.js"],"sourcesContent":["import React, { useContext, useEffect, useState, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport context from '../../../context';\nimport { User } from '../../../model';\nimport toaster from '../../../components/toast';\nimport { getErrorMsg } from '../../../utils';\nimport { EventBus } from '../../../basic-sdk';\nimport { EXTERNAL_EVENT } from '../../../constants';\nconst ParticipantsContext = React.createContext(null);\nexport const ParticipantsProvider = props => {\n  const isSdocRevision = context.getSetting('isSdocRevision');\n  const isPublished = context.getSetting('isPublished');\n  const [participants, setParticipants] = useState([]);\n  const {\n    t\n  } = useTranslation();\n  const updateLocalParticipants = useCallback(function () {\n    let added = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    if (!Array.isArray(added) || added.length === 0) return;\n    let newParticipants = participants.slice(0);\n    added.forEach(participant => {\n      const newParticipant = new User(participant);\n      if (!newParticipants.find(item => item.username === newParticipant.username)) {\n        newParticipants.push(newParticipant);\n      }\n    });\n    setParticipants(newParticipants);\n  }, [participants]);\n  const addParticipants = useCallback(otherEmail => {\n    if (participants.find(participant => participant.username === otherEmail)) return;\n    context.addParticipants([otherEmail]).then(res => {\n      const {\n        success\n      } = res.data;\n      updateLocalParticipants(success);\n    }).catch(error => {\n      const errorMessage = getErrorMsg(error);\n      toaster.danger(t(errorMessage));\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [updateLocalParticipants, participants]);\n  const deleteLocalParticipant = useCallback(email => {\n    if (!participants.find(participant => participant.username === email)) return;\n    let newParticipants = participants.slice(0);\n    newParticipants = newParticipants.filter(participant => participant.username !== email);\n    setParticipants(newParticipants);\n  }, [participants]);\n  const deleteParticipant = useCallback(email => {\n    if (!participants.find(participant => participant.username === email)) return;\n    context.deleteParticipants(email).then(res => {\n      let newParticipants = participants.slice(0);\n      newParticipants = newParticipants.filter(participant => participant.username !== email);\n      setParticipants(newParticipants);\n    }).catch(error => {\n      const errorMessage = getErrorMsg(error);\n      toaster.danger(t(errorMessage));\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [participants]);\n  useEffect(() => {\n    if (isSdocRevision && isPublished) return;\n    context.listParticipants().then(res => {\n      const participants = res.data.participant_list;\n      updateLocalParticipants(participants);\n    }).catch(error => {});\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    const eventBus = EventBus.getInstance();\n    const unsubscribeParticipantAdded = eventBus.subscribe(EXTERNAL_EVENT.PARTICIPANT_ADDED, updateLocalParticipants);\n    const unsubscribeParticipantRemoved = eventBus.subscribe(EXTERNAL_EVENT.PARTICIPANT_REMOVED, deleteLocalParticipant);\n    return () => {\n      unsubscribeParticipantAdded();\n      unsubscribeParticipantRemoved();\n    };\n  }, [updateLocalParticipants, deleteLocalParticipant]);\n  return /*#__PURE__*/React.createElement(ParticipantsContext.Provider, {\n    value: {\n      participants,\n      addParticipants,\n      deleteParticipant\n    }\n  }, props.children);\n};\nexport const useParticipantsContext = () => {\n  const context = useContext(ParticipantsContext);\n  if (!context) {\n    throw new Error('\\'ParticipantsContext\\' is null');\n  }\n  const {\n    participants,\n    addParticipants,\n    deleteParticipant\n  } = context;\n  return {\n    participants,\n    addParticipants,\n    deleteParticipant\n  };\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}