{"ast":null,"code":"import _toConsumableArray from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import ReactDom from'react-dom';import{UncontrolledTooltip}from'reactstrap';import classnames from'classnames';import{DiffViewer}from'@seafile/sdoc-editor';import moment from'moment';import{seafileAPI}from'../../../utils/seafile-api';import{PER_PAGE,gettext,historyRepoID}from'../../../utils/constants';import Loading from'../../../components/loading';import GoBack from'../../../components/common/go-back';import SidePanel from'./side-panel';import{Utils,isMobile}from'../../../utils/utils';import toaster from'../../../components/toast';import{getCurrentAndLastVersion}from'./helper';import'../../../css/layout.css';import'./index.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var _window$app$config=window.app.config,serviceURL=_window$app$config.serviceURL,avatarURL=_window$app$config.avatarURL,siteRoot=_window$app$config.siteRoot;var _window$app$pageOptio=window.app.pageOptions,username=_window$app$pageOptio.username,name=_window$app$pageOptio.name;var _window$fileHistory$p=window.fileHistory.pageOptions,repoID=_window$fileHistory$p.repoID,fileName=_window$fileHistory$p.fileName,filePath=_window$fileHistory$p.filePath,docUuid=_window$fileHistory$p.docUuid,assetsUrl=_window$fileHistory$p.assetsUrl;window.seafile={repoID:repoID,docPath:filePath,docName:fileName,docUuid:docUuid,isOpenSocket:false,serviceUrl:serviceURL,name:name,username:username,avatarURL:avatarURL,siteRoot:siteRoot,assetsUrl:assetsUrl};var SdocFileHistory=/*#__PURE__*/function(_React$Component){_inherits(SdocFileHistory,_React$Component);var _super=_createSuper(SdocFileHistory);function SdocFileHistory(props){var _this;_classCallCheck(this,SdocFileHistory);_this=_super.call(this,props);_this.getInitContent=function(firstChildren){if(firstChildren){return{version:-1,children:[{id:firstChildren.id,type:'title',children:[{id:firstChildren.children[0].id,text:''}]}]};}return _this.getInitContentByPath();};_this.getInitContentByPath=function(path){var _path$split,_path$split$pop;var name=path?(_path$split=path.split('/'))===null||_path$split===void 0?void 0:(_path$split$pop=_path$split.pop())===null||_path$split$pop===void 0?void 0:_path$split$pop.slice(0,-5):'';return{version:-1,children:[{id:'1',type:'title',children:[{id:'2',text:name}]}]};};_this.updateLastVersionContent=function(currentVersionContent,currentVersion,lastVersion){if(!lastVersion){_this.setContent(currentVersionContent,'');return;}if(lastVersion==='init'){var lastVersionContent=currentVersionContent?_this.getInitContent(currentVersionContent.children[0]):_this.getInitContentByPath(currentVersion.path);var validCurrentVersionContent=currentVersionContent||_this.getInitContentByPath(currentVersion.path);_this.setContent(validCurrentVersionContent,lastVersionContent);return;}seafileAPI.getFileRevision(historyRepoID,lastVersion.commit_id,lastVersion.path).then(function(res){return res.data?seafileAPI.getFileContent(res.data):{data:''};}).then(function(res){var lastVersionContent=res.data;var firstChildren=currentVersionContent.children[0];var validLastVersionContent=lastVersion&&!lastVersionContent?_this.getInitContent(firstChildren):lastVersionContent;_this.setContent(currentVersionContent,validLastVersionContent);}).catch(function(error){var errorMessage=Utils.getErrorMsg(error,true);toaster.danger(gettext(errorMessage));_this.setContent(currentVersionContent,'');});};_this.onSelectHistoryVersion=function(currentVersion,lastVersion){_this.setState({isLoading:true,currentVersion:currentVersion});seafileAPI.getFileRevision(historyRepoID,currentVersion.commit_id,currentVersion.path).then(function(res){return seafileAPI.getFileContent(res.data);}).then(function(res){var currentVersionContent=res.data;_this.updateLastVersionContent(currentVersionContent,currentVersion,lastVersion);}).catch(function(error){var errorMessage=Utils.getErrorMsg(error,true);toaster.danger(gettext(errorMessage));_this.setContent('','');});};_this.setContent=function(){var currentVersionContent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var lastVersionContent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';_this.setState({currentVersionContent:currentVersionContent,lastVersionContent:lastVersionContent,isLoading:false,changes:[],currentDiffIndex:0});};_this.onShowChanges=function(isShowChanges,lastVersion){if(isShowChanges){var _this$state=_this.state,currentVersionContent=_this$state.currentVersionContent,currentVersion=_this$state.currentVersion;_this.setState({isLoading:true,isShowChanges:isShowChanges},function(){localStorage.setItem('seahub-sdoc-history-show-changes',isShowChanges+'');_this.updateLastVersionContent(currentVersionContent,currentVersion,lastVersion);});return;}_this.setState({isLoading:true,isShowChanges:isShowChanges},function(){_this.setState({isLoading:false,lastVersionContent:''},function(){localStorage.setItem('seahub-sdoc-history-show-changes',isShowChanges+'');});});};_this.getTopLevelChanges=function(changes){var topLevelChanges=[];changes.forEach(function(item){var dom=document.querySelectorAll(\"[data-id=\\\"\".concat(item,\"\\\"]\"))[0];if(!dom)return[];while(((_dom=dom)===null||_dom===void 0?void 0:(_dom$dataset=_dom.dataset)===null||_dom$dataset===void 0?void 0:_dom$dataset.root)!=='true'){var _dom,_dom$dataset,_dom2;if(!((_dom2=dom)!==null&&_dom2!==void 0&&_dom2.parentNode)||dom instanceof Document)break;var parentNode=dom.parentNode;if(parentNode instanceof Document){break;}else{dom=parentNode;}}topLevelChanges.push(dom.dataset.id);});return Array.from(new Set(topLevelChanges));};// Merge consecutive added areas or deleted areas\n_this.getMergedChanges=function(topLevelChanges,diffValue){var topLevelChangesValue=[];var changes=[];diffValue.forEach(function(item){if(topLevelChanges.includes(item.id)){var obj={id:item.id,value:item};topLevelChangesValue.push(obj);}});topLevelChangesValue.forEach(function(item){var _changes;var preChange=(_changes=changes[changes.length-1])===null||_changes===void 0?void 0:_changes.value;var curChange=item.value;if(curChange!==null&&curChange!==void 0&&curChange.add&&preChange!==null&&preChange!==void 0&&preChange.add)return;if(curChange!==null&&curChange!==void 0&&curChange.delete&&preChange!==null&&preChange!==void 0&&preChange.delete)return;changes.push(item);});return changes.map(function(item){return item.id;});};_this.setDiffCount=function(){var diff=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{value:[],changes:[]};var changes=diff.changes,value=diff.value;var topLevelChanges=_this.getTopLevelChanges(changes);var mergedChanges=_this.getMergedChanges(topLevelChanges,value);_this.setState({changes:mergedChanges,currentDiffIndex:0});};_this.jumpToElement=function(currentDiffIndex){_this.setState({currentDiffIndex:currentDiffIndex},function(){var _this$state2=_this.state,currentDiffIndex=_this$state2.currentDiffIndex,changes=_this$state2.changes;var change=changes[currentDiffIndex];var changeElement=document.querySelectorAll(\"[data-id=\\\"\".concat(change,\"\\\"]\"))[0];if(changeElement){_this.historyContentRef.scrollTop=changeElement.offsetTop-10;}});};_this.lastChange=function(){var _this$state3=_this.state,currentDiffIndex=_this$state3.currentDiffIndex,changes=_this$state3.changes;if(currentDiffIndex===0){_this.jumpToElement(changes.length-1);return;}_this.jumpToElement(currentDiffIndex-1);};_this.nextChange=function(){var _this$state4=_this.state,currentDiffIndex=_this$state4.currentDiffIndex,changes=_this$state4.changes;if(currentDiffIndex===changes.length-1){_this.jumpToElement(0);return;}_this.jumpToElement(currentDiffIndex+1);};_this.changeSidePanelStatus=function(){_this.setState({showSidePanel:!_this.state.showSidePanel});};_this.renderChangesTip=function(_ref){var onChangeSidePanelDisplay=_ref.onChangeSidePanelDisplay;var _this$state5=_this.state,isShowChanges=_this$state5.isShowChanges,changes=_this$state5.changes,currentDiffIndex=_this$state5.currentDiffIndex,isLoading=_this$state5.isLoading;if(isLoading)return null;if(!isShowChanges)return null;var changesCount=changes?changes.length:0;if(changesCount===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"sdoc-file-history-header-right d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-container d-flex align-items-center pl-2 pr-2\",children:gettext('No changes')}),/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-switch ml-4\",children:/*#__PURE__*/_jsx(\"i\",{className:\"sf3-font sf3-font-history\",onClick:onChangeSidePanelDisplay})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"sdoc-file-history-header-right d-flex align-items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sdoc-file-changes-container d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2\",children:\"\".concat(gettext('Changes'),\" \").concat(currentDiffIndex+1,\"/\").concat(changesCount)}),/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-divider\"}),/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-last d-flex align-items-center justify-content-center\",id:\"sdoc-file-changes-last\",onClick:_this.lastChange,children:/*#__PURE__*/_jsx(\"span\",{className:\"fas fa-chevron-up\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-divider\"}),/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-next d-flex align-items-center justify-content-center\",id:\"sdoc-file-changes-next\",onClick:_this.nextChange,children:/*#__PURE__*/_jsx(\"span\",{className:\"fas fa-chevron-down\"})}),/*#__PURE__*/_jsx(UncontrolledTooltip,{placement:\"bottom\",target:\"sdoc-file-changes-last\",delay:0,fade:false,children:gettext('Last modification')}),/*#__PURE__*/_jsx(UncontrolledTooltip,{placement:\"bottom\",target:\"sdoc-file-changes-next\",delay:0,fade:false,children:gettext('Next modification')})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-changes-switch d-flex align-items-center justify-content-center ml-4\",id:\"sdoc-file-changes-panel-switch\",onClick:_this.changeSidePanelStatus,children:/*#__PURE__*/_jsx(\"i\",{className:\"sf3-font sf3-font-history\"})})]});};var _isShowChanges=localStorage.getItem('seahub-sdoc-history-show-changes')==='false'?false:true;_this.state={isLoading:true,isShowChanges:_isShowChanges,currentVersion:{},currentVersionContent:'',lastVersionContent:'',changes:[],currentDiffIndex:0,isMobile:isMobile,sidePanelInitData:{},showSidePanel:true};return _this;}_createClass(SdocFileHistory,[{key:\"componentDidMount\",value:function componentDidMount(){this.firstLoadSdocHistory();}},{key:\"formatHistories\",value:function formatHistories(histories){var oldHistoryGroups=[];// when init data, it will be []\nif(!Array.isArray(histories)||histories.length===0)return oldHistoryGroups;var newHistoryGroups=oldHistoryGroups.slice(0);histories.forEach(function(history){var date=history.date;var momentDate=moment(date);var month=momentDate.format('YYYY-MM');var monthItem=newHistoryGroups.find(function(item){return item.month===month;});if(monthItem){monthItem.children.push({day:momentDate.format('YYYY-MM-DD'),showDaily:false,children:[history]});}else{newHistoryGroups.push({month:month,children:[{day:momentDate.format('YYYY-MM-DD'),showDaily:false,children:[history]}]});}});return newHistoryGroups;}},{key:\"firstLoadSdocHistory\",value:function firstLoadSdocHistory(){var _this2=this;var currentPage=1;seafileAPI.listSdocHistory(docUuid,currentPage,PER_PAGE).then(function(res){var result=res.data;var resultCount=result.histories.length;var historyGroups=_this2.formatHistories(result.histories);var hasMore=resultCount>=PER_PAGE;var sidePanelInitData={historyGroups:historyGroups,hasMore:hasMore,isLoading:false};_this2.setState({sidePanelInitData:sidePanelInitData});if(historyGroups.length>0){var path=[0,0,0];var isShowChanges=_this2.state.isShowChanges;_this2.onSelectHistoryVersion.apply(_this2,_toConsumableArray(getCurrentAndLastVersion(path,historyGroups,isShowChanges)));}}).catch(function(error){var errorMessage='there has an error in server';var isLoading=false;_this2.setState({isLoading:isLoading});_this2.setState({sidePanelInitData:{isLoading:isLoading,errorMessage:errorMessage}});throw Error(errorMessage);});}},{key:\"render\",value:function render(){var _this3=this;var _this$state6=this.state,currentVersion=_this$state6.currentVersion,isShowChanges=_this$state6.isShowChanges,currentVersionContent=_this$state6.currentVersionContent,lastVersionContent=_this$state6.lastVersionContent,isLoading=_this$state6.isLoading,isMobile=_this$state6.isMobile,sidePanelInitData=_this$state6.sidePanelInitData,showSidePanel=_this$state6.showSidePanel;return/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-history d-flex \".concat(isMobile?'mobile':''),children:/*#__PURE__*/_jsxs(\"div\",{className:\"sdoc-file-history-container d-flex flex-column\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sdoc-file-history-header pt-2 pb-2 pl-4 pr-4 d-flex justify-content-between w-100\",children:[/*#__PURE__*/_jsxs(\"div\",{className:classnames('sdoc-file-history-header-left d-flex align-items-center',{'pr-4':isShowChanges}),children:[/*#__PURE__*/_jsx(GoBack,{}),/*#__PURE__*/_jsx(\"div\",{className:\"file-name text-truncate\",children:fileName})]}),this.renderChangesTip({onChangeSidePanelDisplay:this.changeSidePanelStatus})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-history-content d-flex\",ref:function ref(_ref2){return _this3.historyContentRef=_ref2;},children:isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"sdoc-file-history-viewer d-flex align-items-center justify-content-center\",children:/*#__PURE__*/_jsx(Loading,{})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(DiffViewer,{currentContent:currentVersionContent,lastContent:isShowChanges?lastVersionContent:'',didMountCallback:this.setDiffCount}),showSidePanel&&/*#__PURE__*/_jsx(SidePanel,{isShowChanges:isShowChanges,currentVersion:currentVersion,onSelectHistoryVersion:this.onSelectHistoryVersion,onShowChanges:this.onShowChanges,sidePanelInitData:sidePanelInitData,onClose:this.changeSidePanelStatus})]})})]})});}}]);return SdocFileHistory;}(React.Component);ReactDom.render(/*#__PURE__*/_jsx(SdocFileHistory,{}),document.getElementById('wrapper'));","map":{"version":3,"names":["React","ReactDom","UncontrolledTooltip","classnames","DiffViewer","moment","seafileAPI","PER_PAGE","gettext","historyRepoID","Loading","GoBack","SidePanel","Utils","isMobile","toaster","getCurrentAndLastVersion","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","_window$app$config","window","app","config","serviceURL","avatarURL","siteRoot","_window$app$pageOptio","pageOptions","username","name","_window$fileHistory$p","fileHistory","repoID","fileName","filePath","docUuid","assetsUrl","seafile","docPath","docName","isOpenSocket","serviceUrl","SdocFileHistory","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","getInitContent","firstChildren","version","children","id","type","text","getInitContentByPath","path","_path$split","_path$split$pop","split","pop","slice","updateLastVersionContent","currentVersionContent","currentVersion","lastVersion","setContent","lastVersionContent","validCurrentVersionContent","getFileRevision","commit_id","then","res","data","getFileContent","validLastVersionContent","catch","error","errorMessage","getErrorMsg","danger","onSelectHistoryVersion","setState","isLoading","arguments","length","undefined","changes","currentDiffIndex","onShowChanges","isShowChanges","_this$state","state","localStorage","setItem","getTopLevelChanges","topLevelChanges","forEach","item","dom","document","querySelectorAll","concat","_dom","_dom$dataset","dataset","root","_dom2","parentNode","Document","push","Array","from","Set","getMergedChanges","diffValue","topLevelChangesValue","includes","obj","value","_changes","preChange","curChange","add","delete","map","setDiffCount","diff","mergedChanges","jumpToElement","_this$state2","change","changeElement","historyContentRef","scrollTop","offsetTop","lastChange","_this$state3","nextChange","_this$state4","changeSidePanelStatus","showSidePanel","renderChangesTip","_ref","onChangeSidePanelDisplay","_this$state5","changesCount","className","onClick","placement","target","delay","fade","getItem","sidePanelInitData","_createClass","key","componentDidMount","firstLoadSdocHistory","formatHistories","histories","oldHistoryGroups","isArray","newHistoryGroups","history","date","momentDate","month","format","monthItem","find","day","showDaily","_this2","currentPage","listSdocHistory","result","resultCount","historyGroups","hasMore","apply","_toConsumableArray","Error","render","_this3","_this$state6","ref","currentContent","lastContent","didMountCallback","onClose","Component","getElementById"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/sdoc/sdoc-file-history/index.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport { UncontrolledTooltip } from 'reactstrap';\nimport classnames from 'classnames';\nimport { DiffViewer } from '@seafile/sdoc-editor';\nimport moment from 'moment';\nimport { seafileAPI } from '../../../utils/seafile-api';\nimport { PER_PAGE, gettext, historyRepoID } from '../../../utils/constants';\nimport Loading from '../../../components/loading';\nimport GoBack from '../../../components/common/go-back';\nimport SidePanel from './side-panel';\nimport { Utils, isMobile } from '../../../utils/utils';\nimport toaster from '../../../components/toast';\nimport { getCurrentAndLastVersion } from './helper';\n\nimport '../../../css/layout.css';\nimport './index.css';\n\nconst { serviceURL, avatarURL, siteRoot } = window.app.config;\nconst { username, name } = window.app.pageOptions;\nconst { repoID, fileName, filePath, docUuid, assetsUrl } = window.fileHistory.pageOptions;\n\nwindow.seafile = {\n  repoID,\n  docPath: filePath,\n  docName: fileName,\n  docUuid,\n  isOpenSocket: false,\n  serviceUrl: serviceURL,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  assetsUrl,\n};\n\nclass SdocFileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    const isShowChanges = localStorage.getItem('seahub-sdoc-history-show-changes') === 'false' ? false : true;\n    this.state = {\n      isLoading: true,\n      isShowChanges,\n      currentVersion: {},\n      currentVersionContent: '',\n      lastVersionContent: '',\n      changes: [],\n      currentDiffIndex: 0,\n      isMobile: isMobile,\n      sidePanelInitData: {},\n      showSidePanel: true,\n    };\n  }\n\n  componentDidMount() {\n    this.firstLoadSdocHistory();\n  }\n\n  getInitContent = (firstChildren) => {\n    if (firstChildren) {\n      return {\n        version: -1,\n        children: [\n          {\n            id: firstChildren.id,\n            type: 'title',\n            children: [\n              {\n                id: firstChildren.children[0].id,\n                text: ''\n              }\n            ]\n          }\n        ]\n      };\n    }\n    return this.getInitContentByPath();\n  };\n\n  getInitContentByPath = (path) => {\n    const name = path ? path.split('/')?.pop()?.slice(0, -5) : '';\n    return {\n      version: -1,\n      children: [\n        {\n          id: '1',\n          type: 'title',\n          children: [\n            {\n              id: '2',\n              text: name\n            }\n          ]\n        }\n      ]\n    };\n  };\n\n  updateLastVersionContent = (currentVersionContent, currentVersion, lastVersion) => {\n    if (!lastVersion) {\n      this.setContent(currentVersionContent, '');\n      return;\n    }\n    if (lastVersion === 'init') {\n      const lastVersionContent = currentVersionContent ? this.getInitContent(currentVersionContent.children[0]) : this.getInitContentByPath(currentVersion.path);\n      const validCurrentVersionContent = currentVersionContent || this.getInitContentByPath(currentVersion.path);\n      this.setContent(validCurrentVersionContent, lastVersionContent);\n      return;\n    }\n    seafileAPI.getFileRevision(historyRepoID, lastVersion.commit_id, lastVersion.path).then(res => {\n      return res.data ? seafileAPI.getFileContent(res.data) : { data: '' };\n    }).then(res => {\n      const lastVersionContent = res.data;\n      const firstChildren = currentVersionContent.children[0];\n      const validLastVersionContent = lastVersion && !lastVersionContent ? this.getInitContent(firstChildren) : lastVersionContent;\n      this.setContent(currentVersionContent, validLastVersionContent);\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n      this.setContent(currentVersionContent, '');\n    });\n  };\n\n  onSelectHistoryVersion = (currentVersion, lastVersion) => {\n    this.setState({ isLoading: true, currentVersion });\n    seafileAPI.getFileRevision(historyRepoID, currentVersion.commit_id, currentVersion.path).then(res => {\n      return seafileAPI.getFileContent(res.data);\n    }).then(res => {\n      const currentVersionContent = res.data;\n      this.updateLastVersionContent(currentVersionContent, currentVersion, lastVersion);\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n      this.setContent('', '');\n    });\n  };\n\n  setContent = (currentVersionContent = '', lastVersionContent = '') => {\n    this.setState({ currentVersionContent, lastVersionContent, isLoading: false, changes: [], currentDiffIndex: 0 });\n  };\n\n  onShowChanges = (isShowChanges, lastVersion) => {\n    if (isShowChanges) {\n      const { currentVersionContent, currentVersion } = this.state;\n      this.setState({ isLoading: true, isShowChanges }, () => {\n        localStorage.setItem('seahub-sdoc-history-show-changes', isShowChanges + '');\n        this.updateLastVersionContent(currentVersionContent, currentVersion, lastVersion);\n      });\n      return;\n    }\n    this.setState({ isLoading: true, isShowChanges }, () => {\n      this.setState({ isLoading: false, lastVersionContent: '' }, () => {\n        localStorage.setItem('seahub-sdoc-history-show-changes', isShowChanges + '');\n      });\n    });\n  };\n\n  getTopLevelChanges = (changes) => {\n    const topLevelChanges = [];\n    changes.forEach((item) => {\n      let dom = document.querySelectorAll(`[data-id=\"${item}\"]`)[0];\n      if (!dom) return [];\n      while (dom?.dataset?.root !== 'true') {\n        if (!dom?.parentNode || dom instanceof Document) break;\n        const parentNode = dom.parentNode;\n        if (parentNode instanceof Document) {\n          break;\n        } else {\n          dom = parentNode;\n        }\n      }\n      topLevelChanges.push(dom.dataset.id);\n    });\n    return Array.from(new Set(topLevelChanges));\n  };\n\n  // Merge consecutive added areas or deleted areas\n  getMergedChanges = (topLevelChanges, diffValue) => {\n    const topLevelChangesValue = [];\n    const changes = [];\n\n    diffValue.forEach((item) => {\n      if (topLevelChanges.includes(item.id)) {\n        const obj = {\n          id: item.id,\n          value: item\n        };\n        topLevelChangesValue.push(obj);\n      }\n    });\n\n    topLevelChangesValue.forEach((item) => {\n      const preChange = changes[changes.length - 1]?.value;\n      const curChange = item.value;\n      if (curChange?.add && preChange?.add) return;\n      if (curChange?.delete && preChange?.delete) return;\n      changes.push(item);\n    });\n    return changes.map(item => item.id);\n  };\n\n  setDiffCount = (diff = { value: [], changes: [] }) => {\n    const { changes, value } = diff;\n    const topLevelChanges = this.getTopLevelChanges(changes);\n    const mergedChanges = this.getMergedChanges(topLevelChanges, value);\n    this.setState({ changes: mergedChanges, currentDiffIndex: 0 });\n  };\n\n  jumpToElement = (currentDiffIndex) => {\n    this.setState({ currentDiffIndex }, () => {\n      const { currentDiffIndex, changes } = this.state;\n      const change = changes[currentDiffIndex];\n      const changeElement = document.querySelectorAll(`[data-id=\"${change}\"]`)[0];\n      if (changeElement) {\n        this.historyContentRef.scrollTop = changeElement.offsetTop - 10;\n      }\n    });\n  };\n\n  lastChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === 0) {\n      this.jumpToElement(changes.length - 1);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex - 1);\n  };\n\n  nextChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === changes.length - 1) {\n      this.jumpToElement(0);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex + 1);\n  };\n\n  changeSidePanelStatus = () => {\n    this.setState({ showSidePanel: !this.state.showSidePanel });\n  };\n\n  renderChangesTip = ({ onChangeSidePanelDisplay }) => {\n    const { isShowChanges, changes, currentDiffIndex, isLoading } = this.state;\n    if (isLoading) return null;\n    if (!isShowChanges) return null;\n    const changesCount = changes ? changes.length : 0;\n    if (changesCount === 0) {\n      return (\n        <div className=\"sdoc-file-history-header-right d-flex align-items-center\">\n          <div className=\"sdoc-file-changes-container d-flex align-items-center pl-2 pr-2\">\n            {gettext('No changes')}\n          </div>\n          <div className='sdoc-file-changes-switch ml-4'>\n            <i className=\"sf3-font sf3-font-history\" onClick={onChangeSidePanelDisplay}></i>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"sdoc-file-history-header-right d-flex align-items-center\">\n        <div className=\"sdoc-file-changes-container d-flex align-items-center\">\n          <div className=\"sdoc-file-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2\">\n            {`${gettext('Changes')} ${currentDiffIndex + 1}/${changesCount}`}\n          </div>\n          <div className=\"sdoc-file-changes-divider\"></div>\n          <div\n            className=\"sdoc-file-changes-last d-flex align-items-center justify-content-center\"\n            id=\"sdoc-file-changes-last\"\n            onClick={this.lastChange}\n          >\n            <span className=\"fas fa-chevron-up\"></span>\n          </div>\n          <div className=\"sdoc-file-changes-divider\"></div>\n          <div\n            className=\"sdoc-file-changes-next d-flex align-items-center justify-content-center\"\n            id=\"sdoc-file-changes-next\"\n            onClick={this.nextChange}\n          >\n            <span className=\"fas fa-chevron-down\"></span>\n          </div>\n          <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-last\" delay={0} fade={false}>\n            {gettext('Last modification')}\n          </UncontrolledTooltip>\n          <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-next\" delay={0} fade={false}>\n            {gettext('Next modification')}\n          </UncontrolledTooltip>\n        </div>\n        <div\n          className=\"sdoc-file-changes-switch d-flex align-items-center justify-content-center ml-4\"\n          id=\"sdoc-file-changes-panel-switch\"\n          onClick={this.changeSidePanelStatus}\n        >\n          <i className=\"sf3-font sf3-font-history\"></i>\n        </div>\n      </div>\n    );\n  };\n\n  formatHistories(histories) {\n    const oldHistoryGroups = []; // when init data, it will be []\n    if (!Array.isArray(histories) || histories.length === 0) return oldHistoryGroups;\n    const newHistoryGroups = oldHistoryGroups.slice(0);\n    histories.forEach(history => {\n      const { date } = history;\n      const momentDate = moment(date);\n      const month = momentDate.format('YYYY-MM');\n      const monthItem = newHistoryGroups.find(item => item.month === month);\n      if (monthItem) {\n        monthItem.children.push({ day: momentDate.format('YYYY-MM-DD'), showDaily: false, children: [history] });\n      } else {\n        newHistoryGroups.push({\n          month,\n          children: [\n            { day: momentDate.format('YYYY-MM-DD'), showDaily: false, children: [history] }\n          ]\n        });\n      }\n    });\n    return newHistoryGroups;\n  }\n\n  firstLoadSdocHistory() {\n    const currentPage = 1;\n    seafileAPI.listSdocHistory(docUuid, currentPage, PER_PAGE).then(res => {\n      const result = res.data;\n      const resultCount = result.histories.length;\n      const historyGroups = this.formatHistories(result.histories);\n      let hasMore = resultCount >= PER_PAGE;\n      const sidePanelInitData = {\n        historyGroups,\n        hasMore,\n        isLoading: false,\n      };\n      this.setState({ sidePanelInitData });\n\n      if (historyGroups.length > 0) {\n        const path = [0, 0, 0];\n        const { isShowChanges } = this.state;\n        this.onSelectHistoryVersion(...getCurrentAndLastVersion(path, historyGroups, isShowChanges));\n      }\n    }).catch((error) => {\n      const errorMessage = 'there has an error in server';\n      const isLoading = false;\n      this.setState({ isLoading });\n      this.setState({ sidePanelInitData: { isLoading, errorMessage } });\n      throw Error(errorMessage);\n    });\n  }\n\n  render() {\n    const { currentVersion, isShowChanges, currentVersionContent, lastVersionContent, isLoading, isMobile, sidePanelInitData, showSidePanel } = this.state;\n    return (\n      <div className={`sdoc-file-history d-flex ${isMobile ? 'mobile' : ''}`}>\n        <div className=\"sdoc-file-history-container d-flex flex-column\">\n          <div className=\"sdoc-file-history-header pt-2 pb-2 pl-4 pr-4 d-flex justify-content-between w-100\">\n            <div className={classnames('sdoc-file-history-header-left d-flex align-items-center', { 'pr-4': isShowChanges })}>\n              <GoBack />\n              <div className=\"file-name text-truncate\">{fileName}</div>\n            </div>\n            {this.renderChangesTip({ onChangeSidePanelDisplay: this.changeSidePanelStatus })}\n          </div>\n          <div className=\"sdoc-file-history-content d-flex\" ref={ref => this.historyContentRef = ref}>\n            {isLoading ? (\n              <div className=\"sdoc-file-history-viewer d-flex align-items-center justify-content-center\">\n                <Loading />\n              </div>\n            ) : (\n              <>\n                <DiffViewer\n                  currentContent={currentVersionContent}\n                  lastContent={isShowChanges ? lastVersionContent : ''}\n                  didMountCallback={this.setDiffCount}\n                />\n                {\n                  showSidePanel && (\n                    <SidePanel\n                      isShowChanges={isShowChanges}\n                      currentVersion={currentVersion}\n                      onSelectHistoryVersion={this.onSelectHistoryVersion}\n                      onShowChanges={this.onShowChanges}\n                      sidePanelInitData={sidePanelInitData}\n                      onClose={this.changeSidePanelStatus}\n                    />\n                  )\n                }\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SdocFileHistory />, document.getElementById('wrapper'));\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}