{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\nvar _toConsumableArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _slicedToArray = require(\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.transformsToList = void 0;\nvar _slate = require(\"slate\");\nvar _core = require(\"../../../core\");\nvar _queries = require(\"../queries\");\nvar _constant = require(\"../constant\");\nvar _elementTypes = require(\"../../../constants/element-types\");\nvar _unwrapList = require(\"./unwrap-list\");\nvar wrapLineList = function wrapLineList(editor, type) {\n  var emptyList = (0, _core.generateElement)(type, {\n    childrenOrText: []\n  });\n  _slate.Transforms.wrapNodes(editor, emptyList);\n  var paragraphEntry = (0, _core.getSelectedNodeEntryByType)(editor, _elementTypes.PARAGRAPH);\n  if (!paragraphEntry) return;\n  var _paragraphEntry = _slicedToArray(paragraphEntry, 2),\n    paragraphPath = _paragraphEntry[1];\n  var emptyListItem = (0, _core.generateElement)(_elementTypes.LIST_ITEM, {\n    childrenOrText: []\n  });\n  _slate.Transforms.wrapNodes(editor, emptyListItem, {\n    at: paragraphPath\n  });\n};\nvar wrapRangeList = function wrapRangeList(editor, type) {\n  var _slate$Range$edges = _slate.Range.edges(editor.selection),\n    _slate$Range$edges2 = _slicedToArray(_slate$Range$edges, 2),\n    startPoint = _slate$Range$edges2[0],\n    endPoint = _slate$Range$edges2[1];\n  var _slate$Node$common = _slate.Node.common(editor, startPoint.path, endPoint.path),\n    _slate$Node$common2 = _slicedToArray(_slate$Node$common, 2),\n    commonAncestorNode = _slate$Node$common2[0],\n    commonAncestorPath = _slate$Node$common2[1];\n\n  // If common anchestor is of list,order list, unordered list, list of items,wrap or un wrap it\n  if ([].concat(_toConsumableArray(_constant.LIST_TYPES), [_elementTypes.LIST_ITEM]).includes(commonAncestorNode.type)) {\n    // Change to another list type, if select different depth of list,set the shallowest depth to the given type\n    if (commonAncestorNode.type !== type) {\n      var options = {\n        at: startPoint,\n        match: {\n          type: _constant.LIST_TYPES\n        },\n        mode: 'lowest'\n      };\n      var startListEntry = (0, _core.findNode)(editor, options);\n      var endListEntry = (0, _core.findNode)(editor, _objectSpread(_objectSpread({}, options), {}, {\n        at: endPoint\n      }));\n      var selectDepth = Math.min(startListEntry[1].length, endListEntry[1].length);\n      _slate.Transforms.setNodes(editor, {\n        type: type\n      }, {\n        match: function match(node, path) {\n          return _slate.Element.isElement(node) && _constant.LIST_TYPES.includes(node.type) && path.length >= selectDepth;\n        },\n        mode: 'all'\n      });\n    } else {\n      (0, _unwrapList.unwrapList)(editor);\n    }\n    return;\n  }\n  var commonAncestorDepth = commonAncestorPath.length;\n  var selectedNodeEntries = _slate.Editor.nodes(editor, {\n    mode: 'all'\n  });\n  // Filter out all the child node of selected node.\n  var nodeEntryList = Array.from(selectedNodeEntries).filter(function (_ref) {\n    var _ref3 = _slicedToArray(_ref, 2),\n      node = _ref3[0],\n      path = _ref3[1];\n    return path.length === commonAncestorDepth + 1;\n  });\n  nodeEntryList.forEach(function (_ref2) {\n    var _ref4 = _slicedToArray(_ref2, 2),\n      node = _ref4[0],\n      path = _ref4[1];\n    if (_constant.LIST_TYPES.includes(node.type)) {\n      _slate.Transforms.setNodes(editor, {\n        type: type\n      }, {\n        at: path,\n        match: function match(n) {\n          return _slate.Element.isElement(n) && _elementTypes.LIST_ITEM.includes(n.type);\n        },\n        mode: 'all'\n      });\n    } else {\n      var emptyListItem = (0, _core.generateElement)(_elementTypes.LIST_ITEM, {\n        childrenOrText: []\n      });\n      _slate.Transforms.wrapNodes(editor, emptyListItem, {\n        at: path\n      });\n      var emptyList = (0, _core.generateElement)(type, {\n        childrenOrText: []\n      });\n      _slate.Transforms.wrapNodes(editor, emptyList, {\n        at: path\n      });\n    }\n  });\n};\n\n/**\n * @param {object} editor\n * @param {keyof LIST_TYPES} type\n */\nvar transformsToList = function transformsToList(editor, type) {\n  _slate.Editor.withoutNormalizing(editor, function () {\n    var selection = editor.selection;\n    if (!selection) return false;\n    if (_slate.Range.isCollapsed(selection) || !(0, _core.isRangeAcrossBlocks)(editor)) {\n      var res = (0, _queries.getListItemEntry)(editor);\n      // Unwrap list if `res` exist which means selected in list,or wrap it\n      if (res) {\n        var list = res.list;\n        var setListType = function setListType(editor, type) {\n          return _slate.Transforms.setNodes(editor, {\n            type: type\n          }, {\n            match: function match(node) {\n              return _constant.LIST_TYPES.includes((0, _core.getNodeType)(node));\n            },\n            mode: 'lowest',\n            at: editor.selection\n          });\n        };\n        // Change list type to another, if list type is different from the given type\n        list[0].type !== type ? setListType(editor, type) : (0, _unwrapList.unwrapList)(editor);\n      } else {\n        wrapLineList(editor, type);\n      }\n      return;\n    }\n    // Selection is a range\n    wrapRangeList(editor, type);\n  });\n};\nexports.transformsToList = transformsToList;","map":{"version":3,"names":["_objectSpread","require","default","_toConsumableArray","_slicedToArray","Object","defineProperty","exports","value","transformsToList","_slate","_core","_queries","_constant","_elementTypes","_unwrapList","wrapLineList","editor","type","emptyList","generateElement","childrenOrText","Transforms","wrapNodes","paragraphEntry","getSelectedNodeEntryByType","PARAGRAPH","_paragraphEntry","paragraphPath","emptyListItem","LIST_ITEM","at","wrapRangeList","_slate$Range$edges","Range","edges","selection","_slate$Range$edges2","startPoint","endPoint","_slate$Node$common","Node","common","path","_slate$Node$common2","commonAncestorNode","commonAncestorPath","concat","LIST_TYPES","includes","options","match","mode","startListEntry","findNode","endListEntry","selectDepth","Math","min","length","setNodes","node","Element","isElement","unwrapList","commonAncestorDepth","selectedNodeEntries","Editor","nodes","nodeEntryList","Array","from","filter","_ref","_ref3","forEach","_ref2","_ref4","n","withoutNormalizing","isCollapsed","isRangeAcrossBlocks","res","getListItemEntry","list","setListType","getNodeType"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/seafile-editor/dist/extension/plugins/list/transforms/transforms-to-list.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.transformsToList = void 0;\nvar _slate = require(\"slate\");\nvar _core = require(\"../../../core\");\nvar _queries = require(\"../queries\");\nvar _constant = require(\"../constant\");\nvar _elementTypes = require(\"../../../constants/element-types\");\nvar _unwrapList = require(\"./unwrap-list\");\nconst wrapLineList = (editor, type) => {\n  const emptyList = (0, _core.generateElement)(type, {\n    childrenOrText: []\n  });\n  _slate.Transforms.wrapNodes(editor, emptyList);\n  const paragraphEntry = (0, _core.getSelectedNodeEntryByType)(editor, _elementTypes.PARAGRAPH);\n  if (!paragraphEntry) return;\n  const [, paragraphPath] = paragraphEntry;\n  const emptyListItem = (0, _core.generateElement)(_elementTypes.LIST_ITEM, {\n    childrenOrText: []\n  });\n  _slate.Transforms.wrapNodes(editor, emptyListItem, {\n    at: paragraphPath\n  });\n};\nconst wrapRangeList = (editor, type) => {\n  const [startPoint, endPoint] = _slate.Range.edges(editor.selection);\n  const [commonAncestorNode, commonAncestorPath] = _slate.Node.common(editor, startPoint.path, endPoint.path);\n\n  // If common anchestor is of list,order list, unordered list, list of items,wrap or un wrap it\n  if ([..._constant.LIST_TYPES, _elementTypes.LIST_ITEM].includes(commonAncestorNode.type)) {\n    // Change to another list type, if select different depth of list,set the shallowest depth to the given type\n    if (commonAncestorNode.type !== type) {\n      const options = {\n        at: startPoint,\n        match: {\n          type: _constant.LIST_TYPES\n        },\n        mode: 'lowest'\n      };\n      const startListEntry = (0, _core.findNode)(editor, options);\n      const endListEntry = (0, _core.findNode)(editor, {\n        ...options,\n        at: endPoint\n      });\n      const selectDepth = Math.min(startListEntry[1].length, endListEntry[1].length);\n      _slate.Transforms.setNodes(editor, {\n        type\n      }, {\n        match: (node, path) => _slate.Element.isElement(node) && _constant.LIST_TYPES.includes(node.type) && path.length >= selectDepth,\n        mode: 'all'\n      });\n    } else {\n      (0, _unwrapList.unwrapList)(editor);\n    }\n    return;\n  }\n  const commonAncestorDepth = commonAncestorPath.length;\n  const selectedNodeEntries = _slate.Editor.nodes(editor, {\n    mode: 'all'\n  });\n  // Filter out all the child node of selected node.\n  const nodeEntryList = Array.from(selectedNodeEntries).filter(_ref => {\n    let [node, path] = _ref;\n    return path.length === commonAncestorDepth + 1;\n  });\n  nodeEntryList.forEach(_ref2 => {\n    let [node, path] = _ref2;\n    if (_constant.LIST_TYPES.includes(node.type)) {\n      _slate.Transforms.setNodes(editor, {\n        type\n      }, {\n        at: path,\n        match: n => _slate.Element.isElement(n) && _elementTypes.LIST_ITEM.includes(n.type),\n        mode: 'all'\n      });\n    } else {\n      const emptyListItem = (0, _core.generateElement)(_elementTypes.LIST_ITEM, {\n        childrenOrText: []\n      });\n      _slate.Transforms.wrapNodes(editor, emptyListItem, {\n        at: path\n      });\n      const emptyList = (0, _core.generateElement)(type, {\n        childrenOrText: []\n      });\n      _slate.Transforms.wrapNodes(editor, emptyList, {\n        at: path\n      });\n    }\n  });\n};\n\n/**\n * @param {object} editor\n * @param {keyof LIST_TYPES} type\n */\nconst transformsToList = (editor, type) => {\n  _slate.Editor.withoutNormalizing(editor, () => {\n    const {\n      selection\n    } = editor;\n    if (!selection) return false;\n    if (_slate.Range.isCollapsed(selection) || !(0, _core.isRangeAcrossBlocks)(editor)) {\n      const res = (0, _queries.getListItemEntry)(editor);\n      // Unwrap list if `res` exist which means selected in list,or wrap it\n      if (res) {\n        const {\n          list\n        } = res;\n        const setListType = (editor, type) => _slate.Transforms.setNodes(editor, {\n          type\n        }, {\n          match: node => _constant.LIST_TYPES.includes((0, _core.getNodeType)(node)),\n          mode: 'lowest',\n          at: editor.selection\n        });\n        // Change list type to another, if list type is different from the given type\n        list[0].type !== type ? setListType(editor, type) : (0, _unwrapList.unwrapList)(editor);\n      } else {\n        wrapLineList(editor, type);\n      }\n      return;\n    }\n    // Selection is a range\n    wrapRangeList(editor, type);\n  });\n};\nexports.transformsToList = transformsToList;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}