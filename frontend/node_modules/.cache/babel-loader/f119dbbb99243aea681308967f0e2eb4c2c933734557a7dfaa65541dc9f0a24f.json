{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { Editor, Node, Path, Transforms } from '@seafile/slate';\nimport { CALL_OUT, PARAGRAPH } from '../../constants/element-type';\nimport { focusEditor, generateEmptyElement, getSelectedElems, isRangeAcrossBlocks } from '../../core';\nimport { CALLOUT_ALLOWED_INSIDE_TYPES, CALLOUT_COLOR_MAP } from './constant';\nexport var isMenuActive = function isMenuActive(editor) {\n  var selection = editor.selection;\n  if (!selection) return false;\n  var isInsideCallout = !!getCalloutEntry(editor);\n  if (isInsideCallout) return true;\n  return false;\n};\nexport var isMenuDisabled = function isMenuDisabled(editor, readonly) {\n  if (readonly) return true;\n  var selection = editor.selection;\n  if (!selection) return true;\n  var selectedElements = getSelectedElems(editor);\n  var isRangeAcrossBlock = isRangeAcrossBlocks(editor);\n  // If selected multiple block element contains callout, disable callout menu\n  var isAllSelectedElementsInAllowTypes = selectedElements.length && selectedElements.every(function (element) {\n    if (element.type === CALL_OUT && isRangeAcrossBlock) return false;\n    return CALLOUT_ALLOWED_INSIDE_TYPES.includes(element.type);\n  });\n  if (isAllSelectedElementsInAllowTypes) return false;\n  return true;\n};\n\n/**\n * @param {keyof CALLOUT_COLOR_MAP} [background_color] fill color\n */\nexport var generateCallout = function generateCallout() {\n  var background_color = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Object.keys(CALLOUT_COLOR_MAP)[5];\n  var props = {\n    style: {\n      background_color: background_color\n    }\n  };\n  var callout = generateEmptyElement(CALL_OUT, props);\n  callout.children = [];\n  return callout;\n};\nexport var wrapCallout = function wrapCallout(editor) {\n  var selection = editor.selection;\n  if (!selection) return;\n  var callout = generateCallout();\n  Transforms.wrapNodes(editor, callout, {\n    mode: 'highest'\n  });\n  focusEditor(editor);\n};\nexport var unwrapCallout = function unwrapCallout(editor) {\n  var selection = editor.selection;\n  if (!selection) return;\n  var aboveNodeEntry = Editor.above(editor, {\n    match: function match(n) {\n      return n.type === CALL_OUT;\n    }\n  });\n  if (!aboveNodeEntry) return;\n  var _aboveNodeEntry = _slicedToArray(aboveNodeEntry, 2),\n    calloutPath = _aboveNodeEntry[1];\n  Transforms.unwrapNodes(editor, {\n    at: calloutPath,\n    match: function match(n) {\n      return n.type === CALL_OUT;\n    }\n  });\n  var point = Editor.point(editor, editor.selection);\n  focusEditor(editor, point);\n};\nexport var changeFillBackgroundColor = function changeFillBackgroundColor(editor, background_color) {\n  Transforms.setNodes(editor, {\n    style: {\n      background_color: background_color\n    }\n  }, {\n    match: function match(n) {\n      return n.type === CALL_OUT;\n    }\n  });\n  Transforms.select(editor, Editor.start(editor, editor.selection));\n};\nexport var setCalloutIcon = function setCalloutIcon(editor, icon_name) {\n  Transforms.setNodes(editor, {\n    callout_icon: icon_name\n  }, {\n    match: function match(n) {\n      return n.type === CALL_OUT;\n    }\n  });\n  Transforms.select(editor, Editor.start(editor, editor.selection));\n};\nexport var deleteCalloutIcon = function deleteCalloutIcon(editor) {\n  Transforms.setNodes(editor, {\n    callout_icon: ''\n  }, {\n    match: function match(n) {\n      return n.type === CALL_OUT;\n    }\n  });\n  Transforms.select(editor, Editor.start(editor, editor.selection));\n};\n\n// Check is cursor in callout\nexport var getCalloutEntry = function getCalloutEntry(editor) {\n  var at = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : editor.selection;\n  var aboveNodeEntry = Editor.above(editor, {\n    match: function match(n) {\n      return n.type === CALL_OUT;\n    },\n    mode: 'highest',\n    at: at\n  });\n  return aboveNodeEntry;\n};\nexport var isCalloutContentEmpty = function isCalloutContentEmpty(calloutEntry) {\n  var _calloutEntry = _slicedToArray(calloutEntry, 1),\n    calloutNode = _calloutEntry[0];\n  var contentString = Node.string(calloutNode);\n  var calloutChildren = calloutNode.children;\n  var isSingleParagraph = calloutChildren.length === 1 && calloutChildren[0].type === PARAGRAPH;\n  var isEmptyContent = contentString.length === 0;\n  return isSingleParagraph && isEmptyContent;\n};\n\n// Insert a new element at new line in callout after current path\nexport var insertElementAtNewLineInCallout = function insertElementAtNewLineInCallout(editor, type, currentPath) {\n  var element = generateEmptyElement(type);\n  var insertPath = Path.next(currentPath);\n  Transforms.insertNodes(editor, element, {\n    at: insertPath\n  });\n  Transforms.select(editor, insertPath);\n};","map":{"version":3,"names":["Editor","Node","Path","Transforms","CALL_OUT","PARAGRAPH","focusEditor","generateEmptyElement","getSelectedElems","isRangeAcrossBlocks","CALLOUT_ALLOWED_INSIDE_TYPES","CALLOUT_COLOR_MAP","isMenuActive","editor","selection","isInsideCallout","getCalloutEntry","isMenuDisabled","readonly","selectedElements","isRangeAcrossBlock","isAllSelectedElementsInAllowTypes","length","every","element","type","includes","generateCallout","background_color","arguments","undefined","Object","keys","props","style","callout","children","wrapCallout","wrapNodes","mode","unwrapCallout","aboveNodeEntry","above","match","n","_aboveNodeEntry","_slicedToArray","calloutPath","unwrapNodes","at","point","changeFillBackgroundColor","setNodes","select","start","setCalloutIcon","icon_name","callout_icon","deleteCalloutIcon","isCalloutContentEmpty","calloutEntry","_calloutEntry","calloutNode","contentString","string","calloutChildren","isSingleParagraph","isEmptyContent","insertElementAtNewLineInCallout","currentPath","insertPath","next","insertNodes"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/basic-sdk/extension/plugins/callout/helper.js"],"sourcesContent":["import { Editor, Node, Path, Transforms } from '@seafile/slate';\nimport { CALL_OUT, PARAGRAPH } from '../../constants/element-type';\nimport { focusEditor, generateEmptyElement, getSelectedElems, isRangeAcrossBlocks } from '../../core';\nimport { CALLOUT_ALLOWED_INSIDE_TYPES, CALLOUT_COLOR_MAP } from './constant';\nexport const isMenuActive = editor => {\n  const {\n    selection\n  } = editor;\n  if (!selection) return false;\n  const isInsideCallout = !!getCalloutEntry(editor);\n  if (isInsideCallout) return true;\n  return false;\n};\nexport const isMenuDisabled = (editor, readonly) => {\n  if (readonly) return true;\n  const {\n    selection\n  } = editor;\n  if (!selection) return true;\n  const selectedElements = getSelectedElems(editor);\n  const isRangeAcrossBlock = isRangeAcrossBlocks(editor);\n  // If selected multiple block element contains callout, disable callout menu\n  const isAllSelectedElementsInAllowTypes = selectedElements.length && selectedElements.every(element => {\n    if (element.type === CALL_OUT && isRangeAcrossBlock) return false;\n    return CALLOUT_ALLOWED_INSIDE_TYPES.includes(element.type);\n  });\n  if (isAllSelectedElementsInAllowTypes) return false;\n  return true;\n};\n\n/**\n * @param {keyof CALLOUT_COLOR_MAP} [background_color] fill color\n */\nexport const generateCallout = function () {\n  let background_color = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Object.keys(CALLOUT_COLOR_MAP)[5];\n  const props = {\n    style: {\n      background_color\n    }\n  };\n  const callout = generateEmptyElement(CALL_OUT, props);\n  callout.children = [];\n  return callout;\n};\nexport const wrapCallout = editor => {\n  const {\n    selection\n  } = editor;\n  if (!selection) return;\n  const callout = generateCallout();\n  Transforms.wrapNodes(editor, callout, {\n    mode: 'highest'\n  });\n  focusEditor(editor);\n};\nexport const unwrapCallout = editor => {\n  const {\n    selection\n  } = editor;\n  if (!selection) return;\n  const aboveNodeEntry = Editor.above(editor, {\n    match: n => n.type === CALL_OUT\n  });\n  if (!aboveNodeEntry) return;\n  const [, calloutPath] = aboveNodeEntry;\n  Transforms.unwrapNodes(editor, {\n    at: calloutPath,\n    match: n => n.type === CALL_OUT\n  });\n  const point = Editor.point(editor, editor.selection);\n  focusEditor(editor, point);\n};\nexport const changeFillBackgroundColor = (editor, background_color) => {\n  Transforms.setNodes(editor, {\n    style: {\n      background_color\n    }\n  }, {\n    match: n => n.type === CALL_OUT\n  });\n  Transforms.select(editor, Editor.start(editor, editor.selection));\n};\nexport const setCalloutIcon = (editor, icon_name) => {\n  Transforms.setNodes(editor, {\n    callout_icon: icon_name\n  }, {\n    match: n => n.type === CALL_OUT\n  });\n  Transforms.select(editor, Editor.start(editor, editor.selection));\n};\nexport const deleteCalloutIcon = editor => {\n  Transforms.setNodes(editor, {\n    callout_icon: ''\n  }, {\n    match: n => n.type === CALL_OUT\n  });\n  Transforms.select(editor, Editor.start(editor, editor.selection));\n};\n\n// Check is cursor in callout\nexport const getCalloutEntry = function (editor) {\n  let at = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : editor.selection;\n  const aboveNodeEntry = Editor.above(editor, {\n    match: n => n.type === CALL_OUT,\n    mode: 'highest',\n    at\n  });\n  return aboveNodeEntry;\n};\nexport const isCalloutContentEmpty = calloutEntry => {\n  const [calloutNode] = calloutEntry;\n  const contentString = Node.string(calloutNode);\n  const calloutChildren = calloutNode.children;\n  const isSingleParagraph = calloutChildren.length === 1 && calloutChildren[0].type === PARAGRAPH;\n  const isEmptyContent = contentString.length === 0;\n  return isSingleParagraph && isEmptyContent;\n};\n\n// Insert a new element at new line in callout after current path\nexport const insertElementAtNewLineInCallout = (editor, type, currentPath) => {\n  const element = generateEmptyElement(type);\n  const insertPath = Path.next(currentPath);\n  Transforms.insertNodes(editor, element, {\n    at: insertPath\n  });\n  Transforms.select(editor, insertPath);\n};"],"mappings":";AAAA,SAASA,MAAM,EAAEC,IAAI,EAAEC,IAAI,EAAEC,UAAU,QAAQ,gBAAgB;AAC/D,SAASC,QAAQ,EAAEC,SAAS,QAAQ,8BAA8B;AAClE,SAASC,WAAW,EAAEC,oBAAoB,EAAEC,gBAAgB,EAAEC,mBAAmB,QAAQ,YAAY;AACrG,SAASC,4BAA4B,EAAEC,iBAAiB,QAAQ,YAAY;AAC5E,OAAO,IAAMC,YAAY,GAAG,SAAfA,YAAYA,CAAGC,MAAM,EAAI;EACpC,IACEC,SAAS,GACPD,MAAM,CADRC,SAAS;EAEX,IAAI,CAACA,SAAS,EAAE,OAAO,KAAK;EAC5B,IAAMC,eAAe,GAAG,CAAC,CAACC,eAAe,CAACH,MAAM,CAAC;EACjD,IAAIE,eAAe,EAAE,OAAO,IAAI;EAChC,OAAO,KAAK;AACd,CAAC;AACD,OAAO,IAAME,cAAc,GAAG,SAAjBA,cAAcA,CAAIJ,MAAM,EAAEK,QAAQ,EAAK;EAClD,IAAIA,QAAQ,EAAE,OAAO,IAAI;EACzB,IACEJ,SAAS,GACPD,MAAM,CADRC,SAAS;EAEX,IAAI,CAACA,SAAS,EAAE,OAAO,IAAI;EAC3B,IAAMK,gBAAgB,GAAGX,gBAAgB,CAACK,MAAM,CAAC;EACjD,IAAMO,kBAAkB,GAAGX,mBAAmB,CAACI,MAAM,CAAC;EACtD;EACA,IAAMQ,iCAAiC,GAAGF,gBAAgB,CAACG,MAAM,IAAIH,gBAAgB,CAACI,KAAK,CAAC,UAAAC,OAAO,EAAI;IACrG,IAAIA,OAAO,CAACC,IAAI,KAAKrB,QAAQ,IAAIgB,kBAAkB,EAAE,OAAO,KAAK;IACjE,OAAOV,4BAA4B,CAACgB,QAAQ,CAACF,OAAO,CAACC,IAAI,CAAC;EAC5D,CAAC,CAAC;EACF,IAAIJ,iCAAiC,EAAE,OAAO,KAAK;EACnD,OAAO,IAAI;AACb,CAAC;;AAED;AACA;AACA;AACA,OAAO,IAAMM,eAAe,GAAG,SAAlBA,eAAeA,CAAA,EAAe;EACzC,IAAIC,gBAAgB,GAAGC,SAAS,CAACP,MAAM,GAAG,CAAC,IAAIO,SAAS,CAAC,CAAC,CAAC,KAAKC,SAAS,GAAGD,SAAS,CAAC,CAAC,CAAC,GAAGE,MAAM,CAACC,IAAI,CAACrB,iBAAiB,CAAC,CAAC,CAAC,CAAC;EAC5H,IAAMsB,KAAK,GAAG;IACZC,KAAK,EAAE;MACLN,gBAAgB,EAAhBA;IACF;EACF,CAAC;EACD,IAAMO,OAAO,GAAG5B,oBAAoB,CAACH,QAAQ,EAAE6B,KAAK,CAAC;EACrDE,OAAO,CAACC,QAAQ,GAAG,EAAE;EACrB,OAAOD,OAAO;AAChB,CAAC;AACD,OAAO,IAAME,WAAW,GAAG,SAAdA,WAAWA,CAAGxB,MAAM,EAAI;EACnC,IACEC,SAAS,GACPD,MAAM,CADRC,SAAS;EAEX,IAAI,CAACA,SAAS,EAAE;EAChB,IAAMqB,OAAO,GAAGR,eAAe,CAAC,CAAC;EACjCxB,UAAU,CAACmC,SAAS,CAACzB,MAAM,EAAEsB,OAAO,EAAE;IACpCI,IAAI,EAAE;EACR,CAAC,CAAC;EACFjC,WAAW,CAACO,MAAM,CAAC;AACrB,CAAC;AACD,OAAO,IAAM2B,aAAa,GAAG,SAAhBA,aAAaA,CAAG3B,MAAM,EAAI;EACrC,IACEC,SAAS,GACPD,MAAM,CADRC,SAAS;EAEX,IAAI,CAACA,SAAS,EAAE;EAChB,IAAM2B,cAAc,GAAGzC,MAAM,CAAC0C,KAAK,CAAC7B,MAAM,EAAE;IAC1C8B,KAAK,EAAE,SAAAA,MAAAC,CAAC;MAAA,OAAIA,CAAC,CAACnB,IAAI,KAAKrB,QAAQ;IAAA;EACjC,CAAC,CAAC;EACF,IAAI,CAACqC,cAAc,EAAE;EACrB,IAAAI,eAAA,GAAAC,cAAA,CAAwBL,cAAc;IAA7BM,WAAW,GAAAF,eAAA;EACpB1C,UAAU,CAAC6C,WAAW,CAACnC,MAAM,EAAE;IAC7BoC,EAAE,EAAEF,WAAW;IACfJ,KAAK,EAAE,SAAAA,MAAAC,CAAC;MAAA,OAAIA,CAAC,CAACnB,IAAI,KAAKrB,QAAQ;IAAA;EACjC,CAAC,CAAC;EACF,IAAM8C,KAAK,GAAGlD,MAAM,CAACkD,KAAK,CAACrC,MAAM,EAAEA,MAAM,CAACC,SAAS,CAAC;EACpDR,WAAW,CAACO,MAAM,EAAEqC,KAAK,CAAC;AAC5B,CAAC;AACD,OAAO,IAAMC,yBAAyB,GAAG,SAA5BA,yBAAyBA,CAAItC,MAAM,EAAEe,gBAAgB,EAAK;EACrEzB,UAAU,CAACiD,QAAQ,CAACvC,MAAM,EAAE;IAC1BqB,KAAK,EAAE;MACLN,gBAAgB,EAAhBA;IACF;EACF,CAAC,EAAE;IACDe,KAAK,EAAE,SAAAA,MAAAC,CAAC;MAAA,OAAIA,CAAC,CAACnB,IAAI,KAAKrB,QAAQ;IAAA;EACjC,CAAC,CAAC;EACFD,UAAU,CAACkD,MAAM,CAACxC,MAAM,EAAEb,MAAM,CAACsD,KAAK,CAACzC,MAAM,EAAEA,MAAM,CAACC,SAAS,CAAC,CAAC;AACnE,CAAC;AACD,OAAO,IAAMyC,cAAc,GAAG,SAAjBA,cAAcA,CAAI1C,MAAM,EAAE2C,SAAS,EAAK;EACnDrD,UAAU,CAACiD,QAAQ,CAACvC,MAAM,EAAE;IAC1B4C,YAAY,EAAED;EAChB,CAAC,EAAE;IACDb,KAAK,EAAE,SAAAA,MAAAC,CAAC;MAAA,OAAIA,CAAC,CAACnB,IAAI,KAAKrB,QAAQ;IAAA;EACjC,CAAC,CAAC;EACFD,UAAU,CAACkD,MAAM,CAACxC,MAAM,EAAEb,MAAM,CAACsD,KAAK,CAACzC,MAAM,EAAEA,MAAM,CAACC,SAAS,CAAC,CAAC;AACnE,CAAC;AACD,OAAO,IAAM4C,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAG7C,MAAM,EAAI;EACzCV,UAAU,CAACiD,QAAQ,CAACvC,MAAM,EAAE;IAC1B4C,YAAY,EAAE;EAChB,CAAC,EAAE;IACDd,KAAK,EAAE,SAAAA,MAAAC,CAAC;MAAA,OAAIA,CAAC,CAACnB,IAAI,KAAKrB,QAAQ;IAAA;EACjC,CAAC,CAAC;EACFD,UAAU,CAACkD,MAAM,CAACxC,MAAM,EAAEb,MAAM,CAACsD,KAAK,CAACzC,MAAM,EAAEA,MAAM,CAACC,SAAS,CAAC,CAAC;AACnE,CAAC;;AAED;AACA,OAAO,IAAME,eAAe,GAAG,SAAlBA,eAAeA,CAAaH,MAAM,EAAE;EAC/C,IAAIoC,EAAE,GAAGpB,SAAS,CAACP,MAAM,GAAG,CAAC,IAAIO,SAAS,CAAC,CAAC,CAAC,KAAKC,SAAS,GAAGD,SAAS,CAAC,CAAC,CAAC,GAAGhB,MAAM,CAACC,SAAS;EAC7F,IAAM2B,cAAc,GAAGzC,MAAM,CAAC0C,KAAK,CAAC7B,MAAM,EAAE;IAC1C8B,KAAK,EAAE,SAAAA,MAAAC,CAAC;MAAA,OAAIA,CAAC,CAACnB,IAAI,KAAKrB,QAAQ;IAAA;IAC/BmC,IAAI,EAAE,SAAS;IACfU,EAAE,EAAFA;EACF,CAAC,CAAC;EACF,OAAOR,cAAc;AACvB,CAAC;AACD,OAAO,IAAMkB,qBAAqB,GAAG,SAAxBA,qBAAqBA,CAAGC,YAAY,EAAI;EACnD,IAAAC,aAAA,GAAAf,cAAA,CAAsBc,YAAY;IAA3BE,WAAW,GAAAD,aAAA;EAClB,IAAME,aAAa,GAAG9D,IAAI,CAAC+D,MAAM,CAACF,WAAW,CAAC;EAC9C,IAAMG,eAAe,GAAGH,WAAW,CAAC1B,QAAQ;EAC5C,IAAM8B,iBAAiB,GAAGD,eAAe,CAAC3C,MAAM,KAAK,CAAC,IAAI2C,eAAe,CAAC,CAAC,CAAC,CAACxC,IAAI,KAAKpB,SAAS;EAC/F,IAAM8D,cAAc,GAAGJ,aAAa,CAACzC,MAAM,KAAK,CAAC;EACjD,OAAO4C,iBAAiB,IAAIC,cAAc;AAC5C,CAAC;;AAED;AACA,OAAO,IAAMC,+BAA+B,GAAG,SAAlCA,+BAA+BA,CAAIvD,MAAM,EAAEY,IAAI,EAAE4C,WAAW,EAAK;EAC5E,IAAM7C,OAAO,GAAGjB,oBAAoB,CAACkB,IAAI,CAAC;EAC1C,IAAM6C,UAAU,GAAGpE,IAAI,CAACqE,IAAI,CAACF,WAAW,CAAC;EACzClE,UAAU,CAACqE,WAAW,CAAC3D,MAAM,EAAEW,OAAO,EAAE;IACtCyB,EAAE,EAAEqB;EACN,CAAC,CAAC;EACFnE,UAAU,CAACkD,MAAM,CAACxC,MAAM,EAAEyD,UAAU,CAAC;AACvC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}