{"ast":null,"code":"import _objectSpread from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _classCallCheck from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component,Fragment}from'react';import{Utils}from'../../../utils/utils';import{seafileAPI}from'../../../utils/seafile-api';import{gettext,mediaUrl,logoPath,orgID,orgEnableAdminCustomLogo,orgEnableAdminCustomName}from'../../../utils/constants';import Loading from'../../../components/loading';import toaster from'../../../components/toast';import MainPanelTopbar from'../main-panel-topbar';import Section from'./section';import InputItem from'./input-item';import FileItem from'./file-item';import'../../../css/system-admin-web-settings.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var OrgWebSettings=/*#__PURE__*/function(_Component){_inherits(OrgWebSettings,_Component);var _super=_createSuper(OrgWebSettings);function OrgWebSettings(props){var _this;_classCallCheck(this,OrgWebSettings);_this=_super.call(this,props);_this.updateName=function(key,newOrgName){seafileAPI.orgAdminUpdateName(orgID,newOrgName).then(function(res){_this.setState({config_dict:res.data});toaster.success(gettext('Success'));}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.updateLogo=function(file){seafileAPI.orgAdminUpdateLogo(orgID,file).then(function(res){_this.setState({logoPath:res.data.logo_path});toaster.success(gettext('Success'));}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.updateFileExtWhiteList=function(key,value){seafileAPI.orgAdminSetSysSettingInfo(orgID,key,value).then(function(res){_this.setState({file_ext_white_list:res.data.file_ext_white_list});toaster.success(gettext('Success'));}).catch(function(error){var errMessage=Utils.getErrorMsg(error);toaster.danger(errMessage);});};_this.state={loading:true,errorMsg:'',config_dict:null,logoPath:logoPath,file_ext_white_list:''};return _this;}_createClass(OrgWebSettings,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;seafileAPI.orgAdminGetOrgInfo().then(function(res){_this2.setState({loading:false,config_dict:res.data,file_ext_white_list:res.data.file_ext_white_list});}).catch(function(error){_this2.setState({loading:false,errorMsg:Utils.getErrorMsg(error,true)// true: show login tip if 403\n});});}},{key:\"render\",value:function render(){var _this$state=this.state,loading=_this$state.loading,errorMsg=_this$state.errorMsg,config_dict=_this$state.config_dict,file_ext_white_list=_this$state.file_ext_white_list;var logoPath=this.state.logoPath;logoPath=logoPath.indexOf('image-view')!=-1?logoPath:mediaUrl+logoPath;return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MainPanelTopbar,_objectSpread({},this.props)),/*#__PURE__*/_jsx(\"div\",{className:\"main-panel-center flex-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"cur-view-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cur-view-path\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"sf-heading\",children:gettext('Settings')})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cur-view-content container mw-100\",children:[loading&&/*#__PURE__*/_jsx(Loading,{}),errorMsg&&/*#__PURE__*/_jsx(\"p\",{className:\"error text-center mt-4\",children:errorMsg}),!loading&&!errorMsg&&config_dict&&/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"small text-secondary my-4\"}),/*#__PURE__*/_jsx(Section,{headingText:gettext('Info'),children:/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(InputItem,{saveSetting:this.updateName,displayName:gettext('Team name'),keyText:\"orgName\",value:config_dict['org_name'],helpTip:'',disabled:!orgEnableAdminCustomName}),orgEnableAdminCustomLogo&&/*#__PURE__*/_jsx(FileItem,{postFile:this.updateLogo,displayName:\"Logo\",keyText:\"Logo\",filePath:logoPath,fileWidth:256,fileHeight:64,helpTip:\"logo.png, 256px * 64px\"})]})}),/*#__PURE__*/_jsx(Section,{headingText:gettext('File Upload'),children:/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsx(InputItem,{saveSetting:this.updateFileExtWhiteList,displayName:gettext('File extension white list'),keyText:\"file_ext_white_list\",value:file_ext_white_list,helpTip:gettext('File extension white list for file upload via web UI and API. For example, \"md;txt;docx\". Empty means no limit.')})})})]})]})]})})]});}}]);return OrgWebSettings;}(Component);export default OrgWebSettings;","map":{"version":3,"names":["React","Component","Fragment","Utils","seafileAPI","gettext","mediaUrl","logoPath","orgID","orgEnableAdminCustomLogo","orgEnableAdminCustomName","Loading","toaster","MainPanelTopbar","Section","InputItem","FileItem","jsx","_jsx","jsxs","_jsxs","OrgWebSettings","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","updateName","key","newOrgName","orgAdminUpdateName","then","res","setState","config_dict","data","success","catch","error","errMessage","getErrorMsg","danger","updateLogo","file","orgAdminUpdateLogo","logo_path","updateFileExtWhiteList","value","orgAdminSetSysSettingInfo","file_ext_white_list","state","loading","errorMsg","_createClass","componentDidMount","_this2","orgAdminGetOrgInfo","render","_this$state","indexOf","children","_objectSpread","className","headingText","saveSetting","displayName","keyText","helpTip","disabled","postFile","filePath","fileWidth","fileHeight"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/org-admin/web-settings/web-settings.js"],"sourcesContent":["import React, { Component, Fragment } from 'react';\nimport { Utils } from '../../../utils/utils';\nimport { seafileAPI } from '../../../utils/seafile-api';\nimport { gettext, mediaUrl, logoPath, orgID, orgEnableAdminCustomLogo, orgEnableAdminCustomName } from '../../../utils/constants';\nimport Loading from '../../../components/loading';\nimport toaster from '../../../components/toast';\nimport MainPanelTopbar from '../main-panel-topbar';\nimport Section from './section';\nimport InputItem from './input-item';\nimport FileItem from './file-item';\n\nimport '../../../css/system-admin-web-settings.css';\n\nclass OrgWebSettings extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading: true,\n      errorMsg: '',\n      config_dict: null,\n      logoPath: logoPath,\n      file_ext_white_list: '',\n    };\n  }\n\n  componentDidMount () {\n    seafileAPI.orgAdminGetOrgInfo().then((res) => {\n      this.setState({\n        loading: false,\n        config_dict: res.data,\n        file_ext_white_list: res.data.file_ext_white_list\n      });\n    }).catch((error) => {\n      this.setState({\n        loading: false,\n        errorMsg: Utils.getErrorMsg(error, true) // true: show login tip if 403\n      });\n    });\n  }\n\n  updateName= (key, newOrgName) => {\n    seafileAPI.orgAdminUpdateName(orgID, newOrgName).then((res) => {\n      this.setState({\n        config_dict: res.data\n      });\n      toaster.success(gettext('Success'));\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  updateLogo = (file) => {\n    seafileAPI.orgAdminUpdateLogo(orgID, file).then((res) => {\n      this.setState({\n        logoPath: res.data.logo_path\n      });\n      toaster.success(gettext('Success'));\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  updateFileExtWhiteList = (key, value) => {\n    seafileAPI.orgAdminSetSysSettingInfo(orgID, key, value).then((res) => {\n      this.setState({\n        file_ext_white_list: res.data.file_ext_white_list\n      });\n      toaster.success(gettext('Success'));\n    }).catch((error) => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  render() {\n    const { loading, errorMsg, config_dict, file_ext_white_list } = this.state;\n    let logoPath = this.state.logoPath;\n    logoPath = logoPath.indexOf('image-view') != -1 ? logoPath : mediaUrl + logoPath;\n    return (\n      <Fragment>\n        <MainPanelTopbar {...this.props} />\n        <div className=\"main-panel-center flex-row\">\n          <div className=\"cur-view-container\">\n            <div className=\"cur-view-path\">\n              <h3 className=\"sf-heading\">{gettext('Settings')}</h3>\n            </div>\n            <div className=\"cur-view-content container mw-100\">\n              {loading && <Loading />}\n              {errorMsg && <p className=\"error text-center mt-4\">{errorMsg}</p>}\n              {(!loading && !errorMsg) && config_dict &&\n              <Fragment>\n                <p className=\"small text-secondary my-4\"></p>\n\n                <Section headingText={gettext('Info')}>\n                  <Fragment>\n                    <InputItem\n                      saveSetting={this.updateName}\n                      displayName={gettext('Team name')}\n                      keyText='orgName'\n                      value={config_dict['org_name']}\n                      helpTip={''}\n                      disabled={!orgEnableAdminCustomName}\n                    />\n                    { orgEnableAdminCustomLogo && <FileItem\n                      postFile={this.updateLogo}\n                      displayName='Logo'\n                      keyText='Logo'\n                      filePath={logoPath}\n                      fileWidth={256}\n                      fileHeight={64}\n                      helpTip='logo.png, 256px * 64px'\n                    />\n                    }\n                  </Fragment>\n                </Section>\n                <Section headingText={gettext('File Upload')}>\n                  <Fragment>\n                    <InputItem\n                      saveSetting={this.updateFileExtWhiteList}\n                      displayName={gettext('File extension white list')}\n                      keyText='file_ext_white_list'\n                      value={file_ext_white_list}\n                      helpTip={gettext('File extension white list for file upload via web UI and API. For example, \"md;txt;docx\". Empty means no limit.')}\n                    />\n                  </Fragment>\n                </Section>\n              </Fragment>\n              }\n            </div>\n          </div>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nexport default OrgWebSettings;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}