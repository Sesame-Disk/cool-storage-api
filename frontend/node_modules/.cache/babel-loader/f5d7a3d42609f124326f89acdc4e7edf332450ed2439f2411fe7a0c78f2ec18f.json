{"ast":null,"code":"import _slicedToArray from \"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { withTranslation } from 'react-i18next';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap';\nimport printJS from '@seafile/print-js';\nimport { EventBus } from '../../basic-sdk';\nimport { EXTERNAL_EVENT } from '../../constants';\nimport context from '../../context';\nimport { INTERNAL_EVENT } from '../../basic-sdk/constants';\nimport MenuShortcutPrompt from '../../basic-sdk/extension/commons/menu-shortcut-indicator';\nvar MoreOperations = function MoreOperations(_ref) {\n  var t = _ref.t;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isDropdownOpen = _useState2[0],\n    setIsDropdownOpen = _useState2[1];\n  var parentFolderURL = context.getSetting('parentFolderURL');\n  var isPro = context.getSetting('isPro');\n  var isFreezed = context.getSetting('isFreezed');\n  var docPerm = context.getSetting('docPerm');\n  var historyURL = context.getSetting('historyURL');\n  var isSdocRevision = context.getSetting('isSdocRevision');\n  var cssUrls = context.getPrintCss();\n  useEffect(function () {\n    var eventBus = EventBus.getInstance();\n    var unSubscribe = eventBus.subscribe(INTERNAL_EVENT.ON_PRINT, handlePrint);\n    return function () {\n      unSubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var toggleDropdown = useCallback(function (isDropdownOpen) {\n    setIsDropdownOpen(!isDropdownOpen);\n  }, []);\n  var handlePrint = useCallback(function () {\n    printJS({\n      printable: 'sdoc-editor',\n      type: 'html',\n      scanStyles: true,\n      targetStyles: ['*'],\n      style: '@page { size: auto A4 landscape;margin:20px auto; padding: 0;} .d-print-none{display:none !important;}',\n      css: cssUrls\n    });\n  }, [cssUrls]);\n  var onFreezeDocument = useCallback(function () {\n    var eventBus = EventBus.getInstance();\n    eventBus.dispatch(EXTERNAL_EVENT.FREEZE_DOCUMENT);\n  }, []);\n  var unFreeze = useCallback(function () {\n    var eventBus = EventBus.getInstance();\n    eventBus.dispatch(EXTERNAL_EVENT.UNFREEZE);\n  }, []);\n  var handleClickHistory = useCallback(function (event) {\n    if (docPerm !== 'rw' || !historyURL) return;\n    if (isSdocRevision) return;\n    event.stopPropagation();\n    event.nativeEvent.stopImmediatePropagation();\n    window.location.href = historyURL;\n  }, [docPerm, historyURL, isSdocRevision]);\n  var printShortCutTexts = useMemo(function () {\n    // chrome in Mac: \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n    var isMac = window.navigator.userAgent.indexOf('Macintosh') !== -1;\n    var printTexts = isMac ? ['⌘', 'P'] : ['Ctrl', 'P'];\n    return printTexts;\n  }, []);\n  return /*#__PURE__*/React.createElement(Dropdown, {\n    className: \"sdoc-operator-folder\",\n    isOpen: isDropdownOpen,\n    toggle: function toggle() {\n      return toggleDropdown(isDropdownOpen);\n    }\n  }, /*#__PURE__*/React.createElement(DropdownToggle, {\n    className: \"op-item\",\n    tag: \"span\"\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-more\"\n  })), /*#__PURE__*/React.createElement(DropdownMenu, {\n    className: \"sdoc-dropdown-menu\",\n    right: true\n  }, /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: handlePrint\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-dropdown-print-container\"\n  }, /*#__PURE__*/React.createElement(\"div\", null, t('Print')), /*#__PURE__*/React.createElement(MenuShortcutPrompt, {\n    shortcuts: printShortCutTexts\n  }))), isPro && isFreezed && /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: unFreeze\n  }, t('Unfreeze')), isPro && !isFreezed && /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: onFreezeDocument\n  }, t('Freeze_document')), /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: handleClickHistory\n  }, t('Document_history')), parentFolderURL && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-operator-folder-divider\"\n  }), /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    tag: \"a\",\n    href: parentFolderURL\n  }, t('Open_parent_folder')))));\n};\nexport default withTranslation('sdoc-editor')(MoreOperations);","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","withTranslation","Dropdown","DropdownToggle","DropdownMenu","DropdownItem","printJS","EventBus","EXTERNAL_EVENT","context","INTERNAL_EVENT","MenuShortcutPrompt","MoreOperations","_ref","t","_useState","_useState2","_slicedToArray","isDropdownOpen","setIsDropdownOpen","parentFolderURL","getSetting","isPro","isFreezed","docPerm","historyURL","isSdocRevision","cssUrls","getPrintCss","eventBus","getInstance","unSubscribe","subscribe","ON_PRINT","handlePrint","toggleDropdown","printable","type","scanStyles","targetStyles","style","css","onFreezeDocument","dispatch","FREEZE_DOCUMENT","unFreeze","UNFREEZE","handleClickHistory","event","stopPropagation","nativeEvent","stopImmediatePropagation","window","location","href","printShortCutTexts","isMac","navigator","userAgent","indexOf","printTexts","createElement","className","isOpen","toggle","tag","right","onClick","shortcuts","Fragment"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@seafile/sdoc-editor/dist/components/doc-operations/more-operations.js"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { withTranslation } from 'react-i18next';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap';\nimport printJS from '@seafile/print-js';\nimport { EventBus } from '../../basic-sdk';\nimport { EXTERNAL_EVENT } from '../../constants';\nimport context from '../../context';\nimport { INTERNAL_EVENT } from '../../basic-sdk/constants';\nimport MenuShortcutPrompt from '../../basic-sdk/extension/commons/menu-shortcut-indicator';\nconst MoreOperations = _ref => {\n  let {\n    t\n  } = _ref;\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n  const parentFolderURL = context.getSetting('parentFolderURL');\n  const isPro = context.getSetting('isPro');\n  const isFreezed = context.getSetting('isFreezed');\n  const docPerm = context.getSetting('docPerm');\n  const historyURL = context.getSetting('historyURL');\n  const isSdocRevision = context.getSetting('isSdocRevision');\n  const cssUrls = context.getPrintCss();\n  useEffect(() => {\n    const eventBus = EventBus.getInstance();\n    const unSubscribe = eventBus.subscribe(INTERNAL_EVENT.ON_PRINT, handlePrint);\n    return () => {\n      unSubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const toggleDropdown = useCallback(isDropdownOpen => {\n    setIsDropdownOpen(!isDropdownOpen);\n  }, []);\n  const handlePrint = useCallback(() => {\n    printJS({\n      printable: 'sdoc-editor',\n      type: 'html',\n      scanStyles: true,\n      targetStyles: ['*'],\n      style: '@page { size: auto A4 landscape;margin:20px auto; padding: 0;} .d-print-none{display:none !important;}',\n      css: cssUrls\n    });\n  }, [cssUrls]);\n  const onFreezeDocument = useCallback(() => {\n    const eventBus = EventBus.getInstance();\n    eventBus.dispatch(EXTERNAL_EVENT.FREEZE_DOCUMENT);\n  }, []);\n  const unFreeze = useCallback(() => {\n    const eventBus = EventBus.getInstance();\n    eventBus.dispatch(EXTERNAL_EVENT.UNFREEZE);\n  }, []);\n  const handleClickHistory = useCallback(event => {\n    if (docPerm !== 'rw' || !historyURL) return;\n    if (isSdocRevision) return;\n    event.stopPropagation();\n    event.nativeEvent.stopImmediatePropagation();\n    window.location.href = historyURL;\n  }, [docPerm, historyURL, isSdocRevision]);\n  const printShortCutTexts = useMemo(() => {\n    // chrome in Mac: \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n    const isMac = window.navigator.userAgent.indexOf('Macintosh') !== -1;\n    const printTexts = isMac ? ['⌘', 'P'] : ['Ctrl', 'P'];\n    return printTexts;\n  }, []);\n  return /*#__PURE__*/React.createElement(Dropdown, {\n    className: \"sdoc-operator-folder\",\n    isOpen: isDropdownOpen,\n    toggle: () => toggleDropdown(isDropdownOpen)\n  }, /*#__PURE__*/React.createElement(DropdownToggle, {\n    className: \"op-item\",\n    tag: \"span\"\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"sdocfont sdoc-more\"\n  })), /*#__PURE__*/React.createElement(DropdownMenu, {\n    className: \"sdoc-dropdown-menu\",\n    right: true\n  }, /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: handlePrint\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-dropdown-print-container\"\n  }, /*#__PURE__*/React.createElement(\"div\", null, t('Print')), /*#__PURE__*/React.createElement(MenuShortcutPrompt, {\n    shortcuts: printShortCutTexts\n  }))), isPro && isFreezed && /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: unFreeze\n  }, t('Unfreeze')), isPro && !isFreezed && /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: onFreezeDocument\n  }, t('Freeze_document')), /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    onClick: handleClickHistory\n  }, t('Document_history')), parentFolderURL && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sdoc-operator-folder-divider\"\n  }), /*#__PURE__*/React.createElement(DropdownItem, {\n    className: \"sdoc-dropdown-menu-item\",\n    tag: \"a\",\n    href: parentFolderURL\n  }, t('Open_parent_folder')))));\n};\nexport default withTranslation('sdoc-editor')(MoreOperations);"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}