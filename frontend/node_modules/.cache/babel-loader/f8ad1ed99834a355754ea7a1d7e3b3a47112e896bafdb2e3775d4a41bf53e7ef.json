{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{seafileAPI}from'../../utils/seafile-api';import{Utils}from'../../utils/utils';var initFavicon=function initFavicon(fileName){var fileIcon=Utils.getFileIconUrl(fileName,192);document.getElementById('favicon').href=fileIcon;};var getFileInfo=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(repoID,filePath){var fileInfoRes,_fileInfoRes$data,mtime,size,starred,permission,lastModifier,id;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return seafileAPI.getFileInfo(repoID,filePath);case 2:fileInfoRes=_context.sent;_fileInfoRes$data=fileInfoRes.data,mtime=_fileInfoRes$data.mtime,size=_fileInfoRes$data.size,starred=_fileInfoRes$data.starred,permission=_fileInfoRes$data.permission,lastModifier=_fileInfoRes$data.last_modifier_name,id=_fileInfoRes$data.id;return _context.abrupt(\"return\",{mtime:mtime,size:size,starred:starred,permission:permission,lastModifier:lastModifier,id:id});case 5:case\"end\":return _context.stop();}},_callee);}));return function getFileInfo(_x,_x2){return _ref.apply(this,arguments);};}();var getFileDownloadUrl=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(repoID,filePath){var fileDownloadUrlRes,downloadUrl;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return seafileAPI.getFileDownloadLink(repoID,filePath);case 2:fileDownloadUrlRes=_context2.sent;downloadUrl=fileDownloadUrlRes.data;return _context2.abrupt(\"return\",downloadUrl);case 5:case\"end\":return _context2.stop();}},_callee2);}));return function getFileDownloadUrl(_x3,_x4){return _ref2.apply(this,arguments);};}();var setPermission=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(permission,repoID){var hasPermission,permissionID,customPermissionRes,customPermission,canModify;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:hasPermission=permission==='rw'||permission==='cloud-edit';// get custom permission\nif(!permission.startsWith('custom-')){_context3.next=9;break;}permissionID=permission.split('-')[1];_context3.next=5;return seafileAPI.getCustomPermission(repoID,permissionID);case 5:customPermissionRes=_context3.sent;customPermission=customPermissionRes.data.permission;canModify=customPermission.permission.modify;hasPermission=canModify?true:hasPermission;case 9:return _context3.abrupt(\"return\",hasPermission);case 10:case\"end\":return _context3.stop();}},_callee3);}));return function setPermission(_x5,_x6){return _ref3.apply(this,arguments);};}();var setFileContent=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(downloadUrl){var fileContentRes,markdownContent;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.next=2;return seafileAPI.getFileContent(downloadUrl);case 2:fileContentRes=_context4.sent;markdownContent=fileContentRes.data;return _context4.abrupt(\"return\",markdownContent);case 5:case\"end\":return _context4.stop();}},_callee4);}));return function setFileContent(_x7){return _ref4.apply(this,arguments);};}();export var getPlainOptions=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(_ref5){var fileName,filePath,repoID,fileInfo,downloadUrl,markdownContent,hasPermission;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:fileName=_ref5.fileName,filePath=_ref5.filePath,repoID=_ref5.repoID;initFavicon(fileName);_context5.next=4;return getFileInfo(repoID,filePath);case 4:fileInfo=_context5.sent;_context5.next=7;return getFileDownloadUrl(repoID,filePath);case 7:downloadUrl=_context5.sent;_context5.next=10;return setFileContent(downloadUrl);case 10:markdownContent=_context5.sent;_context5.next=13;return setPermission(fileInfo.permission,repoID);case 13:hasPermission=_context5.sent;return _context5.abrupt(\"return\",{markdownContent:markdownContent,hasPermission:hasPermission,fileInfo:fileInfo});case 15:case\"end\":return _context5.stop();}},_callee5);}));return function getPlainOptions(_x8){return _ref6.apply(this,arguments);};}();","map":{"version":3,"names":["seafileAPI","Utils","initFavicon","fileName","fileIcon","getFileIconUrl","document","getElementById","href","getFileInfo","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","repoID","filePath","fileInfoRes","_fileInfoRes$data","mtime","size","starred","permission","lastModifier","id","wrap","_callee$","_context","prev","next","sent","data","last_modifier_name","abrupt","stop","_x","_x2","apply","arguments","getFileDownloadUrl","_ref2","_callee2","fileDownloadUrlRes","downloadUrl","_callee2$","_context2","getFileDownloadLink","_x3","_x4","setPermission","_ref3","_callee3","hasPermission","permissionID","customPermissionRes","customPermission","canModify","_callee3$","_context3","startsWith","split","getCustomPermission","modify","_x5","_x6","setFileContent","_ref4","_callee4","fileContentRes","markdownContent","_callee4$","_context4","getFileContent","_x7","getPlainOptions","_ref6","_callee5","_ref5","fileInfo","_callee5$","_context5","_x8"],"sources":["/Users/abel/Documents/Code-Experiments/cool-storage-api/frontend/src/pages/plain-markdown-editor/helper.js"],"sourcesContent":["import { seafileAPI } from '../../utils/seafile-api';\nimport { Utils } from '../../utils/utils';\n\nconst initFavicon = (fileName) => {\n  const fileIcon = Utils.getFileIconUrl(fileName, 192);\n  document.getElementById('favicon').href = fileIcon;\n};\n\nconst getFileInfo = async (repoID, filePath) => {\n  const fileInfoRes = await seafileAPI.getFileInfo(repoID, filePath);\n  const { mtime, size, starred, permission, last_modifier_name: lastModifier, id } = fileInfoRes.data;\n  return { mtime, size, starred, permission, lastModifier, id };\n};\n\nconst getFileDownloadUrl = async (repoID, filePath) => {\n  const fileDownloadUrlRes = await seafileAPI.getFileDownloadLink(repoID, filePath);\n  const downloadUrl = fileDownloadUrlRes.data;\n  return downloadUrl;\n};\n\nconst setPermission = async (permission, repoID) => {\n  let hasPermission = permission === 'rw' || permission === 'cloud-edit';\n  // get custom permission\n  if (permission.startsWith('custom-')) {\n    const permissionID = permission.split('-')[1];\n    const customPermissionRes = await seafileAPI.getCustomPermission(repoID, permissionID);\n    const customPermission = customPermissionRes.data.permission;\n    const { modify: canModify } = customPermission.permission;\n    hasPermission = canModify ? true : hasPermission;\n  }\n  return hasPermission;\n};\n\nconst setFileContent = async (downloadUrl) => {\n  const fileContentRes = await seafileAPI.getFileContent(downloadUrl);\n  const markdownContent = fileContentRes.data;\n  return markdownContent;\n};\n\nexport const getPlainOptions = async ({ fileName, filePath, repoID }) => {\n  initFavicon(fileName);\n  const fileInfo = await getFileInfo(repoID, filePath);\n  const downloadUrl = await getFileDownloadUrl(repoID, filePath);\n  const markdownContent = await setFileContent(downloadUrl);\n  const hasPermission = await setPermission(fileInfo.permission, repoID);\n\n  return { markdownContent, hasPermission, fileInfo };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}